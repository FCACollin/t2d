<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.592">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Francois Collin">
<meta name="dcterms.date" content="2022-07-01">
<title>T2D: Exercise and Genetic Expression Profile - 6&nbsp; WGCNA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./t2d_07_mir.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">
<span class="chapter-number">6</span>&nbsp; <span class="chapter-title">WGCNA</span>
</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">T2D: Exercise and Genetic Expression Profile</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/FCACollin/t2d" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preamble</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_03_bds.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Missingness in adlb and advs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_08_dmg.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Demographics and Baseline Anthropometrics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_09_chg.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Anthropometrics Changes From Baseline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_06_rna.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">RNASeq - Refresher</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_07_mir.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">mRNA / micro RNA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_11_wcn.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">WGCNA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#mrna-seq---wgcna" id="toc-mrna-seq---wgcna" class="nav-link active" data-scroll-target="#mrna-seq---wgcna"> <span class="header-section-number">6.1</span> mRNA Seq - WGCNA</a>
  <ul class="collapse">
<li><a href="#materials-and-methods" id="toc-materials-and-methods" class="nav-link" data-scroll-target="#materials-and-methods"> <span class="header-section-number">6.1.1</span> Materials and Methods</a></li>
  <li><a href="#sample-clustering" id="toc-sample-clustering" class="nav-link" data-scroll-target="#sample-clustering"> <span class="header-section-number">6.1.2</span> Sample clustering</a></li>
  <li><a href="#soft-threshold-determination" id="toc-soft-threshold-determination" class="nav-link" data-scroll-target="#soft-threshold-determination"> <span class="header-section-number">6.1.3</span> Soft threshold determination</a></li>
  <li><a href="#gene-clustering" id="toc-gene-clustering" class="nav-link" data-scroll-target="#gene-clustering"> <span class="header-section-number">6.1.4</span> Gene clustering</a></li>
  </ul>
</li>
  <li><a href="#session-informations" id="toc-session-informations" class="nav-link" data-scroll-target="#session-informations"> <span class="header-section-number">6.2</span> Session Informations</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/FCACollin/t2d/edit/main/t2d_11_wcn.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">
<span class="chapter-number">6</span>&nbsp; <span class="chapter-title">WGCNA</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Program 11</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Francois Collin </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 1, 2022</p>
    </div>
  </div>
    
  </div>
  

</header><section id="mrna-seq---wgcna" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="mrna-seq---wgcna">
<span class="header-section-number">6.1</span> mRNA Seq - WGCNA</h2>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">cfg_prog</span> <span class="op">&lt;-</span> <span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/read_yaml.html">read_yaml</a></span><span class="op">(</span><span class="st">"_prog.yml"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html">load_all</a></span><span class="op">(</span><span class="st">"src/pkg/dbs.data"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>ℹ Loading dbs.data</code></pre>
</div>
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html">load_all</a></span><span class="op">(</span><span class="st">"src/pkg/latarnia.utils"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>ℹ Loading latarnia.utils</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: grid</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: shiny</code></pre>
</div>
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>results <span class="op">=</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">knitr</span><span class="op">$</span><span class="va">results</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"R/ngs.R"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"R/inches.R"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The analysis was realized with R <span class="citation" data-cites="RCT2022">(v4.2.0, <a href="references.html#ref-RCT2022" role="doc-biblioref">R Core Team 2022</a>)</span>. Note the use of the additional packages downloaded from the RStudio package manager repository (freeze date 2022-05-04, <a href="https://packagemanager.rstudio.com/all/2022-05-04+Y3JhbiwyOjQ1MjYyMTU7NTVFQjhGODU">repos</a>):</p>
<ul>
<li>
<code>DESeq2</code> for differential expression analysis and variance stabilizing transformation <span class="citation" data-cites="Love2014">(version 1.36.0, <a href="references.html#ref-Love2014" role="doc-biblioref">Love, Huber, and Anders 2014</a>)</span>
</li>
</ul>
<section id="materials-and-methods" class="level3" data-number="6.1.1"><h3 data-number="6.1.1" class="anchored" data-anchor-id="materials-and-methods">
<span class="header-section-number">6.1.1</span> Materials and Methods</h3>
<section id="helper-functions" class="level4" data-number="6.1.1.1"><h4 data-number="6.1.1.1" class="anchored" data-anchor-id="helper-functions">
<span class="header-section-number">6.1.1.1</span> Helper functions</h4>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># Help for data pre-processing</span>
<span class="va">filter_for_depth</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span>, <span class="va">assay</span>, <span class="va">depth_threshold</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">mae</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">mae</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">depth_threshold</span>, <span class="op">]</span>
<span class="op">}</span>

<span class="va">filter_for_visit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span>, <span class="va">visit</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">mae</span><span class="op">[</span>, <span class="fu">colData</span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">avisit</span> <span class="op">==</span> <span class="va">visit</span>, <span class="op">]</span>
<span class="op">}</span>

<span class="va">filter_for_low_expr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span>, <span class="va">assay</span>, <span class="va">cpm_threshold</span>,
                                <span class="va">frac_cols</span> <span class="op">=</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">rna</span><span class="op">$</span><span class="va">cpm_threshold</span><span class="op">$</span><span class="va">fraccol</span>
<span class="op">)</span> <span class="op">{</span>
  <span class="co"># Genes expressed at least cpm_threshold in frac_cols columns</span>
  <span class="va">mae</span><span class="op">[</span>
    <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu">cpm</span><span class="op">(</span><span class="va">mae</span><span class="op">[[</span><span class="va">assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">cpm_threshold</span><span class="op">)</span> <span class="op">&gt;</span>
      <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">mae</span><span class="op">[[</span><span class="va">assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">frac_cols</span>,
    ,
  <span class="op">]</span>
<span class="op">}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="data-preparation" class="level4" data-number="6.1.1.2"><h4 data-number="6.1.1.2" class="anchored" data-anchor-id="data-preparation">
<span class="header-section-number">6.1.1.2</span> Data preparation</h4>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">adsl</span>
<span class="va">advs</span> <span class="op">&lt;-</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">advs</span>
<span class="va">adlb</span> <span class="op">&lt;-</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">adlb</span>

<span class="co">#' Subjid and Visit to Sample</span>
<span class="co">#' </span>
<span class="va">subjvis_to_spl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">subjid</span>, <span class="st">"v"</span>, <span class="va">df</span><span class="op">$</span><span class="va">avisitn</span><span class="op">)</span>

<span class="va">ads</span> <span class="op">&lt;-</span> <span class="va">adlb</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">advs</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ct</span>, <span class="va">dtype</span>, <span class="va">param</span>, <span class="va">base</span>, <span class="va">basetype</span>, <span class="va">chg</span>, <span class="va">pchg</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"paramcd"</span>, values_from <span class="op">=</span> <span class="st">"aval"</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">adsl</span>, y <span class="op">=</span> _, by <span class="op">=</span> <span class="st">"subjid"</span><span class="op">)</span> |&gt;
  <span class="op">(</span>\<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu">S4Vectors</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html">DataFrame</a></span><span class="op">(</span><span class="va">df</span>, row.names <span class="op">=</span> <span class="fu">subjvis_to_spl</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">subjid</span>, <span class="va">diabcd</span>, <span class="va">diab</span>, <span class="va">avisitn</span>, <span class="va">avisit</span>, <span class="va">GLU120</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="op">(</span>\<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">assertthat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertthat/man/assert_that.html">assert_that</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu">subjvis_to_spl</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
    <span class="va">df</span>
  <span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="op">)</span>

<span class="va">ads</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">rna</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  mrna <span class="op">=</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">mrna_raw</span>,
  premirna <span class="op">=</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">premirna_raw</span>,
  mirna <span class="op">=</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">mirna_raw</span>
<span class="op">)</span>

<span class="va">rna</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"premirna"</span>, <span class="st">"mirna"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>
  X <span class="op">=</span> <span class="va">rna</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"premirna"</span>, <span class="st">"mirna"</span><span class="op">)</span><span class="op">]</span>,
  FUN <span class="op">=</span> <span class="va">format_mirna</span>
<span class="op">)</span>

<span class="co"># Rows represent genes</span>
<span class="va">rna</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">rna</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">]</span><span class="op">)</span>
<span class="va">rna</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">rna</span>, <span class="va">as.matrix</span><span class="op">)</span>
<span class="fu">assertthat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertthat/man/assert_that.html">assert_that</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">rna</span><span class="op">$</span><span class="va">premirna</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">rna</span><span class="op">$</span><span class="va">mirna</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">rna</span><span class="op">$</span><span class="va">allmirna</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">rna</span><span class="op">$</span><span class="va">premirna</span>, <span class="va">rna</span><span class="op">$</span><span class="va">mirna</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org">testthat</a></span><span class="op">)</span>
<span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"rna features discriminated in noexpr, expr"</span>, <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">rna</span>, FUN <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html">expect_true</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://waldronlab.io/MultiAssayExperiment/">MultiAssayExperiment</a></span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Loading required package: SummarizedExperiment</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MatrixGenerics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: matrixStats</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MatrixGenerics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:matrixStats':

    colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse,
    colCounts, colCummaxs, colCummins, colCumprods, colCumsums,
    colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs,
    colMads, colMaxs, colMeans2, colMedians, colMins, colOrderStats,
    colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds,
    colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads,
    colWeightedMeans, colWeightedMedians, colWeightedSds,
    colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet,
    rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods,
    rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,
    rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins,
    rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks,
    rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars,
    rowWeightedMads, rowWeightedMeans, rowWeightedMedians,
    rowWeightedSds, rowWeightedVars</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: GenomicRanges</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: stats4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: BiocGenerics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'BiocGenerics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    IQR, mad, sd, var, xtabs</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    anyDuplicated, append, as.data.frame, basename, cbind, colnames,
    dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep,
    grepl, intersect, is.unsorted, lapply, Map, mapply, match, mget,
    order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,
    rbind, Reduce, rownames, sapply, setdiff, sort, table, tapply,
    union, unique, unsplit, which.max, which.min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: S4Vectors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'S4Vectors'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    expand.grid, I, unname</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: IRanges</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: GenomeInfoDb</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Biobase</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome to Bioconductor

    Vignettes contain introductory material; view with
    'browseVignettes()'. To cite Bioconductor, see
    'citation("Biobase")', and for packages 'citation("pkgname")'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Biobase'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:MatrixGenerics':

    rowMedians</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:matrixStats':

    anyMissing, rowMedians</code></pre>
</div>
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co">#' (Sample-)Map Arrays</span>
<span class="co">#'</span>
<span class="co">#' Use the column names of `x` to deduce the `primary` and `colnames`.</span>
<span class="co">#' This is used to generate the sample mapping between colData and Experiments.</span>
<span class="co">#'</span>
<span class="co">#' @param x (`dataframe`).</span>
<span class="co">#'</span>
<span class="co">#' @note In our case, primary and colnames are equivalent, colnames could</span>
<span class="co">#' be different from primary names when a biological sample has different</span>
<span class="co">#' names in the biological assays (e.g. machine constraint, technical</span>
<span class="co">#' repetitions).</span>
<span class="co">#'</span>
<span class="co">#' @seealso [MultiAssayExperiment::listToMap()]</span>
<span class="co">#' @examples</span>
<span class="co">#' \dontrun{</span>
<span class="co">#'   lapply(rna, map_arrays)</span>
<span class="co">#'   MultiAssayExperiment::listToMap(lapply(rna, map_arrays))</span>
<span class="co">#' }</span>
<span class="co">#'</span>
<span class="va">map_arrays</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>colname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
  <span class="va">y</span><span class="op">$</span><span class="va">primary</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">$</span><span class="va">colname</span>
  <span class="va">y</span>
<span class="op">}</span>

<span class="va">besd_mae</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/MultiAssayExperiment.html">MultiAssayExperiment</a></span><span class="op">(</span>
  experiments <span class="op">=</span> <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/ExperimentList.html">ExperimentList</a></span><span class="op">(</span><span class="va">rna</span><span class="op">)</span>,
  colData <span class="op">=</span> <span class="va">ads</span>,
  sampleMap <span class="op">=</span> <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/mapToList.html">listToMap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">rna</span>, <span class="va">map_arrays</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">besd_mae</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co">#' # https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/FemaleLiver-01-dataInput.pdf</span>
<span class="co">#' # WGCNA: gene in rows, sample in cols</span>

<span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">rna</span>
<span class="va">ngs_assay</span> <span class="op">&lt;-</span> <span class="st">"allmirna"</span>
<span class="va">dta</span> <span class="op">&lt;-</span> <span class="va">besd_mae</span> |&gt;
  <span class="op">(</span>\<span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="va">mae</span><span class="op">[</span> , , <span class="va">ngs_assay</span><span class="op">]</span><span class="op">)</span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu">filter_for_depth</span><span class="op">(</span><span class="va">ngs_assay</span>, <span class="va">ctrl</span><span class="op">$</span><span class="va">depth_threshold</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> |&gt;
  <span class="fu">filter_for_visit</span><span class="op">(</span><span class="st">"Baseline"</span><span class="op">)</span> |&gt;
  <span class="fu">filter_for_low_expr</span><span class="op">(</span><span class="va">ngs_assay</span>, <span class="va">ctrl</span><span class="op">$</span><span class="va">cpm_threshold</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> |&gt;
  <span class="op">(</span>\<span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">mae</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span>
      <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/DESeqDataSet.html">DESeqDataSetFromMatrix</a></span><span class="op">(</span>
        countData <span class="op">=</span> <span class="va">mae</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span>,
        colData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mae</span><span class="op">)</span>,
        design <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="op">~</span> <span class="va">diabcd</span><span class="op">)</span>
      <span class="op">)</span> |&gt;
      <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/varianceStabilizingTransformation.html">varianceStabilizingTransformation</a></span><span class="op">(</span>blind <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> |&gt;
      <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">assay</a></span><span class="op">(</span><span class="op">)</span>
    <span class="va">mae</span>
  <span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: 'experiments' dropped; see 'metadata'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>harmonizing input:
  removing 282 sampleMap rows not in names(experiments)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- note: fitType='parametric', but the dispersion trend was not well captured by the
   function: y = a/x + b, and a local regression fit was automatically substituted.
   specify fitType='local' or 'mean' to avoid this message next time.</code></pre>
</div>
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co">#' WGCNA Expression data.</span>
<span class="co">#'</span>
<span class="co">#' A matrix or data frame in which columns are genes and rows ar samples.</span>
<span class="co">#'</span>
<span class="va">dta_expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">dta</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="fu">assert_that</span><span class="op">(</span><span class="fu">WGCNA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/goodSamplesGenes.html">goodSamplesGenes</a></span><span class="op">(</span><span class="va">dta_expr</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">$</span><span class="va">allOK</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
</div>
</section></section><section id="sample-clustering" class="level3" data-number="6.1.2"><h3 data-number="6.1.2" class="anchored" data-anchor-id="sample-clustering">
<span class="header-section-number">6.1.2</span> Sample clustering</h3>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">spl_clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">dta_expr</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span>

<span class="co"># Clustering Dendrogram of samples based on their Euclidean distance</span>
<span class="va">theme_custom</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/theme_dendro.html">theme_dendro</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
      plot.margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="st">"null"</span><span class="op">)</span>,
      panel.spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="st">"null"</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>
<span class="op">}</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/andrie/ggdendro">ggdendro</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="va">dend</span> <span class="op">&lt;-</span> <span class="va">spl_clust</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html">as.dendrogram</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">lim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/nobs.html">nobs</a></span><span class="op">(</span><span class="va">dend</span><span class="op">)</span><span class="op">)</span>
<span class="va">ddata</span> <span class="op">&lt;-</span> <span class="fu">ggdendro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/dendro_data.html">dendro_data</a></span><span class="op">(</span><span class="va">dend</span>, type <span class="op">=</span> <span class="st">"rectangle"</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggdendro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/segment.html">segment</a></span><span class="op">(</span><span class="va">ddata</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span>clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_reverse</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/nobs.html">nobs</a></span><span class="op">(</span><span class="va">dend</span><span class="op">)</span><span class="op">)</span>,
    labels <span class="op">=</span> <span class="fu">ggdendro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/segment.html">label</a></span><span class="op">(</span><span class="va">ddata</span><span class="op">)</span><span class="op">$</span><span class="va">label</span>,
    lim <span class="op">=</span> <span class="va">lim</span>,
    position <span class="op">=</span> <span class="st">"top"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_custom</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">dta_traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">dta</span><span class="op">)</span>
<span class="va">dta_traits</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">)</span>
<span class="va">dta_traits</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">$</span><span class="va">x</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span><span class="op">(</span><span class="va">dend</span><span class="op">)</span><span class="op">)</span>
<span class="va">dta_traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>
  <span class="va">dta_traits</span>,
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
    xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">1</span>,
    ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>,
    fill <span class="op">=</span> <span class="va">diabcd</span>
  <span class="op">)</span>
<span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">34</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"C"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, begin <span class="op">=</span> <span class="fl">.2</span>, end <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="va">lim</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_custom</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span>

<span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>
  <span class="va">dta_traits</span>,
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
    xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">1</span>,
    ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>,
    fill <span class="op">=</span> <span class="va">GLU120</span>
  <span class="op">)</span>
<span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">34</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="va">lim</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_custom</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span>

<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">egg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/egg/man/ggarrange.html">ggarrange</a></span><span class="op">(</span>
  <span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p4</span>,
  nrow <span class="op">=</span> <span class="fl">1</span>,
  widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,
  padding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"lines"</span><span class="op">)</span>,
  draw <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">clean_slate</span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu">add_title</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="st">"Figure xxx"</span>,
    <span class="fu">wrap_long_lines</span><span class="op">(</span>
      <span class="st">"Clustering dendrogram of samples based on their Euclidean distance
      and trait heatmap"</span>
    <span class="op">)</span>
  <span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">add_figure</span><span class="op">(</span><span class="va">p</span>, height <span class="op">=</span> <span class="fu">inches</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu">show_slate</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="soft-threshold-determination" class="level3" data-number="6.1.3"><h3 data-number="6.1.3" class="anchored" data-anchor-id="soft-threshold-determination">
<span class="header-section-number">6.1.3</span> Soft threshold determination</h3>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/">WGCNA</a></span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Loading required package: dynamicTreeCut</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: fastcluster</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'fastcluster'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    hclust</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'WGCNA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:IRanges':

    cor</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:S4Vectors':

    cor</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    cor</code></pre>
</div>
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/allowWGCNAThreads.html">enableWGCNAThreads</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">sft</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/pickSoftThreshold.html">pickSoftThreshold</a></span><span class="op">(</span>
  <span class="va">dta_expr</span>,
  powerVector <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">12</span>, to<span class="op">=</span><span class="fl">20</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
  verbose <span class="op">=</span> <span class="fl">0</span>
<span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="va">pwr</span> <span class="op">&lt;-</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">rna</span><span class="op">$</span><span class="va">wgcna</span><span class="op">$</span><span class="va">sft</span><span class="op">$</span><span class="va">allmirna</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>
  <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span>,
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
    <span class="va">Power</span>,
    <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span> <span class="op">*</span> <span class="va">SFT.R.sq</span>,
    label <span class="op">=</span> <span class="va">Power</span>,
    shape <span class="op">=</span> <span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span>
  <span class="op">)</span>
<span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">.9</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> |&gt; <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/subsetBy.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span>,
    vjust <span class="op">=</span> <span class="fl">0</span>, nudge_y <span class="op">=</span> <span class="fl">.025</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> |&gt; <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/subsetBy.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">Power</span>, yend <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> |&gt; <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/subsetBy.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, yend <span class="op">=</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span> <span class="op">*</span> <span class="va">SFT.R.sq</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span> <span class="op">=</span> <span class="fl">21</span>, <span class="st">"FALSE"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Soft Threshold (power)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Scale Free Topology Model Fit"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Scale independence"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>
  <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span>,
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Power</span>, <span class="va">mean.k.</span>, label <span class="op">=</span> <span class="va">Power</span>, shape <span class="op">=</span> <span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> |&gt; <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/subsetBy.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">Power</span>, yend <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> |&gt; <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/subsetBy.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, yend <span class="op">=</span> <span class="va">mean.k.</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> |&gt; <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/subsetBy.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span>,
    vjust <span class="op">=</span> <span class="fl">0</span>, hjust <span class="op">=</span> <span class="fl">0</span>, nudge_y <span class="op">=</span> <span class="fl">1</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span> <span class="op">=</span> <span class="fl">21</span>, <span class="st">"FALSE"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Soft Threshold (power)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Mean connectivity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Mean connectivity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">egg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/egg/man/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow <span class="op">=</span> <span class="fl">1</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">clean_slate</span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu">add_title</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="st">"Figure xxx"</span>,
    <span class="st">"Soft threshold determination"</span>
  <span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">add_figure</span><span class="op">(</span><span class="va">p</span>, width <span class="op">=</span> <span class="fu">inches</span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>, height <span class="op">=</span> <span class="fu">inches</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu">show_slate</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="gene-clustering" class="level3" data-number="6.1.4"><h3 data-number="6.1.4" class="anchored" data-anchor-id="gene-clustering">
<span class="header-section-number">6.1.4</span> Gene clustering</h3>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">pwr</span> <span class="op">&lt;-</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">rna</span><span class="op">$</span><span class="va">wgcna</span><span class="op">$</span><span class="va">sft</span><span class="op">$</span><span class="va">allmirna</span>
<span class="va">adjc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/adjacency.html">adjacency</a></span><span class="op">(</span><span class="va">dta_expr</span>, power <span class="op">=</span> <span class="va">pwr</span><span class="op">)</span>

<span class="co"># Turn adjacency into topological overlap</span>
<span class="va">tom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/TOMsimilarity.html">TOMsimilarity</a></span><span class="op">(</span><span class="va">adjc</span><span class="op">)</span>
<span class="va">diss_tom</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">tom</span>

<span class="va">gene_hc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fastcluster/man/hclust.html">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span><span class="op">(</span><span class="va">diss_tom</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span>

<span class="co"># We like large modules, so we set the minimum module size relatively high:</span>
<span class="va">minModuleSize</span> <span class="op">&lt;-</span> <span class="fl">30</span>

<span class="co"># Module identification using dynamic tree cut:</span>
<span class="va">dyn_mods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dynamicTreeCut/man/cutreeDynamic.html">cutreeDynamic</a></span><span class="op">(</span>
  dendro <span class="op">=</span> <span class="va">gene_hc</span>,
  distM <span class="op">=</span> <span class="va">diss_tom</span>,
  deepSplit <span class="op">=</span> <span class="fl">2</span>,
  pamRespectsDendro <span class="op">=</span> <span class="cn">FALSE</span>,
  minClusterSize <span class="op">=</span> <span class="va">minModuleSize</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dyn_mods</span><span class="op">)</span>

<span class="co"># Convert numeric lables into colors</span>
<span class="va">dyn_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/labels2colors.html">labels2colors</a></span><span class="op">(</span><span class="va">dyn_mods</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dyn_col</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># Plot the dendrogram and colors underneath</span>
<span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/plotDendroAndColors.html">plotDendroAndColors</a></span><span class="op">(</span>
  <span class="va">gene_hc</span>,
  <span class="va">dyn_col</span>,
  <span class="st">"Dynamic Tree Cut"</span>,
  dendroLabels <span class="op">=</span> <span class="cn">FALSE</span>, hang <span class="op">=</span> <span class="fl">0.03</span>,
  addGuide <span class="op">=</span> <span class="cn">TRUE</span>, guideHang <span class="op">=</span> <span class="fl">0.05</span>,
  main <span class="op">=</span> <span class="st">"Gene dendrogram and module colors"</span>
<span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="legacy" class="level4" data-number="6.1.4.1"><h4 data-number="6.1.4.1" class="anchored" data-anchor-id="legacy">
<span class="header-section-number">6.1.4.1</span> Legacy</h4>
</section><section id="data-preparation-1" class="level4" data-number="6.1.4.2"><h4 data-number="6.1.4.2" class="anchored" data-anchor-id="data-preparation-1">
<span class="header-section-number">6.1.4.2</span> Data preparation</h4>
</section></section></section><section id="session-informations" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="session-informations">
<span class="header-section-number">6.2</span> Session Informations</h2>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://r-lib.github.io/sessioninfo/reference/session_info.html">session_info</a></span><span class="op">(</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-Love2014" class="csl-entry" role="doc-biblioentry">
Love, Michael I., Wolfgang Huber, and Simon Anders. 2014. <span>“Moderated Estimation of Fold Change and Dispersion for RNA-Seq Data with DESeq2.”</span> <em>Genome Biology</em> 15: 550. <a href="https://doi.org/10.1186/s13059-014-0550-8">https://doi.org/10.1186/s13059-014-0550-8</a>.
</div>
<div id="ref-RCT2022" class="csl-entry" role="doc-biblioentry">
R Core Team. 2022. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
    } else {
      disableStylesheet(alternateStylesheets);
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="./t2d_07_mir.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">mRNA / micro RNA</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb57" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "WGCNA"</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> Program 11</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Francois Collin"</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.time(), '%Y-%m-%d')`"</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="an">always_allow_html:</span><span class="co"> true</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="fu">## mRNA Seq - WGCNA</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, cfg_prog}</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>cfg_prog <span class="ot">&lt;-</span> yaml<span class="sc">::</span><span class="fu">read_yaml</span>(<span class="st">"_prog.yml"</span>)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, settings}</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">"src/pkg/dbs.data"</span>)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">"src/pkg/latarnia.utils"</span>)</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">results =</span> cfg_prog<span class="sc">$</span>knitr<span class="sc">$</span>results)</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/ngs.R"</span>)</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/inches.R"</span>)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>The analysis was realized with R <span class="co">[</span><span class="ot">v4.2.0, @RCT2022</span><span class="co">]</span>. Note the</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>use of the additional packages downloaded from the RStudio package manager</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>repository (freeze date 2022-05-04, <span class="co">[</span><span class="ot">repos</span><span class="co">]</span>(</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>https://packagemanager.rstudio.com/all/2022-05-04+Y3JhbiwyOjQ1MjYyMTU7NTVFQjhGODU)):</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`DESeq2`</span> for differential expression analysis and</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>  variance stabilizing transformation <span class="co">[</span><span class="ot">version 1.36.0, @Love2014</span><span class="co">]</span></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a><span class="fu">### Materials and Methods</span></span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Helper functions</span></span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Help for data pre-processing</span></span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>filter_for_depth <span class="ot">&lt;-</span> <span class="cf">function</span>(mae, assay, depth_threshold) {</span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>  mae[, <span class="fu">colSums</span>(mae[[ngs_assay]]) <span class="sc">&gt;</span> depth_threshold, ]</span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>filter_for_visit <span class="ot">&lt;-</span> <span class="cf">function</span>(mae, visit) {</span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>  mae[, <span class="fu">colData</span>(mae)<span class="sc">$</span>avisit <span class="sc">==</span> visit, ]</span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a>filter_for_low_expr <span class="ot">&lt;-</span> <span class="cf">function</span>(mae, assay, cpm_threshold,</span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>                                <span class="at">frac_cols =</span> cfg_prog<span class="sc">$</span>rna<span class="sc">$</span>cpm_threshold<span class="sc">$</span>fraccol</span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Genes expressed at least cpm_threshold in frac_cols columns</span></span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a>  mae[</span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowSums</span>(<span class="fu">cpm</span>(mae[[assay]]) <span class="sc">&gt;</span> cpm_threshold) <span class="sc">&gt;</span></span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ncol</span>(mae[[assay]]) <span class="sc">*</span> frac_cols,</span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a>    ,</span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Data preparation</span></span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, ads}</span></span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a>adsl <span class="ot">&lt;-</span> dbs.data<span class="sc">::</span>adsl</span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a>advs <span class="ot">&lt;-</span> dbs.data<span class="sc">::</span>advs</span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a>adlb <span class="ot">&lt;-</span> dbs.data<span class="sc">::</span>adlb</span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a><span class="co">#' Subjid and Visit to Sample</span></span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a>subjvis_to_spl <span class="ot">&lt;-</span> <span class="cf">function</span>(df) <span class="fu">paste0</span>(df<span class="sc">$</span>subjid, <span class="st">"v"</span>, df<span class="sc">$</span>avisitn)</span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a>ads <span class="ot">&lt;-</span> adlb <span class="sc">|&gt;</span></span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(advs) <span class="sc">|&gt;</span></span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(ct, dtype, param, base, basetype, chg, pchg)) <span class="sc">|&gt;</span></span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"paramcd"</span>, <span class="at">values_from =</span> <span class="st">"aval"</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(adsl, <span class="at">y =</span> _, <span class="at">by =</span> <span class="st">"subjid"</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a>  (\(df) S4Vectors<span class="sc">::</span><span class="fu">DataFrame</span>(df, <span class="at">row.names =</span> <span class="fu">subjvis_to_spl</span>(df)))() <span class="sc">|&gt;</span></span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(subjid, diabcd, diab, avisitn, avisit, GLU120)) <span class="sc">|&gt;</span></span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a>  (\(df) {</span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a>    assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">all</span>(<span class="fu">table</span>(<span class="fu">subjvis_to_spl</span>(df)) <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb57-84"><a href="#cb57-84" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb57-85"><a href="#cb57-85" aria-hidden="true" tabindex="-1"></a>  })()</span>
<span id="cb57-86"><a href="#cb57-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-87"><a href="#cb57-87" aria-hidden="true" tabindex="-1"></a>ads</span>
<span id="cb57-88"><a href="#cb57-88" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-89"><a href="#cb57-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-90"><a href="#cb57-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, rna}</span></span>
<span id="cb57-91"><a href="#cb57-91" aria-hidden="true" tabindex="-1"></a>rna <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb57-92"><a href="#cb57-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">mrna =</span> dbs.data<span class="sc">::</span>mrna_raw,</span>
<span id="cb57-93"><a href="#cb57-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">premirna =</span> dbs.data<span class="sc">::</span>premirna_raw,</span>
<span id="cb57-94"><a href="#cb57-94" aria-hidden="true" tabindex="-1"></a>  <span class="at">mirna =</span> dbs.data<span class="sc">::</span>mirna_raw</span>
<span id="cb57-95"><a href="#cb57-95" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-96"><a href="#cb57-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-97"><a href="#cb57-97" aria-hidden="true" tabindex="-1"></a>rna[<span class="fu">c</span>(<span class="st">"premirna"</span>, <span class="st">"mirna"</span>)] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb57-98"><a href="#cb57-98" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> rna[<span class="fu">c</span>(<span class="st">"premirna"</span>, <span class="st">"mirna"</span>)],</span>
<span id="cb57-99"><a href="#cb57-99" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN =</span> format_mirna</span>
<span id="cb57-100"><a href="#cb57-100" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-101"><a href="#cb57-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-102"><a href="#cb57-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Rows represent genes</span></span>
<span id="cb57-103"><a href="#cb57-103" aria-hidden="true" tabindex="-1"></a>rna <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="at">X =</span> rna, <span class="at">FUN =</span> <span class="cf">function</span>(x) y <span class="ot">&lt;-</span> x[<span class="fu">rowSums</span>(x) <span class="sc">&gt;</span> <span class="dv">0</span>, ])</span>
<span id="cb57-104"><a href="#cb57-104" aria-hidden="true" tabindex="-1"></a>rna <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="at">X =</span> rna, as.matrix)</span>
<span id="cb57-105"><a href="#cb57-105" aria-hidden="true" tabindex="-1"></a>assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(rna<span class="sc">$</span>premirna) <span class="sc">==</span> <span class="fu">colnames</span>(rna<span class="sc">$</span>mirna)))</span>
<span id="cb57-106"><a href="#cb57-106" aria-hidden="true" tabindex="-1"></a>rna<span class="sc">$</span>allmirna <span class="ot">&lt;-</span> <span class="fu">rbind</span>(rna<span class="sc">$</span>premirna, rna<span class="sc">$</span>mirna)</span>
<span id="cb57-107"><a href="#cb57-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-108"><a href="#cb57-108" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb57-109"><a href="#cb57-109" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"rna features discriminated in noexpr, expr"</span>, {</span>
<span id="cb57-110"><a href="#cb57-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="at">X =</span> rna, <span class="at">FUN =</span> \(x) <span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">rowSums</span>(x) <span class="sc">&gt;</span> <span class="dv">0</span>)))</span>
<span id="cb57-111"><a href="#cb57-111" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb57-112"><a href="#cb57-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-113"><a href="#cb57-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-114"><a href="#cb57-114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, mae}</span></span>
<span id="cb57-115"><a href="#cb57-115" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MultiAssayExperiment)</span>
<span id="cb57-116"><a href="#cb57-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-117"><a href="#cb57-117" aria-hidden="true" tabindex="-1"></a><span class="co">#' (Sample-)Map Arrays</span></span>
<span id="cb57-118"><a href="#cb57-118" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-119"><a href="#cb57-119" aria-hidden="true" tabindex="-1"></a><span class="co">#' Use the column names of `x` to deduce the `primary` and `colnames`.</span></span>
<span id="cb57-120"><a href="#cb57-120" aria-hidden="true" tabindex="-1"></a><span class="co">#' This is used to generate the sample mapping between colData and Experiments.</span></span>
<span id="cb57-121"><a href="#cb57-121" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-122"><a href="#cb57-122" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param x (`dataframe`).</span></span>
<span id="cb57-123"><a href="#cb57-123" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-124"><a href="#cb57-124" aria-hidden="true" tabindex="-1"></a><span class="co">#' @note In our case, primary and colnames are equivalent, colnames could</span></span>
<span id="cb57-125"><a href="#cb57-125" aria-hidden="true" tabindex="-1"></a><span class="co">#' be different from primary names when a biological sample has different</span></span>
<span id="cb57-126"><a href="#cb57-126" aria-hidden="true" tabindex="-1"></a><span class="co">#' names in the biological assays (e.g. machine constraint, technical</span></span>
<span id="cb57-127"><a href="#cb57-127" aria-hidden="true" tabindex="-1"></a><span class="co">#' repetitions).</span></span>
<span id="cb57-128"><a href="#cb57-128" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-129"><a href="#cb57-129" aria-hidden="true" tabindex="-1"></a><span class="co">#' @seealso [MultiAssayExperiment::listToMap()]</span></span>
<span id="cb57-130"><a href="#cb57-130" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb57-131"><a href="#cb57-131" aria-hidden="true" tabindex="-1"></a><span class="co">#' \dontrun{</span></span>
<span id="cb57-132"><a href="#cb57-132" aria-hidden="true" tabindex="-1"></a><span class="co">#'   lapply(rna, map_arrays)</span></span>
<span id="cb57-133"><a href="#cb57-133" aria-hidden="true" tabindex="-1"></a><span class="co">#'   MultiAssayExperiment::listToMap(lapply(rna, map_arrays))</span></span>
<span id="cb57-134"><a href="#cb57-134" aria-hidden="true" tabindex="-1"></a><span class="co">#' }</span></span>
<span id="cb57-135"><a href="#cb57-135" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-136"><a href="#cb57-136" aria-hidden="true" tabindex="-1"></a>map_arrays <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb57-137"><a href="#cb57-137" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">colname =</span> <span class="fu">colnames</span>(x))</span>
<span id="cb57-138"><a href="#cb57-138" aria-hidden="true" tabindex="-1"></a>  y<span class="sc">$</span>primary <span class="ot">&lt;-</span> y<span class="sc">$</span>colname</span>
<span id="cb57-139"><a href="#cb57-139" aria-hidden="true" tabindex="-1"></a>  y</span>
<span id="cb57-140"><a href="#cb57-140" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-141"><a href="#cb57-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-142"><a href="#cb57-142" aria-hidden="true" tabindex="-1"></a>besd_mae <span class="ot">&lt;-</span> <span class="fu">MultiAssayExperiment</span>(</span>
<span id="cb57-143"><a href="#cb57-143" aria-hidden="true" tabindex="-1"></a>  <span class="at">experiments =</span> <span class="fu">ExperimentList</span>(rna),</span>
<span id="cb57-144"><a href="#cb57-144" aria-hidden="true" tabindex="-1"></a>  <span class="at">colData =</span> ads,</span>
<span id="cb57-145"><a href="#cb57-145" aria-hidden="true" tabindex="-1"></a>  <span class="at">sampleMap =</span> <span class="fu">listToMap</span>(<span class="fu">lapply</span>(rna, map_arrays))</span>
<span id="cb57-146"><a href="#cb57-146" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-147"><a href="#cb57-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-148"><a href="#cb57-148" aria-hidden="true" tabindex="-1"></a>besd_mae</span>
<span id="cb57-149"><a href="#cb57-149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-150"><a href="#cb57-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-151"><a href="#cb57-151" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filter, eval=TRUE}</span></span>
<span id="cb57-152"><a href="#cb57-152" aria-hidden="true" tabindex="-1"></a><span class="co">#' # https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/FemaleLiver-01-dataInput.pdf</span></span>
<span id="cb57-153"><a href="#cb57-153" aria-hidden="true" tabindex="-1"></a><span class="co">#' # WGCNA: gene in rows, sample in cols</span></span>
<span id="cb57-154"><a href="#cb57-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-155"><a href="#cb57-155" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> cfg_prog<span class="sc">$</span>rna</span>
<span id="cb57-156"><a href="#cb57-156" aria-hidden="true" tabindex="-1"></a>ngs_assay <span class="ot">&lt;-</span> <span class="st">"allmirna"</span></span>
<span id="cb57-157"><a href="#cb57-157" aria-hidden="true" tabindex="-1"></a>dta <span class="ot">&lt;-</span> besd_mae <span class="sc">|&gt;</span></span>
<span id="cb57-158"><a href="#cb57-158" aria-hidden="true" tabindex="-1"></a>  (\(mae) mae[ , , ngs_assay])() <span class="sc">|&gt;</span></span>
<span id="cb57-159"><a href="#cb57-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_for_depth</span>(ngs_assay, ctrl<span class="sc">$</span>depth_threshold[[ngs_assay]]) <span class="sc">|&gt;</span></span>
<span id="cb57-160"><a href="#cb57-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_for_visit</span>(<span class="st">"Baseline"</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-161"><a href="#cb57-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_for_low_expr</span>(ngs_assay, ctrl<span class="sc">$</span>cpm_threshold[[ngs_assay]]) <span class="sc">|&gt;</span></span>
<span id="cb57-162"><a href="#cb57-162" aria-hidden="true" tabindex="-1"></a>  (\(mae) {</span>
<span id="cb57-163"><a href="#cb57-163" aria-hidden="true" tabindex="-1"></a>    mae[[ngs_assay]] <span class="ot">&lt;-</span></span>
<span id="cb57-164"><a href="#cb57-164" aria-hidden="true" tabindex="-1"></a>      DESeq2<span class="sc">::</span><span class="fu">DESeqDataSetFromMatrix</span>(</span>
<span id="cb57-165"><a href="#cb57-165" aria-hidden="true" tabindex="-1"></a>        <span class="at">countData =</span> mae[[ngs_assay]],</span>
<span id="cb57-166"><a href="#cb57-166" aria-hidden="true" tabindex="-1"></a>        <span class="at">colData =</span> <span class="fu">colData</span>(<span class="at">x =</span> mae),</span>
<span id="cb57-167"><a href="#cb57-167" aria-hidden="true" tabindex="-1"></a>        <span class="at">design =</span> stats<span class="sc">::</span><span class="fu">formula</span>(<span class="sc">~</span> diabcd)</span>
<span id="cb57-168"><a href="#cb57-168" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb57-169"><a href="#cb57-169" aria-hidden="true" tabindex="-1"></a>      DESeq2<span class="sc">::</span><span class="fu">varianceStabilizingTransformation</span>(<span class="at">blind =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-170"><a href="#cb57-170" aria-hidden="true" tabindex="-1"></a>      SummarizedExperiment<span class="sc">::</span><span class="fu">assay</span>()</span>
<span id="cb57-171"><a href="#cb57-171" aria-hidden="true" tabindex="-1"></a>    mae</span>
<span id="cb57-172"><a href="#cb57-172" aria-hidden="true" tabindex="-1"></a>  })()</span>
<span id="cb57-173"><a href="#cb57-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-174"><a href="#cb57-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-175"><a href="#cb57-175" aria-hidden="true" tabindex="-1"></a><span class="co">#' WGCNA Expression data.</span></span>
<span id="cb57-176"><a href="#cb57-176" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-177"><a href="#cb57-177" aria-hidden="true" tabindex="-1"></a><span class="co">#' A matrix or data frame in which columns are genes and rows ar samples.</span></span>
<span id="cb57-178"><a href="#cb57-178" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-179"><a href="#cb57-179" aria-hidden="true" tabindex="-1"></a>dta_expr <span class="ot">&lt;-</span> <span class="fu">t</span>(dta[[ngs_assay]])</span>
<span id="cb57-180"><a href="#cb57-180" aria-hidden="true" tabindex="-1"></a><span class="fu">assert_that</span>(WGCNA<span class="sc">::</span><span class="fu">goodSamplesGenes</span>(dta_expr, <span class="at">verbose =</span> <span class="dv">0</span>)<span class="sc">$</span>allOK)</span>
<span id="cb57-181"><a href="#cb57-181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-182"><a href="#cb57-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-183"><a href="#cb57-183" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sample clustering</span></span>
<span id="cb57-184"><a href="#cb57-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-185"><a href="#cb57-185" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, sample_clustering, eval=TRUE}</span></span>
<span id="cb57-186"><a href="#cb57-186" aria-hidden="true" tabindex="-1"></a>spl_clust <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(dta_expr), <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb57-187"><a href="#cb57-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-188"><a href="#cb57-188" aria-hidden="true" tabindex="-1"></a><span class="co"># Clustering Dendrogram of samples based on their Euclidean distance</span></span>
<span id="cb57-189"><a href="#cb57-189" aria-hidden="true" tabindex="-1"></a>theme_custom <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb57-190"><a href="#cb57-190" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_dendro</span>() <span class="sc">+</span></span>
<span id="cb57-191"><a href="#cb57-191" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb57-192"><a href="#cb57-192" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="st">"null"</span>),</span>
<span id="cb57-193"><a href="#cb57-193" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="st">"null"</span>)</span>
<span id="cb57-194"><a href="#cb57-194" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb57-195"><a href="#cb57-195" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(...)</span>
<span id="cb57-196"><a href="#cb57-196" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-197"><a href="#cb57-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-198"><a href="#cb57-198" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdendro)</span>
<span id="cb57-199"><a href="#cb57-199" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb57-200"><a href="#cb57-200" aria-hidden="true" tabindex="-1"></a>dend <span class="ot">&lt;-</span> spl_clust <span class="sc">|&gt;</span> <span class="fu">as.dendrogram</span>()</span>
<span id="cb57-201"><a href="#cb57-201" aria-hidden="true" tabindex="-1"></a>lim <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">nobs</span>(dend))</span>
<span id="cb57-202"><a href="#cb57-202" aria-hidden="true" tabindex="-1"></a>ddata <span class="ot">&lt;-</span> ggdendro<span class="sc">::</span><span class="fu">dendro_data</span>(dend, <span class="at">type =</span> <span class="st">"rectangle"</span>)</span>
<span id="cb57-203"><a href="#cb57-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-204"><a href="#cb57-204" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(ggdendro<span class="sc">::</span><span class="fu">segment</span>(ddata)) <span class="sc">+</span></span>
<span id="cb57-205"><a href="#cb57-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb57-206"><a href="#cb57-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb57-207"><a href="#cb57-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb57-208"><a href="#cb57-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb57-209"><a href="#cb57-209" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq_len</span>(<span class="fu">nobs</span>(dend)),</span>
<span id="cb57-210"><a href="#cb57-210" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> ggdendro<span class="sc">::</span><span class="fu">label</span>(ddata)<span class="sc">$</span>label,</span>
<span id="cb57-211"><a href="#cb57-211" aria-hidden="true" tabindex="-1"></a>    <span class="at">lim =</span> lim,</span>
<span id="cb57-212"><a href="#cb57-212" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"top"</span></span>
<span id="cb57-213"><a href="#cb57-213" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-214"><a href="#cb57-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_custom</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>())</span>
<span id="cb57-215"><a href="#cb57-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-216"><a href="#cb57-216" aria-hidden="true" tabindex="-1"></a>dta_traits <span class="ot">&lt;-</span> <span class="fu">colData</span>(dta)</span>
<span id="cb57-217"><a href="#cb57-217" aria-hidden="true" tabindex="-1"></a>dta_traits<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">rownames</span>(dta_traits)</span>
<span id="cb57-218"><a href="#cb57-218" aria-hidden="true" tabindex="-1"></a>dta_traits<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">factor</span>(dta_traits<span class="sc">$</span>x, <span class="at">levels =</span> <span class="fu">labels</span>(dend))</span>
<span id="cb57-219"><a href="#cb57-219" aria-hidden="true" tabindex="-1"></a>dta_traits <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(dta_traits)</span>
<span id="cb57-220"><a href="#cb57-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-221"><a href="#cb57-221" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb57-222"><a href="#cb57-222" aria-hidden="true" tabindex="-1"></a>  dta_traits,</span>
<span id="cb57-223"><a href="#cb57-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb57-224"><a href="#cb57-224" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">1</span>,</span>
<span id="cb57-225"><a href="#cb57-225" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="fu">as.numeric</span>(x) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">ymax =</span> <span class="fu">as.numeric</span>(x) <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb57-226"><a href="#cb57-226" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> diabcd</span>
<span id="cb57-227"><a href="#cb57-227" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-228"><a href="#cb57-228" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb57-229"><a href="#cb57-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb57-230"><a href="#cb57-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">34</span>) <span class="sc">+</span></span>
<span id="cb57-231"><a href="#cb57-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb57-232"><a href="#cb57-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"C"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">begin =</span> .<span class="dv">2</span>, <span class="at">end =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb57-233"><a href="#cb57-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> lim) <span class="sc">+</span></span>
<span id="cb57-234"><a href="#cb57-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_custom</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb57-235"><a href="#cb57-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-236"><a href="#cb57-236" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb57-237"><a href="#cb57-237" aria-hidden="true" tabindex="-1"></a>  dta_traits,</span>
<span id="cb57-238"><a href="#cb57-238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb57-239"><a href="#cb57-239" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">1</span>,</span>
<span id="cb57-240"><a href="#cb57-240" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="fu">as.numeric</span>(x) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">ymax =</span> <span class="fu">as.numeric</span>(x) <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb57-241"><a href="#cb57-241" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> GLU120</span>
<span id="cb57-242"><a href="#cb57-242" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-243"><a href="#cb57-243" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb57-244"><a href="#cb57-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb57-245"><a href="#cb57-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">34</span>) <span class="sc">+</span></span>
<span id="cb57-246"><a href="#cb57-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb57-247"><a href="#cb57-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb57-248"><a href="#cb57-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> lim) <span class="sc">+</span></span>
<span id="cb57-249"><a href="#cb57-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_custom</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb57-250"><a href="#cb57-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-251"><a href="#cb57-251" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> egg<span class="sc">::</span><span class="fu">ggarrange</span>(</span>
<span id="cb57-252"><a href="#cb57-252" aria-hidden="true" tabindex="-1"></a>  p1, p2, p4,</span>
<span id="cb57-253"><a href="#cb57-253" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb57-254"><a href="#cb57-254" aria-hidden="true" tabindex="-1"></a>  <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb57-255"><a href="#cb57-255" aria-hidden="true" tabindex="-1"></a>  <span class="at">padding =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"lines"</span>),</span>
<span id="cb57-256"><a href="#cb57-256" aria-hidden="true" tabindex="-1"></a>  <span class="at">draw =</span> <span class="cn">FALSE</span></span>
<span id="cb57-257"><a href="#cb57-257" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-258"><a href="#cb57-258" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">clean_slate</span>() <span class="sc">|&gt;</span></span>
<span id="cb57-259"><a href="#cb57-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_title</span>(<span class="fu">c</span>(</span>
<span id="cb57-260"><a href="#cb57-260" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Figure xxx"</span>,</span>
<span id="cb57-261"><a href="#cb57-261" aria-hidden="true" tabindex="-1"></a>    <span class="fu">wrap_long_lines</span>(</span>
<span id="cb57-262"><a href="#cb57-262" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Clustering dendrogram of samples based on their Euclidean distance</span></span>
<span id="cb57-263"><a href="#cb57-263" aria-hidden="true" tabindex="-1"></a><span class="st">      and trait heatmap"</span></span>
<span id="cb57-264"><a href="#cb57-264" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-265"><a href="#cb57-265" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb57-266"><a href="#cb57-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_figure</span>(p, <span class="at">height =</span> <span class="fu">inches</span>(<span class="dv">5</span>))</span>
<span id="cb57-267"><a href="#cb57-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-268"><a href="#cb57-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-269"><a href="#cb57-269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb57-270"><a href="#cb57-270" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11.7</span></span>
<span id="cb57-271"><a href="#cb57-271" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8.3</span></span>
<span id="cb57-272"><a href="#cb57-272" aria-hidden="true" tabindex="-1"></a><span class="fu">show_slate</span>(p)</span>
<span id="cb57-273"><a href="#cb57-273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-274"><a href="#cb57-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-275"><a href="#cb57-275" aria-hidden="true" tabindex="-1"></a><span class="fu">### Soft threshold determination</span></span>
<span id="cb57-276"><a href="#cb57-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-279"><a href="#cb57-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-280"><a href="#cb57-280" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WGCNA)</span>
<span id="cb57-281"><a href="#cb57-281" aria-hidden="true" tabindex="-1"></a><span class="fu">enableWGCNAThreads</span>()</span>
<span id="cb57-282"><a href="#cb57-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-283"><a href="#cb57-283" aria-hidden="true" tabindex="-1"></a>sft <span class="ot">&lt;-</span> <span class="fu">pickSoftThreshold</span>(</span>
<span id="cb57-284"><a href="#cb57-284" aria-hidden="true" tabindex="-1"></a>  dta_expr,</span>
<span id="cb57-285"><a href="#cb57-285" aria-hidden="true" tabindex="-1"></a>  <span class="at">powerVector =</span> <span class="fu">c</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">12</span>, <span class="at">to=</span><span class="dv">20</span>, <span class="at">by=</span><span class="dv">2</span>)),</span>
<span id="cb57-286"><a href="#cb57-286" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span></span>
<span id="cb57-287"><a href="#cb57-287" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-288"><a href="#cb57-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-289"><a href="#cb57-289" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb57-290"><a href="#cb57-290" aria-hidden="true" tabindex="-1"></a>pwr <span class="ot">&lt;-</span> cfg_prog<span class="sc">$</span>rna<span class="sc">$</span>wgcna<span class="sc">$</span>sft<span class="sc">$</span>allmirna</span>
<span id="cb57-291"><a href="#cb57-291" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb57-292"><a href="#cb57-292" aria-hidden="true" tabindex="-1"></a>  sft<span class="sc">$</span>fitIndices,</span>
<span id="cb57-293"><a href="#cb57-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb57-294"><a href="#cb57-294" aria-hidden="true" tabindex="-1"></a>    Power,</span>
<span id="cb57-295"><a href="#cb57-295" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span> <span class="fu">sign</span>(slope) <span class="sc">*</span> SFT.R.sq,</span>
<span id="cb57-296"><a href="#cb57-296" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> Power,</span>
<span id="cb57-297"><a href="#cb57-297" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> Power <span class="sc">==</span> pwr</span>
<span id="cb57-298"><a href="#cb57-298" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-299"><a href="#cb57-299" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb57-300"><a href="#cb57-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">9</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb57-301"><a href="#cb57-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">lty =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb57-302"><a href="#cb57-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb57-303"><a href="#cb57-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb57-304"><a href="#cb57-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(</span>
<span id="cb57-305"><a href="#cb57-305" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sft<span class="sc">$</span>fitIndices <span class="sc">|&gt;</span> <span class="fu">subset</span>(Power <span class="sc">==</span> <span class="dv">5</span>),</span>
<span id="cb57-306"><a href="#cb57-306" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">nudge_y =</span> .<span class="dv">025</span></span>
<span id="cb57-307"><a href="#cb57-307" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-308"><a href="#cb57-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb57-309"><a href="#cb57-309" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sft<span class="sc">$</span>fitIndices <span class="sc">|&gt;</span> <span class="fu">subset</span>(Power <span class="sc">==</span> <span class="dv">5</span>),</span>
<span id="cb57-310"><a href="#cb57-310" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xend =</span> Power, <span class="at">yend =</span> <span class="dv">0</span>)</span>
<span id="cb57-311"><a href="#cb57-311" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-312"><a href="#cb57-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb57-313"><a href="#cb57-313" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sft<span class="sc">$</span>fitIndices <span class="sc">|&gt;</span> <span class="fu">subset</span>(Power <span class="sc">==</span> <span class="dv">5</span>),</span>
<span id="cb57-314"><a href="#cb57-314" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xend =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">yend =</span> <span class="sc">-</span> <span class="fu">sign</span>(slope) <span class="sc">*</span> SFT.R.sq)</span>
<span id="cb57-315"><a href="#cb57-315" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-316"><a href="#cb57-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb57-317"><a href="#cb57-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"TRUE"</span> <span class="ot">=</span> <span class="dv">21</span>, <span class="st">"FALSE"</span> <span class="ot">=</span> <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb57-318"><a href="#cb57-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb57-319"><a href="#cb57-319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Soft Threshold (power)"</span>) <span class="sc">+</span></span>
<span id="cb57-320"><a href="#cb57-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Scale Free Topology Model Fit"</span>) <span class="sc">+</span></span>
<span id="cb57-321"><a href="#cb57-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Scale independence"</span>) <span class="sc">+</span></span>
<span id="cb57-322"><a href="#cb57-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb57-323"><a href="#cb57-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb57-324"><a href="#cb57-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-325"><a href="#cb57-325" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb57-326"><a href="#cb57-326" aria-hidden="true" tabindex="-1"></a>  sft<span class="sc">$</span>fitIndices,</span>
<span id="cb57-327"><a href="#cb57-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(Power, mean.k., <span class="at">label =</span> Power, <span class="at">shape =</span> Power <span class="sc">==</span> pwr)) <span class="sc">+</span></span>
<span id="cb57-328"><a href="#cb57-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb57-329"><a href="#cb57-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb57-330"><a href="#cb57-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb57-331"><a href="#cb57-331" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sft<span class="sc">$</span>fitIndices <span class="sc">|&gt;</span> <span class="fu">subset</span>(Power <span class="sc">==</span> <span class="dv">5</span>),</span>
<span id="cb57-332"><a href="#cb57-332" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xend =</span> Power, <span class="at">yend =</span> <span class="dv">0</span>)</span>
<span id="cb57-333"><a href="#cb57-333" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-334"><a href="#cb57-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb57-335"><a href="#cb57-335" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sft<span class="sc">$</span>fitIndices <span class="sc">|&gt;</span> <span class="fu">subset</span>(Power <span class="sc">==</span> <span class="dv">5</span>),</span>
<span id="cb57-336"><a href="#cb57-336" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xend =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">yend =</span> mean.k.)</span>
<span id="cb57-337"><a href="#cb57-337" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-338"><a href="#cb57-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(</span>
<span id="cb57-339"><a href="#cb57-339" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sft<span class="sc">$</span>fitIndices <span class="sc">|&gt;</span> <span class="fu">subset</span>(Power <span class="sc">==</span> <span class="dv">5</span>),</span>
<span id="cb57-340"><a href="#cb57-340" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">nudge_y =</span> <span class="dv">1</span></span>
<span id="cb57-341"><a href="#cb57-341" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-342"><a href="#cb57-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb57-343"><a href="#cb57-343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"TRUE"</span> <span class="ot">=</span> <span class="dv">21</span>, <span class="st">"FALSE"</span> <span class="ot">=</span> <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb57-344"><a href="#cb57-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Soft Threshold (power)"</span>) <span class="sc">+</span></span>
<span id="cb57-345"><a href="#cb57-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Mean connectivity"</span>) <span class="sc">+</span></span>
<span id="cb57-346"><a href="#cb57-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Mean connectivity"</span>) <span class="sc">+</span></span>
<span id="cb57-347"><a href="#cb57-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb57-348"><a href="#cb57-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb57-349"><a href="#cb57-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-350"><a href="#cb57-350" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">draw =</span> <span class="cn">FALSE</span>)</span>
<span id="cb57-351"><a href="#cb57-351" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">clean_slate</span>() <span class="sc">|&gt;</span></span>
<span id="cb57-352"><a href="#cb57-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_title</span>(<span class="fu">c</span>(</span>
<span id="cb57-353"><a href="#cb57-353" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Figure xxx"</span>,</span>
<span id="cb57-354"><a href="#cb57-354" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Soft threshold determination"</span></span>
<span id="cb57-355"><a href="#cb57-355" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb57-356"><a href="#cb57-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_figure</span>(p, <span class="at">width =</span> <span class="fu">inches</span>(<span class="dv">6</span>), <span class="at">height =</span> <span class="fu">inches</span>(<span class="dv">3</span>))</span>
<span id="cb57-357"><a href="#cb57-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-358"><a href="#cb57-358" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-359"><a href="#cb57-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-360"><a href="#cb57-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-361"><a href="#cb57-361" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb57-362"><a href="#cb57-362" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11.7</span></span>
<span id="cb57-363"><a href="#cb57-363" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8.3</span></span>
<span id="cb57-364"><a href="#cb57-364" aria-hidden="true" tabindex="-1"></a><span class="fu">show_slate</span>(p)</span>
<span id="cb57-365"><a href="#cb57-365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-366"><a href="#cb57-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-367"><a href="#cb57-367" aria-hidden="true" tabindex="-1"></a><span class="fu">### Gene clustering</span></span>
<span id="cb57-368"><a href="#cb57-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-371"><a href="#cb57-371" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-372"><a href="#cb57-372" aria-hidden="true" tabindex="-1"></a>pwr <span class="ot">&lt;-</span> cfg_prog<span class="sc">$</span>rna<span class="sc">$</span>wgcna<span class="sc">$</span>sft<span class="sc">$</span>allmirna</span>
<span id="cb57-373"><a href="#cb57-373" aria-hidden="true" tabindex="-1"></a>adjc <span class="ot">&lt;-</span> <span class="fu">adjacency</span>(dta_expr, <span class="at">power =</span> pwr)</span>
<span id="cb57-374"><a href="#cb57-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-375"><a href="#cb57-375" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn adjacency into topological overlap</span></span>
<span id="cb57-376"><a href="#cb57-376" aria-hidden="true" tabindex="-1"></a>tom <span class="ot">&lt;-</span> <span class="fu">TOMsimilarity</span>(adjc)</span>
<span id="cb57-377"><a href="#cb57-377" aria-hidden="true" tabindex="-1"></a>diss_tom <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> tom</span>
<span id="cb57-378"><a href="#cb57-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-379"><a href="#cb57-379" aria-hidden="true" tabindex="-1"></a>gene_hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">as.dist</span>(diss_tom), <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb57-380"><a href="#cb57-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-381"><a href="#cb57-381" aria-hidden="true" tabindex="-1"></a><span class="co"># We like large modules, so we set the minimum module size relatively high:</span></span>
<span id="cb57-382"><a href="#cb57-382" aria-hidden="true" tabindex="-1"></a>minModuleSize <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb57-383"><a href="#cb57-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-384"><a href="#cb57-384" aria-hidden="true" tabindex="-1"></a><span class="co"># Module identification using dynamic tree cut:</span></span>
<span id="cb57-385"><a href="#cb57-385" aria-hidden="true" tabindex="-1"></a>dyn_mods <span class="ot">&lt;-</span> <span class="fu">cutreeDynamic</span>(</span>
<span id="cb57-386"><a href="#cb57-386" aria-hidden="true" tabindex="-1"></a>  <span class="at">dendro =</span> gene_hc,</span>
<span id="cb57-387"><a href="#cb57-387" aria-hidden="true" tabindex="-1"></a>  <span class="at">distM =</span> diss_tom,</span>
<span id="cb57-388"><a href="#cb57-388" aria-hidden="true" tabindex="-1"></a>  <span class="at">deepSplit =</span> <span class="dv">2</span>,</span>
<span id="cb57-389"><a href="#cb57-389" aria-hidden="true" tabindex="-1"></a>  <span class="at">pamRespectsDendro =</span> <span class="cn">FALSE</span>,</span>
<span id="cb57-390"><a href="#cb57-390" aria-hidden="true" tabindex="-1"></a>  <span class="at">minClusterSize =</span> minModuleSize</span>
<span id="cb57-391"><a href="#cb57-391" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-392"><a href="#cb57-392" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dyn_mods)</span>
<span id="cb57-393"><a href="#cb57-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-394"><a href="#cb57-394" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert numeric lables into colors</span></span>
<span id="cb57-395"><a href="#cb57-395" aria-hidden="true" tabindex="-1"></a>dyn_col <span class="ot">&lt;-</span> <span class="fu">labels2colors</span>(dyn_mods)</span>
<span id="cb57-396"><a href="#cb57-396" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dyn_col)</span>
<span id="cb57-397"><a href="#cb57-397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-398"><a href="#cb57-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-399"><a href="#cb57-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-400"><a href="#cb57-400" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb57-401"><a href="#cb57-401" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the dendrogram and colors underneath</span></span>
<span id="cb57-402"><a href="#cb57-402" aria-hidden="true" tabindex="-1"></a><span class="fu">plotDendroAndColors</span>(</span>
<span id="cb57-403"><a href="#cb57-403" aria-hidden="true" tabindex="-1"></a>  gene_hc,</span>
<span id="cb57-404"><a href="#cb57-404" aria-hidden="true" tabindex="-1"></a>  dyn_col,</span>
<span id="cb57-405"><a href="#cb57-405" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Dynamic Tree Cut"</span>,</span>
<span id="cb57-406"><a href="#cb57-406" aria-hidden="true" tabindex="-1"></a>  <span class="at">dendroLabels =</span> <span class="cn">FALSE</span>, <span class="at">hang =</span> <span class="fl">0.03</span>,</span>
<span id="cb57-407"><a href="#cb57-407" aria-hidden="true" tabindex="-1"></a>  <span class="at">addGuide =</span> <span class="cn">TRUE</span>, <span class="at">guideHang =</span> <span class="fl">0.05</span>,</span>
<span id="cb57-408"><a href="#cb57-408" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Gene dendrogram and module colors"</span></span>
<span id="cb57-409"><a href="#cb57-409" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-410"><a href="#cb57-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-411"><a href="#cb57-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-412"><a href="#cb57-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-413"><a href="#cb57-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-414"><a href="#cb57-414" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Legacy</span></span>
<span id="cb57-415"><a href="#cb57-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-416"><a href="#cb57-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, include=FALSE}</span></span>
<span id="cb57-417"><a href="#cb57-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-418"><a href="#cb57-418" aria-hidden="true" tabindex="-1"></a><span class="co">#' WGCNA Wrappers</span></span>
<span id="cb57-419"><a href="#cb57-419" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb57-420"><a href="#cb57-420" aria-hidden="true" tabindex="-1"></a><span class="co">#' Set of function for standardised pre/post processing of WGCNA results.</span></span>
<span id="cb57-421"><a href="#cb57-421" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-422"><a href="#cb57-422" aria-hidden="true" tabindex="-1"></a><span class="co">#' @name wrap_wgcna</span></span>
<span id="cb57-423"><a href="#cb57-423" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-424"><a href="#cb57-424" aria-hidden="true" tabindex="-1"></a><span class="cn">NULL</span></span>
<span id="cb57-425"><a href="#cb57-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-426"><a href="#cb57-426" aria-hidden="true" tabindex="-1"></a><span class="co">#' @describeIn wrap_wgcna sample dendrogram with trait color matrix.</span></span>
<span id="cb57-427"><a href="#cb57-427" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param x (`list`) suitable for `besd_wgcna`.</span></span>
<span id="cb57-428"><a href="#cb57-428" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb57-429"><a href="#cb57-429" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-430"><a href="#cb57-430" aria-hidden="true" tabindex="-1"></a>wrap_sample_dendro <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb57-431"><a href="#cb57-431" aria-hidden="true" tabindex="-1"></a>  trait_colors <span class="ot">&lt;-</span> WGCNA<span class="sc">::</span><span class="fu">numbers2colors</span>(x<span class="sc">$</span>traits)</span>
<span id="cb57-432"><a href="#cb57-432" aria-hidden="true" tabindex="-1"></a>  WGCNA<span class="sc">::</span><span class="fu">plotDendroAndColors</span>(</span>
<span id="cb57-433"><a href="#cb57-433" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>clust_ind, trait_colors,</span>
<span id="cb57-434"><a href="#cb57-434" aria-hidden="true" tabindex="-1"></a>    <span class="at">groupLabels =</span> <span class="fu">names</span>(x<span class="sc">$</span>traits)</span>
<span id="cb57-435"><a href="#cb57-435" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-436"><a href="#cb57-436" aria-hidden="true" tabindex="-1"></a>  graphics<span class="sc">::</span><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb57-437"><a href="#cb57-437" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-438"><a href="#cb57-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-439"><a href="#cb57-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-440"><a href="#cb57-440" aria-hidden="true" tabindex="-1"></a><span class="co">#' VST Norm</span></span>
<span id="cb57-441"><a href="#cb57-441" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-442"><a href="#cb57-442" aria-hidden="true" tabindex="-1"></a><span class="co">#' Feature count normalization.</span></span>
<span id="cb57-443"><a href="#cb57-443" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-444"><a href="#cb57-444" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param mae (`MultiAssayExperiment`)</span></span>
<span id="cb57-445"><a href="#cb57-445" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param assay (`character`)</span></span>
<span id="cb57-446"><a href="#cb57-446" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param adam (`list`)</span></span>
<span id="cb57-447"><a href="#cb57-447" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-448"><a href="#cb57-448" aria-hidden="true" tabindex="-1"></a><span class="co">#' @details The VST normalization stems from the differential expression</span></span>
<span id="cb57-449"><a href="#cb57-449" aria-hidden="true" tabindex="-1"></a><span class="co">#' object preparation so as to insure consistency of methods.</span></span>
<span id="cb57-450"><a href="#cb57-450" aria-hidden="true" tabindex="-1"></a><span class="co">#' The call to the adam datasets is necessary as `CHG` data were not included</span></span>
<span id="cb57-451"><a href="#cb57-451" aria-hidden="true" tabindex="-1"></a><span class="co">#' in the MAE (it would be possible to add it there but I wonder what would</span></span>
<span id="cb57-452"><a href="#cb57-452" aria-hidden="true" tabindex="-1"></a><span class="co">#' be the consequences in terms of analysis result of adding theme).</span></span>
<span id="cb57-453"><a href="#cb57-453" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-454"><a href="#cb57-454" aria-hidden="true" tabindex="-1"></a><span class="co">#' @note Initially prepared for WGCNA, it was evidenced it is more generally</span></span>
<span id="cb57-455"><a href="#cb57-455" aria-hidden="true" tabindex="-1"></a><span class="co">#' applied for a recurrent contrast (baseline data and training-induced</span></span>
<span id="cb57-456"><a href="#cb57-456" aria-hidden="true" tabindex="-1"></a><span class="co">#' variations.</span></span>
<span id="cb57-457"><a href="#cb57-457" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-458"><a href="#cb57-458" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return</span></span>
<span id="cb57-459"><a href="#cb57-459" aria-hidden="true" tabindex="-1"></a><span class="co">#' Every item of the list is a set of expression data and clinical</span></span>
<span id="cb57-460"><a href="#cb57-460" aria-hidden="true" tabindex="-1"></a><span class="co">#' parameters (aka traits).</span></span>
<span id="cb57-461"><a href="#cb57-461" aria-hidden="true" tabindex="-1"></a><span class="co">#' Item a: </span></span>
<span id="cb57-462"><a href="#cb57-462" aria-hidden="true" tabindex="-1"></a><span class="co">#' baseline feature expression and clinical parameter.</span></span>
<span id="cb57-463"><a href="#cb57-463" aria-hidden="true" tabindex="-1"></a><span class="co">#' Item b: </span></span>
<span id="cb57-464"><a href="#cb57-464" aria-hidden="true" tabindex="-1"></a><span class="co">#' training-induced expression variation profile across</span></span>
<span id="cb57-465"><a href="#cb57-465" aria-hidden="true" tabindex="-1"></a><span class="co">#' all samples (arm blind).</span></span>
<span id="cb57-466"><a href="#cb57-466" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-467"><a href="#cb57-467" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom stats reshape</span></span>
<span id="cb57-468"><a href="#cb57-468" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom SummarizedExperiment assay</span></span>
<span id="cb57-469"><a href="#cb57-469" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb57-470"><a href="#cb57-470" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-471"><a href="#cb57-471" aria-hidden="true" tabindex="-1"></a>vst_norm <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb57-472"><a href="#cb57-472" aria-hidden="true" tabindex="-1"></a>  mae,</span>
<span id="cb57-473"><a href="#cb57-473" aria-hidden="true" tabindex="-1"></a>  <span class="at">adam =</span> <span class="fu">list</span>(</span>
<span id="cb57-474"><a href="#cb57-474" aria-hidden="true" tabindex="-1"></a>    <span class="at">adsl =</span> adsl,</span>
<span id="cb57-475"><a href="#cb57-475" aria-hidden="true" tabindex="-1"></a>    <span class="at">adlb =</span> adlb,</span>
<span id="cb57-476"><a href="#cb57-476" aria-hidden="true" tabindex="-1"></a>    <span class="at">advs =</span> advs</span>
<span id="cb57-477"><a href="#cb57-477" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb57-478"><a href="#cb57-478" aria-hidden="true" tabindex="-1"></a>  <span class="at">assay =</span> <span class="fu">c</span>(<span class="st">"allmirna"</span>, <span class="st">"mrna"</span>)) { </span>
<span id="cb57-479"><a href="#cb57-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-480"><a href="#cb57-480" aria-hidden="true" tabindex="-1"></a>  assay <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(assay)</span>
<span id="cb57-481"><a href="#cb57-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-482"><a href="#cb57-482" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Expressions as in DE: the data preparation stems from the differential</span></span>
<span id="cb57-483"><a href="#cb57-483" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expression preparation function.</span></span>
<span id="cb57-484"><a href="#cb57-484" aria-hidden="true" tabindex="-1"></a>  data_as_de <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb57-485"><a href="#cb57-485" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> <span class="fu">setNames</span>(<span class="at">nm =</span> assay),</span>
<span id="cb57-486"><a href="#cb57-486" aria-hidden="true" tabindex="-1"></a>    <span class="at">mae =</span> mae,</span>
<span id="cb57-487"><a href="#cb57-487" aria-hidden="true" tabindex="-1"></a>    <span class="at">FUN =</span> <span class="cf">function</span>(x, mae) {</span>
<span id="cb57-488"><a href="#cb57-488" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lapply</span>(</span>
<span id="cb57-489"><a href="#cb57-489" aria-hidden="true" tabindex="-1"></a>        <span class="at">X =</span> <span class="fu">c</span>(<span class="at">Training_all =</span> <span class="fu">list</span>(</span>
<span id="cb57-490"><a href="#cb57-490" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="fu">levels</span>(MultiAssayExperiment<span class="sc">::</span><span class="fu">colData</span>(mae)<span class="sc">$</span>AVISIT), <span class="st">"no-arm"</span>)</span>
<span id="cb57-491"><a href="#cb57-491" aria-hidden="true" tabindex="-1"></a>            )),</span>
<span id="cb57-492"><a href="#cb57-492" aria-hidden="true" tabindex="-1"></a>        <span class="at">mae =</span> mae,</span>
<span id="cb57-493"><a href="#cb57-493" aria-hidden="true" tabindex="-1"></a>        <span class="at">assay =</span> x,</span>
<span id="cb57-494"><a href="#cb57-494" aria-hidden="true" tabindex="-1"></a>        <span class="at">control =</span> <span class="fu">control_rna</span>(<span class="at">verbose =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-495"><a href="#cb57-495" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> prepare_de</span>
<span id="cb57-496"><a href="#cb57-496" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb57-497"><a href="#cb57-497" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-498"><a href="#cb57-498" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-499"><a href="#cb57-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-500"><a href="#cb57-500" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Instead of model fit, get the vst transformed results.</span></span>
<span id="cb57-501"><a href="#cb57-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gc</span>(<span class="at">reset =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-502"><a href="#cb57-502" aria-hidden="true" tabindex="-1"></a>  get_vst <span class="ot">&lt;-</span> <span class="cf">function</span>(x, assay) {</span>
<span id="cb57-503"><a href="#cb57-503" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>vst <span class="ot">&lt;-</span> DESeq2<span class="sc">::</span><span class="fu">varianceStabilizingTransformation</span>(x<span class="sc">$</span>dds, <span class="at">blind =</span> <span class="cn">FALSE</span>)</span>
<span id="cb57-504"><a href="#cb57-504" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>mae[[assay]] <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">assay</span>(x<span class="sc">$</span>vst)</span>
<span id="cb57-505"><a href="#cb57-505" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb57-506"><a href="#cb57-506" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-507"><a href="#cb57-507" aria-hidden="true" tabindex="-1"></a>  vst <span class="ot">&lt;-</span> <span class="fu">get_vst</span>(<span class="at">x =</span> data_as_de[[assay]]<span class="sc">$</span>Training_all, <span class="at">assay =</span> assay)</span>
<span id="cb57-508"><a href="#cb57-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-509"><a href="#cb57-509" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb57-510"><a href="#cb57-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-511"><a href="#cb57-511" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First item</span></span>
<span id="cb57-512"><a href="#cb57-512" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> vst<span class="sc">$</span>mae</span>
<span id="cb57-513"><a href="#cb57-513" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> y[,</span>
<span id="cb57-514"><a href="#cb57-514" aria-hidden="true" tabindex="-1"></a>    MultiAssayExperiment<span class="sc">::</span><span class="fu">colData</span>(y)<span class="sc">$</span>AVISIT <span class="sc">==</span> <span class="st">"BASELINE"</span> <span class="sc">&amp;</span></span>
<span id="cb57-515"><a href="#cb57-515" aria-hidden="true" tabindex="-1"></a>      MultiAssayExperiment<span class="sc">::</span><span class="fu">colData</span>(y)<span class="sc">$</span>ARMCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"NGT"</span>, <span class="st">"T2D"</span>),</span>
<span id="cb57-516"><a href="#cb57-516" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb57-517"><a href="#cb57-517" aria-hidden="true" tabindex="-1"></a>  expr <span class="ot">&lt;-</span> <span class="fu">t</span>(y[[assay]])</span>
<span id="cb57-518"><a href="#cb57-518" aria-hidden="true" tabindex="-1"></a>  traits <span class="ot">&lt;-</span> MultiAssayExperiment<span class="sc">::</span><span class="fu">colData</span>(y)</span>
<span id="cb57-519"><a href="#cb57-519" aria-hidden="true" tabindex="-1"></a>  traits <span class="ot">&lt;-</span> traits[</span>
<span id="cb57-520"><a href="#cb57-520" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">colnames</span>(traits) <span class="sc">%in%</span></span>
<span id="cb57-521"><a href="#cb57-521" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb57-522"><a href="#cb57-522" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SUBJID"</span>, <span class="st">"AVISIT"</span>, <span class="st">"sample"</span>, <span class="st">"AVISITNUM"</span>, <span class="st">"USUBJID"</span>, <span class="st">"SEX"</span>, <span class="st">"ARM"</span>,</span>
<span id="cb57-523"><a href="#cb57-523" aria-hidden="true" tabindex="-1"></a>        <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">"^.*SC$"</span>, <span class="at">x =</span> <span class="fu">names</span>(traits), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-524"><a href="#cb57-524" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb57-525"><a href="#cb57-525" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb57-526"><a href="#cb57-526" aria-hidden="true" tabindex="-1"></a>  traits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb57-527"><a href="#cb57-527" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(traits, <span class="cf">function</span>(x) <span class="fu">as_scaled_numeric</span>(x)),</span>
<span id="cb57-528"><a href="#cb57-528" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="fu">row.names</span>(traits)</span>
<span id="cb57-529"><a href="#cb57-529" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-530"><a href="#cb57-530" aria-hidden="true" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">all</span>(<span class="fu">rownames</span>(traits) <span class="sc">==</span> <span class="fu">rownames</span>(expr)))</span>
<span id="cb57-531"><a href="#cb57-531" aria-hidden="true" tabindex="-1"></a>  result<span class="sc">$</span>a <span class="ot">&lt;-</span>  <span class="fu">list</span>(</span>
<span id="cb57-532"><a href="#cb57-532" aria-hidden="true" tabindex="-1"></a>    <span class="at">expr =</span> expr,</span>
<span id="cb57-533"><a href="#cb57-533" aria-hidden="true" tabindex="-1"></a>    <span class="at">traits =</span> traits</span>
<span id="cb57-534"><a href="#cb57-534" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-535"><a href="#cb57-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-536"><a href="#cb57-536" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Second item</span></span>
<span id="cb57-537"><a href="#cb57-537" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Expression From VST.</span></span>
<span id="cb57-538"><a href="#cb57-538" aria-hidden="true" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">assert_that</span>(</span>
<span id="cb57-539"><a href="#cb57-539" aria-hidden="true" tabindex="-1"></a>    <span class="fu">all</span>(<span class="fu">table</span>(MultiAssayExperiment<span class="sc">::</span><span class="fu">colData</span>(vst<span class="sc">$</span>mae)<span class="sc">$</span>USUBJID) <span class="sc">==</span> <span class="dv">2</span>)</span>
<span id="cb57-540"><a href="#cb57-540" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-541"><a href="#cb57-541" aria-hidden="true" tabindex="-1"></a>  subj <span class="ot">&lt;-</span> <span class="fu">unique</span>(MultiAssayExperiment<span class="sc">::</span><span class="fu">colData</span>(vst<span class="sc">$</span>mae)<span class="sc">$</span>USUBJID)</span>
<span id="cb57-542"><a href="#cb57-542" aria-hidden="true" tabindex="-1"></a>  ls_avisit <span class="ot">&lt;-</span> MultiAssayExperiment<span class="sc">::</span><span class="fu">colData</span>(vst<span class="sc">$</span>mae)</span>
<span id="cb57-543"><a href="#cb57-543" aria-hidden="true" tabindex="-1"></a>  ls_avisit <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(ls_avisit)</span>
<span id="cb57-544"><a href="#cb57-544" aria-hidden="true" tabindex="-1"></a>  ls_avisit <span class="ot">&lt;-</span> <span class="fu">split</span>(ls_avisit, <span class="at">f =</span> ls_avisit<span class="sc">$</span>AVISIT)</span>
<span id="cb57-545"><a href="#cb57-545" aria-hidden="true" tabindex="-1"></a>  bl <span class="ot">&lt;-</span> <span class="fu">rownames</span>(ls_avisit<span class="sc">$</span>BASELINE)[<span class="fu">match</span>(subj, ls_avisit<span class="sc">$</span>BASELINE<span class="sc">$</span>USUBJID)]</span>
<span id="cb57-546"><a href="#cb57-546" aria-hidden="true" tabindex="-1"></a>  m3 <span class="ot">&lt;-</span> <span class="fu">rownames</span>(ls_avisit<span class="sc">$</span><span class="st">`</span><span class="at">MONTH 3</span><span class="st">`</span>)[<span class="fu">match</span>(subj, ls_avisit<span class="sc">$</span><span class="st">`</span><span class="at">MONTH 3</span><span class="st">`</span><span class="sc">$</span>USUBJID)]</span>
<span id="cb57-547"><a href="#cb57-547" aria-hidden="true" tabindex="-1"></a>  expr <span class="ot">&lt;-</span> vst<span class="sc">$</span>mae[[assay]]</span>
<span id="cb57-548"><a href="#cb57-548" aria-hidden="true" tabindex="-1"></a>  expr <span class="ot">&lt;-</span> expr[, m3] <span class="sc">-</span> expr[, bl]</span>
<span id="cb57-549"><a href="#cb57-549" aria-hidden="true" tabindex="-1"></a>  expr <span class="ot">&lt;-</span> <span class="fu">t</span>(expr)</span>
<span id="cb57-550"><a href="#cb57-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(expr) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(</span>
<span id="cb57-551"><a href="#cb57-551" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="st">"^(X[0-9]*)v.*$"</span>,</span>
<span id="cb57-552"><a href="#cb57-552" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">rownames</span>(expr),</span>
<span id="cb57-553"><a href="#cb57-553" aria-hidden="true" tabindex="-1"></a>    <span class="at">replacement =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span></span>
<span id="cb57-554"><a href="#cb57-554" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-555"><a href="#cb57-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-556"><a href="#cb57-556" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Traits CHG.</span></span>
<span id="cb57-557"><a href="#cb57-557" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Long-format ADaM, key is UBSUJID x AVISIT.</span></span>
<span id="cb57-558"><a href="#cb57-558" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lab test data are added.</span></span>
<span id="cb57-559"><a href="#cb57-559" aria-hidden="true" tabindex="-1"></a>  adsl <span class="ot">&lt;-</span> adam<span class="sc">$</span>adsl</span>
<span id="cb57-560"><a href="#cb57-560" aria-hidden="true" tabindex="-1"></a>  adlb <span class="ot">&lt;-</span> adam<span class="sc">$</span>adlb</span>
<span id="cb57-561"><a href="#cb57-561" aria-hidden="true" tabindex="-1"></a>  advs <span class="ot">&lt;-</span> adam<span class="sc">$</span>advs</span>
<span id="cb57-562"><a href="#cb57-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-563"><a href="#cb57-563" aria-hidden="true" tabindex="-1"></a>  anl <span class="ot">&lt;-</span> adlb[</span>
<span id="cb57-564"><a href="#cb57-564" aria-hidden="true" tabindex="-1"></a>    adlb<span class="sc">$</span>AVISIT <span class="sc">==</span> <span class="st">"MONTH 3"</span> <span class="sc">&amp;</span></span>
<span id="cb57-565"><a href="#cb57-565" aria-hidden="true" tabindex="-1"></a>      adlb<span class="sc">$</span>PARAMCD <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb57-566"><a href="#cb57-566" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CHOL"</span>, <span class="st">"HBA1C"</span>, <span class="st">"HDL"</span>, <span class="st">"HOMAB"</span>, <span class="st">"HOMAIR"</span>, <span class="st">"LDL"</span>, <span class="st">"MATSUDA"</span>, <span class="st">"TRIG"</span></span>
<span id="cb57-567"><a href="#cb57-567" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb57-568"><a href="#cb57-568" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb57-569"><a href="#cb57-569" aria-hidden="true" tabindex="-1"></a>  anl <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb57-570"><a href="#cb57-570" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> anl[<span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"PARAMCD"</span>, <span class="st">"CHG"</span>, <span class="st">"PCHG"</span>)],</span>
<span id="cb57-571"><a href="#cb57-571" aria-hidden="true" tabindex="-1"></a>    <span class="at">v.names =</span> <span class="fu">c</span>(<span class="st">"CHG"</span>, <span class="st">"PCHG"</span>),</span>
<span id="cb57-572"><a href="#cb57-572" aria-hidden="true" tabindex="-1"></a>    <span class="at">timevar =</span> <span class="st">"PARAMCD"</span>,</span>
<span id="cb57-573"><a href="#cb57-573" aria-hidden="true" tabindex="-1"></a>    <span class="at">idvar =</span> <span class="st">"USUBJID"</span>,</span>
<span id="cb57-574"><a href="#cb57-574" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> <span class="st">"wide"</span></span>
<span id="cb57-575"><a href="#cb57-575" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-576"><a href="#cb57-576" aria-hidden="true" tabindex="-1"></a>  adam <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb57-577"><a href="#cb57-577" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> adsl[<span class="fu">c</span>(</span>
<span id="cb57-578"><a href="#cb57-578" aria-hidden="true" tabindex="-1"></a>      <span class="st">"USUBJID"</span>, <span class="st">"SUBJID"</span>, <span class="st">"AGE"</span>, <span class="st">"SEX"</span>, <span class="st">"ARM"</span>, <span class="st">"ARMCD"</span>,</span>
<span id="cb57-579"><a href="#cb57-579" aria-hidden="true" tabindex="-1"></a>      <span class="st">"T2DFH"</span>, <span class="st">"NTRAIN"</span></span>
<span id="cb57-580"><a href="#cb57-580" aria-hidden="true" tabindex="-1"></a>      )],</span>
<span id="cb57-581"><a href="#cb57-581" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> anl,</span>
<span id="cb57-582"><a href="#cb57-582" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"USUBJID"</span></span>
<span id="cb57-583"><a href="#cb57-583" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-584"><a href="#cb57-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-585"><a href="#cb57-585" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the timepoint-defined LB data.</span></span>
<span id="cb57-586"><a href="#cb57-586" aria-hidden="true" tabindex="-1"></a>  anl <span class="ot">&lt;-</span> adlb[</span>
<span id="cb57-587"><a href="#cb57-587" aria-hidden="true" tabindex="-1"></a>    adlb<span class="sc">$</span>AVISIT <span class="sc">==</span> <span class="st">"MONTH 3"</span> <span class="sc">&amp;</span></span>
<span id="cb57-588"><a href="#cb57-588" aria-hidden="true" tabindex="-1"></a>      adlb<span class="sc">$</span>PARAMCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"GLUC"</span>, <span class="st">"INSULIN"</span>),</span>
<span id="cb57-589"><a href="#cb57-589" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb57-590"><a href="#cb57-590" aria-hidden="true" tabindex="-1"></a>  anl<span class="sc">$</span>PARAMCD <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="co"># nolint</span></span>
<span id="cb57-591"><a href="#cb57-591" aria-hidden="true" tabindex="-1"></a>    anl<span class="sc">$</span>PARAMCD, anl<span class="sc">$</span>ATPTNUM, <span class="at">sep =</span> <span class="st">"_"</span></span>
<span id="cb57-592"><a href="#cb57-592" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-593"><a href="#cb57-593" aria-hidden="true" tabindex="-1"></a>  anl <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb57-594"><a href="#cb57-594" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> anl[<span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"PARAMCD"</span>, <span class="st">"CHG"</span>, <span class="st">"PCHG"</span>)],</span>
<span id="cb57-595"><a href="#cb57-595" aria-hidden="true" tabindex="-1"></a>    <span class="at">v.names =</span> <span class="fu">c</span>(<span class="st">"CHG"</span>, <span class="st">"PCHG"</span>),</span>
<span id="cb57-596"><a href="#cb57-596" aria-hidden="true" tabindex="-1"></a>    <span class="at">timevar =</span> <span class="st">"PARAMCD"</span>,</span>
<span id="cb57-597"><a href="#cb57-597" aria-hidden="true" tabindex="-1"></a>    <span class="at">idvar =</span> <span class="st">"USUBJID"</span>,</span>
<span id="cb57-598"><a href="#cb57-598" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> <span class="st">"wide"</span></span>
<span id="cb57-599"><a href="#cb57-599" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-600"><a href="#cb57-600" aria-hidden="true" tabindex="-1"></a>  adam <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x =</span> adam, <span class="at">y =</span> anl, <span class="at">by =</span> <span class="st">"USUBJID"</span>)</span>
<span id="cb57-601"><a href="#cb57-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-602"><a href="#cb57-602" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Vital Sign data are added.</span></span>
<span id="cb57-603"><a href="#cb57-603" aria-hidden="true" tabindex="-1"></a>  anl <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb57-604"><a href="#cb57-604" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> advs[</span>
<span id="cb57-605"><a href="#cb57-605" aria-hidden="true" tabindex="-1"></a>      advs<span class="sc">$</span>AVISIT <span class="sc">==</span> <span class="st">"MONTH 3"</span>,</span>
<span id="cb57-606"><a href="#cb57-606" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"PARAMCD"</span>, <span class="st">"CHG"</span>, <span class="st">"PCHG"</span>)],</span>
<span id="cb57-607"><a href="#cb57-607" aria-hidden="true" tabindex="-1"></a>    <span class="at">v.names =</span> <span class="fu">c</span>(<span class="st">"CHG"</span>, <span class="st">"PCHG"</span>),</span>
<span id="cb57-608"><a href="#cb57-608" aria-hidden="true" tabindex="-1"></a>    <span class="at">timevar =</span> <span class="st">"PARAMCD"</span>,</span>
<span id="cb57-609"><a href="#cb57-609" aria-hidden="true" tabindex="-1"></a>    <span class="at">idvar =</span> <span class="st">"USUBJID"</span>,</span>
<span id="cb57-610"><a href="#cb57-610" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> <span class="st">"wide"</span></span>
<span id="cb57-611"><a href="#cb57-611" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-612"><a href="#cb57-612" aria-hidden="true" tabindex="-1"></a>  adam <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x =</span> adam, <span class="at">y =</span> anl, <span class="at">by =</span> <span class="st">"USUBJID"</span>)</span>
<span id="cb57-613"><a href="#cb57-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-614"><a href="#cb57-614" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clean ADaM names.</span></span>
<span id="cb57-615"><a href="#cb57-615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(adam) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(</span>
<span id="cb57-616"><a href="#cb57-616" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="st">"^CHG</span><span class="sc">\\</span><span class="st">.(.*)$"</span>,</span>
<span id="cb57-617"><a href="#cb57-617" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">colnames</span>(adam),</span>
<span id="cb57-618"><a href="#cb57-618" aria-hidden="true" tabindex="-1"></a>    <span class="at">replacement =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span></span>
<span id="cb57-619"><a href="#cb57-619" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-620"><a href="#cb57-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(adam) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(</span>
<span id="cb57-621"><a href="#cb57-621" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="st">"^PCHG</span><span class="sc">\\</span><span class="st">.(.*)$"</span>,</span>
<span id="cb57-622"><a href="#cb57-622" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">colnames</span>(adam),</span>
<span id="cb57-623"><a href="#cb57-623" aria-hidden="true" tabindex="-1"></a>    <span class="at">replacement =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">1_PCHG"</span></span>
<span id="cb57-624"><a href="#cb57-624" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-625"><a href="#cb57-625" aria-hidden="true" tabindex="-1"></a>  adam<span class="sc">$</span>ARMCD <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(adam<span class="sc">$</span>ARMCD)<span class="co"># nolint</span></span>
<span id="cb57-626"><a href="#cb57-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-627"><a href="#cb57-627" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Traits matrix (numeric).</span></span>
<span id="cb57-628"><a href="#cb57-628" aria-hidden="true" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">max</span>(<span class="fu">table</span>(adam<span class="sc">$</span>USUBJID)) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb57-629"><a href="#cb57-629" aria-hidden="true" tabindex="-1"></a>  traits <span class="ot">&lt;-</span> adam[<span class="fu">match</span>(subj, adam<span class="sc">$</span>USUBJID), ]</span>
<span id="cb57-630"><a href="#cb57-630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(traits) <span class="ot">&lt;-</span> traits<span class="sc">$</span>SUBJID</span>
<span id="cb57-631"><a href="#cb57-631" aria-hidden="true" tabindex="-1"></a>  traits <span class="ot">&lt;-</span> traits[</span>
<span id="cb57-632"><a href="#cb57-632" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">colnames</span>(traits) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"SUBJID"</span>, <span class="st">"USUBJID"</span>, <span class="st">"SEX"</span>, <span class="st">"ARM"</span>)</span>
<span id="cb57-633"><a href="#cb57-633" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb57-634"><a href="#cb57-634" aria-hidden="true" tabindex="-1"></a>  traits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb57-635"><a href="#cb57-635" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(traits, <span class="cf">function</span>(x) <span class="fu">as_scaled_numeric</span>(x)),</span>
<span id="cb57-636"><a href="#cb57-636" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="fu">row.names</span>(traits)</span>
<span id="cb57-637"><a href="#cb57-637" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-638"><a href="#cb57-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-639"><a href="#cb57-639" aria-hidden="true" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">all</span>(<span class="fu">rownames</span>(traits) <span class="sc">==</span> <span class="fu">rownames</span>(expr)))</span>
<span id="cb57-640"><a href="#cb57-640" aria-hidden="true" tabindex="-1"></a>  result<span class="sc">$</span>b <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb57-641"><a href="#cb57-641" aria-hidden="true" tabindex="-1"></a>    <span class="at">expr =</span> expr,</span>
<span id="cb57-642"><a href="#cb57-642" aria-hidden="true" tabindex="-1"></a>    <span class="at">traits =</span> traits</span>
<span id="cb57-643"><a href="#cb57-643" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-644"><a href="#cb57-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-645"><a href="#cb57-645" aria-hidden="true" tabindex="-1"></a>  result</span>
<span id="cb57-646"><a href="#cb57-646" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-647"><a href="#cb57-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-648"><a href="#cb57-648" aria-hidden="true" tabindex="-1"></a>besd_wgcna <span class="ot">&lt;-</span> <span class="fu">vst_norm</span>(<span class="at">mae =</span> besd_mae, <span class="at">assay =</span> <span class="st">"mrna"</span>)</span>
<span id="cb57-649"><a href="#cb57-649" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb57-650"><a href="#cb57-650" aria-hidden="true" tabindex="-1"></a>assertthat<span class="sc">::</span><span class="fu">assert_that</span>(</span>
<span id="cb57-651"><a href="#cb57-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">all</span>(</span>
<span id="cb57-652"><a href="#cb57-652" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(</span>
<span id="cb57-653"><a href="#cb57-653" aria-hidden="true" tabindex="-1"></a>      besd_wgcna,</span>
<span id="cb57-654"><a href="#cb57-654" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(x) </span>
<span id="cb57-655"><a href="#cb57-655" aria-hidden="true" tabindex="-1"></a>        WGCNA<span class="sc">::</span><span class="fu">goodSamplesGenes</span>(x<span class="sc">$</span>expr, <span class="at">verbose =</span> <span class="dv">0</span>)<span class="sc">$</span>allOK</span>
<span id="cb57-656"><a href="#cb57-656" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-657"><a href="#cb57-657" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-658"><a href="#cb57-658" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-659"><a href="#cb57-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-660"><a href="#cb57-660" aria-hidden="true" tabindex="-1"></a><span class="co">#' Add clust_ind to besd_wgcna.</span></span>
<span id="cb57-661"><a href="#cb57-661" aria-hidden="true" tabindex="-1"></a>besd_wgcna <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb57-662"><a href="#cb57-662" aria-hidden="true" tabindex="-1"></a>  besd_wgcna,</span>
<span id="cb57-663"><a href="#cb57-663" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) {</span>
<span id="cb57-664"><a href="#cb57-664" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>clust_ind <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(x<span class="sc">$</span>expr), <span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb57-665"><a href="#cb57-665" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb57-666"><a href="#cb57-666" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-667"><a href="#cb57-667" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-668"><a href="#cb57-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-669"><a href="#cb57-669" aria-hidden="true" tabindex="-1"></a>besd_wgcna<span class="sc">$</span>a<span class="sc">$</span>sft_val <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb57-670"><a href="#cb57-670" aria-hidden="true" tabindex="-1"></a>besd_wgcna<span class="sc">$</span>b<span class="sc">$</span>sft_val <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb57-671"><a href="#cb57-671" aria-hidden="true" tabindex="-1"></a>besd_wgcna  <span class="ot">&lt;-</span> <span class="fu">lapply</span>(besd_wgcna, wrap_sft)</span>
<span id="cb57-672"><a href="#cb57-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-673"><a href="#cb57-673" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>(); <span class="fu">gc</span>(<span class="at">reset =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-674"><a href="#cb57-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-675"><a href="#cb57-675" aria-hidden="true" tabindex="-1"></a><span class="co">#' @describeIn wrap_wgcna add `sft` to `besd_wgcna`;</span></span>
<span id="cb57-676"><a href="#cb57-676" aria-hidden="true" tabindex="-1"></a><span class="co">#'   semi-automatic procedure for sft.</span></span>
<span id="cb57-677"><a href="#cb57-677" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb57-678"><a href="#cb57-678" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-679"><a href="#cb57-679" aria-hidden="true" tabindex="-1"></a>wrap_sft <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb57-680"><a href="#cb57-680" aria-hidden="true" tabindex="-1"></a>  sft_power <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(<span class="fu">seq_len</span>(<span class="dv">10</span>), <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">30</span>, <span class="dv">2</span>), x<span class="sc">$</span>sft_val))</span>
<span id="cb57-681"><a href="#cb57-681" aria-hidden="true" tabindex="-1"></a>  sft_power <span class="ot">&lt;-</span> sft_power[<span class="fu">order</span>(sft_power)]</span>
<span id="cb57-682"><a href="#cb57-682" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>sft <span class="ot">&lt;-</span> WGCNA<span class="sc">::</span><span class="fu">pickSoftThreshold</span>(</span>
<span id="cb57-683"><a href="#cb57-683" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>expr,</span>
<span id="cb57-684"><a href="#cb57-684" aria-hidden="true" tabindex="-1"></a>    <span class="at">powerVector =</span> sft_power,</span>
<span id="cb57-685"><a href="#cb57-685" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="dv">5</span></span>
<span id="cb57-686"><a href="#cb57-686" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-687"><a href="#cb57-687" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb57-688"><a href="#cb57-688" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-689"><a href="#cb57-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-690"><a href="#cb57-690" aria-hidden="true" tabindex="-1"></a><span class="co">#' @describeIn wrap_wgcna plot the soft-threshold determining procedure.</span></span>
<span id="cb57-691"><a href="#cb57-691" aria-hidden="true" tabindex="-1"></a><span class="co">#' @import ggplot2</span></span>
<span id="cb57-692"><a href="#cb57-692" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb57-693"><a href="#cb57-693" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-694"><a href="#cb57-694" aria-hidden="true" tabindex="-1"></a>wrap_gg_sft <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb57-695"><a href="#cb57-695" aria-hidden="true" tabindex="-1"></a>  dta <span class="ot">&lt;-</span> x<span class="sc">$</span>sft<span class="sc">$</span>fitIndices</span>
<span id="cb57-696"><a href="#cb57-696" aria-hidden="true" tabindex="-1"></a>  dta<span class="sc">$</span>signed_rsq <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">sign</span>(dta<span class="sc">$</span>slope) <span class="sc">*</span> dta<span class="sc">$</span>SFT.R.sq</span>
<span id="cb57-697"><a href="#cb57-697" aria-hidden="true" tabindex="-1"></a>  dta <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb57-698"><a href="#cb57-698" aria-hidden="true" tabindex="-1"></a>    dta[<span class="fu">c</span>(<span class="st">"Power"</span>, <span class="st">"signed_rsq"</span>, <span class="st">"mean.k."</span>)],</span>
<span id="cb57-699"><a href="#cb57-699" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"signed_rsq"</span>, <span class="st">"mean.k."</span>),</span>
<span id="cb57-700"><a href="#cb57-700" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"criteria"</span>,</span>
<span id="cb57-701"><a href="#cb57-701" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb57-702"><a href="#cb57-702" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-703"><a href="#cb57-703" aria-hidden="true" tabindex="-1"></a>  dta<span class="sc">$</span>criteria <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb57-704"><a href="#cb57-704" aria-hidden="true" tabindex="-1"></a>    dta<span class="sc">$</span>criteria,</span>
<span id="cb57-705"><a href="#cb57-705" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"signed_rsq"</span>, <span class="st">"mean.k."</span>),</span>
<span id="cb57-706"><a href="#cb57-706" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Scale independence"</span>, <span class="st">"Mean connectivity"</span>)</span>
<span id="cb57-707"><a href="#cb57-707" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-708"><a href="#cb57-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-709"><a href="#cb57-709" aria-hidden="true" tabindex="-1"></a>  dta_hline <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb57-710"><a href="#cb57-710" aria-hidden="true" tabindex="-1"></a>    <span class="at">criteria =</span> <span class="fu">factor</span>(</span>
<span id="cb57-711"><a href="#cb57-711" aria-hidden="true" tabindex="-1"></a>      <span class="fu">levels</span>(dta<span class="sc">$</span>criteria)[<span class="dv">1</span>],</span>
<span id="cb57-712"><a href="#cb57-712" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">levels</span>(dta<span class="sc">$</span>criteria)</span>
<span id="cb57-713"><a href="#cb57-713" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb57-714"><a href="#cb57-714" aria-hidden="true" tabindex="-1"></a>    <span class="at">yintercept =</span> </span>
<span id="cb57-715"><a href="#cb57-715" aria-hidden="true" tabindex="-1"></a>      dta<span class="sc">$</span>value[dta<span class="sc">$</span>criteria <span class="sc">==</span> <span class="fu">levels</span>(dta<span class="sc">$</span>criteria)[<span class="dv">1</span>] <span class="sc">&amp;</span> dta<span class="sc">$</span>Power <span class="sc">==</span> x<span class="sc">$</span>sft_val],</span>
<span id="cb57-716"><a href="#cb57-716" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x<span class="sc">$</span>sft_val</span>
<span id="cb57-717"><a href="#cb57-717" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-718"><a href="#cb57-718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb57-719"><a href="#cb57-719" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dta,</span>
<span id="cb57-720"><a href="#cb57-720" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes_string</span>(<span class="at">x =</span> <span class="st">"Power"</span>, <span class="at">y =</span> <span class="st">"value"</span>, <span class="at">label =</span> <span class="st">"Power"</span>)</span>
<span id="cb57-721"><a href="#cb57-721" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="fu">geom_hline</span>(</span>
<span id="cb57-722"><a href="#cb57-722" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dta_hline,</span>
<span id="cb57-723"><a href="#cb57-723" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes_string</span>(<span class="at">yintercept =</span> <span class="st">"yintercept"</span>)</span>
<span id="cb57-724"><a href="#cb57-724" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="fu">geom_line</span>(</span>
<span id="cb57-725"><a href="#cb57-725" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray60"</span>, <span class="at">lty =</span> <span class="dv">2</span></span>
<span id="cb57-726"><a href="#cb57-726" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="fu">geom_text</span>(</span>
<span id="cb57-727"><a href="#cb57-727" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="fu">geom_label</span>(</span>
<span id="cb57-728"><a href="#cb57-728" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dta_hline,</span>
<span id="cb57-729"><a href="#cb57-729" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes_string</span>(<span class="at">y =</span> <span class="st">"yintercept"</span>, <span class="at">x =</span> <span class="st">"x"</span>, <span class="at">label =</span> <span class="st">"x"</span>)</span>
<span id="cb57-730"><a href="#cb57-730" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="fu">facet_wrap</span>(</span>
<span id="cb57-731"><a href="#cb57-731" aria-hidden="true" tabindex="-1"></a>    criteria <span class="sc">~</span>  ., <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb57-732"><a href="#cb57-732" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-733"><a href="#cb57-733" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-734"><a href="#cb57-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-735"><a href="#cb57-735" aria-hidden="true" tabindex="-1"></a><span class="co">#' @describeIn wrap_wgcna add `wgcna` to `besd_wgcna`.</span></span>
<span id="cb57-736"><a href="#cb57-736" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param data (`list`)\cr expression profile.</span></span>
<span id="cb57-737"><a href="#cb57-737" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param control (`list`)\cr control as prepared by [control_wgcna()].</span></span>
<span id="cb57-738"><a href="#cb57-738" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom stats cor</span></span>
<span id="cb57-739"><a href="#cb57-739" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb57-740"><a href="#cb57-740" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-741"><a href="#cb57-741" aria-hidden="true" tabindex="-1"></a>estimate_wgcna <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb57-742"><a href="#cb57-742" aria-hidden="true" tabindex="-1"></a>  data,</span>
<span id="cb57-743"><a href="#cb57-743" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">control_wgcna</span>()) {</span>
<span id="cb57-744"><a href="#cb57-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-745"><a href="#cb57-745" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (control<span class="sc">$</span>verbose) <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">----Adjacency: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-746"><a href="#cb57-746" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (control<span class="sc">$</span>corFnc <span class="sc">==</span> <span class="st">"bicor"</span>) bicor <span class="ot">&lt;-</span> WGCNA<span class="sc">::</span>bicor</span>
<span id="cb57-747"><a href="#cb57-747" aria-hidden="true" tabindex="-1"></a>  adj <span class="ot">&lt;-</span> WGCNA<span class="sc">::</span><span class="fu">adjacency</span>(</span>
<span id="cb57-748"><a href="#cb57-748" aria-hidden="true" tabindex="-1"></a>    <span class="at">datExpr =</span> data,</span>
<span id="cb57-749"><a href="#cb57-749" aria-hidden="true" tabindex="-1"></a>    <span class="at">power =</span> control<span class="sc">$</span>power,</span>
<span id="cb57-750"><a href="#cb57-750" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> control<span class="sc">$</span>type,</span>
<span id="cb57-751"><a href="#cb57-751" aria-hidden="true" tabindex="-1"></a>    <span class="at">corFnc =</span> control<span class="sc">$</span>corFnc</span>
<span id="cb57-752"><a href="#cb57-752" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-753"><a href="#cb57-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-754"><a href="#cb57-754" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Turn adjacency into topological overlap</span></span>
<span id="cb57-755"><a href="#cb57-755" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (control<span class="sc">$</span>verbose) <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">----TOM: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-756"><a href="#cb57-756" aria-hidden="true" tabindex="-1"></a>  TOM <span class="ot">&lt;-</span>  WGCNA<span class="sc">::</span><span class="fu">TOMsimilarity</span>(</span>
<span id="cb57-757"><a href="#cb57-757" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjMat =</span> adj,</span>
<span id="cb57-758"><a href="#cb57-758" aria-hidden="true" tabindex="-1"></a>    <span class="at">TOMType =</span> control<span class="sc">$</span>TOMType</span>
<span id="cb57-759"><a href="#cb57-759" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-760"><a href="#cb57-760" aria-hidden="true" tabindex="-1"></a>  dissTOM <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> TOM</span>
<span id="cb57-761"><a href="#cb57-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-762"><a href="#cb57-762" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Call the hierarchical clustering function</span></span>
<span id="cb57-763"><a href="#cb57-763" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (control<span class="sc">$</span>verbose) <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">----hclust: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-764"><a href="#cb57-764" aria-hidden="true" tabindex="-1"></a>  dendro <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">hclust</span>(stats<span class="sc">::</span><span class="fu">as.dist</span>(dissTOM), <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb57-765"><a href="#cb57-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-766"><a href="#cb57-766" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Module identification using dynamic tree cut:</span></span>
<span id="cb57-767"><a href="#cb57-767" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (control<span class="sc">$</span>verbose) <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">----cutreeDynamic: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-768"><a href="#cb57-768" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We like large modules, so we set the minimum module size relatively high:</span></span>
<span id="cb57-769"><a href="#cb57-769" aria-hidden="true" tabindex="-1"></a>  dynamicMods <span class="ot">&lt;-</span> dynamicTreeCut<span class="sc">::</span><span class="fu">cutreeDynamic</span>(</span>
<span id="cb57-770"><a href="#cb57-770" aria-hidden="true" tabindex="-1"></a>    <span class="at">dendro =</span> dendro,</span>
<span id="cb57-771"><a href="#cb57-771" aria-hidden="true" tabindex="-1"></a>    <span class="at">distM =</span> dissTOM,</span>
<span id="cb57-772"><a href="#cb57-772" aria-hidden="true" tabindex="-1"></a>    <span class="at">cutHeight =</span> control<span class="sc">$</span>cutHeight,</span>
<span id="cb57-773"><a href="#cb57-773" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"hybrid"</span>,</span>
<span id="cb57-774"><a href="#cb57-774" aria-hidden="true" tabindex="-1"></a>    <span class="at">deepSplit =</span> control<span class="sc">$</span>deepSplit,</span>
<span id="cb57-775"><a href="#cb57-775" aria-hidden="true" tabindex="-1"></a>    <span class="at">pamRespectsDendro =</span> <span class="cn">FALSE</span>,</span>
<span id="cb57-776"><a href="#cb57-776" aria-hidden="true" tabindex="-1"></a>    <span class="at">minClusterSize =</span> control<span class="sc">$</span>minClusterSize</span>
<span id="cb57-777"><a href="#cb57-777" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-778"><a href="#cb57-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-779"><a href="#cb57-779" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert numeric lables into colors</span></span>
<span id="cb57-780"><a href="#cb57-780" aria-hidden="true" tabindex="-1"></a>  dynamicColors <span class="ot">&lt;-</span> WGCNA<span class="sc">::</span><span class="fu">labels2colors</span>(dynamicMods)</span>
<span id="cb57-781"><a href="#cb57-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-782"><a href="#cb57-782" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate eigengenes</span></span>
<span id="cb57-783"><a href="#cb57-783" aria-hidden="true" tabindex="-1"></a>  MEList <span class="ot">&lt;-</span> WGCNA<span class="sc">::</span><span class="fu">moduleEigengenes</span>(<span class="at">expr =</span> data, <span class="at">colors =</span> dynamicColors)</span>
<span id="cb57-784"><a href="#cb57-784" aria-hidden="true" tabindex="-1"></a>  MEs <span class="ot">&lt;-</span> MEList<span class="sc">$</span>eigengenes</span>
<span id="cb57-785"><a href="#cb57-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-786"><a href="#cb57-786" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate dissimilarity of module eigengenes</span></span>
<span id="cb57-787"><a href="#cb57-787" aria-hidden="true" tabindex="-1"></a>  MEDiss <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">cor</span>(MEs);</span>
<span id="cb57-788"><a href="#cb57-788" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cluster module eigengenes</span></span>
<span id="cb57-789"><a href="#cb57-789" aria-hidden="true" tabindex="-1"></a>  METree <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">hclust</span>(stats<span class="sc">::</span><span class="fu">as.dist</span>(MEDiss), <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb57-790"><a href="#cb57-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-791"><a href="#cb57-791" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Call an automatic merging function</span></span>
<span id="cb57-792"><a href="#cb57-792" aria-hidden="true" tabindex="-1"></a>  merge <span class="ot">&lt;-</span> WGCNA<span class="sc">::</span><span class="fu">mergeCloseModules</span>(</span>
<span id="cb57-793"><a href="#cb57-793" aria-hidden="true" tabindex="-1"></a>    data,</span>
<span id="cb57-794"><a href="#cb57-794" aria-hidden="true" tabindex="-1"></a>    dynamicColors</span>
<span id="cb57-795"><a href="#cb57-795" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-796"><a href="#cb57-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-797"><a href="#cb57-797" aria-hidden="true" tabindex="-1"></a>  color_group <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb57-798"><a href="#cb57-798" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Dynamic Tree Cut"</span> <span class="ot">=</span> dynamicColors,</span>
<span id="cb57-799"><a href="#cb57-799" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Merged dynamic"</span> <span class="ot">=</span> merge<span class="sc">$</span>color</span>
<span id="cb57-800"><a href="#cb57-800" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-801"><a href="#cb57-801" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb57-802"><a href="#cb57-802" aria-hidden="true" tabindex="-1"></a>    <span class="at">dendro =</span> dendro,</span>
<span id="cb57-803"><a href="#cb57-803" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> color_group,</span>
<span id="cb57-804"><a href="#cb57-804" aria-hidden="true" tabindex="-1"></a>    <span class="at">mod_merge =</span> merge,</span>
<span id="cb57-805"><a href="#cb57-805" aria-hidden="true" tabindex="-1"></a>    <span class="at">MEs =</span> MEs</span>
<span id="cb57-806"><a href="#cb57-806" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-807"><a href="#cb57-807" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-808"><a href="#cb57-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-809"><a href="#cb57-809" aria-hidden="true" tabindex="-1"></a><span class="co">#' @describeIn wrap_wgcna convenient Controls</span></span>
<span id="cb57-810"><a href="#cb57-810" aria-hidden="true" tabindex="-1"></a><span class="co">#' @inheritParams WGCNA::adjacency</span></span>
<span id="cb57-811"><a href="#cb57-811" aria-hidden="true" tabindex="-1"></a><span class="co">#' @inheritParams WGCNA::TOMsimilarity</span></span>
<span id="cb57-812"><a href="#cb57-812" aria-hidden="true" tabindex="-1"></a><span class="co">#' @inheritParams dynamicTreeCut::cutreeDynamic</span></span>
<span id="cb57-813"><a href="#cb57-813" aria-hidden="true" tabindex="-1"></a><span class="co">#' @inheritParams WGCNA::mergeCloseModules</span></span>
<span id="cb57-814"><a href="#cb57-814" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb57-815"><a href="#cb57-815" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb57-816"><a href="#cb57-816" aria-hidden="true" tabindex="-1"></a>control_wgcna <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb57-817"><a href="#cb57-817" aria-hidden="true" tabindex="-1"></a>  power,</span>
<span id="cb57-818"><a href="#cb57-818" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"signed"</span>,</span>
<span id="cb57-819"><a href="#cb57-819" aria-hidden="true" tabindex="-1"></a>  <span class="at">TOMType =</span> <span class="st">"signed"</span>,</span>
<span id="cb57-820"><a href="#cb57-820" aria-hidden="true" tabindex="-1"></a>  <span class="at">corFnc =</span> <span class="fu">c</span>(<span class="st">"pearson"</span> <span class="ot">=</span> <span class="st">"cor"</span>, <span class="st">"bicor"</span> <span class="ot">=</span> <span class="st">"bicor"</span>)[<span class="dv">1</span>], </span>
<span id="cb57-821"><a href="#cb57-821" aria-hidden="true" tabindex="-1"></a>  <span class="at">deepSplit =</span> <span class="dv">1</span>, <span class="co"># wa 2 for Medium sensitivity</span></span>
<span id="cb57-822"><a href="#cb57-822" aria-hidden="true" tabindex="-1"></a>  <span class="at">cutHeight =</span> <span class="fl">0.995</span>, <span class="co"># Default 0.995</span></span>
<span id="cb57-823"><a href="#cb57-823" aria-hidden="true" tabindex="-1"></a>  <span class="at">minClusterSize =</span> <span class="dv">20</span>, <span class="co"># min(20, ncol(datExpr)/2 ) </span></span>
<span id="cb57-824"><a href="#cb57-824" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb57-825"><a href="#cb57-825" aria-hidden="true" tabindex="-1"></a>  ) {</span>
<span id="cb57-826"><a href="#cb57-826" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>(<span class="fu">environment</span>())</span>
<span id="cb57-827"><a href="#cb57-827" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-828"><a href="#cb57-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-829"><a href="#cb57-829" aria-hidden="true" tabindex="-1"></a>besd_wgcna <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb57-830"><a href="#cb57-830" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> besd_wgcna,</span>
<span id="cb57-831"><a href="#cb57-831" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb57-832"><a href="#cb57-832" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>wgcna <span class="ot">&lt;-</span> <span class="fu">estimate_wgcna</span>(</span>
<span id="cb57-833"><a href="#cb57-833" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> x<span class="sc">$</span>expr,</span>
<span id="cb57-834"><a href="#cb57-834" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">control_wgcna</span>(<span class="at">power =</span> x<span class="sc">$</span>sft_val)</span>
<span id="cb57-835"><a href="#cb57-835" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-836"><a href="#cb57-836" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gc</span>(); <span class="fu">gc</span>(<span class="at">reset =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-837"><a href="#cb57-837" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb57-838"><a href="#cb57-838" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-839"><a href="#cb57-839" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-840"><a href="#cb57-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-841"><a href="#cb57-841" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-842"><a href="#cb57-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-843"><a href="#cb57-843" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Data preparation</span></span>
<span id="cb57-844"><a href="#cb57-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-845"><a href="#cb57-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-846"><a href="#cb57-846" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session Informations</span></span>
<span id="cb57-847"><a href="#cb57-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-850"><a href="#cb57-850" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-851"><a href="#cb57-851" aria-hidden="true" tabindex="-1"></a>sessioninfo<span class="sc">::</span><span class="fu">session_info</span>()</span>
<span id="cb57-852"><a href="#cb57-852" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
      <div class="nav-footer-center">Copyright 2022, FCA Collin, Ph.D.</div>
  </div>
</footer>


</body></html>