<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Francois Collin">
<meta name="dcterms.date" content="2022-12-12">
<title>T2D: Exercise and Genetic Expression Profile - 6&nbsp; WGCNA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./t2d_13_gea.html" rel="next">
<link href="./t2d_07_mir.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">
<span class="chapter-number">6</span>&nbsp; <span class="chapter-title">WGCNA</span>
</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">T2D: Exercise and Genetic Expression Profile</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/FCACollin/t2d" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preamble</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_03_bds.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Missingness in adlb and advs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_08_dmg.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Demographics and Baseline Anthropometrics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_09_chg.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Anthropometrics Changes From Baseline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_06_rna.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">RNASeq - Refresher</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_07_mir.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">mRNA / micro RNA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_11_wcn.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">WGCNA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_13_gea.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">GSEA / DE Results</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#mrna-seq-mirna---wgcna" id="toc-mrna-seq-mirna---wgcna" class="nav-link active" data-scroll-target="#mrna-seq-mirna---wgcna"> <span class="header-section-number">6.1</span> mRNA Seq / miRNA - WGCNA</a>
  <ul class="collapse">
<li>
<a href="#materials-and-methods" id="toc-materials-and-methods" class="nav-link" data-scroll-target="#materials-and-methods"> <span class="header-section-number">6.1.1</span> Materials and Methods</a>
  <ul class="collapse">
<li><a href="#helper-functions" id="toc-helper-functions" class="nav-link" data-scroll-target="#helper-functions"> <span class="header-section-number">6.1.1.1</span> Helper functions</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation"> <span class="header-section-number">6.1.1.2</span> Data preparation</a></li>
  </ul>
</li>
  <li>
<a href="#mirna-baseline" id="toc-mirna-baseline" class="nav-link" data-scroll-target="#mirna-baseline"> <span class="header-section-number">6.1.2</span> miRNA / Baseline</a>
  <ul class="collapse">
<li><a href="#sample-clustering-oid-1" id="toc-sample-clustering-oid-1" class="nav-link" data-scroll-target="#sample-clustering-oid-1"> <span class="header-section-number">6.1.2.1</span> Sample clustering (OID 1)</a></li>
  <li>
<a href="#gene-clustering" id="toc-gene-clustering" class="nav-link" data-scroll-target="#gene-clustering"> <span class="header-section-number">6.1.2.2</span> Gene Clustering</a>
  <ul class="collapse">
<li><a href="#soft-threshold-determination-oid-2" id="toc-soft-threshold-determination-oid-2" class="nav-link" data-scroll-target="#soft-threshold-determination-oid-2"> <span class="header-section-number">6.1.2.2.1</span> Soft threshold determination (OID 2)</a></li>
  <li><a href="#network" id="toc-network" class="nav-link" data-scroll-target="#network"> <span class="header-section-number">6.1.2.2.2</span> Network</a></li>
  </ul>
</li>
  <li>
<a href="#eigengenes-exploration" id="toc-eigengenes-exploration" class="nav-link" data-scroll-target="#eigengenes-exploration"> <span class="header-section-number">6.1.2.3</span> Eigengenes exploration</a>
  <ul class="collapse">
<li><a href="#oid-3---heatmap" id="toc-oid-3---heatmap" class="nav-link" data-scroll-target="#oid-3---heatmap"> <span class="header-section-number">6.1.2.3.1</span> OID 3 - Heatmap</a></li>
  <li><a href="#oid-4---excel-file" id="toc-oid-4---excel-file" class="nav-link" data-scroll-target="#oid-4---excel-file"> <span class="header-section-number">6.1.2.3.2</span> OID 4 - Excel file</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#mrna-baseline" id="toc-mrna-baseline" class="nav-link" data-scroll-target="#mrna-baseline"> <span class="header-section-number">6.1.3</span> mRNA / Baseline</a>
  <ul class="collapse">
<li><a href="#sample-clustering-oid-5" id="toc-sample-clustering-oid-5" class="nav-link" data-scroll-target="#sample-clustering-oid-5"> <span class="header-section-number">6.1.3.1</span> Sample clustering (OID 5)</a></li>
  <li>
<a href="#gene-clustering-1" id="toc-gene-clustering-1" class="nav-link" data-scroll-target="#gene-clustering-1"> <span class="header-section-number">6.1.3.2</span> Gene Clustering</a>
  <ul class="collapse">
<li><a href="#soft-threshold-determination-oid-6" id="toc-soft-threshold-determination-oid-6" class="nav-link" data-scroll-target="#soft-threshold-determination-oid-6"> <span class="header-section-number">6.1.3.2.1</span> Soft threshold determination (OID 6)</a></li>
  <li><a href="#network-1" id="toc-network-1" class="nav-link" data-scroll-target="#network-1"> <span class="header-section-number">6.1.3.2.2</span> Network</a></li>
  </ul>
</li>
  <li>
<a href="#eigengenes-exploration-1" id="toc-eigengenes-exploration-1" class="nav-link" data-scroll-target="#eigengenes-exploration-1"> <span class="header-section-number">6.1.3.3</span> Eigengenes exploration</a>
  <ul class="collapse">
<li><a href="#oid-7---heatmap" id="toc-oid-7---heatmap" class="nav-link" data-scroll-target="#oid-7---heatmap"> <span class="header-section-number">6.1.3.3.1</span> OID 7 - Heatmap</a></li>
  <li><a href="#oid-8---excel-file" id="toc-oid-8---excel-file" class="nav-link" data-scroll-target="#oid-8---excel-file"> <span class="header-section-number">6.1.3.3.2</span> OID 8 - Excel file</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#mirna-chg" id="toc-mirna-chg" class="nav-link" data-scroll-target="#mirna-chg"> <span class="header-section-number">6.1.4</span> miRNA / CHG</a>
  <ul class="collapse">
<li><a href="#sample-clustering-oid-9" id="toc-sample-clustering-oid-9" class="nav-link" data-scroll-target="#sample-clustering-oid-9"> <span class="header-section-number">6.1.4.1</span> Sample Clustering (OID 9)</a></li>
  <li>
<a href="#gene-clustering-2" id="toc-gene-clustering-2" class="nav-link" data-scroll-target="#gene-clustering-2"> <span class="header-section-number">6.1.4.2</span> Gene Clustering</a>
  <ul class="collapse">
<li><a href="#soft-threshold-determination-oid-10" id="toc-soft-threshold-determination-oid-10" class="nav-link" data-scroll-target="#soft-threshold-determination-oid-10"> <span class="header-section-number">6.1.4.2.1</span> Soft threshold determination (OID 10)</a></li>
  <li><a href="#network-2" id="toc-network-2" class="nav-link" data-scroll-target="#network-2"> <span class="header-section-number">6.1.4.2.2</span> Network</a></li>
  </ul>
</li>
  <li>
<a href="#eigengenes-exploration-2" id="toc-eigengenes-exploration-2" class="nav-link" data-scroll-target="#eigengenes-exploration-2"> <span class="header-section-number">6.1.4.3</span> Eigengenes exploration</a>
  <ul class="collapse">
<li><a href="#oid-11---heatmap" id="toc-oid-11---heatmap" class="nav-link" data-scroll-target="#oid-11---heatmap"> <span class="header-section-number">6.1.4.3.1</span> OID 11 - Heatmap</a></li>
  <li><a href="#oid-12---excel-file" id="toc-oid-12---excel-file" class="nav-link" data-scroll-target="#oid-12---excel-file"> <span class="header-section-number">6.1.4.3.2</span> OID 12 - Excel file</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#mrna-chg" id="toc-mrna-chg" class="nav-link" data-scroll-target="#mrna-chg"> <span class="header-section-number">6.1.5</span> mRNA / CHG</a>
  <ul class="collapse">
<li><a href="#sample-clustering-oid-13" id="toc-sample-clustering-oid-13" class="nav-link" data-scroll-target="#sample-clustering-oid-13"> <span class="header-section-number">6.1.5.1</span> Sample Clustering (OID 13)</a></li>
  <li>
<a href="#gene-clustering-3" id="toc-gene-clustering-3" class="nav-link" data-scroll-target="#gene-clustering-3"> <span class="header-section-number">6.1.5.2</span> Gene Clustering</a>
  <ul class="collapse">
<li><a href="#soft-threshold-determination-oid-14" id="toc-soft-threshold-determination-oid-14" class="nav-link" data-scroll-target="#soft-threshold-determination-oid-14"> <span class="header-section-number">6.1.5.2.1</span> Soft threshold determination (OID 14)</a></li>
  <li><a href="#network-3" id="toc-network-3" class="nav-link" data-scroll-target="#network-3"> <span class="header-section-number">6.1.5.2.2</span> Network</a></li>
  </ul>
</li>
  <li>
<a href="#eigengenes-exploration-3" id="toc-eigengenes-exploration-3" class="nav-link" data-scroll-target="#eigengenes-exploration-3"> <span class="header-section-number">6.1.5.3</span> Eigengenes exploration</a>
  <ul class="collapse">
<li><a href="#oid-15---heatmap" id="toc-oid-15---heatmap" class="nav-link" data-scroll-target="#oid-15---heatmap"> <span class="header-section-number">6.1.5.3.1</span> OID 15 - Heatmap</a></li>
  <li><a href="#oid-16---excel-file" id="toc-oid-16---excel-file" class="nav-link" data-scroll-target="#oid-16---excel-file"> <span class="header-section-number">6.1.5.3.2</span> OID 16 - Excel file</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#legacy" id="toc-legacy" class="nav-link" data-scroll-target="#legacy"> <span class="header-section-number">6.1.6</span> Legacy</a>
  <ul class="collapse">
<li><a href="#data-preparation-1" id="toc-data-preparation-1" class="nav-link" data-scroll-target="#data-preparation-1"> <span class="header-section-number">6.1.6.1</span> Data preparation</a></li>
  </ul>
</li>
  </ul>
</li>
  <li><a href="#session-informations" id="toc-session-informations" class="nav-link" data-scroll-target="#session-informations"> <span class="header-section-number">6.2</span> Session Informations</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/FCACollin/t2d/edit/main/t2d_11_wcn.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">
<span class="chapter-number">6</span>&nbsp; <span class="chapter-title">WGCNA</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Program 11</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Francois Collin </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 12, 2022</p>
    </div>
  </div>
    
  </div>
  

</header><section id="mrna-seq-mirna---wgcna" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="mrna-seq-mirna---wgcna">
<span class="header-section-number">6.1</span> mRNA Seq / miRNA - WGCNA</h2>
<blockquote class="blockquote">
<p>“<em>The Weighted Correlation Network Analysis (WGCNA) [11,12] corresponds to a data reduction method and unsupervised classification method. It simplifies the interpretation of thousands of gene responses to a dozen of synthetic groups (or modules) of genes. The net establishes connections between genes-genes are connected if their expression is correlated. Genes can be more or less intensively connected depending on the value of the correlation (the weights). The connectivity between genes is then interpreted into a distance, and the distance is used to group genes into modules. This is how a high number of genes can be reduced into a small number of clusters whose expression is quantified by the Eigengenes (first principal component within the module). It relies on the assumption that highly correlated genes within a module are involved in common biological processes.</em>” <span class="citation" data-cites="Niemira2020">Niemira et al. (<a href="references.html#ref-Niemira2020" role="doc-biblioref">2020</a>)</span></p>
</blockquote>
<p>Two gene co-expression networks were obtained, 1) the first one based on baseline samples for NGT and T2D subject samples and 2) the second on training-induced expression variation independently from the study arm. In detail:</p>
<ol type="1">
<li>baseline samples for NGT and T2D were selected, the same inclusion criteria as in the section “<em>Differential expression analysis</em>” were used. Gene expression was transformed using variance stabilizing transformation. The optimal soft-threshold adjacency matrix was graphically determined, then the network was estimated resulting in gene modules and corresponding Eigengenes. The <code>cutreeDynamic</code> algorithm was used for tree pruning of the gene hierarchical clustering dendrogram resulting in co-expression modules; correlated modules (r &gt; 0.80) were merged. The quantitative clinical parameters were centred to the average and scaled-to-variance while factors were decomposed into dummy variables so as to study the association between gene modules and clinical traits quantified with Pearson’s correlation coefficient.</li>
<li>training-induced variation was studied similarly, the approach above was applicable here also, using the difference between variance-stabilizing transformed expression matrix as input to the procedure.</li>
</ol>
<p>Note: it is not possible to use the differentially expressed genes as a starting point. The WGCNA method includes a disclaimer preventing the use of pre-filtered / selected genes based on DEG analysis result.</p>
<p>The module identification was followed by gene set enrichment analysis. To do so, the correlation between gene expression (Variance-Stabilized Transformed values, VST) and the eigengene estimated in every module was used as a measure of module membership. Then, for every module, genesets as defined by the Gene Ontology (GO) project were selected if at least 10 genes belonged to the module. Then, the GSEA procedure was run while considering all expressed genes with existing <em>entrez gene</em> id and determining an enrichment score and associated p.value based on 10000 random permutations. The result focused specifically on enriched and up-regulated genesets, i.e. genesets with over representation of genes with higher correlation with the eigengene within each module.</p>
<p>The analysis was realized with R <span class="citation" data-cites="RCT2022">(v4.2.0, <a href="references.html#ref-RCT2022" role="doc-biblioref">R Core Team 2022</a>)</span>. Note the use of the additional packages downloaded from the RStudio package manager repository (freeze date 2022-05-04, <a href="https://packagemanager.rstudio.com/all/2022-05-04+Y3JhbiwyOjQ1MjYyMTU7NTVFQjhGODU">repos</a>):</p>
<ul>
<li>
<code>MultiAssayExperiment</code> for management of multi-omics experiment objects <span class="citation" data-cites="Ramos2017">(version 1.22.0, <a href="references.html#ref-Ramos2017" role="doc-biblioref">Ramos et al. 2017</a>)</span>
</li>
<li>
<code>DESeq2</code> for differential expression analysis and variance stabilizing transformation <span class="citation" data-cites="Love2014">(version 1.36.0, <a href="references.html#ref-Love2014" role="doc-biblioref">Love, Huber, and Anders 2014</a>)</span>
</li>
<li>
<code>cowplot</code> for figure composition <span class="citation" data-cites="Wilke2020">(version 1.1.1, <a href="references.html#ref-Wilke2020" role="doc-biblioref">Wilke 2020</a>)</span>
</li>
<li>
<code>ggplot2</code> for graphics <span class="citation" data-cites="Wickham2016">(version 3.3.6, <a href="references.html#ref-Wickham2016" role="doc-biblioref">Wickham 2016</a>)</span>
</li>
<li>
<code>WGCNA</code> for gene clustering <span class="citation" data-cites="Langfelder2008">Langfelder and Horvath (<a href="references.html#ref-Langfelder2012" role="doc-biblioref">2012</a>)</span>.</li>
</ul>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cfg_prog</span> <span class="op">&lt;-</span> <span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/read_yaml.html">read_yaml</a></span><span class="op">(</span><span class="st">"_prog.yml"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html">load_all</a></span><span class="op">(</span><span class="st">"src/pkg/dbs.data"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>ℹ Loading dbs.data</code></pre>
</div>
<details><summary>Show the code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html">load_all</a></span><span class="op">(</span><span class="st">"src/pkg/latarnia.utils"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>ℹ Loading latarnia.utils
Loading required package: grid

Loading required package: shiny</code></pre>
</div>
<details><summary>Show the code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>results <span class="op">=</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">knitr</span><span class="op">$</span><span class="va">results</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"R/ngs.R"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"R/inches.R"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"R/export_xl.R"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="materials-and-methods" class="level3" data-number="6.1.1"><h3 data-number="6.1.1" class="anchored" data-anchor-id="materials-and-methods">
<span class="header-section-number">6.1.1</span> Materials and Methods</h3>
<section id="helper-functions" class="level4" data-number="6.1.1.1"><h4 data-number="6.1.1.1" class="anchored" data-anchor-id="helper-functions">
<span class="header-section-number">6.1.1.1</span> Helper functions</h4>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Help for data pre-processing</span></span>
<span><span class="va">filter_for_depth</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span>, <span class="va">assay</span>, <span class="va">depth_threshold</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mae</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">mae</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">depth_threshold</span>, <span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">filter_for_visit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span>, <span class="va">visit</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mae</span><span class="op">[</span>, <span class="fu">colData</span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">avisit</span> <span class="op">==</span> <span class="va">visit</span>, <span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">filter_for_coldata</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span>, <span class="va">col</span>, <span class="va">is</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mae</span><span class="op">[</span>, <span class="fu">colData</span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">is</span>, <span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">filter_for_low_expr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span>, <span class="va">assay</span>, <span class="va">cpm_threshold</span>,</span>
<span>                                <span class="va">frac_cols</span> <span class="op">=</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">rna</span><span class="op">$</span><span class="va">cpm_threshold</span><span class="op">$</span><span class="va">fraccol</span></span>
<span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Genes expressed at least cpm_threshold in frac_cols columns</span></span>
<span>  <span class="va">mae</span><span class="op">[</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu">cpm</span><span class="op">(</span><span class="va">mae</span><span class="op">[[</span><span class="va">assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">cpm_threshold</span><span class="op">)</span> <span class="op">&gt;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">mae</span><span class="op">[[</span><span class="va">assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">frac_cols</span>,</span>
<span>    ,</span>
<span>  <span class="op">]</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="data-preparation" class="level4" data-number="6.1.1.2"><h4 data-number="6.1.1.2" class="anchored" data-anchor-id="data-preparation">
<span class="header-section-number">6.1.1.2</span> Data preparation</h4>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">adsl</span></span>
<span><span class="va">advs</span> <span class="op">&lt;-</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">advs</span></span>
<span><span class="va">adlb</span> <span class="op">&lt;-</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">adlb</span></span>
<span></span>
<span><span class="co">#' Subjid and Visit to Sample</span></span>
<span><span class="co">#' </span></span>
<span><span class="va">subjvis_to_spl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">subjid</span>, <span class="st">"v"</span>, <span class="va">df</span><span class="op">$</span><span class="va">avisitn</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ads</span> <span class="op">&lt;-</span> <span class="va">adlb</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">advs</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ct</span>, <span class="va">dtype</span>, <span class="va">param</span>, <span class="va">base</span>, <span class="va">basetype</span>, <span class="va">chg</span>, <span class="va">pchg</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"paramcd"</span>, values_from <span class="op">=</span> <span class="st">"aval"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">adsl</span>, y <span class="op">=</span> <span class="va">_</span>, by <span class="op">=</span> <span class="st">"subjid"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu">S4Vectors</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html">DataFrame</a></span><span class="op">(</span><span class="va">df</span>, row.names <span class="op">=</span> <span class="fu">subjvis_to_spl</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">assertthat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertthat/man/assert_that.html">assert_that</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu">subjvis_to_spl</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">df</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rna</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  mrna <span class="op">=</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">mrna_raw</span>,</span>
<span>  premirna <span class="op">=</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">premirna_raw</span>,</span>
<span>  mirna <span class="op">=</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">mirna_raw</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rna</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"premirna"</span>, <span class="st">"mirna"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">rna</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"premirna"</span>, <span class="st">"mirna"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">format_mirna</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rows represent genes</span></span>
<span><span class="va">rna</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">rna</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">rna</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">rna</span>, <span class="va">as.matrix</span><span class="op">)</span></span>
<span><span class="fu">assertthat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertthat/man/assert_that.html">assert_that</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">rna</span><span class="op">$</span><span class="va">premirna</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">rna</span><span class="op">$</span><span class="va">mirna</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rna</span><span class="op">$</span><span class="va">allmirna</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">rna</span><span class="op">$</span><span class="va">premirna</span>, <span class="va">rna</span><span class="op">$</span><span class="va">mirna</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org">testthat</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"rna features discriminated in noexpr, expr"</span>, <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">rna</span>, FUN <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html">expect_true</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://waldronlab.io/MultiAssayExperiment/">MultiAssayExperiment</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Loading required package: SummarizedExperiment</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MatrixGenerics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: matrixStats</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MatrixGenerics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:matrixStats':

    colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse,
    colCounts, colCummaxs, colCummins, colCumprods, colCumsums,
    colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs,
    colMads, colMaxs, colMeans2, colMedians, colMins, colOrderStats,
    colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds,
    colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads,
    colWeightedMeans, colWeightedMedians, colWeightedSds,
    colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet,
    rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods,
    rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,
    rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins,
    rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks,
    rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars,
    rowWeightedMads, rowWeightedMeans, rowWeightedMedians,
    rowWeightedSds, rowWeightedVars</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: GenomicRanges</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: stats4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: BiocGenerics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'BiocGenerics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    IQR, mad, sd, var, xtabs</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    anyDuplicated, append, as.data.frame, basename, cbind, colnames,
    dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep,
    grepl, intersect, is.unsorted, lapply, Map, mapply, match, mget,
    order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,
    rbind, Reduce, rownames, sapply, setdiff, sort, table, tapply,
    union, unique, unsplit, which.max, which.min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: S4Vectors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'S4Vectors'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    expand.grid, I, unname</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: IRanges</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: GenomeInfoDb</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Biobase</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome to Bioconductor

    Vignettes contain introductory material; view with
    'browseVignettes()'. To cite Bioconductor, see
    'citation("Biobase")', and for packages 'citation("pkgname")'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Biobase'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:MatrixGenerics':

    rowMedians</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:matrixStats':

    anyMissing, rowMedians</code></pre>
</div>
<details><summary>Show the code</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' (Sample-)Map Arrays</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Use the column names of `x` to deduce the `primary` and `colnames`.</span></span>
<span><span class="co">#' This is used to generate the sample mapping between colData and Experiments.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x (`dataframe`).</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @note In our case, primary and colnames are equivalent, colnames could</span></span>
<span><span class="co">#' be different from primary names when a biological sample has different</span></span>
<span><span class="co">#' names in the biological assays (e.g. machine constraint, technical</span></span>
<span><span class="co">#' repetitions).</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @seealso [MultiAssayExperiment::listToMap()]</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' \dontrun{</span></span>
<span><span class="co">#'   lapply(rna, map_arrays)</span></span>
<span><span class="co">#'   MultiAssayExperiment::listToMap(lapply(rna, map_arrays))</span></span>
<span><span class="co">#' }</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">map_arrays</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>colname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">y</span><span class="op">$</span><span class="va">primary</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">$</span><span class="va">colname</span></span>
<span>  <span class="va">y</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">ads</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">ads</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">besd_mae</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/MultiAssayExperiment.html">MultiAssayExperiment</a></span><span class="op">(</span></span>
<span>  experiments <span class="op">=</span> <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/ExperimentList.html">ExperimentList</a></span><span class="op">(</span><span class="va">rna</span><span class="op">)</span>,</span>
<span>  colData <span class="op">=</span> <span class="va">ads</span>,</span>
<span>  sampleMap <span class="op">=</span> <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/mapToList.html">listToMap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">rna</span>, <span class="va">map_arrays</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">besd_mae</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="mirna-baseline" class="level3" data-number="6.1.2"><h3 data-number="6.1.2" class="anchored" data-anchor-id="mirna-baseline">
<span class="header-section-number">6.1.2</span> miRNA / Baseline</h3>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' # https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/FemaleLiver-01-dataInput.pdf</span></span>
<span><span class="co">#' # WGCNA: gene in rows, sample in cols</span></span>
<span></span>
<span><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">rna</span></span>
<span><span class="va">ngs_assay</span> <span class="op">&lt;-</span> <span class="st">"allmirna"</span></span>
<span><span class="va">ctrl_wgcna</span> <span class="op">&lt;-</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">rna</span><span class="op">$</span><span class="va">wgcna</span><span class="op">$</span><span class="va">baseline</span><span class="op">$</span><span class="va">allmirna</span></span>
<span></span>
<span><span class="co"># Specific to sample_clustering</span></span>
<span><span class="va">col_fill</span> <span class="op">&lt;-</span> <span class="st">"glu120"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dta</span> <span class="op">&lt;-</span> <span class="va">besd_mae</span> <span class="op">|&gt;</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="va">mae</span><span class="op">[</span> , , <span class="va">ngs_assay</span><span class="op">]</span><span class="op">)</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter_for_depth</span><span class="op">(</span><span class="va">ngs_assay</span>, <span class="va">ctrl</span><span class="op">$</span><span class="va">depth_threshold</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter_for_coldata</span><span class="op">(</span><span class="st">"avisit"</span>, is <span class="op">=</span> <span class="st">"Baseline"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter_for_coldata</span><span class="op">(</span><span class="st">"diabcd"</span>, is <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NGT"</span>, <span class="st">"T2D"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter_for_low_expr</span><span class="op">(</span><span class="va">ngs_assay</span>, <span class="va">ctrl</span><span class="op">$</span><span class="va">cpm_threshold</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mae</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>      <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/DESeqDataSet.html">DESeqDataSetFromMatrix</a></span><span class="op">(</span></span>
<span>        countData <span class="op">=</span> <span class="va">mae</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span>,</span>
<span>        colData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mae</span><span class="op">)</span>,</span>
<span>        design <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="op">~</span> <span class="va">diabcd</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/varianceStabilizingTransformation.html">varianceStabilizingTransformation</a></span><span class="op">(</span>blind <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">assay</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">mae</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: 'experiments' dropped; see 'metadata'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>harmonizing input:
  removing 282 sampleMap rows not in names(experiments)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>factor levels were dropped which had no samples</code></pre>
</div>
<details><summary>Show the code</summary><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' WGCNA Expression data.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' A matrix or data frame in which columns are genes and rows ar samples.</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">dta_expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">dta</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">assert_that</span><span class="op">(</span><span class="fu">WGCNA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/goodSamplesGenes.html">goodSamplesGenes</a></span><span class="op">(</span><span class="va">dta_expr</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">$</span><span class="va">allOK</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<details><summary>Show the code</summary><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dta_traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">dta</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="sample-clustering-oid-1" class="level4" data-number="6.1.2.1"><h4 data-number="6.1.2.1" class="anchored" data-anchor-id="sample-clustering-oid-1">
<span class="header-section-number">6.1.2.1</span> Sample clustering (OID 1)</h4>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spl_clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">dta_expr</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"complete"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clustering Dendrogram of samples based on their Euclidean distance</span></span>
<span><span class="va">theme_custom</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/theme_dendro.html">theme_dendro</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>      plot.margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="st">"null"</span><span class="op">)</span>,</span>
<span>      panel.spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="st">"null"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/andrie/ggdendro">ggdendro</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">dend</span> <span class="op">&lt;-</span> <span class="va">spl_clust</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html">as.dendrogram</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dta_traits</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">)</span></span>
<span><span class="va">dta_traits</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">$</span><span class="va">x</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span><span class="op">(</span><span class="va">dend</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dta_traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/nobs.html">nobs</a></span><span class="op">(</span><span class="va">dend</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ddata</span> <span class="op">&lt;-</span> <span class="fu">ggdendro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/dendro_data.html">dendro_data</a></span><span class="op">(</span><span class="va">dend</span>, type <span class="op">=</span> <span class="st">"rectangle"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggdendro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/segment.html">segment</a></span><span class="op">(</span><span class="va">ddata</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span>clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_reverse</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/nobs.html">nobs</a></span><span class="op">(</span><span class="va">dend</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu">ggdendro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/segment.html">label</a></span><span class="op">(</span><span class="va">ddata</span><span class="op">)</span><span class="op">$</span><span class="va">label</span>,</span>
<span>    lim <span class="op">=</span> <span class="va">lim</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_custom</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">dta_traits</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">diabcd</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">34</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"C"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, begin <span class="op">=</span> <span class="fl">.2</span>, end <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="va">lim</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_custom</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">dta_traits</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>    fill <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/name.html">as.name</a></span><span class="op">(</span><span class="va">col_fill</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">34</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="va">lim</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_custom</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">egg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/egg/man/ggarrange.html">ggarrange</a></span><span class="op">(</span></span>
<span>  <span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p4</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  padding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>  draw <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">title</span> <span class="op">&lt;-</span> <span class="st">"miRNA / Baseline - Clustering dendrogram of samples based on their</span></span>
<span><span class="st">  Euclidean distance and trait heatmap"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">clean_slate</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_title</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Figure 11."</span>,   <span class="va">oid</span><span class="op">)</span>,</span>
<span>    <span class="fu">wrap_long_lines</span><span class="op">(</span><span class="va">title</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_figure</span><span class="op">(</span><span class="va">p</span>, height <span class="op">=</span> <span class="fu">inches</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_note</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Note: VST transformed expression matrix used to estimate distances</span></span>
<span><span class="st">    between samples, _complete_ method was used for the hierarchical</span></span>
<span><span class="st">    clustering."</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">oid</span>, <span class="fl">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="fu">export_as</span><span class="op">(</span></span>
<span>  <span class="va">p</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">".pdf"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  file_graph_alone <span class="op">=</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">"_af.pdf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_01.pdf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_01_af.pdf (annot. free)</code></pre>
</div>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">show_slate</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="gene-clustering" class="level4" data-number="6.1.2.2"><h4 data-number="6.1.2.2" class="anchored" data-anchor-id="gene-clustering">
<span class="header-section-number">6.1.2.2</span> Gene Clustering</h4>
<section id="soft-threshold-determination-oid-2" class="level5" data-number="6.1.2.2.1"><h5 data-number="6.1.2.2.1" class="anchored" data-anchor-id="soft-threshold-determination-oid-2">
<span class="header-section-number">6.1.2.2.1</span> Soft threshold determination (OID 2)</h5>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/">WGCNA</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Loading required package: dynamicTreeCut</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: fastcluster</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'fastcluster'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    hclust</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'WGCNA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:IRanges':

    cor</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:S4Vectors':

    cor</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    cor</code></pre>
</div>
<details><summary>Show the code</summary><div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/allowWGCNAThreads.html">enableWGCNAThreads</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pwr</span> <span class="op">&lt;-</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">adjacency</span><span class="op">$</span><span class="va">power</span></span>
<span><span class="va">sft</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/pickSoftThreshold.html">pickSoftThreshold</a></span><span class="op">(</span></span>
<span>  <span class="va">dta_expr</span>,</span>
<span>  powerVector <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">12</span>, to<span class="op">=</span><span class="fl">20</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Power</span>, <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span> <span class="op">*</span> <span class="va">SFT.R.sq</span>, label <span class="op">=</span> <span class="va">Power</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">.9</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    vjust <span class="op">=</span> <span class="fl">0</span>, nudge_y <span class="op">=</span> <span class="fl">.025</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">Power</span>, yend <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, yend <span class="op">=</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span> <span class="op">*</span> <span class="va">SFT.R.sq</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span> <span class="op">=</span> <span class="fl">21</span>, <span class="st">"FALSE"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Soft Threshold (power)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Scale Free Topology Model Fit"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Scale independence"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Power</span>, <span class="va">mean.k.</span>, label <span class="op">=</span> <span class="va">Power</span>, shape <span class="op">=</span> <span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">Power</span>, yend <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, yend <span class="op">=</span> <span class="va">mean.k.</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    vjust <span class="op">=</span> <span class="fl">0</span>, hjust <span class="op">=</span> <span class="fl">0</span>, nudge_y <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span> <span class="op">=</span> <span class="fl">21</span>, <span class="st">"FALSE"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Soft Threshold (power)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Mean connectivity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Mean connectivity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">egg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/egg/man/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow <span class="op">=</span> <span class="fl">1</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">title</span> <span class="op">&lt;-</span> <span class="st">"Micro-RNA / Baseline - Soft threshold determination"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">clean_slate</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_title</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Figure 11."</span>, <span class="va">oid</span><span class="op">)</span>,</span>
<span>    <span class="va">title</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_figure</span><span class="op">(</span><span class="va">p</span>, width <span class="op">=</span> <span class="fu">inches</span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>, height <span class="op">=</span> <span class="fu">inches</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">oid</span>, <span class="fl">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="fu">export_as</span><span class="op">(</span></span>
<span>  <span class="va">p</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">".pdf"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  file_graph_alone <span class="op">=</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">"_af.pdf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_02.pdf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_02_af.pdf (annot. free)</code></pre>
</div>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">show_slate</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="network" class="level5" data-number="6.1.2.2.2"><h5 data-number="6.1.2.2.2" class="anchored" data-anchor-id="network">
<span class="header-section-number">6.1.2.2.2</span> Network</h5>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># gene dissimilarity</span></span>
<span><span class="va">tom_dis</span> <span class="op">&lt;-</span> <span class="va">dta_expr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/adjacency.html">adjacency</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">adjacency</span><span class="op">$</span><span class="va">type</span>,</span>
<span>    power <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">adjacency</span><span class="op">$</span><span class="va">power</span>,</span>
<span>    corFnc <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">adjacency</span><span class="op">$</span><span class="va">cor_fn</span><span class="op">$</span><span class="va">value</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/TOMsimilarity.html">TOMsimilarity</a></span><span class="op">(</span>TOMType <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">tom</span><span class="op">$</span><span class="va">type</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">tom</span><span class="op">)</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">tom</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gene_hc</span> <span class="op">&lt;-</span> <span class="va">tom_dis</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/fastcluster/man/hclust.html">hclust</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># gene clustering</span></span>
<span><span class="va">dyn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dynamicTreeCut/man/cutreeDynamic.html">cutreeDynamic</a></span><span class="op">(</span></span>
<span>  <span class="va">gene_hc</span>,</span>
<span>  cutHeight <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">cuttree</span><span class="op">$</span><span class="va">cut_height</span>,</span>
<span>  minClusterSize <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">cuttree</span><span class="op">$</span><span class="va">min_cluster_size</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"hybrid"</span>,</span>
<span>  distM <span class="op">=</span> <span class="va">tom_dis</span>,</span>
<span>  deepSplit <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">cuttree</span><span class="op">$</span><span class="va">deep_split</span>,</span>
<span>  pamRespectsDendro <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dyn_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/labels2colors.html">labels2colors</a></span><span class="op">(</span><span class="va">dyn_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># me: module eigengenes (also used to merge dyn_col)</span></span>
<span><span class="va">dyn_mge</span> <span class="op">&lt;-</span> <span class="va">dta_expr</span> <span class="op">|&gt;</span> <span class="fu">WGCNA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/mergeCloseModules.html">mergeCloseModules</a></span><span class="op">(</span><span class="va">dyn_col</span><span class="op">)</span></span>
<span><span class="va">meig</span> <span class="op">&lt;-</span> <span class="va">dyn_mge</span><span class="op">$</span><span class="va">newMEs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Not exported yet</span></span>
<span><span class="fu">WGCNA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/plotDendroAndColors.html">plotDendroAndColors</a></span><span class="op">(</span></span>
<span>  dendro <span class="op">=</span> <span class="va">gene_hc</span>,</span>
<span>  colors <span class="op">=</span> <span class="va">dyn_mge</span><span class="op">$</span><span class="va">color</span>,</span>
<span>  dendroLabels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  addGuide <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  guideHang <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  groupLabels <span class="op">=</span> <span class="st">""</span>,</span>
<span>  cex.rowText <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  cex.colorLabels <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  cex.dendroLabels <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  marAll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ylab <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  main <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="eigengenes-exploration" class="level4" data-number="6.1.2.3"><h4 data-number="6.1.2.3" class="anchored" data-anchor-id="eigengenes-exploration">
<span class="header-section-number">6.1.2.3</span> Eigengenes exploration</h4>
<section id="oid-3---heatmap" class="level5" data-number="6.1.2.3.1"><h5 data-number="6.1.2.3.1" class="anchored" data-anchor-id="oid-3---heatmap">
<span class="header-section-number">6.1.2.3.1</span> OID 3 - Heatmap</h5>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">theme_custom_dend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">gg</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">gg</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>      axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span></span>
<span>        fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="st">"transparent"</span></span>
<span>      <span class="op">)</span>,</span>
<span>      panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span></span>
<span>        fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="st">"transparent"</span></span>
<span>      <span class="op">)</span>,</span>
<span>      plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span></span>
<span>        fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="st">"transparent"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' @describeIn wrap_wgcna improved correlation matrix.</span></span>
<span><span class="co">#' @param mat_y,mat_x the matrix used in rows or columns.</span></span>
<span><span class="co">#' @param draw (`logical`)</span></span>
<span><span class="co">#' @param newpage (`logical`)</span></span>
<span><span class="co">#' @import ggplot2</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">gg_eigen</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mat_y</span>, <span class="va">mat_x</span>, <span class="va">draw</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">newpage</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">dta</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">mat_y</span>, <span class="va">mat_x</span>, use <span class="op">=</span> <span class="st">"pairwise.complete.obs"</span><span class="op">)</span></span>
<span>  <span class="va">dta</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span></span>
<span>    <span class="va">dta</span>, varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"eig"</span>, <span class="st">"traits"</span><span class="op">)</span>, value.name <span class="op">=</span> <span class="st">"cor"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">dta</span><span class="op">$</span><span class="va">cor_pval</span> <span class="op">&lt;-</span> <span class="fu">WGCNA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/corPvalueStudent.html">corPvalueStudent</a></span><span class="op">(</span><span class="va">dta</span><span class="op">$</span><span class="va">cor</span>, nSamples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">mat_x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">dendro_y</span>   <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span>d <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">mat_y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">dendro_y</span>   <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html">as.dendrogram</a></span><span class="op">(</span><span class="va">dendro_y</span><span class="op">)</span>;</span>
<span>  <span class="va">y_neworder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span><span class="op">(</span><span class="va">dendro_y</span><span class="op">)</span></span>
<span>  <span class="va">dendro_y</span>   <span class="op">&lt;-</span> <span class="fu">ggdendro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/ggdendrogram.html">ggdendrogram</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dendro_y</span>, rotate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="op">-</span><span class="fl">0.2</span><span class="op">)</span>, units<span class="op">=</span><span class="st">"lines"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">dendro_y</span> <span class="op">&lt;-</span> <span class="fu">theme_custom_dend</span><span class="op">(</span>gg <span class="op">=</span> <span class="va">dendro_y</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">dendro_x</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">mat_x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">dendro_x</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span>d <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dendro_x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">dendro_x</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html">as.dendrogram</a></span><span class="op">(</span><span class="va">dendro_x</span><span class="op">)</span></span>
<span>  <span class="va">x_neworder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span><span class="op">(</span><span class="va">dendro_x</span><span class="op">)</span></span>
<span>  <span class="va">dendro_x</span> <span class="op">&lt;-</span> <span class="fu">ggdendro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/ggdendrogram.html">ggdendrogram</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dendro_x</span>, rotate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="op">-</span><span class="fl">.8</span>,<span class="fl">0</span><span class="op">)</span>, units<span class="op">=</span><span class="st">"lines"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">dendro_x</span> <span class="op">&lt;-</span> <span class="fu">theme_custom_dend</span><span class="op">(</span>gg <span class="op">=</span> <span class="va">dendro_x</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">dta</span><span class="op">$</span><span class="va">traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dta</span><span class="op">$</span><span class="va">traits</span>, levels <span class="op">=</span> <span class="va">x_neworder</span><span class="op">)</span></span>
<span>  <span class="va">dta</span><span class="op">$</span><span class="va">eig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dta</span><span class="op">$</span><span class="va">eig</span>, levels <span class="op">=</span> <span class="va">y_neworder</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">dta</span><span class="op">$</span><span class="va">cor_pval_2d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">dta</span><span class="op">$</span><span class="va">cor_pval</span>, <span class="fl">2</span><span class="op">)</span>, nsmall <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Create heatmap plot</span></span>
<span>  <span class="va">heatmap.plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">dta</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"traits"</span>, y <span class="op">=</span> <span class="st">"eig"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dta</span>, fill <span class="op">=</span> <span class="st">"transparent"</span>, col <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span></span>
<span>      data <span class="op">=</span> <span class="va">dta</span><span class="op">[</span><span class="va">dta</span><span class="op">$</span><span class="va">cor_pval</span> <span class="op">&lt;</span> <span class="fl">0.1</span>, <span class="op">]</span>,</span>
<span>      mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"cor"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span></span>
<span>      data <span class="op">=</span> <span class="va">dta</span><span class="op">[</span><span class="va">dta</span><span class="op">$</span><span class="va">cor_pval</span> <span class="op">&lt;</span> <span class="fl">0.1</span>, <span class="op">]</span>,</span>
<span>      mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"cor_pval_2d"</span><span class="op">)</span>,</span>
<span>      col <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">2</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span></span>
<span>      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">.2</span><span class="op">)</span>,</span>
<span>      name <span class="op">=</span> <span class="st">"Corr."</span>,</span>
<span>      guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html">guide_colourbar</a></span><span class="op">(</span>barheight <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>      option <span class="op">=</span> <span class="st">"B"</span>,</span>
<span>      direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>      lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      begin <span class="op">=</span> <span class="fl">.1</span>,</span>
<span>      end <span class="op">=</span> <span class="fl">.9</span></span>
<span>    <span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span></span>
<span>      expand <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>      axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      legend.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>      axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>      legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span></span>
<span>        fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="st">"transparent"</span></span>
<span>      <span class="op">)</span>,</span>
<span>      panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span></span>
<span>        fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="st">"transparent"</span></span>
<span>      <span class="op">)</span>,</span>
<span>      plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span></span>
<span>        fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="st">"transparent"</span></span>
<span>      <span class="op">)</span>,</span>
<span>      legend.key.width <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">.3</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op">(</span><span class="va">heatmap.plot</span><span class="op">)</span></span>
<span>  <span class="va">a2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op">(</span><span class="va">dendro_y</span><span class="op">)</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">a1</span>, <span class="va">a2</span>, size <span class="op">=</span> <span class="st">"max"</span><span class="op">)</span></span>
<span>  <span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op">(</span><span class="va">dendro_x</span><span class="op">)</span></span>
<span>  <span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">gtable</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gtable/man/gtable_add_cols.html">gtable_add_cols</a></span><span class="op">(</span></span>
<span>    <span class="va">b</span>,</span>
<span>    widths <span class="op">=</span> <span class="va">a1</span><span class="op">$</span><span class="va">widths</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">a1</span><span class="op">$</span><span class="va">widths</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">widths</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    pos <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">gtable</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gtable/man/gtable_add_cols.html">gtable_add_cols</a></span><span class="op">(</span><span class="va">b</span>, widths <span class="op">=</span> <span class="va">a2</span><span class="op">$</span><span class="va">widths</span>, pos <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">ab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">b</span>, <span class="va">a</span>, size <span class="op">=</span> <span class="st">"last"</span><span class="op">)</span></span>
<span>  <span class="va">ab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">b</span>, <span class="va">a</span>, size <span class="op">=</span> <span class="st">"last"</span>, z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ab</span><span class="op">$</span><span class="va">heights</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">3</span>, <span class="st">"lines"</span><span class="op">)</span></span>
<span>  <span class="va">ab</span><span class="op">$</span><span class="va">widths</span><span class="op">[</span><span class="fl">16</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">3</span>, <span class="st">"lines"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">draw</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">newpage</span><span class="op">)</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.newpage.html">grid.newpage</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.draw.html">grid.draw</a></span><span class="op">(</span><span class="va">ab</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    gg <span class="op">=</span> <span class="va">ab</span>,</span>
<span>    data <span class="op">=</span> <span class="va">dta</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">prep_col</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html">UseMethod</a></span><span class="op">(</span><span class="st">"prep_col"</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="va">prep_col.numeric</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/identity.html">identity</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">prep_col.factor</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">prep_col.character</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="fu">prep_col</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">gg_eigen</span><span class="op">(</span></span>
<span>  <span class="va">dta_traits</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="va">diabcd</span>, <span class="va">diab</span>, <span class="va">age</span>, <span class="va">trainn</span>,</span>
<span>      <span class="va">chol</span>, <span class="va">glu0</span>, <span class="va">glu120</span>, <span class="va">glu30</span>, <span class="va">glu60</span>, <span class="va">hba1c</span>, <span class="va">hdl</span>,</span>
<span>      <span class="va">homab</span>, <span class="va">homair</span>, <span class="va">insulin0</span>, <span class="va">insulin120</span>, <span class="va">insulin30</span>, <span class="va">insulin60</span>, <span class="va">ldl</span>,</span>
<span>      <span class="va">matsuda</span>, <span class="va">trig</span>, <span class="va">bmi</span>, <span class="va">bodyfatp</span>, <span class="va">dcal</span>, <span class="va">dcarbt</span>, <span class="va">dfatt</span>,</span>
<span>      <span class="va">dprot</span>, <span class="va">fatacfr</span>, <span class="va">fatmass</span>, <span class="va">leanmass</span>, <span class="va">smmass</span>, <span class="va">vat</span>, <span class="va">vo2maxe</span>,</span>
<span>      <span class="va">vo2maxlbm</span>, <span class="va">vo2maxml</span>, <span class="va">weight</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">prep_col</span><span class="op">)</span><span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html">DataFrame</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">meig</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Scale for 'x' is already present. Adding another scale for 'x', which will
replace the existing scale.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'x' is already present. Adding another scale for 'x', which will
replace the existing scale.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fl">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">clean_slate</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_figure</span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">gg</span><span class="op">)</span></span>
<span></span>
<span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">oid</span>, <span class="fl">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="fu">export_as</span><span class="op">(</span></span>
<span>  <span class="va">p</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">".pdf"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  file_graph_alone <span class="op">=</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">"_af.pdf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_03.pdf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_03_af.pdf (annot. free)</code></pre>
</div>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">show_slate</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="oid-4---excel-file" class="level5" data-number="6.1.2.3.2"><h5 data-number="6.1.2.3.2" class="anchored" data-anchor-id="oid-4---excel-file">
<span class="header-section-number">6.1.2.3.2</span> OID 4 - Excel file</h5>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">title</span> <span class="op">&lt;-</span> <span class="st">"miRNA at baseline - WGCNA modules"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spl_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">dyn_mge</span><span class="op">$</span><span class="va">oldMEs</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>      cols <span class="op">=</span> <span class="op">-</span><span class="st">"sample"</span>,</span>
<span>      names_to <span class="op">=</span> <span class="st">"module"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html">within</a></span><span class="op">(</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"raw_me"</span><span class="op">)</span>,</span>
<span>  <span class="va">dyn_mge</span><span class="op">$</span><span class="va">newMEs</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>      cols <span class="op">=</span> <span class="op">-</span><span class="st">"sample"</span>,</span>
<span>      names_to <span class="op">=</span> <span class="st">"module"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html">within</a></span><span class="op">(</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"merged_me"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ft_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dta_expr</span><span class="op">)</span>,</span>
<span>  raw_me <span class="op">=</span> <span class="va">dyn_col</span>,</span>
<span>  merged_me <span class="op">=</span> <span class="va">dyn_mge</span><span class="op">$</span><span class="va">colors</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">oid</span>, <span class="fl">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">export_xl</span><span class="op">(</span></span>
<span>  ft_mod <span class="op">=</span> <span class="va">ft_mod</span>,</span>
<span>  spl_mod <span class="op">=</span> <span class="va">spl_mod</span>,</span>
<span>  info <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="va">title</span>,</span>
<span>    ft_mod <span class="op">=</span> <span class="fu">wrap_long_lines</span><span class="op">(</span></span>
<span>      <span class="st">"Associate genetic features with calculated module (a feature belongs to</span></span>
<span><span class="st">      a module)"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    spl_mod <span class="op">=</span> <span class="st">"Sample eigengen value (eigengen _expression profile_)"</span>,</span>
<span>    source <span class="op">=</span> <span class="st">"UMB-BESD"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  dir <span class="op">=</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>,</span>
<span>  basenm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span><span class="op">)</span>,</span>
<span>  rdata <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>RData output (binary: ../tlg/graph/t2d_11_04.RData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Excel output: ../tlg/graph/t2d_11_04.xlsx</code></pre>
</div>
</div>
</section></section></section><section id="mrna-baseline" class="level3" data-number="6.1.3"><h3 data-number="6.1.3" class="anchored" data-anchor-id="mrna-baseline">
<span class="header-section-number">6.1.3</span> mRNA / Baseline</h3>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' # https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/FemaleLiver-01-dataInput.pdf</span></span>
<span><span class="co">#' # WGCNA: gene in rows, sample in cols</span></span>
<span></span>
<span><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">rna</span></span>
<span><span class="va">ngs_assay</span> <span class="op">&lt;-</span> <span class="st">"mrna"</span></span>
<span><span class="va">ctrl_wgcna</span> <span class="op">&lt;-</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">rna</span><span class="op">$</span><span class="va">wgcna</span><span class="op">$</span><span class="va">baseline</span><span class="op">$</span><span class="va">mrna</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dta</span> <span class="op">&lt;-</span> <span class="va">besd_mae</span> <span class="op">|&gt;</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="va">mae</span><span class="op">[</span> , , <span class="va">ngs_assay</span><span class="op">]</span><span class="op">)</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter_for_depth</span><span class="op">(</span><span class="va">ngs_assay</span>, <span class="va">ctrl</span><span class="op">$</span><span class="va">depth_threshold</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter_for_coldata</span><span class="op">(</span><span class="st">"avisit"</span>, is <span class="op">=</span> <span class="st">"Baseline"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter_for_coldata</span><span class="op">(</span><span class="st">"diabcd"</span>, is <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NGT"</span>, <span class="st">"T2D"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter_for_low_expr</span><span class="op">(</span><span class="va">ngs_assay</span>, <span class="va">ctrl</span><span class="op">$</span><span class="va">cpm_threshold</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mae</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>      <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/DESeqDataSet.html">DESeqDataSetFromMatrix</a></span><span class="op">(</span></span>
<span>        countData <span class="op">=</span> <span class="va">mae</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span>,</span>
<span>        colData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mae</span><span class="op">)</span>,</span>
<span>        design <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="op">~</span> <span class="va">diabcd</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/varianceStabilizingTransformation.html">varianceStabilizingTransformation</a></span><span class="op">(</span>blind <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">assay</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">mae</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: 'experiments' dropped; see 'metadata'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>harmonizing input:
  removing 282 sampleMap rows not in names(experiments)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>factor levels were dropped which had no samples</code></pre>
</div>
<details><summary>Show the code</summary><div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' WGCNA Expression data.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' A matrix or data frame in which columns are genes and rows ar samples.</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">dta_expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">dta</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">assert_that</span><span class="op">(</span><span class="fu">WGCNA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/goodSamplesGenes.html">goodSamplesGenes</a></span><span class="op">(</span><span class="va">dta_expr</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">$</span><span class="va">allOK</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dta_traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">dta</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">expr_desc</span> <span class="op">&lt;-</span> <span class="st">"mRNA / Baseline - VST"</span></span>
<span><span class="va">exportas</span> <span class="op">&lt;-</span> <span class="st">"dta_11_01.RData"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">dta_expr</span>, <span class="st">"desc"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">expr_desc</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">dta_expr</span>, <span class="st">"label"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Variance-Stabilised Transformed expression matrix"</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">dta_expr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">filenm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">dta</span>, <span class="va">exportas</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">dta_expr</span>, file <span class="op">=</span> <span class="va">filenm</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Export: "</span>, <span class="va">filenm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Export: ../data/dta_11_01.RData</code></pre>
</div>
<details><summary>Show the code</summary><div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">expr_desc</span>, <span class="va">exportas</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="sample-clustering-oid-5" class="level4" data-number="6.1.3.1"><h4 data-number="6.1.3.1" class="anchored" data-anchor-id="sample-clustering-oid-5">
<span class="header-section-number">6.1.3.1</span> Sample clustering (OID 5)</h4>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb89"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spl_clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fastcluster/man/hclust.html">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">dta_expr</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"complete"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clustering Dendrogram of samples based on their Euclidean distance</span></span>
<span><span class="va">theme_custom</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/theme_dendro.html">theme_dendro</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>      plot.margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="st">"null"</span><span class="op">)</span>,</span>
<span>      panel.spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="st">"null"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/andrie/ggdendro">ggdendro</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">dend</span> <span class="op">&lt;-</span> <span class="va">spl_clust</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html">as.dendrogram</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dta_traits</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">)</span></span>
<span><span class="va">dta_traits</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">$</span><span class="va">x</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span><span class="op">(</span><span class="va">dend</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dta_traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/nobs.html">nobs</a></span><span class="op">(</span><span class="va">dend</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ddata</span> <span class="op">&lt;-</span> <span class="fu">ggdendro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/dendro_data.html">dendro_data</a></span><span class="op">(</span><span class="va">dend</span>, type <span class="op">=</span> <span class="st">"rectangle"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggdendro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/segment.html">segment</a></span><span class="op">(</span><span class="va">ddata</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span>clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_reverse</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/nobs.html">nobs</a></span><span class="op">(</span><span class="va">dend</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu">ggdendro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/segment.html">label</a></span><span class="op">(</span><span class="va">ddata</span><span class="op">)</span><span class="op">$</span><span class="va">label</span>,</span>
<span>    lim <span class="op">=</span> <span class="va">lim</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_custom</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">dta_traits</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">diabcd</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">34</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"C"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, begin <span class="op">=</span> <span class="fl">.2</span>, end <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="va">lim</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_custom</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">dta_traits</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>    fill <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/name.html">as.name</a></span><span class="op">(</span><span class="va">col_fill</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">34</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="va">lim</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_custom</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">egg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/egg/man/ggarrange.html">ggarrange</a></span><span class="op">(</span></span>
<span>  <span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p4</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  padding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>  draw <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">title</span> <span class="op">&lt;-</span> <span class="st">"mRNA / Baseline -Clustering dendrogram of samples based on their</span></span>
<span><span class="st">  Euclidean distance and trait heatmap"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb91"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">clean_slate</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_title</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Figure 11."</span>,   <span class="va">oid</span><span class="op">)</span>,</span>
<span>    <span class="fu">wrap_long_lines</span><span class="op">(</span><span class="va">title</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_figure</span><span class="op">(</span><span class="va">p</span>, height <span class="op">=</span> <span class="fu">inches</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_note</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Note: VST transformed expression matrix used to estimate distances</span></span>
<span><span class="st">    between samples, _complete_ method was used for the hierarchical</span></span>
<span><span class="st">    clustering."</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">oid</span>, <span class="fl">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="fu">export_as</span><span class="op">(</span></span>
<span>  <span class="va">p</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">".pdf"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  file_graph_alone <span class="op">=</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">"_af.pdf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_05.pdf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_05_af.pdf (annot. free)</code></pre>
</div>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">show_slate</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="gene-clustering-1" class="level4" data-number="6.1.3.2"><h4 data-number="6.1.3.2" class="anchored" data-anchor-id="gene-clustering-1">
<span class="header-section-number">6.1.3.2</span> Gene Clustering</h4>
<section id="soft-threshold-determination-oid-6" class="level5" data-number="6.1.3.2.1"><h5 data-number="6.1.3.2.1" class="anchored" data-anchor-id="soft-threshold-determination-oid-6">
<span class="header-section-number">6.1.3.2.1</span> Soft threshold determination (OID 6)</h5>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb95"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/">WGCNA</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/allowWGCNAThreads.html">enableWGCNAThreads</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pwr</span> <span class="op">&lt;-</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">adjacency</span><span class="op">$</span><span class="va">power</span></span>
<span><span class="va">sft</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/pickSoftThreshold.html">pickSoftThreshold</a></span><span class="op">(</span></span>
<span>  <span class="va">dta_expr</span>,</span>
<span>  powerVector <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">12</span>, to<span class="op">=</span><span class="fl">20</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Power</span>, <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span> <span class="op">*</span> <span class="va">SFT.R.sq</span>, label <span class="op">=</span> <span class="va">Power</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">.9</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    vjust <span class="op">=</span> <span class="fl">0</span>, nudge_y <span class="op">=</span> <span class="fl">.025</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">Power</span>, yend <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, yend <span class="op">=</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span> <span class="op">*</span> <span class="va">SFT.R.sq</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span> <span class="op">=</span> <span class="fl">21</span>, <span class="st">"FALSE"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Soft Threshold (power)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Scale Free Topology Model Fit"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Scale independence"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Power</span>, <span class="va">mean.k.</span>, label <span class="op">=</span> <span class="va">Power</span>, shape <span class="op">=</span> <span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">Power</span>, yend <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, yend <span class="op">=</span> <span class="va">mean.k.</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    vjust <span class="op">=</span> <span class="fl">0</span>, hjust <span class="op">=</span> <span class="fl">0</span>, nudge_y <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span> <span class="op">=</span> <span class="fl">21</span>, <span class="st">"FALSE"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Soft Threshold (power)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Mean connectivity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Mean connectivity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">egg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/egg/man/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow <span class="op">=</span> <span class="fl">1</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span><span class="va">title</span> <span class="op">&lt;-</span> <span class="st">"mRNA / Baseline - Soft threshold determination"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb97"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">clean_slate</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_title</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Figure 11."</span>, <span class="va">oid</span><span class="op">)</span>,</span>
<span>    <span class="va">title</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_figure</span><span class="op">(</span><span class="va">p</span>, width <span class="op">=</span> <span class="fu">inches</span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>, height <span class="op">=</span> <span class="fu">inches</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">oid</span>, <span class="fl">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="fu">export_as</span><span class="op">(</span></span>
<span>  <span class="va">p</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">".pdf"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  file_graph_alone <span class="op">=</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">"_af.pdf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_06.pdf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_06_af.pdf (annot. free)</code></pre>
</div>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">show_slate</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="network-1" class="level5" data-number="6.1.3.2.2"><h5 data-number="6.1.3.2.2" class="anchored" data-anchor-id="network-1">
<span class="header-section-number">6.1.3.2.2</span> Network</h5>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb101"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># gene dissimilarity</span></span>
<span><span class="va">tom_dis</span> <span class="op">&lt;-</span> <span class="va">dta_expr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/adjacency.html">adjacency</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">adjacency</span><span class="op">$</span><span class="va">type</span>,</span>
<span>    power <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">adjacency</span><span class="op">$</span><span class="va">power</span>,</span>
<span>    corFnc <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">adjacency</span><span class="op">$</span><span class="va">cor_fn</span><span class="op">$</span><span class="va">value</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/TOMsimilarity.html">TOMsimilarity</a></span><span class="op">(</span>TOMType <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">tom</span><span class="op">$</span><span class="va">type</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">tom</span><span class="op">)</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">tom</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gene_hc</span> <span class="op">&lt;-</span> <span class="va">tom_dis</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/fastcluster/man/hclust.html">hclust</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># gene clustering</span></span>
<span><span class="va">dyn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dynamicTreeCut/man/cutreeDynamic.html">cutreeDynamic</a></span><span class="op">(</span></span>
<span>  <span class="va">gene_hc</span>,</span>
<span>  cutHeight <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">cuttree</span><span class="op">$</span><span class="va">cut_height</span>,</span>
<span>  minClusterSize <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">cuttree</span><span class="op">$</span><span class="va">min_cluster_size</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"hybrid"</span>,</span>
<span>  distM <span class="op">=</span> <span class="va">tom_dis</span>,</span>
<span>  deepSplit <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">cuttree</span><span class="op">$</span><span class="va">deep_split</span>,</span>
<span>  pamRespectsDendro <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dyn_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/labels2colors.html">labels2colors</a></span><span class="op">(</span><span class="va">dyn_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># me: module eigengenes (also used to merge dyn_col)</span></span>
<span><span class="va">dyn_mge</span> <span class="op">&lt;-</span> <span class="va">dta_expr</span> <span class="op">|&gt;</span> <span class="fu">WGCNA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/mergeCloseModules.html">mergeCloseModules</a></span><span class="op">(</span><span class="va">dyn_col</span><span class="op">)</span></span>
<span><span class="va">meig</span> <span class="op">&lt;-</span> <span class="va">dyn_mge</span><span class="op">$</span><span class="va">newMEs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb102"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Not exported yet</span></span>
<span><span class="fu">WGCNA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/plotDendroAndColors.html">plotDendroAndColors</a></span><span class="op">(</span></span>
<span>  dendro <span class="op">=</span> <span class="va">gene_hc</span>,</span>
<span>  colors <span class="op">=</span> <span class="va">dyn_mge</span><span class="op">$</span><span class="va">color</span>,</span>
<span>  dendroLabels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  addGuide <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  guideHang <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  groupLabels <span class="op">=</span> <span class="st">""</span>,</span>
<span>  cex.rowText <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  cex.colorLabels <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  cex.dendroLabels <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  marAll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ylab <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  main <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="eigengenes-exploration-1" class="level4" data-number="6.1.3.3"><h4 data-number="6.1.3.3" class="anchored" data-anchor-id="eigengenes-exploration-1">
<span class="header-section-number">6.1.3.3</span> Eigengenes exploration</h4>
<section id="oid-7---heatmap" class="level5" data-number="6.1.3.3.1"><h5 data-number="6.1.3.3.1" class="anchored" data-anchor-id="oid-7---heatmap">
<span class="header-section-number">6.1.3.3.1</span> OID 7 - Heatmap</h5>
<div class="cell">

</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb103"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">gg_eigen</span><span class="op">(</span></span>
<span>  <span class="va">dta_traits</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="va">diabcd</span>, <span class="va">diab</span>, <span class="va">age</span>, <span class="va">trainn</span>,</span>
<span>      <span class="va">chol</span>, <span class="va">glu0</span>, <span class="va">glu120</span>, <span class="va">glu30</span>, <span class="va">glu60</span>, <span class="va">hba1c</span>, <span class="va">hdl</span>,</span>
<span>      <span class="va">homab</span>, <span class="va">homair</span>, <span class="va">insulin0</span>, <span class="va">insulin120</span>, <span class="va">insulin30</span>, <span class="va">insulin60</span>, <span class="va">ldl</span>,</span>
<span>      <span class="va">matsuda</span>, <span class="va">trig</span>, <span class="va">bmi</span>, <span class="va">bodyfatp</span>, <span class="va">dcal</span>, <span class="va">dcarbt</span>, <span class="va">dfatt</span>,</span>
<span>      <span class="va">dprot</span>, <span class="va">fatacfr</span>, <span class="va">fatmass</span>, <span class="va">leanmass</span>, <span class="va">smmass</span>, <span class="va">vat</span>, <span class="va">vo2maxe</span>,</span>
<span>      <span class="va">vo2maxlbm</span>, <span class="va">vo2maxml</span>, <span class="va">weight</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">prep_col</span><span class="op">)</span><span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html">DataFrame</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">meig</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Scale for 'x' is already present. Adding another scale for 'x', which will
replace the existing scale.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'x' is already present. Adding another scale for 'x', which will
replace the existing scale.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb108"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fl">7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb109"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">clean_slate</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_figure</span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">gg</span><span class="op">)</span></span>
<span></span>
<span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">oid</span>, <span class="fl">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="fu">export_as</span><span class="op">(</span></span>
<span>  <span class="va">p</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">".pdf"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  file_graph_alone <span class="op">=</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">"_af.pdf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_07.pdf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_07_af.pdf (annot. free)</code></pre>
</div>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb112"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">show_slate</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="oid-8---excel-file" class="level5" data-number="6.1.3.3.2"><h5 data-number="6.1.3.3.2" class="anchored" data-anchor-id="oid-8---excel-file">
<span class="header-section-number">6.1.3.3.2</span> OID 8 - Excel file</h5>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb113"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span><span class="va">title</span> <span class="op">&lt;-</span> <span class="st">"mRNA at baseline - WGCNA modules"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb114"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spl_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">dyn_mge</span><span class="op">$</span><span class="va">oldMEs</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>      cols <span class="op">=</span> <span class="op">-</span><span class="st">"sample"</span>,</span>
<span>      names_to <span class="op">=</span> <span class="st">"module"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html">within</a></span><span class="op">(</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"raw_me"</span><span class="op">)</span>,</span>
<span>  <span class="va">dyn_mge</span><span class="op">$</span><span class="va">newMEs</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>      cols <span class="op">=</span> <span class="op">-</span><span class="st">"sample"</span>,</span>
<span>      names_to <span class="op">=</span> <span class="st">"module"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html">within</a></span><span class="op">(</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"merged_me"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ft_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dta_expr</span><span class="op">)</span>,</span>
<span>  raw_me <span class="op">=</span> <span class="va">dyn_col</span>,</span>
<span>  merged_me <span class="op">=</span> <span class="va">dyn_mge</span><span class="op">$</span><span class="va">colors</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">oid</span>, <span class="fl">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">export_xl</span><span class="op">(</span></span>
<span>  ft_mod <span class="op">=</span> <span class="va">ft_mod</span>,</span>
<span>  spl_mod <span class="op">=</span> <span class="va">spl_mod</span>,</span>
<span>  info <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="va">title</span>,</span>
<span>    ft_mod <span class="op">=</span> <span class="fu">wrap_long_lines</span><span class="op">(</span></span>
<span>      <span class="st">"Associate genetic features with calculated module (a feature belongs to</span></span>
<span><span class="st">      a module)"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    spl_mod <span class="op">=</span> <span class="st">"Sample eigengen value (eigengen _expression profile_)"</span>,</span>
<span>    source <span class="op">=</span> <span class="st">"UMB-BESD"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  dir <span class="op">=</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>,</span>
<span>  basenm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span><span class="op">)</span>,</span>
<span>  rdata <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>RData output (binary: ../tlg/graph/t2d_11_08.RData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Excel output: ../tlg/graph/t2d_11_08.xlsx</code></pre>
</div>
</div>
</section></section></section><section id="mirna-chg" class="level3" data-number="6.1.4"><h3 data-number="6.1.4" class="anchored" data-anchor-id="mirna-chg">
<span class="header-section-number">6.1.4</span> miRNA / CHG</h3>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb117"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' # https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/FemaleLiver-01-dataInput.pdf</span></span>
<span><span class="co">#' # WGCNA: gene in rows, sample in cols</span></span>
<span></span>
<span><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">rna</span></span>
<span><span class="va">ngs_assay</span> <span class="op">&lt;-</span> <span class="st">"allmirna"</span></span>
<span><span class="va">ctrl_wgcna</span> <span class="op">&lt;-</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">rna</span><span class="op">$</span><span class="va">wgcna</span><span class="op">$</span><span class="va">chg</span><span class="op">$</span><span class="va">allmirna</span> <span class="co"># TODO</span></span>
<span></span>
<span><span class="co"># Specific to sample_clustering</span></span>
<span><span class="va">col_fill</span> <span class="op">&lt;-</span> <span class="st">"glu120_chg"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb118"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filter_for_paired_visits</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">assert_that</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">subjid</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">subj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">subjid</span><span class="op">)</span></span>
<span>  <span class="va">subj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">subj</span><span class="op">[</span><span class="va">subj</span> <span class="op">==</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">mae</span> <span class="op">&lt;-</span> <span class="va">mae</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">subjid</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">subj</span>, <span class="op">]</span></span>
<span></span>
<span>  <span class="va">chk_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">check</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">chk_df</span>, f <span class="op">=</span> <span class="va">chk_df</span><span class="op">$</span><span class="va">avisit</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Verify the selection:</span></span>
<span>  <span class="fu">assert_that</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">check</span>, subj <span class="op">=</span> <span class="va">subj</span>,\<span class="op">(</span><span class="va">x</span>, <span class="va">subj</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">subj</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">x</span><span class="op">$</span><span class="va">subjid</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">mae</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/gc.html">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dta</span> <span class="op">&lt;-</span> <span class="va">besd_mae</span> <span class="op">|&gt;</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="va">mae</span><span class="op">[</span> , , <span class="va">ngs_assay</span><span class="op">]</span><span class="op">)</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter_for_depth</span><span class="op">(</span><span class="va">ngs_assay</span>, <span class="va">ctrl</span><span class="op">$</span><span class="va">depth_threshold</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter_for_paired_visits</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter_for_low_expr</span><span class="op">(</span><span class="va">ngs_assay</span>, <span class="va">ctrl</span><span class="op">$</span><span class="va">cpm_threshold</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># VST transformation</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">avisit_</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">avisit</span>,</span>
<span>      levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">avisit</span><span class="op">)</span>,</span>
<span>      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">" "</span>, <span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">avisit</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">coldata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"diabcd"</span>, <span class="st">"subjid"</span>, <span class="st">"avisit_"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>    <span class="va">mae</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/DESeqDataSet.html">DESeqDataSetFromMatrix</a></span><span class="op">(</span></span>
<span>      countData <span class="op">=</span> <span class="va">mae</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span>,</span>
<span>      colData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mae</span><span class="op">)</span>,</span>
<span>      design <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="op">~</span> <span class="va">subjid</span> <span class="op">+</span> <span class="va">avisit_</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/varianceStabilizingTransformation.html">varianceStabilizingTransformation</a></span><span class="op">(</span>blind <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">assay</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">mae</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter_for_coldata</span><span class="op">(</span><span class="st">"diabcd"</span>, is <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NGT"</span>, <span class="st">"T2D"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Get traits: BL, M3, CHG:</span></span>
<span>    <span class="va">bl</span> <span class="op">&lt;-</span> <span class="va">mae</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">avisit</span> <span class="op">==</span> <span class="st">"Baseline"</span>, <span class="op">]</span></span>
<span>    <span class="va">m3</span> <span class="op">&lt;-</span> <span class="va">mae</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">avisit</span> <span class="op">==</span> <span class="st">"Month 3"</span>, <span class="op">]</span></span>
<span>    <span class="fu">assert_that</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">bl</span><span class="op">)</span><span class="op">$</span><span class="va">subjid</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span><span class="op">$</span><span class="va">subjid</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">mat</span> <span class="op">&lt;-</span> <span class="va">m3</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">bl</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">nm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">subjid</span>, nm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">nm</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>    <span class="va">get_vars_when</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span>,</span>
<span>                              <span class="va">fun</span> <span class="op">=</span> <span class="va">is.numeric</span>,</span>
<span>                              <span class="va">col_names</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span></span>
<span>      <span class="fu">assert_that</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">subjid</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">subjid</span></span>
<span>      <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">fun</span><span class="op">)</span><span class="op">]</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">col_names</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">df</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">m3_cd</span> <span class="op">&lt;-</span> <span class="fu">get_vars_when</span><span class="op">(</span><span class="va">m3</span>, <span class="va">is.numeric</span><span class="op">)</span> <span class="co"># m3_col data</span></span>
<span>    <span class="va">bl_cd</span> <span class="op">&lt;-</span> <span class="fu">get_vars_when</span><span class="op">(</span><span class="va">bl</span>, <span class="va">is.numeric</span><span class="op">)</span></span>
<span>    <span class="co"># bl qualitative (diabcd and other)</span></span>
<span>    <span class="va">bl_ql</span> <span class="op">&lt;-</span> <span class="fu">get_vars_when</span><span class="op">(</span><span class="va">bl</span>, <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Negate</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Map</a></span><span class="op">(</span>a <span class="op">=</span> <span class="va">m3_cd</span>, b <span class="op">=</span> <span class="va">bl_cd</span>, f <span class="op">=</span> \<span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="va">a</span> <span class="op">-</span> <span class="va">b</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">S4Vectors</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html">DataFrame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="op">(</span>\<span class="op">(</span><span class="va">df</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"_m3"</span>, <span class="st">"_chg"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">args</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="co"># Constant columns are not interesting for gene variation association</span></span>
<span>        <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">sd</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span>
<span>      <span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="va">bl_cd</span>, <span class="va">m3_cd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bl_ql</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/MultiAssayExperiment.html">MultiAssayExperiment</a></span><span class="op">(</span></span>
<span>      experiments <span class="op">=</span> <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/ExperimentList.html">ExperimentList</a></span><span class="op">(</span>vst <span class="op">=</span> <span class="va">mat</span><span class="op">)</span>,</span>
<span>      colData <span class="op">=</span> <span class="va">traits</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: 'experiments' dropped; see 'metadata'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>harmonizing input:
  removing 282 sampleMap rows not in names(experiments)</code></pre>
</div>
<details><summary>Show the code</summary><div class="sourceCode" id="cb121"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' WGCNA Expression data.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' A matrix or data frame in which columns are genes and rows ar samples.</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">dta_expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">dta</span><span class="op">[[</span><span class="st">"vst"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">assert_that</span><span class="op">(</span><span class="fu">WGCNA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/goodSamplesGenes.html">goodSamplesGenes</a></span><span class="op">(</span><span class="va">dta_expr</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">$</span><span class="va">allOK</span><span class="op">)</span></span>
<span><span class="va">dta_traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">dta</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="sample-clustering-oid-9" class="level4" data-number="6.1.4.1"><h4 data-number="6.1.4.1" class="anchored" data-anchor-id="sample-clustering-oid-9">
<span class="header-section-number">6.1.4.1</span> Sample Clustering (OID 9)</h4>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb122"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spl_clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fastcluster/man/hclust.html">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">dta_expr</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"complete"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clustering Dendrogram of samples based on their Euclidean distance</span></span>
<span><span class="va">theme_custom</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/theme_dendro.html">theme_dendro</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>      plot.margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="st">"null"</span><span class="op">)</span>,</span>
<span>      panel.spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="st">"null"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/andrie/ggdendro">ggdendro</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">dend</span> <span class="op">&lt;-</span> <span class="va">spl_clust</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html">as.dendrogram</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dta_traits</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">)</span></span>
<span><span class="va">dta_traits</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">$</span><span class="va">x</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span><span class="op">(</span><span class="va">dend</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dta_traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/nobs.html">nobs</a></span><span class="op">(</span><span class="va">dend</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ddata</span> <span class="op">&lt;-</span> <span class="fu">ggdendro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/dendro_data.html">dendro_data</a></span><span class="op">(</span><span class="va">dend</span>, type <span class="op">=</span> <span class="st">"rectangle"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggdendro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/segment.html">segment</a></span><span class="op">(</span><span class="va">ddata</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span>clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_reverse</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/nobs.html">nobs</a></span><span class="op">(</span><span class="va">dend</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu">ggdendro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/segment.html">label</a></span><span class="op">(</span><span class="va">ddata</span><span class="op">)</span><span class="op">$</span><span class="va">label</span>,</span>
<span>    lim <span class="op">=</span> <span class="va">lim</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_custom</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">dta_traits</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">diabcd</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">34</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"C"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, begin <span class="op">=</span> <span class="fl">.2</span>, end <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="va">lim</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_custom</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">dta_traits</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>    fill <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/name.html">as.name</a></span><span class="op">(</span><span class="va">col_fill</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">34</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="va">lim</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_custom</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">egg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/egg/man/ggarrange.html">ggarrange</a></span><span class="op">(</span></span>
<span>  <span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p4</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  padding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>  draw <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb123"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fl">9</span></span>
<span><span class="va">title</span> <span class="op">&lt;-</span> <span class="st">"miRNA / Change from Baseline - Clustering dendrogram of samples based</span></span>
<span><span class="st">  on their Euclidean distance and trait heatmap"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb124"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">clean_slate</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_title</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Figure 11."</span>,   <span class="va">oid</span><span class="op">)</span>,</span>
<span>    <span class="fu">wrap_long_lines</span><span class="op">(</span><span class="va">title</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_figure</span><span class="op">(</span><span class="va">p</span>, height <span class="op">=</span> <span class="fu">inches</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_note</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Note: VST transformed expression matrix used to estimate distances</span></span>
<span><span class="st">    between samples, _complete_ method was used for the hierarchical</span></span>
<span><span class="st">    clustering."</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">oid</span>, <span class="fl">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="fu">export_as</span><span class="op">(</span></span>
<span>  <span class="va">p</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">".pdf"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  file_graph_alone <span class="op">=</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">"_af.pdf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_09.pdf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_09_af.pdf (annot. free)</code></pre>
</div>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb127"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">show_slate</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="gene-clustering-2" class="level4" data-number="6.1.4.2"><h4 data-number="6.1.4.2" class="anchored" data-anchor-id="gene-clustering-2">
<span class="header-section-number">6.1.4.2</span> Gene Clustering</h4>
<section id="soft-threshold-determination-oid-10" class="level5" data-number="6.1.4.2.1"><h5 data-number="6.1.4.2.1" class="anchored" data-anchor-id="soft-threshold-determination-oid-10">
<span class="header-section-number">6.1.4.2.1</span> Soft threshold determination (OID 10)</h5>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb128"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/">WGCNA</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/allowWGCNAThreads.html">enableWGCNAThreads</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pwr</span> <span class="op">&lt;-</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">adjacency</span><span class="op">$</span><span class="va">power</span></span>
<span><span class="va">sft</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/pickSoftThreshold.html">pickSoftThreshold</a></span><span class="op">(</span></span>
<span>  <span class="va">dta_expr</span>,</span>
<span>  powerVector <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">12</span>, to<span class="op">=</span><span class="fl">20</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Power</span>, <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span> <span class="op">*</span> <span class="va">SFT.R.sq</span>, label <span class="op">=</span> <span class="va">Power</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">.9</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    vjust <span class="op">=</span> <span class="fl">0</span>, nudge_y <span class="op">=</span> <span class="fl">.025</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">Power</span>, yend <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, yend <span class="op">=</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span> <span class="op">*</span> <span class="va">SFT.R.sq</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span> <span class="op">=</span> <span class="fl">21</span>, <span class="st">"FALSE"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Soft Threshold (power)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Scale Free Topology Model Fit"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Scale independence"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Power</span>, <span class="va">mean.k.</span>, label <span class="op">=</span> <span class="va">Power</span>, shape <span class="op">=</span> <span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">Power</span>, yend <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, yend <span class="op">=</span> <span class="va">mean.k.</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    vjust <span class="op">=</span> <span class="fl">0</span>, hjust <span class="op">=</span> <span class="fl">0</span>, nudge_y <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span> <span class="op">=</span> <span class="fl">21</span>, <span class="st">"FALSE"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Soft Threshold (power)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Mean connectivity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Mean connectivity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">egg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/egg/man/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow <span class="op">=</span> <span class="fl">1</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb129"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">title</span> <span class="op">&lt;-</span> <span class="st">"Micro-RNA / Change from Baseline - Soft threshold determination"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb130"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">clean_slate</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_title</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Figure 11."</span>, <span class="va">oid</span><span class="op">)</span>,</span>
<span>    <span class="va">title</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_figure</span><span class="op">(</span><span class="va">p</span>, width <span class="op">=</span> <span class="fu">inches</span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>, height <span class="op">=</span> <span class="fu">inches</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">oid</span>, <span class="fl">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="fu">export_as</span><span class="op">(</span></span>
<span>  <span class="va">p</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">".pdf"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  file_graph_alone <span class="op">=</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">"_af.pdf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_10.pdf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_10_af.pdf (annot. free)</code></pre>
</div>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb133"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">show_slate</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="network-2" class="level5" data-number="6.1.4.2.2"><h5 data-number="6.1.4.2.2" class="anchored" data-anchor-id="network-2">
<span class="header-section-number">6.1.4.2.2</span> Network</h5>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb134"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># gene dissimilarity</span></span>
<span><span class="va">tom_dis</span> <span class="op">&lt;-</span> <span class="va">dta_expr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/adjacency.html">adjacency</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">adjacency</span><span class="op">$</span><span class="va">type</span>,</span>
<span>    power <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">adjacency</span><span class="op">$</span><span class="va">power</span>,</span>
<span>    corFnc <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">adjacency</span><span class="op">$</span><span class="va">cor_fn</span><span class="op">$</span><span class="va">value</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/TOMsimilarity.html">TOMsimilarity</a></span><span class="op">(</span>TOMType <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">tom</span><span class="op">$</span><span class="va">type</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">tom</span><span class="op">)</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">tom</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gene_hc</span> <span class="op">&lt;-</span> <span class="va">tom_dis</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/fastcluster/man/hclust.html">hclust</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># gene clustering</span></span>
<span><span class="va">dyn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dynamicTreeCut/man/cutreeDynamic.html">cutreeDynamic</a></span><span class="op">(</span></span>
<span>  <span class="va">gene_hc</span>,</span>
<span>  cutHeight <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">cuttree</span><span class="op">$</span><span class="va">cut_height</span>,</span>
<span>  minClusterSize <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">cuttree</span><span class="op">$</span><span class="va">min_cluster_size</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"hybrid"</span>,</span>
<span>  distM <span class="op">=</span> <span class="va">tom_dis</span>,</span>
<span>  deepSplit <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">cuttree</span><span class="op">$</span><span class="va">deep_split</span>,</span>
<span>  pamRespectsDendro <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dyn_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/labels2colors.html">labels2colors</a></span><span class="op">(</span><span class="va">dyn_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># me: module eigengenes (also used to merge dyn_col)</span></span>
<span><span class="va">dyn_mge</span> <span class="op">&lt;-</span> <span class="va">dta_expr</span> <span class="op">|&gt;</span> <span class="fu">WGCNA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/mergeCloseModules.html">mergeCloseModules</a></span><span class="op">(</span><span class="va">dyn_col</span><span class="op">)</span></span>
<span><span class="va">meig</span> <span class="op">&lt;-</span> <span class="va">dyn_mge</span><span class="op">$</span><span class="va">newMEs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb135"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Not exported yet</span></span>
<span><span class="fu">WGCNA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/plotDendroAndColors.html">plotDendroAndColors</a></span><span class="op">(</span></span>
<span>  dendro <span class="op">=</span> <span class="va">gene_hc</span>,</span>
<span>  colors <span class="op">=</span> <span class="va">dyn_mge</span><span class="op">$</span><span class="va">color</span>,</span>
<span>  dendroLabels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  addGuide <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  guideHang <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  groupLabels <span class="op">=</span> <span class="st">""</span>,</span>
<span>  cex.rowText <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  cex.colorLabels <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  cex.dendroLabels <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  marAll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ylab <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  main <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="eigengenes-exploration-2" class="level4" data-number="6.1.4.3"><h4 data-number="6.1.4.3" class="anchored" data-anchor-id="eigengenes-exploration-2">
<span class="header-section-number">6.1.4.3</span> Eigengenes exploration</h4>
<section id="oid-11---heatmap" class="level5" data-number="6.1.4.3.1"><h5 data-number="6.1.4.3.1" class="anchored" data-anchor-id="oid-11---heatmap">
<span class="header-section-number">6.1.4.3.1</span> OID 11 - Heatmap</h5>
<div class="cell">

</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb136"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">gg_eigen</span><span class="op">(</span></span>
<span>  <span class="va">dta_traits</span> <span class="op">|&gt;</span></span>
<span>    <span class="op">(</span>\<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span></span>
<span>       <span class="va">df</span>,</span>
<span>       <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span></span>
<span>     <span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">prep_col</span><span class="op">)</span><span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html">DataFrame</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">meig</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Scale for 'x' is already present. Adding another scale for 'x', which will
replace the existing scale.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'x' is already present. Adding another scale for 'x', which will
replace the existing scale.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb141"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fl">11</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb142"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">clean_slate</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_figure</span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">gg</span><span class="op">)</span></span>
<span></span>
<span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">oid</span>, <span class="fl">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="fu">export_as</span><span class="op">(</span></span>
<span>  <span class="va">p</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">".pdf"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  file_graph_alone <span class="op">=</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">"_af.pdf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_11.pdf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_11_af.pdf (annot. free)</code></pre>
</div>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb145"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">show_slate</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="oid-12---excel-file" class="level5" data-number="6.1.4.3.2"><h5 data-number="6.1.4.3.2" class="anchored" data-anchor-id="oid-12---excel-file">
<span class="header-section-number">6.1.4.3.2</span> OID 12 - Excel file</h5>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb146"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span><span class="va">title</span> <span class="op">&lt;-</span> <span class="st">"miRNA Change from Baseline - WGCNA modules"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb147"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spl_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">dyn_mge</span><span class="op">$</span><span class="va">oldMEs</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>      cols <span class="op">=</span> <span class="op">-</span><span class="st">"sample"</span>,</span>
<span>      names_to <span class="op">=</span> <span class="st">"module"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html">within</a></span><span class="op">(</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"raw_me"</span><span class="op">)</span>,</span>
<span>  <span class="va">dyn_mge</span><span class="op">$</span><span class="va">newMEs</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>      cols <span class="op">=</span> <span class="op">-</span><span class="st">"sample"</span>,</span>
<span>      names_to <span class="op">=</span> <span class="st">"module"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html">within</a></span><span class="op">(</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"merged_me"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ft_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dta_expr</span><span class="op">)</span>,</span>
<span>  raw_me <span class="op">=</span> <span class="va">dyn_col</span>,</span>
<span>  merged_me <span class="op">=</span> <span class="va">dyn_mge</span><span class="op">$</span><span class="va">colors</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">oid</span>, <span class="fl">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">export_xl</span><span class="op">(</span></span>
<span>  ft_mod <span class="op">=</span> <span class="va">ft_mod</span>,</span>
<span>  spl_mod <span class="op">=</span> <span class="va">spl_mod</span>,</span>
<span>  info <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="va">title</span>,</span>
<span>    ft_mod <span class="op">=</span> <span class="fu">wrap_long_lines</span><span class="op">(</span></span>
<span>      <span class="st">"Associate genetic features with calculated module (a feature belongs to</span></span>
<span><span class="st">      a module)"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    spl_mod <span class="op">=</span> <span class="st">"Sample eigengen value (eigengen _expression profile_)"</span>,</span>
<span>    source <span class="op">=</span> <span class="st">"UMB-BESD"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  dir <span class="op">=</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>,</span>
<span>  basenm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span><span class="op">)</span>,</span>
<span>  rdata <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>RData output (binary: ../tlg/graph/t2d_11_12.RData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Excel output: ../tlg/graph/t2d_11_12.xlsx</code></pre>
</div>
</div>
</section></section></section><section id="mrna-chg" class="level3" data-number="6.1.5"><h3 data-number="6.1.5" class="anchored" data-anchor-id="mrna-chg">
<span class="header-section-number">6.1.5</span> mRNA / CHG</h3>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb150"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' # https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/FemaleLiver-01-dataInput.pdf</span></span>
<span><span class="co">#' # WGCNA: gene in rows, sample in cols</span></span>
<span></span>
<span><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">rna</span></span>
<span><span class="va">ngs_assay</span> <span class="op">&lt;-</span> <span class="st">"mrna"</span></span>
<span><span class="va">ctrl_wgcna</span> <span class="op">&lt;-</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">rna</span><span class="op">$</span><span class="va">wgcna</span><span class="op">$</span><span class="va">chg</span><span class="op">$</span><span class="va">mrna</span></span>
<span></span>
<span><span class="co"># Specific to sample_clustering</span></span>
<span><span class="va">col_fill</span> <span class="op">&lt;-</span> <span class="st">"glu120_chg"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb151"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filter_for_paired_visits</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">assert_that</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">subjid</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">subj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">subjid</span><span class="op">)</span></span>
<span>  <span class="va">subj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">subj</span><span class="op">[</span><span class="va">subj</span> <span class="op">==</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">mae</span> <span class="op">&lt;-</span> <span class="va">mae</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">subjid</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">subj</span>, <span class="op">]</span></span>
<span></span>
<span>  <span class="va">chk_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">check</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">chk_df</span>, f <span class="op">=</span> <span class="va">chk_df</span><span class="op">$</span><span class="va">avisit</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Verify the selection:</span></span>
<span>  <span class="fu">assert_that</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">check</span>, subj <span class="op">=</span> <span class="va">subj</span>,\<span class="op">(</span><span class="va">x</span>, <span class="va">subj</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">subj</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">x</span><span class="op">$</span><span class="va">subjid</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">mae</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/gc.html">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dta</span> <span class="op">&lt;-</span> <span class="va">besd_mae</span> <span class="op">|&gt;</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="va">mae</span><span class="op">[</span> , , <span class="va">ngs_assay</span><span class="op">]</span><span class="op">)</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter_for_depth</span><span class="op">(</span><span class="va">ngs_assay</span>, <span class="va">ctrl</span><span class="op">$</span><span class="va">depth_threshold</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter_for_paired_visits</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter_for_low_expr</span><span class="op">(</span><span class="va">ngs_assay</span>, <span class="va">ctrl</span><span class="op">$</span><span class="va">cpm_threshold</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># VST transformation</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">avisit_</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">avisit</span>,</span>
<span>      levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">avisit</span><span class="op">)</span>,</span>
<span>      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">" "</span>, <span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">avisit</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">coldata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"diabcd"</span>, <span class="st">"subjid"</span>, <span class="st">"avisit_"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>    <span class="va">mae</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/DESeqDataSet.html">DESeqDataSetFromMatrix</a></span><span class="op">(</span></span>
<span>      countData <span class="op">=</span> <span class="va">mae</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span>,</span>
<span>      colData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mae</span><span class="op">)</span>,</span>
<span>      design <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="op">~</span> <span class="va">subjid</span> <span class="op">+</span> <span class="va">avisit_</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/varianceStabilizingTransformation.html">varianceStabilizingTransformation</a></span><span class="op">(</span>blind <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">assay</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">mae</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter_for_coldata</span><span class="op">(</span><span class="st">"diabcd"</span>, is <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NGT"</span>, <span class="st">"T2D"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Get traits: BL, M3, CHG:</span></span>
<span>    <span class="va">bl</span> <span class="op">&lt;-</span> <span class="va">mae</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">avisit</span> <span class="op">==</span> <span class="st">"Baseline"</span>, <span class="op">]</span></span>
<span>    <span class="va">m3</span> <span class="op">&lt;-</span> <span class="va">mae</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">avisit</span> <span class="op">==</span> <span class="st">"Month 3"</span>, <span class="op">]</span></span>
<span>    <span class="fu">assert_that</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">bl</span><span class="op">)</span><span class="op">$</span><span class="va">subjid</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span><span class="op">$</span><span class="va">subjid</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">mat</span> <span class="op">&lt;-</span> <span class="va">m3</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">bl</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">nm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">subjid</span>, nm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">nm</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>    <span class="va">get_vars_when</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span>,</span>
<span>                              <span class="va">fun</span> <span class="op">=</span> <span class="va">is.numeric</span>,</span>
<span>                              <span class="va">col_names</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span></span>
<span>      <span class="fu">assert_that</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">subjid</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">subjid</span></span>
<span>      <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">fun</span><span class="op">)</span><span class="op">]</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">col_names</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">df</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">m3_cd</span> <span class="op">&lt;-</span> <span class="fu">get_vars_when</span><span class="op">(</span><span class="va">m3</span>, <span class="va">is.numeric</span><span class="op">)</span> <span class="co"># m3_col data</span></span>
<span>    <span class="va">bl_cd</span> <span class="op">&lt;-</span> <span class="fu">get_vars_when</span><span class="op">(</span><span class="va">bl</span>, <span class="va">is.numeric</span><span class="op">)</span></span>
<span>    <span class="co"># bl qualitative (diabcd and other)</span></span>
<span>    <span class="va">bl_ql</span> <span class="op">&lt;-</span> <span class="fu">get_vars_when</span><span class="op">(</span><span class="va">bl</span>, <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Negate</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Map</a></span><span class="op">(</span>a <span class="op">=</span> <span class="va">m3_cd</span>, b <span class="op">=</span> <span class="va">bl_cd</span>, f <span class="op">=</span> \<span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="va">a</span> <span class="op">-</span> <span class="va">b</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">S4Vectors</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html">DataFrame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="op">(</span>\<span class="op">(</span><span class="va">df</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"_m3"</span>, <span class="st">"_chg"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">args</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="co"># Constant columns are not interesting for gene variation association</span></span>
<span>        <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">sd</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span>
<span>      <span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="va">bl_cd</span>, <span class="va">m3_cd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bl_ql</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/MultiAssayExperiment.html">MultiAssayExperiment</a></span><span class="op">(</span></span>
<span>      experiments <span class="op">=</span> <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/ExperimentList.html">ExperimentList</a></span><span class="op">(</span>vst <span class="op">=</span> <span class="va">mat</span><span class="op">)</span>,</span>
<span>      colData <span class="op">=</span> <span class="va">traits</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: 'experiments' dropped; see 'metadata'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>harmonizing input:
  removing 282 sampleMap rows not in names(experiments)</code></pre>
</div>
<details><summary>Show the code</summary><div class="sourceCode" id="cb154"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' WGCNA Expression data.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' A matrix or data frame in which columns are genes and rows ar samples.</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">dta_expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">dta</span><span class="op">[[</span><span class="st">"vst"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">assert_that</span><span class="op">(</span><span class="fu">WGCNA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/goodSamplesGenes.html">goodSamplesGenes</a></span><span class="op">(</span><span class="va">dta_expr</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">$</span><span class="va">allOK</span><span class="op">)</span></span>
<span><span class="va">dta_traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">dta</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="sample-clustering-oid-13" class="level4" data-number="6.1.5.1"><h4 data-number="6.1.5.1" class="anchored" data-anchor-id="sample-clustering-oid-13">
<span class="header-section-number">6.1.5.1</span> Sample Clustering (OID 13)</h4>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb155"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spl_clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fastcluster/man/hclust.html">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">dta_expr</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"complete"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clustering Dendrogram of samples based on their Euclidean distance</span></span>
<span><span class="va">theme_custom</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/theme_dendro.html">theme_dendro</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>      plot.margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="st">"null"</span><span class="op">)</span>,</span>
<span>      panel.spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="st">"null"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/andrie/ggdendro">ggdendro</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">dend</span> <span class="op">&lt;-</span> <span class="va">spl_clust</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html">as.dendrogram</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dta_traits</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">)</span></span>
<span><span class="va">dta_traits</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">$</span><span class="va">x</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span><span class="op">(</span><span class="va">dend</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dta_traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/nobs.html">nobs</a></span><span class="op">(</span><span class="va">dend</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ddata</span> <span class="op">&lt;-</span> <span class="fu">ggdendro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/dendro_data.html">dendro_data</a></span><span class="op">(</span><span class="va">dend</span>, type <span class="op">=</span> <span class="st">"rectangle"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggdendro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/segment.html">segment</a></span><span class="op">(</span><span class="va">ddata</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span>clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_reverse</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/nobs.html">nobs</a></span><span class="op">(</span><span class="va">dend</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu">ggdendro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggdendro/man/segment.html">label</a></span><span class="op">(</span><span class="va">ddata</span><span class="op">)</span><span class="op">$</span><span class="va">label</span>,</span>
<span>    lim <span class="op">=</span> <span class="va">lim</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_custom</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">dta_traits</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">diabcd</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">34</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"C"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, begin <span class="op">=</span> <span class="fl">.2</span>, end <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="va">lim</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_custom</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">dta_traits</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>    fill <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/name.html">as.name</a></span><span class="op">(</span><span class="va">col_fill</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">34</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="va">lim</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_custom</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">egg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/egg/man/ggarrange.html">ggarrange</a></span><span class="op">(</span></span>
<span>  <span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p4</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  padding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>  draw <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb156"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fl">13</span></span>
<span><span class="va">title</span> <span class="op">&lt;-</span> <span class="st">"mRNA / Change from Baseline - Clustering dendrogram of samples based</span></span>
<span><span class="st">  on their Euclidean distance and trait heatmap"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb157"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">clean_slate</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_title</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Figure 11."</span>,   <span class="va">oid</span><span class="op">)</span>,</span>
<span>    <span class="fu">wrap_long_lines</span><span class="op">(</span><span class="va">title</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_figure</span><span class="op">(</span><span class="va">p</span>, height <span class="op">=</span> <span class="fu">inches</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_note</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Note: VST transformed expression matrix used to estimate distances</span></span>
<span><span class="st">    between samples, _complete_ method was used for the hierarchical</span></span>
<span><span class="st">    clustering."</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">oid</span>, <span class="fl">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="fu">export_as</span><span class="op">(</span></span>
<span>  <span class="va">p</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">".pdf"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  file_graph_alone <span class="op">=</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">"_af.pdf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_13.pdf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_13_af.pdf (annot. free)</code></pre>
</div>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb160"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">show_slate</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="gene-clustering-3" class="level4" data-number="6.1.5.2"><h4 data-number="6.1.5.2" class="anchored" data-anchor-id="gene-clustering-3">
<span class="header-section-number">6.1.5.2</span> Gene Clustering</h4>
<section id="soft-threshold-determination-oid-14" class="level5" data-number="6.1.5.2.1"><h5 data-number="6.1.5.2.1" class="anchored" data-anchor-id="soft-threshold-determination-oid-14">
<span class="header-section-number">6.1.5.2.1</span> Soft threshold determination (OID 14)</h5>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb161"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/">WGCNA</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/allowWGCNAThreads.html">enableWGCNAThreads</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pwr</span> <span class="op">&lt;-</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">adjacency</span><span class="op">$</span><span class="va">power</span></span>
<span><span class="va">sft</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/pickSoftThreshold.html">pickSoftThreshold</a></span><span class="op">(</span></span>
<span>  <span class="va">dta_expr</span>,</span>
<span>  powerVector <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">12</span>, to<span class="op">=</span><span class="fl">20</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Power</span>, <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span> <span class="op">*</span> <span class="va">SFT.R.sq</span>, label <span class="op">=</span> <span class="va">Power</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">.9</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    vjust <span class="op">=</span> <span class="fl">0</span>, nudge_y <span class="op">=</span> <span class="fl">.025</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">Power</span>, yend <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, yend <span class="op">=</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span> <span class="op">*</span> <span class="va">SFT.R.sq</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span> <span class="op">=</span> <span class="fl">21</span>, <span class="st">"FALSE"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Soft Threshold (power)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Scale Free Topology Model Fit"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Scale independence"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Power</span>, <span class="va">mean.k.</span>, label <span class="op">=</span> <span class="va">Power</span>, shape <span class="op">=</span> <span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">Power</span>, yend <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, yend <span class="op">=</span> <span class="va">mean.k.</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Power</span> <span class="op">==</span> <span class="va">pwr</span><span class="op">)</span>,</span>
<span>    vjust <span class="op">=</span> <span class="fl">0</span>, hjust <span class="op">=</span> <span class="fl">0</span>, nudge_y <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span> <span class="op">=</span> <span class="fl">21</span>, <span class="st">"FALSE"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Soft Threshold (power)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Mean connectivity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Mean connectivity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">egg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/egg/man/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow <span class="op">=</span> <span class="fl">1</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb162"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fl">14</span></span>
<span><span class="va">title</span> <span class="op">&lt;-</span> <span class="st">"mRNA / Change from Baseline - Soft threshold determination"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb163"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">clean_slate</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_title</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Figure 11."</span>, <span class="va">oid</span><span class="op">)</span>,</span>
<span>    <span class="va">title</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_figure</span><span class="op">(</span><span class="va">p</span>, width <span class="op">=</span> <span class="fu">inches</span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>, height <span class="op">=</span> <span class="fu">inches</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">oid</span>, <span class="fl">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="fu">export_as</span><span class="op">(</span></span>
<span>  <span class="va">p</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">".pdf"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  file_graph_alone <span class="op">=</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">"_af.pdf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_14.pdf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_14_af.pdf (annot. free)</code></pre>
</div>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb166"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">show_slate</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="network-3" class="level5" data-number="6.1.5.2.2"><h5 data-number="6.1.5.2.2" class="anchored" data-anchor-id="network-3">
<span class="header-section-number">6.1.5.2.2</span> Network</h5>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb167"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># gene dissimilarity</span></span>
<span><span class="va">tom_dis</span> <span class="op">&lt;-</span> <span class="va">dta_expr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/adjacency.html">adjacency</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">adjacency</span><span class="op">$</span><span class="va">type</span>,</span>
<span>    power <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">adjacency</span><span class="op">$</span><span class="va">power</span>,</span>
<span>    corFnc <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">adjacency</span><span class="op">$</span><span class="va">cor_fn</span><span class="op">$</span><span class="va">value</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/TOMsimilarity.html">TOMsimilarity</a></span><span class="op">(</span>TOMType <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">tom</span><span class="op">$</span><span class="va">type</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">tom</span><span class="op">)</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">tom</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gene_hc</span> <span class="op">&lt;-</span> <span class="va">tom_dis</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/fastcluster/man/hclust.html">hclust</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># gene clustering</span></span>
<span><span class="va">dyn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dynamicTreeCut/man/cutreeDynamic.html">cutreeDynamic</a></span><span class="op">(</span></span>
<span>  <span class="va">gene_hc</span>,</span>
<span>  cutHeight <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">cuttree</span><span class="op">$</span><span class="va">cut_height</span>,</span>
<span>  minClusterSize <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">cuttree</span><span class="op">$</span><span class="va">min_cluster_size</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"hybrid"</span>,</span>
<span>  distM <span class="op">=</span> <span class="va">tom_dis</span>,</span>
<span>  deepSplit <span class="op">=</span> <span class="va">ctrl_wgcna</span><span class="op">$</span><span class="va">cuttree</span><span class="op">$</span><span class="va">deep_split</span>,</span>
<span>  pamRespectsDendro <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dyn_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/labels2colors.html">labels2colors</a></span><span class="op">(</span><span class="va">dyn_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># me: module eigengenes (also used to merge dyn_col)</span></span>
<span><span class="va">dyn_mge</span> <span class="op">&lt;-</span> <span class="va">dta_expr</span> <span class="op">|&gt;</span> <span class="fu">WGCNA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/mergeCloseModules.html">mergeCloseModules</a></span><span class="op">(</span><span class="va">dyn_col</span><span class="op">)</span></span>
<span><span class="va">meig</span> <span class="op">&lt;-</span> <span class="va">dyn_mge</span><span class="op">$</span><span class="va">newMEs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb168"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Not exported yet</span></span>
<span><span class="fu">WGCNA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/plotDendroAndColors.html">plotDendroAndColors</a></span><span class="op">(</span></span>
<span>  dendro <span class="op">=</span> <span class="va">gene_hc</span>,</span>
<span>  colors <span class="op">=</span> <span class="va">dyn_mge</span><span class="op">$</span><span class="va">color</span>,</span>
<span>  dendroLabels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  addGuide <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  guideHang <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  groupLabels <span class="op">=</span> <span class="st">""</span>,</span>
<span>  cex.rowText <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  cex.colorLabels <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  cex.dendroLabels <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  marAll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ylab <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  main <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="eigengenes-exploration-3" class="level4" data-number="6.1.5.3"><h4 data-number="6.1.5.3" class="anchored" data-anchor-id="eigengenes-exploration-3">
<span class="header-section-number">6.1.5.3</span> Eigengenes exploration</h4>
<section id="oid-15---heatmap" class="level5" data-number="6.1.5.3.1"><h5 data-number="6.1.5.3.1" class="anchored" data-anchor-id="oid-15---heatmap">
<span class="header-section-number">6.1.5.3.1</span> OID 15 - Heatmap</h5>
<div class="cell">

</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb169"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">gg_eigen</span><span class="op">(</span></span>
<span>  <span class="va">dta_traits</span> <span class="op">|&gt;</span></span>
<span>    <span class="op">(</span>\<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span></span>
<span>       <span class="va">df</span>,</span>
<span>       <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span></span>
<span>     <span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">prep_col</span><span class="op">)</span><span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html">DataFrame</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dta_traits</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">meig</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Scale for 'x' is already present. Adding another scale for 'x', which will
replace the existing scale.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'x' is already present. Adding another scale for 'x', which will
replace the existing scale.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb174"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fl">15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb175"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">clean_slate</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_figure</span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">gg</span><span class="op">)</span></span>
<span></span>
<span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">oid</span>, <span class="fl">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="fu">export_as</span><span class="op">(</span></span>
<span>  <span class="va">p</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">".pdf"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  file_graph_alone <span class="op">=</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span>, <span class="st">"_af.pdf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_15.pdf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/t2d_11_15_af.pdf (annot. free)</code></pre>
</div>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb178"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">show_slate</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="oid-16---excel-file" class="level5" data-number="6.1.5.3.2"><h5 data-number="6.1.5.3.2" class="anchored" data-anchor-id="oid-16---excel-file">
<span class="header-section-number">6.1.5.3.2</span> OID 16 - Excel file</h5>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb179"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fl">16</span></span>
<span><span class="va">title</span> <span class="op">&lt;-</span> <span class="st">"mRNA Change from Baseline - WGCNA modules"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb180"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spl_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">dyn_mge</span><span class="op">$</span><span class="va">oldMEs</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>      cols <span class="op">=</span> <span class="op">-</span><span class="st">"sample"</span>,</span>
<span>      names_to <span class="op">=</span> <span class="st">"module"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html">within</a></span><span class="op">(</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"raw_me"</span><span class="op">)</span>,</span>
<span>  <span class="va">dyn_mge</span><span class="op">$</span><span class="va">newMEs</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>      cols <span class="op">=</span> <span class="op">-</span><span class="st">"sample"</span>,</span>
<span>      names_to <span class="op">=</span> <span class="st">"module"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html">within</a></span><span class="op">(</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"merged_me"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ft_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dta_expr</span><span class="op">)</span>,</span>
<span>  raw_me <span class="op">=</span> <span class="va">dyn_col</span>,</span>
<span>  merged_me <span class="op">=</span> <span class="va">dyn_mge</span><span class="op">$</span><span class="va">colors</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">oid</span>, <span class="fl">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">export_xl</span><span class="op">(</span></span>
<span>  ft_mod <span class="op">=</span> <span class="va">ft_mod</span>,</span>
<span>  spl_mod <span class="op">=</span> <span class="va">spl_mod</span>,</span>
<span>  info <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="va">title</span>,</span>
<span>    ft_mod <span class="op">=</span> <span class="fu">wrap_long_lines</span><span class="op">(</span></span>
<span>      <span class="st">"Associate genetic features with calculated module (a feature belongs to</span></span>
<span><span class="st">      a module)"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    spl_mod <span class="op">=</span> <span class="st">"Sample eigengen value (eigengen _expression profile_)"</span>,</span>
<span>    source <span class="op">=</span> <span class="st">"UMB-BESD"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  dir <span class="op">=</span> <span class="va">cfg_prog</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>,</span>
<span>  basenm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">basenm</span>, <span class="st">"_"</span>, <span class="va">oid</span><span class="op">)</span>,</span>
<span>  rdata <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>RData output (binary: ../tlg/graph/t2d_11_16.RData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Excel output: ../tlg/graph/t2d_11_16.xlsx</code></pre>
</div>
</div>
</section></section></section><section id="legacy" class="level3" data-number="6.1.6"><h3 data-number="6.1.6" class="anchored" data-anchor-id="legacy">
<span class="header-section-number">6.1.6</span> Legacy</h3>
<section id="data-preparation-1" class="level4" data-number="6.1.6.1"><h4 data-number="6.1.6.1" class="anchored" data-anchor-id="data-preparation-1">
<span class="header-section-number">6.1.6.1</span> Data preparation</h4>
</section></section></section><section id="session-informations" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="session-informations">
<span class="header-section-number">6.2</span> Session Informations</h2>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode" id="cb183"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://r-lib.github.io/sessioninfo/reference/session_info.html">session_info</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-Langfelder2008" class="csl-entry" role="doc-biblioentry">
Langfelder, Peter, and Steve Horvath. 2008. <span>“WGCNA: An r Package for Weighted Correlation Network Analysis.”</span> <em>BMC Bioinformatics</em>, no. 1: 559. <a href="https://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-9-559">https://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-9-559</a>.
</div>
<div id="ref-Langfelder2012" class="csl-entry" role="doc-biblioentry">
———. 2012. <span>“Fast <span>R</span> Functions for Robust Correlations and Hierarchical Clustering.”</span> <em>Journal of Statistical Software</em> 46 (11): 1–17. <a href="https://www.jstatsoft.org/v46/i11/">https://www.jstatsoft.org/v46/i11/</a>.
</div>
<div id="ref-Love2014" class="csl-entry" role="doc-biblioentry">
Love, Michael I., Wolfgang Huber, and Simon Anders. 2014. <span>“Moderated Estimation of Fold Change and Dispersion for RNA-Seq Data with DESeq2.”</span> <em>Genome Biology</em> 15: 550. <a href="https://doi.org/10.1186/s13059-014-0550-8">https://doi.org/10.1186/s13059-014-0550-8</a>.
</div>
<div id="ref-Niemira2020" class="csl-entry" role="doc-biblioentry">
Niemira, Magdalena, Francois Collin, Anna Szalkowska, Agnieszka Bielska, Karolina Chwialkowska, Joanna Reszec, Jacek Niklinski, Miroslaw Kwasniewski, and Adam Kretowski. 2020. <span>“Molecular Signature of Subtypes of Non-Small-Cell Lung Cancer by Large-Scale Transcriptional Profiling: Identification of Key Modules and Genes by Weighted Gene Co-Expression Network Analysis (WGCNA).”</span> <em>Cancers</em> 12 (1): 37. <a href="https://doi.org/10.3390/cancers12010037">https://doi.org/10.3390/cancers12010037</a>.
</div>
<div id="ref-RCT2022" class="csl-entry" role="doc-biblioentry">
R Core Team. 2022. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-Ramos2017" class="csl-entry" role="doc-biblioentry">
Ramos, Marcel, Lucas Schiffer, Angela Re, Rimsha Azhar, Azfar Basunia, Carmen Rodriguez Cabrera, Tiffany Chan, et al. 2017. <span>“Software for the Integration of Multi-Omics Experiments in Bioconductor.”</span> <em>Cancer Research</em> 77(21); e39-42.
</div>
<div id="ref-Wickham2016" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley. 2016. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>.
</div>
<div id="ref-Wilke2020" class="csl-entry" role="doc-biblioentry">
Wilke, Claus O. 2020. <em>Cowplot: Streamlined Plot Theme and Plot Annotations for ’Ggplot2’</em>. <a href="https://wilkelab.org/cowplot/">https://wilkelab.org/cowplot/</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="./t2d_07_mir.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">mRNA / micro RNA</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./t2d_13_gea.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">GSEA / DE Results</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb184" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "WGCNA"</span></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> Program 11</span></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Francois Collin"</span></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.time(), '%Y-%m-%d')`"</span></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a><span class="an">params:</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a><span class="co">  basenm: t2d_11</span></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a><span class="an">always_allow_html:</span><span class="co"> true</span></span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a><span class="fu">## mRNA Seq / miRNA - WGCNA</span></span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; "_The Weighted Correlation Network Analysis (WGCNA) </span><span class="co">[</span><span class="ot">11,12</span><span class="co">]</span><span class="at"> corresponds to a</span></span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; data reduction method and unsupervised classification method. It simplifies</span></span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; the interpretation of thousands of gene responses to a dozen of synthetic</span></span>
<span id="cb184-17"><a href="#cb184-17" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; groups (or modules) of genes. The net establishes connections between</span></span>
<span id="cb184-18"><a href="#cb184-18" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; genes-genes are connected if their expression is correlated. Genes can be</span></span>
<span id="cb184-19"><a href="#cb184-19" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; more or less intensively connected depending on the value of the correlation</span></span>
<span id="cb184-20"><a href="#cb184-20" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; (the weights). The connectivity between genes is then interpreted into a</span></span>
<span id="cb184-21"><a href="#cb184-21" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; distance, and the distance is used to group genes into modules. This is how a</span></span>
<span id="cb184-22"><a href="#cb184-22" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; high number of genes can be reduced into a small number of clusters whose</span></span>
<span id="cb184-23"><a href="#cb184-23" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; expression is quantified by the Eigengenes (first principal component within</span></span>
<span id="cb184-24"><a href="#cb184-24" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; the module). It relies on the assumption that highly correlated genes within</span></span>
<span id="cb184-25"><a href="#cb184-25" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; a module are involved in common biological processes._" @Niemira2020</span></span>
<span id="cb184-26"><a href="#cb184-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-27"><a href="#cb184-27" aria-hidden="true" tabindex="-1"></a>Two gene co-expression networks were obtained, 1) the first one based on</span>
<span id="cb184-28"><a href="#cb184-28" aria-hidden="true" tabindex="-1"></a>baseline samples for NGT and T2D subject samples and</span>
<span id="cb184-29"><a href="#cb184-29" aria-hidden="true" tabindex="-1"></a>2) the second on training-induced expression variation independently from the</span>
<span id="cb184-30"><a href="#cb184-30" aria-hidden="true" tabindex="-1"></a>study arm. In detail:</span>
<span id="cb184-31"><a href="#cb184-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-32"><a href="#cb184-32" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>baseline samples for NGT and T2D were selected, the same inclusion criteria </span>
<span id="cb184-33"><a href="#cb184-33" aria-hidden="true" tabindex="-1"></a>   as in the section "_Differential expression analysis_" were used.</span>
<span id="cb184-34"><a href="#cb184-34" aria-hidden="true" tabindex="-1"></a>   Gene expression was transformed using variance</span>
<span id="cb184-35"><a href="#cb184-35" aria-hidden="true" tabindex="-1"></a>   stabilizing transformation. The optimal soft-threshold adjacency matrix</span>
<span id="cb184-36"><a href="#cb184-36" aria-hidden="true" tabindex="-1"></a>   was graphically determined, then the network was estimated resulting in</span>
<span id="cb184-37"><a href="#cb184-37" aria-hidden="true" tabindex="-1"></a>   gene modules and corresponding Eigengenes. The <span class="in">`cutreeDynamic`</span> algorithm</span>
<span id="cb184-38"><a href="#cb184-38" aria-hidden="true" tabindex="-1"></a>   was used for tree pruning of the gene hierarchical clustering dendrogram</span>
<span id="cb184-39"><a href="#cb184-39" aria-hidden="true" tabindex="-1"></a>   resulting in co-expression modules; correlated modules (r &gt; 0.80) were</span>
<span id="cb184-40"><a href="#cb184-40" aria-hidden="true" tabindex="-1"></a>   merged. The quantitative clinical parameters were centred to the average and</span>
<span id="cb184-41"><a href="#cb184-41" aria-hidden="true" tabindex="-1"></a>   scaled-to-variance while factors were decomposed into dummy variables</span>
<span id="cb184-42"><a href="#cb184-42" aria-hidden="true" tabindex="-1"></a>   so as to study the association between gene modules and clinical traits</span>
<span id="cb184-43"><a href="#cb184-43" aria-hidden="true" tabindex="-1"></a>   quantified with Pearson's correlation coefficient. </span>
<span id="cb184-44"><a href="#cb184-44" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>training-induced variation was studied similarly, the approach above was</span>
<span id="cb184-45"><a href="#cb184-45" aria-hidden="true" tabindex="-1"></a>   applicable here also, using the difference between variance-stabilizing</span>
<span id="cb184-46"><a href="#cb184-46" aria-hidden="true" tabindex="-1"></a>   transformed expression matrix as input to the procedure.</span>
<span id="cb184-47"><a href="#cb184-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-48"><a href="#cb184-48" aria-hidden="true" tabindex="-1"></a>Note: it is not possible to use the differentially expressed genes as a</span>
<span id="cb184-49"><a href="#cb184-49" aria-hidden="true" tabindex="-1"></a>starting point. The WGCNA method includes a disclaimer preventing the</span>
<span id="cb184-50"><a href="#cb184-50" aria-hidden="true" tabindex="-1"></a>use of pre-filtered / selected genes based on DEG analysis result.</span>
<span id="cb184-51"><a href="#cb184-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-52"><a href="#cb184-52" aria-hidden="true" tabindex="-1"></a>The module identification was followed by gene set enrichment analysis. To do</span>
<span id="cb184-53"><a href="#cb184-53" aria-hidden="true" tabindex="-1"></a>so, the correlation between gene expression (Variance-Stabilized Transformed</span>
<span id="cb184-54"><a href="#cb184-54" aria-hidden="true" tabindex="-1"></a>values, VST) and the eigengene estimated in every module was used as a </span>
<span id="cb184-55"><a href="#cb184-55" aria-hidden="true" tabindex="-1"></a>measure of module membership. Then, for every module, genesets as defined</span>
<span id="cb184-56"><a href="#cb184-56" aria-hidden="true" tabindex="-1"></a>by the Gene Ontology (GO) project were selected if at least 10 genes belonged</span>
<span id="cb184-57"><a href="#cb184-57" aria-hidden="true" tabindex="-1"></a>to the module. Then, the GSEA procedure was run while considering</span>
<span id="cb184-58"><a href="#cb184-58" aria-hidden="true" tabindex="-1"></a>all expressed genes with existing _entrez gene_ id and determining an</span>
<span id="cb184-59"><a href="#cb184-59" aria-hidden="true" tabindex="-1"></a>enrichment score and associated p.value based on 10000 random permutations.</span>
<span id="cb184-60"><a href="#cb184-60" aria-hidden="true" tabindex="-1"></a>The result focused specifically on enriched and up-regulated genesets, i.e.</span>
<span id="cb184-61"><a href="#cb184-61" aria-hidden="true" tabindex="-1"></a>genesets with over representation of genes with higher</span>
<span id="cb184-62"><a href="#cb184-62" aria-hidden="true" tabindex="-1"></a>correlation with the eigengene within each module.</span>
<span id="cb184-63"><a href="#cb184-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-64"><a href="#cb184-64" aria-hidden="true" tabindex="-1"></a>The analysis was realized with R <span class="co">[</span><span class="ot">v4.2.0, @RCT2022</span><span class="co">]</span>. Note the</span>
<span id="cb184-65"><a href="#cb184-65" aria-hidden="true" tabindex="-1"></a>use of the additional packages downloaded from the RStudio package manager</span>
<span id="cb184-66"><a href="#cb184-66" aria-hidden="true" tabindex="-1"></a>repository (freeze date 2022-05-04, <span class="co">[</span><span class="ot">repos</span><span class="co">]</span>(</span>
<span id="cb184-67"><a href="#cb184-67" aria-hidden="true" tabindex="-1"></a>https://packagemanager.rstudio.com/all/2022-05-04+Y3JhbiwyOjQ1MjYyMTU7NTVFQjhGODU)):</span>
<span id="cb184-68"><a href="#cb184-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-69"><a href="#cb184-69" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`MultiAssayExperiment`</span> for management of multi-omics experiment objects</span>
<span id="cb184-70"><a href="#cb184-70" aria-hidden="true" tabindex="-1"></a>  <span class="co">[</span><span class="ot">version 1.22.0, @Ramos2017</span><span class="co">]</span></span>
<span id="cb184-71"><a href="#cb184-71" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`DESeq2`</span> for differential expression analysis and</span>
<span id="cb184-72"><a href="#cb184-72" aria-hidden="true" tabindex="-1"></a>  variance stabilizing transformation <span class="co">[</span><span class="ot">version 1.36.0, @Love2014</span><span class="co">]</span></span>
<span id="cb184-73"><a href="#cb184-73" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`cowplot`</span> for figure composition <span class="co">[</span><span class="ot">version 1.1.1, @Wilke2020</span><span class="co">]</span></span>
<span id="cb184-74"><a href="#cb184-74" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`ggplot2`</span> for graphics <span class="co">[</span><span class="ot">version 3.3.6, @Wickham2016</span><span class="co">]</span></span>
<span id="cb184-75"><a href="#cb184-75" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`WGCNA`</span> for gene clustering <span class="co">[</span><span class="ot">version 1.71, @Langfelder2008, @Langfelder2012</span><span class="co">]</span>.</span>
<span id="cb184-76"><a href="#cb184-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-77"><a href="#cb184-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-78"><a href="#cb184-78" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, cfg_prog}</span></span>
<span id="cb184-79"><a href="#cb184-79" aria-hidden="true" tabindex="-1"></a>cfg_prog <span class="ot">&lt;-</span> yaml<span class="sc">::</span><span class="fu">read_yaml</span>(<span class="st">"_prog.yml"</span>)</span>
<span id="cb184-80"><a href="#cb184-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-81"><a href="#cb184-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-82"><a href="#cb184-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, settings}</span></span>
<span id="cb184-83"><a href="#cb184-83" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">"src/pkg/dbs.data"</span>)</span>
<span id="cb184-84"><a href="#cb184-84" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">"src/pkg/latarnia.utils"</span>)</span>
<span id="cb184-85"><a href="#cb184-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-86"><a href="#cb184-86" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">results =</span> cfg_prog<span class="sc">$</span>knitr<span class="sc">$</span>results)</span>
<span id="cb184-87"><a href="#cb184-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-88"><a href="#cb184-88" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/ngs.R"</span>)</span>
<span id="cb184-89"><a href="#cb184-89" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/inches.R"</span>)</span>
<span id="cb184-90"><a href="#cb184-90" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/export_xl.R"</span>)</span>
<span id="cb184-91"><a href="#cb184-91" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-92"><a href="#cb184-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-93"><a href="#cb184-93" aria-hidden="true" tabindex="-1"></a><span class="fu">### Materials and Methods</span></span>
<span id="cb184-94"><a href="#cb184-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-95"><a href="#cb184-95" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Helper functions</span></span>
<span id="cb184-96"><a href="#cb184-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-99"><a href="#cb184-99" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-100"><a href="#cb184-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Help for data pre-processing</span></span>
<span id="cb184-101"><a href="#cb184-101" aria-hidden="true" tabindex="-1"></a>filter_for_depth <span class="ot">&lt;-</span> <span class="cf">function</span>(mae, assay, depth_threshold) {</span>
<span id="cb184-102"><a href="#cb184-102" aria-hidden="true" tabindex="-1"></a>  mae[, <span class="fu">colSums</span>(mae[[ngs_assay]]) <span class="sc">&gt;</span> depth_threshold, ]</span>
<span id="cb184-103"><a href="#cb184-103" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-104"><a href="#cb184-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-105"><a href="#cb184-105" aria-hidden="true" tabindex="-1"></a>filter_for_visit <span class="ot">&lt;-</span> <span class="cf">function</span>(mae, visit) {</span>
<span id="cb184-106"><a href="#cb184-106" aria-hidden="true" tabindex="-1"></a>  mae[, <span class="fu">colData</span>(mae)<span class="sc">$</span>avisit <span class="sc">==</span> visit, ]</span>
<span id="cb184-107"><a href="#cb184-107" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-108"><a href="#cb184-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-109"><a href="#cb184-109" aria-hidden="true" tabindex="-1"></a>filter_for_coldata <span class="ot">&lt;-</span> <span class="cf">function</span>(mae, col, is) {</span>
<span id="cb184-110"><a href="#cb184-110" aria-hidden="true" tabindex="-1"></a>  mae[, <span class="fu">colData</span>(mae)[[col]] <span class="sc">%in%</span> is, ]</span>
<span id="cb184-111"><a href="#cb184-111" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-112"><a href="#cb184-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-113"><a href="#cb184-113" aria-hidden="true" tabindex="-1"></a>filter_for_low_expr <span class="ot">&lt;-</span> <span class="cf">function</span>(mae, assay, cpm_threshold,</span>
<span id="cb184-114"><a href="#cb184-114" aria-hidden="true" tabindex="-1"></a>                                <span class="at">frac_cols =</span> cfg_prog<span class="sc">$</span>rna<span class="sc">$</span>cpm_threshold<span class="sc">$</span>fraccol</span>
<span id="cb184-115"><a href="#cb184-115" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb184-116"><a href="#cb184-116" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Genes expressed at least cpm_threshold in frac_cols columns</span></span>
<span id="cb184-117"><a href="#cb184-117" aria-hidden="true" tabindex="-1"></a>  mae[</span>
<span id="cb184-118"><a href="#cb184-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowSums</span>(<span class="fu">cpm</span>(mae[[assay]]) <span class="sc">&gt;</span> cpm_threshold) <span class="sc">&gt;</span></span>
<span id="cb184-119"><a href="#cb184-119" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ncol</span>(mae[[assay]]) <span class="sc">*</span> frac_cols,</span>
<span id="cb184-120"><a href="#cb184-120" aria-hidden="true" tabindex="-1"></a>    ,</span>
<span id="cb184-121"><a href="#cb184-121" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb184-122"><a href="#cb184-122" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-123"><a href="#cb184-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-124"><a href="#cb184-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-125"><a href="#cb184-125" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Data preparation</span></span>
<span id="cb184-126"><a href="#cb184-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-127"><a href="#cb184-127" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, ads}</span></span>
<span id="cb184-128"><a href="#cb184-128" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb184-129"><a href="#cb184-129" aria-hidden="true" tabindex="-1"></a>adsl <span class="ot">&lt;-</span> dbs.data<span class="sc">::</span>adsl</span>
<span id="cb184-130"><a href="#cb184-130" aria-hidden="true" tabindex="-1"></a>advs <span class="ot">&lt;-</span> dbs.data<span class="sc">::</span>advs</span>
<span id="cb184-131"><a href="#cb184-131" aria-hidden="true" tabindex="-1"></a>adlb <span class="ot">&lt;-</span> dbs.data<span class="sc">::</span>adlb</span>
<span id="cb184-132"><a href="#cb184-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-133"><a href="#cb184-133" aria-hidden="true" tabindex="-1"></a><span class="co">#' Subjid and Visit to Sample</span></span>
<span id="cb184-134"><a href="#cb184-134" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb184-135"><a href="#cb184-135" aria-hidden="true" tabindex="-1"></a>subjvis_to_spl <span class="ot">&lt;-</span> <span class="cf">function</span>(df) <span class="fu">paste0</span>(df<span class="sc">$</span>subjid, <span class="st">"v"</span>, df<span class="sc">$</span>avisitn)</span>
<span id="cb184-136"><a href="#cb184-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-137"><a href="#cb184-137" aria-hidden="true" tabindex="-1"></a>ads <span class="ot">&lt;-</span> adlb <span class="sc">|&gt;</span></span>
<span id="cb184-138"><a href="#cb184-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(advs) <span class="sc">|&gt;</span></span>
<span id="cb184-139"><a href="#cb184-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(ct, dtype, param, base, basetype, chg, pchg)) <span class="sc">|&gt;</span></span>
<span id="cb184-140"><a href="#cb184-140" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"paramcd"</span>, <span class="at">values_from =</span> <span class="st">"aval"</span>) <span class="sc">|&gt;</span></span>
<span id="cb184-141"><a href="#cb184-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(adsl, <span class="at">y =</span> _, <span class="at">by =</span> <span class="st">"subjid"</span>) <span class="sc">|&gt;</span></span>
<span id="cb184-142"><a href="#cb184-142" aria-hidden="true" tabindex="-1"></a>  (\(df) S4Vectors<span class="sc">::</span><span class="fu">DataFrame</span>(df, <span class="at">row.names =</span> <span class="fu">subjvis_to_spl</span>(df)))() <span class="sc">|&gt;</span></span>
<span id="cb184-143"><a href="#cb184-143" aria-hidden="true" tabindex="-1"></a>  (\(df) {</span>
<span id="cb184-144"><a href="#cb184-144" aria-hidden="true" tabindex="-1"></a>    assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">all</span>(<span class="fu">table</span>(<span class="fu">subjvis_to_spl</span>(df)) <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb184-145"><a href="#cb184-145" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb184-146"><a href="#cb184-146" aria-hidden="true" tabindex="-1"></a>  })()</span>
<span id="cb184-147"><a href="#cb184-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-148"><a href="#cb184-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-149"><a href="#cb184-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-150"><a href="#cb184-150" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, rna}</span></span>
<span id="cb184-151"><a href="#cb184-151" aria-hidden="true" tabindex="-1"></a>rna <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb184-152"><a href="#cb184-152" aria-hidden="true" tabindex="-1"></a>  <span class="at">mrna =</span> dbs.data<span class="sc">::</span>mrna_raw,</span>
<span id="cb184-153"><a href="#cb184-153" aria-hidden="true" tabindex="-1"></a>  <span class="at">premirna =</span> dbs.data<span class="sc">::</span>premirna_raw,</span>
<span id="cb184-154"><a href="#cb184-154" aria-hidden="true" tabindex="-1"></a>  <span class="at">mirna =</span> dbs.data<span class="sc">::</span>mirna_raw</span>
<span id="cb184-155"><a href="#cb184-155" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-156"><a href="#cb184-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-157"><a href="#cb184-157" aria-hidden="true" tabindex="-1"></a>rna[<span class="fu">c</span>(<span class="st">"premirna"</span>, <span class="st">"mirna"</span>)] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb184-158"><a href="#cb184-158" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> rna[<span class="fu">c</span>(<span class="st">"premirna"</span>, <span class="st">"mirna"</span>)],</span>
<span id="cb184-159"><a href="#cb184-159" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN =</span> format_mirna</span>
<span id="cb184-160"><a href="#cb184-160" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-161"><a href="#cb184-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-162"><a href="#cb184-162" aria-hidden="true" tabindex="-1"></a><span class="co"># Rows represent genes</span></span>
<span id="cb184-163"><a href="#cb184-163" aria-hidden="true" tabindex="-1"></a>rna <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="at">X =</span> rna, <span class="at">FUN =</span> <span class="cf">function</span>(x) y <span class="ot">&lt;-</span> x[<span class="fu">rowSums</span>(x) <span class="sc">&gt;</span> <span class="dv">0</span>, ])</span>
<span id="cb184-164"><a href="#cb184-164" aria-hidden="true" tabindex="-1"></a>rna <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="at">X =</span> rna, as.matrix)</span>
<span id="cb184-165"><a href="#cb184-165" aria-hidden="true" tabindex="-1"></a>assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(rna<span class="sc">$</span>premirna) <span class="sc">==</span> <span class="fu">colnames</span>(rna<span class="sc">$</span>mirna)))</span>
<span id="cb184-166"><a href="#cb184-166" aria-hidden="true" tabindex="-1"></a>rna<span class="sc">$</span>allmirna <span class="ot">&lt;-</span> <span class="fu">rbind</span>(rna<span class="sc">$</span>premirna, rna<span class="sc">$</span>mirna)</span>
<span id="cb184-167"><a href="#cb184-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-168"><a href="#cb184-168" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb184-169"><a href="#cb184-169" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"rna features discriminated in noexpr, expr"</span>, {</span>
<span id="cb184-170"><a href="#cb184-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="at">X =</span> rna, <span class="at">FUN =</span> \(x) <span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">rowSums</span>(x) <span class="sc">&gt;</span> <span class="dv">0</span>)))</span>
<span id="cb184-171"><a href="#cb184-171" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb184-172"><a href="#cb184-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-173"><a href="#cb184-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-174"><a href="#cb184-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, mae}</span></span>
<span id="cb184-175"><a href="#cb184-175" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MultiAssayExperiment)</span>
<span id="cb184-176"><a href="#cb184-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-177"><a href="#cb184-177" aria-hidden="true" tabindex="-1"></a><span class="co">#' (Sample-)Map Arrays</span></span>
<span id="cb184-178"><a href="#cb184-178" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-179"><a href="#cb184-179" aria-hidden="true" tabindex="-1"></a><span class="co">#' Use the column names of `x` to deduce the `primary` and `colnames`.</span></span>
<span id="cb184-180"><a href="#cb184-180" aria-hidden="true" tabindex="-1"></a><span class="co">#' This is used to generate the sample mapping between colData and Experiments.</span></span>
<span id="cb184-181"><a href="#cb184-181" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-182"><a href="#cb184-182" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param x (`dataframe`).</span></span>
<span id="cb184-183"><a href="#cb184-183" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-184"><a href="#cb184-184" aria-hidden="true" tabindex="-1"></a><span class="co">#' @note In our case, primary and colnames are equivalent, colnames could</span></span>
<span id="cb184-185"><a href="#cb184-185" aria-hidden="true" tabindex="-1"></a><span class="co">#' be different from primary names when a biological sample has different</span></span>
<span id="cb184-186"><a href="#cb184-186" aria-hidden="true" tabindex="-1"></a><span class="co">#' names in the biological assays (e.g. machine constraint, technical</span></span>
<span id="cb184-187"><a href="#cb184-187" aria-hidden="true" tabindex="-1"></a><span class="co">#' repetitions).</span></span>
<span id="cb184-188"><a href="#cb184-188" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-189"><a href="#cb184-189" aria-hidden="true" tabindex="-1"></a><span class="co">#' @seealso [MultiAssayExperiment::listToMap()]</span></span>
<span id="cb184-190"><a href="#cb184-190" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb184-191"><a href="#cb184-191" aria-hidden="true" tabindex="-1"></a><span class="co">#' \dontrun{</span></span>
<span id="cb184-192"><a href="#cb184-192" aria-hidden="true" tabindex="-1"></a><span class="co">#'   lapply(rna, map_arrays)</span></span>
<span id="cb184-193"><a href="#cb184-193" aria-hidden="true" tabindex="-1"></a><span class="co">#'   MultiAssayExperiment::listToMap(lapply(rna, map_arrays))</span></span>
<span id="cb184-194"><a href="#cb184-194" aria-hidden="true" tabindex="-1"></a><span class="co">#' }</span></span>
<span id="cb184-195"><a href="#cb184-195" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-196"><a href="#cb184-196" aria-hidden="true" tabindex="-1"></a>map_arrays <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb184-197"><a href="#cb184-197" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">colname =</span> <span class="fu">colnames</span>(x))</span>
<span id="cb184-198"><a href="#cb184-198" aria-hidden="true" tabindex="-1"></a>  y<span class="sc">$</span>primary <span class="ot">&lt;-</span> y<span class="sc">$</span>colname</span>
<span id="cb184-199"><a href="#cb184-199" aria-hidden="true" tabindex="-1"></a>  y</span>
<span id="cb184-200"><a href="#cb184-200" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-201"><a href="#cb184-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-202"><a href="#cb184-202" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ads) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">colnames</span>(ads))</span>
<span id="cb184-203"><a href="#cb184-203" aria-hidden="true" tabindex="-1"></a>besd_mae <span class="ot">&lt;-</span> <span class="fu">MultiAssayExperiment</span>(</span>
<span id="cb184-204"><a href="#cb184-204" aria-hidden="true" tabindex="-1"></a>  <span class="at">experiments =</span> <span class="fu">ExperimentList</span>(rna),</span>
<span id="cb184-205"><a href="#cb184-205" aria-hidden="true" tabindex="-1"></a>  <span class="at">colData =</span> ads,</span>
<span id="cb184-206"><a href="#cb184-206" aria-hidden="true" tabindex="-1"></a>  <span class="at">sampleMap =</span> <span class="fu">listToMap</span>(<span class="fu">lapply</span>(rna, map_arrays))</span>
<span id="cb184-207"><a href="#cb184-207" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-208"><a href="#cb184-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-209"><a href="#cb184-209" aria-hidden="true" tabindex="-1"></a>besd_mae</span>
<span id="cb184-210"><a href="#cb184-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-211"><a href="#cb184-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-212"><a href="#cb184-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-213"><a href="#cb184-213" aria-hidden="true" tabindex="-1"></a><span class="fu">### miRNA / Baseline</span></span>
<span id="cb184-214"><a href="#cb184-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-215"><a href="#cb184-215" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, mirna_settings, eval=TRUE}</span></span>
<span id="cb184-216"><a href="#cb184-216" aria-hidden="true" tabindex="-1"></a><span class="co">#' # https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/FemaleLiver-01-dataInput.pdf</span></span>
<span id="cb184-217"><a href="#cb184-217" aria-hidden="true" tabindex="-1"></a><span class="co">#' # WGCNA: gene in rows, sample in cols</span></span>
<span id="cb184-218"><a href="#cb184-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-219"><a href="#cb184-219" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> cfg_prog<span class="sc">$</span>rna</span>
<span id="cb184-220"><a href="#cb184-220" aria-hidden="true" tabindex="-1"></a>ngs_assay <span class="ot">&lt;-</span> <span class="st">"allmirna"</span></span>
<span id="cb184-221"><a href="#cb184-221" aria-hidden="true" tabindex="-1"></a>ctrl_wgcna <span class="ot">&lt;-</span> cfg_prog<span class="sc">$</span>rna<span class="sc">$</span>wgcna<span class="sc">$</span>baseline<span class="sc">$</span>allmirna</span>
<span id="cb184-222"><a href="#cb184-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-223"><a href="#cb184-223" aria-hidden="true" tabindex="-1"></a><span class="co"># Specific to sample_clustering</span></span>
<span id="cb184-224"><a href="#cb184-224" aria-hidden="true" tabindex="-1"></a>col_fill <span class="ot">&lt;-</span> <span class="st">"glu120"</span></span>
<span id="cb184-225"><a href="#cb184-225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-226"><a href="#cb184-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-227"><a href="#cb184-227" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filter, eval=TRUE}</span></span>
<span id="cb184-228"><a href="#cb184-228" aria-hidden="true" tabindex="-1"></a>dta <span class="ot">&lt;-</span> besd_mae <span class="sc">|&gt;</span></span>
<span id="cb184-229"><a href="#cb184-229" aria-hidden="true" tabindex="-1"></a>  (\(mae) mae[ , , ngs_assay])() <span class="sc">|&gt;</span></span>
<span id="cb184-230"><a href="#cb184-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_for_depth</span>(ngs_assay, ctrl<span class="sc">$</span>depth_threshold[[ngs_assay]]) <span class="sc">|&gt;</span></span>
<span id="cb184-231"><a href="#cb184-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_for_coldata</span>(<span class="st">"avisit"</span>, <span class="at">is =</span> <span class="st">"Baseline"</span>) <span class="sc">|&gt;</span></span>
<span id="cb184-232"><a href="#cb184-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_for_coldata</span>(<span class="st">"diabcd"</span>, <span class="at">is =</span> <span class="fu">c</span>(<span class="st">"NGT"</span>, <span class="st">"T2D"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb184-233"><a href="#cb184-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_for_low_expr</span>(ngs_assay, ctrl<span class="sc">$</span>cpm_threshold[[ngs_assay]]) <span class="sc">|&gt;</span></span>
<span id="cb184-234"><a href="#cb184-234" aria-hidden="true" tabindex="-1"></a>  (\(mae) {</span>
<span id="cb184-235"><a href="#cb184-235" aria-hidden="true" tabindex="-1"></a>    mae[[ngs_assay]] <span class="ot">&lt;-</span></span>
<span id="cb184-236"><a href="#cb184-236" aria-hidden="true" tabindex="-1"></a>      DESeq2<span class="sc">::</span><span class="fu">DESeqDataSetFromMatrix</span>(</span>
<span id="cb184-237"><a href="#cb184-237" aria-hidden="true" tabindex="-1"></a>        <span class="at">countData =</span> mae[[ngs_assay]],</span>
<span id="cb184-238"><a href="#cb184-238" aria-hidden="true" tabindex="-1"></a>        <span class="at">colData =</span> <span class="fu">colData</span>(<span class="at">x =</span> mae),</span>
<span id="cb184-239"><a href="#cb184-239" aria-hidden="true" tabindex="-1"></a>        <span class="at">design =</span> stats<span class="sc">::</span><span class="fu">formula</span>(<span class="sc">~</span> diabcd)</span>
<span id="cb184-240"><a href="#cb184-240" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb184-241"><a href="#cb184-241" aria-hidden="true" tabindex="-1"></a>      DESeq2<span class="sc">::</span><span class="fu">varianceStabilizingTransformation</span>(<span class="at">blind =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb184-242"><a href="#cb184-242" aria-hidden="true" tabindex="-1"></a>      SummarizedExperiment<span class="sc">::</span><span class="fu">assay</span>()</span>
<span id="cb184-243"><a href="#cb184-243" aria-hidden="true" tabindex="-1"></a>    mae</span>
<span id="cb184-244"><a href="#cb184-244" aria-hidden="true" tabindex="-1"></a>  })()</span>
<span id="cb184-245"><a href="#cb184-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-246"><a href="#cb184-246" aria-hidden="true" tabindex="-1"></a><span class="co">#' WGCNA Expression data.</span></span>
<span id="cb184-247"><a href="#cb184-247" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-248"><a href="#cb184-248" aria-hidden="true" tabindex="-1"></a><span class="co">#' A matrix or data frame in which columns are genes and rows ar samples.</span></span>
<span id="cb184-249"><a href="#cb184-249" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-250"><a href="#cb184-250" aria-hidden="true" tabindex="-1"></a>dta_expr <span class="ot">&lt;-</span> <span class="fu">t</span>(dta[[ngs_assay]])</span>
<span id="cb184-251"><a href="#cb184-251" aria-hidden="true" tabindex="-1"></a><span class="fu">assert_that</span>(WGCNA<span class="sc">::</span><span class="fu">goodSamplesGenes</span>(dta_expr, <span class="at">verbose =</span> <span class="dv">0</span>)<span class="sc">$</span>allOK)</span>
<span id="cb184-252"><a href="#cb184-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-253"><a href="#cb184-253" aria-hidden="true" tabindex="-1"></a>dta_traits <span class="ot">&lt;-</span> <span class="fu">colData</span>(dta) <span class="sc">|&gt;</span> <span class="fu">droplevels</span>()</span>
<span id="cb184-254"><a href="#cb184-254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-255"><a href="#cb184-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-256"><a href="#cb184-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-257"><a href="#cb184-257" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Sample clustering (OID 1)</span></span>
<span id="cb184-258"><a href="#cb184-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-259"><a href="#cb184-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, sample_clustering, eval=TRUE}</span></span>
<span id="cb184-260"><a href="#cb184-260" aria-hidden="true" tabindex="-1"></a>spl_clust <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(dta_expr), <span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb184-261"><a href="#cb184-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-262"><a href="#cb184-262" aria-hidden="true" tabindex="-1"></a><span class="co"># Clustering Dendrogram of samples based on their Euclidean distance</span></span>
<span id="cb184-263"><a href="#cb184-263" aria-hidden="true" tabindex="-1"></a>theme_custom <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb184-264"><a href="#cb184-264" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_dendro</span>() <span class="sc">+</span></span>
<span id="cb184-265"><a href="#cb184-265" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb184-266"><a href="#cb184-266" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="st">"null"</span>),</span>
<span id="cb184-267"><a href="#cb184-267" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="st">"null"</span>)</span>
<span id="cb184-268"><a href="#cb184-268" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb184-269"><a href="#cb184-269" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(...)</span>
<span id="cb184-270"><a href="#cb184-270" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-271"><a href="#cb184-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-272"><a href="#cb184-272" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdendro)</span>
<span id="cb184-273"><a href="#cb184-273" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb184-274"><a href="#cb184-274" aria-hidden="true" tabindex="-1"></a>dend <span class="ot">&lt;-</span> spl_clust <span class="sc">|&gt;</span> <span class="fu">as.dendrogram</span>()</span>
<span id="cb184-275"><a href="#cb184-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-276"><a href="#cb184-276" aria-hidden="true" tabindex="-1"></a>dta_traits<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">rownames</span>(dta_traits)</span>
<span id="cb184-277"><a href="#cb184-277" aria-hidden="true" tabindex="-1"></a>dta_traits<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">factor</span>(dta_traits<span class="sc">$</span>x, <span class="at">levels =</span> <span class="fu">labels</span>(dend))</span>
<span id="cb184-278"><a href="#cb184-278" aria-hidden="true" tabindex="-1"></a>dta_traits <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(dta_traits)</span>
<span id="cb184-279"><a href="#cb184-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-280"><a href="#cb184-280" aria-hidden="true" tabindex="-1"></a>lim <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">nobs</span>(dend))</span>
<span id="cb184-281"><a href="#cb184-281" aria-hidden="true" tabindex="-1"></a>ddata <span class="ot">&lt;-</span> ggdendro<span class="sc">::</span><span class="fu">dendro_data</span>(dend, <span class="at">type =</span> <span class="st">"rectangle"</span>)</span>
<span id="cb184-282"><a href="#cb184-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-283"><a href="#cb184-283" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(ggdendro<span class="sc">::</span><span class="fu">segment</span>(ddata)) <span class="sc">+</span></span>
<span id="cb184-284"><a href="#cb184-284" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb184-285"><a href="#cb184-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb184-286"><a href="#cb184-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb184-287"><a href="#cb184-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb184-288"><a href="#cb184-288" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq_len</span>(<span class="fu">nobs</span>(dend)),</span>
<span id="cb184-289"><a href="#cb184-289" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> ggdendro<span class="sc">::</span><span class="fu">label</span>(ddata)<span class="sc">$</span>label,</span>
<span id="cb184-290"><a href="#cb184-290" aria-hidden="true" tabindex="-1"></a>    <span class="at">lim =</span> lim,</span>
<span id="cb184-291"><a href="#cb184-291" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"top"</span></span>
<span id="cb184-292"><a href="#cb184-292" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb184-293"><a href="#cb184-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_custom</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>())</span>
<span id="cb184-294"><a href="#cb184-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-295"><a href="#cb184-295" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb184-296"><a href="#cb184-296" aria-hidden="true" tabindex="-1"></a>  dta_traits,</span>
<span id="cb184-297"><a href="#cb184-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb184-298"><a href="#cb184-298" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">1</span>,</span>
<span id="cb184-299"><a href="#cb184-299" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="fu">as.numeric</span>(x) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">ymax =</span> <span class="fu">as.numeric</span>(x) <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb184-300"><a href="#cb184-300" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> diabcd</span>
<span id="cb184-301"><a href="#cb184-301" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-302"><a href="#cb184-302" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb184-303"><a href="#cb184-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb184-304"><a href="#cb184-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">34</span>) <span class="sc">+</span></span>
<span id="cb184-305"><a href="#cb184-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb184-306"><a href="#cb184-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"C"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">begin =</span> .<span class="dv">2</span>, <span class="at">end =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb184-307"><a href="#cb184-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> lim) <span class="sc">+</span></span>
<span id="cb184-308"><a href="#cb184-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_custom</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb184-309"><a href="#cb184-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-310"><a href="#cb184-310" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb184-311"><a href="#cb184-311" aria-hidden="true" tabindex="-1"></a>  dta_traits,</span>
<span id="cb184-312"><a href="#cb184-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb184-313"><a href="#cb184-313" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">1</span>,</span>
<span id="cb184-314"><a href="#cb184-314" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="fu">as.numeric</span>(x) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">ymax =</span> <span class="fu">as.numeric</span>(x) <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb184-315"><a href="#cb184-315" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="sc">!!</span><span class="fu">as.name</span>(col_fill)</span>
<span id="cb184-316"><a href="#cb184-316" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-317"><a href="#cb184-317" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb184-318"><a href="#cb184-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb184-319"><a href="#cb184-319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">34</span>) <span class="sc">+</span></span>
<span id="cb184-320"><a href="#cb184-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb184-321"><a href="#cb184-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb184-322"><a href="#cb184-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> lim) <span class="sc">+</span></span>
<span id="cb184-323"><a href="#cb184-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_custom</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb184-324"><a href="#cb184-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-325"><a href="#cb184-325" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> egg<span class="sc">::</span><span class="fu">ggarrange</span>(</span>
<span id="cb184-326"><a href="#cb184-326" aria-hidden="true" tabindex="-1"></a>  p1, p2, p4,</span>
<span id="cb184-327"><a href="#cb184-327" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb184-328"><a href="#cb184-328" aria-hidden="true" tabindex="-1"></a>  <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb184-329"><a href="#cb184-329" aria-hidden="true" tabindex="-1"></a>  <span class="at">padding =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"lines"</span>),</span>
<span id="cb184-330"><a href="#cb184-330" aria-hidden="true" tabindex="-1"></a>  <span class="at">draw =</span> <span class="cn">FALSE</span></span>
<span id="cb184-331"><a href="#cb184-331" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-332"><a href="#cb184-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-333"><a href="#cb184-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-334"><a href="#cb184-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-337"><a href="#cb184-337" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-338"><a href="#cb184-338" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb184-339"><a href="#cb184-339" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="st">"miRNA / Baseline - Clustering dendrogram of samples based on their</span></span>
<span id="cb184-340"><a href="#cb184-340" aria-hidden="true" tabindex="-1"></a><span class="st">  Euclidean distance and trait heatmap"</span></span>
<span id="cb184-341"><a href="#cb184-341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-342"><a href="#cb184-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-343"><a href="#cb184-343" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, export_sample_clustering_graph}</span></span>
<span id="cb184-344"><a href="#cb184-344" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">clean_slate</span>() <span class="sc">|&gt;</span></span>
<span id="cb184-345"><a href="#cb184-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_title</span>(<span class="fu">c</span>(</span>
<span id="cb184-346"><a href="#cb184-346" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">"Figure 11."</span>,   oid),</span>
<span id="cb184-347"><a href="#cb184-347" aria-hidden="true" tabindex="-1"></a>    <span class="fu">wrap_long_lines</span>(title)</span>
<span id="cb184-348"><a href="#cb184-348" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb184-349"><a href="#cb184-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_figure</span>(p, <span class="at">height =</span> <span class="fu">inches</span>(<span class="dv">5</span>)) <span class="sc">|&gt;</span></span>
<span id="cb184-350"><a href="#cb184-350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_note</span>(<span class="fu">c</span>(</span>
<span id="cb184-351"><a href="#cb184-351" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Note: VST transformed expression matrix used to estimate distances</span></span>
<span id="cb184-352"><a href="#cb184-352" aria-hidden="true" tabindex="-1"></a><span class="st">    between samples, _complete_ method was used for the hierarchical</span></span>
<span id="cb184-353"><a href="#cb184-353" aria-hidden="true" tabindex="-1"></a><span class="st">    clustering."</span></span>
<span id="cb184-354"><a href="#cb184-354" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb184-355"><a href="#cb184-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-356"><a href="#cb184-356" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_pad</span>(oid, <span class="dv">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span>)</span>
<span id="cb184-357"><a href="#cb184-357" aria-hidden="true" tabindex="-1"></a><span class="fu">export_as</span>(</span>
<span id="cb184-358"><a href="#cb184-358" aria-hidden="true" tabindex="-1"></a>  p,</span>
<span id="cb184-359"><a href="#cb184-359" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="fu">file.path</span>(cfg_prog<span class="sc">$</span>paths<span class="sc">$</span>grh, <span class="fu">paste0</span>(params<span class="sc">$</span>basenm, <span class="st">"_"</span>, oid, <span class="st">".pdf"</span>)),</span>
<span id="cb184-360"><a href="#cb184-360" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_graph_alone =</span> </span>
<span id="cb184-361"><a href="#cb184-361" aria-hidden="true" tabindex="-1"></a>    <span class="fu">file.path</span>(cfg_prog<span class="sc">$</span>paths<span class="sc">$</span>grh, <span class="fu">paste0</span>(params<span class="sc">$</span>basenm, <span class="st">"_"</span>, oid, <span class="st">"_af.pdf"</span>))</span>
<span id="cb184-362"><a href="#cb184-362" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-363"><a href="#cb184-363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-364"><a href="#cb184-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-365"><a href="#cb184-365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb184-366"><a href="#cb184-366" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11.7</span></span>
<span id="cb184-367"><a href="#cb184-367" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8.3</span></span>
<span id="cb184-368"><a href="#cb184-368" aria-hidden="true" tabindex="-1"></a><span class="fu">show_slate</span>(p)</span>
<span id="cb184-369"><a href="#cb184-369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-370"><a href="#cb184-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-371"><a href="#cb184-371" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Gene Clustering</span></span>
<span id="cb184-372"><a href="#cb184-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-373"><a href="#cb184-373" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Soft threshold determination (OID 2)</span></span>
<span id="cb184-374"><a href="#cb184-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-375"><a href="#cb184-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, sft_determination}</span></span>
<span id="cb184-376"><a href="#cb184-376" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WGCNA)</span>
<span id="cb184-377"><a href="#cb184-377" aria-hidden="true" tabindex="-1"></a><span class="fu">enableWGCNAThreads</span>()</span>
<span id="cb184-378"><a href="#cb184-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-379"><a href="#cb184-379" aria-hidden="true" tabindex="-1"></a>pwr <span class="ot">&lt;-</span> ctrl_wgcna<span class="sc">$</span>adjacency<span class="sc">$</span>power</span>
<span id="cb184-380"><a href="#cb184-380" aria-hidden="true" tabindex="-1"></a>sft <span class="ot">&lt;-</span> <span class="fu">pickSoftThreshold</span>(</span>
<span id="cb184-381"><a href="#cb184-381" aria-hidden="true" tabindex="-1"></a>  dta_expr,</span>
<span id="cb184-382"><a href="#cb184-382" aria-hidden="true" tabindex="-1"></a>  <span class="at">powerVector =</span> <span class="fu">c</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">12</span>, <span class="at">to=</span><span class="dv">20</span>, <span class="at">by=</span><span class="dv">2</span>)),</span>
<span id="cb184-383"><a href="#cb184-383" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span></span>
<span id="cb184-384"><a href="#cb184-384" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-385"><a href="#cb184-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-386"><a href="#cb184-386" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb184-387"><a href="#cb184-387" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb184-388"><a href="#cb184-388" aria-hidden="true" tabindex="-1"></a>  sft<span class="sc">$</span>fitIndices,</span>
<span id="cb184-389"><a href="#cb184-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(Power, <span class="sc">-</span> <span class="fu">sign</span>(slope) <span class="sc">*</span> SFT.R.sq, <span class="at">label =</span> Power)</span>
<span id="cb184-390"><a href="#cb184-390" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb184-391"><a href="#cb184-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">9</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb184-392"><a href="#cb184-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">lty =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb184-393"><a href="#cb184-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb184-394"><a href="#cb184-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(</span>
<span id="cb184-395"><a href="#cb184-395" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sft<span class="sc">$</span>fitIndices <span class="sc">|&gt;</span> <span class="fu">subset</span>(Power <span class="sc">==</span> pwr),</span>
<span id="cb184-396"><a href="#cb184-396" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">nudge_y =</span> .<span class="dv">025</span></span>
<span id="cb184-397"><a href="#cb184-397" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb184-398"><a href="#cb184-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb184-399"><a href="#cb184-399" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sft<span class="sc">$</span>fitIndices <span class="sc">|&gt;</span> <span class="fu">subset</span>(Power <span class="sc">==</span> pwr),</span>
<span id="cb184-400"><a href="#cb184-400" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xend =</span> Power, <span class="at">yend =</span> <span class="dv">0</span>)</span>
<span id="cb184-401"><a href="#cb184-401" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb184-402"><a href="#cb184-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb184-403"><a href="#cb184-403" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sft<span class="sc">$</span>fitIndices <span class="sc">|&gt;</span> <span class="fu">subset</span>(Power <span class="sc">==</span> pwr),</span>
<span id="cb184-404"><a href="#cb184-404" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xend =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">yend =</span> <span class="sc">-</span> <span class="fu">sign</span>(slope) <span class="sc">*</span> SFT.R.sq)</span>
<span id="cb184-405"><a href="#cb184-405" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb184-406"><a href="#cb184-406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> Power <span class="sc">==</span> pwr), <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb184-407"><a href="#cb184-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"TRUE"</span> <span class="ot">=</span> <span class="dv">21</span>, <span class="st">"FALSE"</span> <span class="ot">=</span> <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb184-408"><a href="#cb184-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb184-409"><a href="#cb184-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Soft Threshold (power)"</span>) <span class="sc">+</span></span>
<span id="cb184-410"><a href="#cb184-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Scale Free Topology Model Fit"</span>) <span class="sc">+</span></span>
<span id="cb184-411"><a href="#cb184-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Scale independence"</span>) <span class="sc">+</span></span>
<span id="cb184-412"><a href="#cb184-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb184-413"><a href="#cb184-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb184-414"><a href="#cb184-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-415"><a href="#cb184-415" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb184-416"><a href="#cb184-416" aria-hidden="true" tabindex="-1"></a>  sft<span class="sc">$</span>fitIndices,</span>
<span id="cb184-417"><a href="#cb184-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(Power, mean.k., <span class="at">label =</span> Power, <span class="at">shape =</span> Power <span class="sc">==</span> pwr)) <span class="sc">+</span></span>
<span id="cb184-418"><a href="#cb184-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb184-419"><a href="#cb184-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb184-420"><a href="#cb184-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb184-421"><a href="#cb184-421" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sft<span class="sc">$</span>fitIndices <span class="sc">|&gt;</span> <span class="fu">subset</span>(Power <span class="sc">==</span> pwr),</span>
<span id="cb184-422"><a href="#cb184-422" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xend =</span> Power, <span class="at">yend =</span> <span class="dv">0</span>)</span>
<span id="cb184-423"><a href="#cb184-423" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb184-424"><a href="#cb184-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb184-425"><a href="#cb184-425" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sft<span class="sc">$</span>fitIndices <span class="sc">|&gt;</span> <span class="fu">subset</span>(Power <span class="sc">==</span> pwr),</span>
<span id="cb184-426"><a href="#cb184-426" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xend =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">yend =</span> mean.k.)</span>
<span id="cb184-427"><a href="#cb184-427" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb184-428"><a href="#cb184-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(</span>
<span id="cb184-429"><a href="#cb184-429" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sft<span class="sc">$</span>fitIndices <span class="sc">|&gt;</span> <span class="fu">subset</span>(Power <span class="sc">==</span> pwr),</span>
<span id="cb184-430"><a href="#cb184-430" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">nudge_y =</span> <span class="dv">1</span></span>
<span id="cb184-431"><a href="#cb184-431" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb184-432"><a href="#cb184-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb184-433"><a href="#cb184-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"TRUE"</span> <span class="ot">=</span> <span class="dv">21</span>, <span class="st">"FALSE"</span> <span class="ot">=</span> <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb184-434"><a href="#cb184-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Soft Threshold (power)"</span>) <span class="sc">+</span></span>
<span id="cb184-435"><a href="#cb184-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Mean connectivity"</span>) <span class="sc">+</span></span>
<span id="cb184-436"><a href="#cb184-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Mean connectivity"</span>) <span class="sc">+</span></span>
<span id="cb184-437"><a href="#cb184-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb184-438"><a href="#cb184-438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb184-439"><a href="#cb184-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-440"><a href="#cb184-440" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">draw =</span> <span class="cn">FALSE</span>)</span>
<span id="cb184-441"><a href="#cb184-441" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-442"><a href="#cb184-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-445"><a href="#cb184-445" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-446"><a href="#cb184-446" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb184-447"><a href="#cb184-447" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="st">"Micro-RNA / Baseline - Soft threshold determination"</span></span>
<span id="cb184-448"><a href="#cb184-448" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-449"><a href="#cb184-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-450"><a href="#cb184-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, export_sft_graph}</span></span>
<span id="cb184-451"><a href="#cb184-451" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">clean_slate</span>() <span class="sc">|&gt;</span></span>
<span id="cb184-452"><a href="#cb184-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_title</span>(<span class="fu">c</span>(</span>
<span id="cb184-453"><a href="#cb184-453" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">"Figure 11."</span>, oid),</span>
<span id="cb184-454"><a href="#cb184-454" aria-hidden="true" tabindex="-1"></a>    title</span>
<span id="cb184-455"><a href="#cb184-455" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb184-456"><a href="#cb184-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_figure</span>(p, <span class="at">width =</span> <span class="fu">inches</span>(<span class="dv">6</span>), <span class="at">height =</span> <span class="fu">inches</span>(<span class="dv">3</span>))</span>
<span id="cb184-457"><a href="#cb184-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-458"><a href="#cb184-458" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_pad</span>(oid, <span class="dv">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span>)</span>
<span id="cb184-459"><a href="#cb184-459" aria-hidden="true" tabindex="-1"></a><span class="fu">export_as</span>(</span>
<span id="cb184-460"><a href="#cb184-460" aria-hidden="true" tabindex="-1"></a>  p,</span>
<span id="cb184-461"><a href="#cb184-461" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="fu">file.path</span>(cfg_prog<span class="sc">$</span>paths<span class="sc">$</span>grh, <span class="fu">paste0</span>(params<span class="sc">$</span>basenm, <span class="st">"_"</span>, oid, <span class="st">".pdf"</span>)),</span>
<span id="cb184-462"><a href="#cb184-462" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_graph_alone =</span> </span>
<span id="cb184-463"><a href="#cb184-463" aria-hidden="true" tabindex="-1"></a>    <span class="fu">file.path</span>(cfg_prog<span class="sc">$</span>paths<span class="sc">$</span>grh, <span class="fu">paste0</span>(params<span class="sc">$</span>basenm, <span class="st">"_"</span>, oid, <span class="st">"_af.pdf"</span>))</span>
<span id="cb184-464"><a href="#cb184-464" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-465"><a href="#cb184-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-466"><a href="#cb184-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-467"><a href="#cb184-467" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb184-468"><a href="#cb184-468" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11.7</span></span>
<span id="cb184-469"><a href="#cb184-469" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8.3</span></span>
<span id="cb184-470"><a href="#cb184-470" aria-hidden="true" tabindex="-1"></a><span class="fu">show_slate</span>(p)</span>
<span id="cb184-471"><a href="#cb184-471" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-472"><a href="#cb184-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-473"><a href="#cb184-473" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Network</span></span>
<span id="cb184-474"><a href="#cb184-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-475"><a href="#cb184-475" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, network}</span></span>
<span id="cb184-476"><a href="#cb184-476" aria-hidden="true" tabindex="-1"></a><span class="co"># gene dissimilarity</span></span>
<span id="cb184-477"><a href="#cb184-477" aria-hidden="true" tabindex="-1"></a>tom_dis <span class="ot">&lt;-</span> dta_expr <span class="sc">|&gt;</span></span>
<span id="cb184-478"><a href="#cb184-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adjacency</span>(</span>
<span id="cb184-479"><a href="#cb184-479" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> ctrl_wgcna<span class="sc">$</span>adjacency<span class="sc">$</span>type,</span>
<span id="cb184-480"><a href="#cb184-480" aria-hidden="true" tabindex="-1"></a>    <span class="at">power =</span> ctrl_wgcna<span class="sc">$</span>adjacency<span class="sc">$</span>power,</span>
<span id="cb184-481"><a href="#cb184-481" aria-hidden="true" tabindex="-1"></a>    <span class="at">corFnc =</span> ctrl_wgcna<span class="sc">$</span>adjacency<span class="sc">$</span>cor_fn<span class="sc">$</span>value</span>
<span id="cb184-482"><a href="#cb184-482" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb184-483"><a href="#cb184-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">TOMsimilarity</span>(<span class="at">TOMType =</span> ctrl_wgcna<span class="sc">$</span>tom<span class="sc">$</span>type) <span class="sc">|&gt;</span></span>
<span id="cb184-484"><a href="#cb184-484" aria-hidden="true" tabindex="-1"></a>  (\(tom) <span class="dv">1</span> <span class="sc">-</span> tom)()</span>
<span id="cb184-485"><a href="#cb184-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-486"><a href="#cb184-486" aria-hidden="true" tabindex="-1"></a>gene_hc <span class="ot">&lt;-</span> tom_dis <span class="sc">|&gt;</span></span>
<span id="cb184-487"><a href="#cb184-487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.dist</span>() <span class="sc">|&gt;</span></span>
<span id="cb184-488"><a href="#cb184-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb184-489"><a href="#cb184-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-490"><a href="#cb184-490" aria-hidden="true" tabindex="-1"></a><span class="co"># gene clustering</span></span>
<span id="cb184-491"><a href="#cb184-491" aria-hidden="true" tabindex="-1"></a>dyn_mod <span class="ot">&lt;-</span> <span class="fu">cutreeDynamic</span>(</span>
<span id="cb184-492"><a href="#cb184-492" aria-hidden="true" tabindex="-1"></a>  gene_hc,</span>
<span id="cb184-493"><a href="#cb184-493" aria-hidden="true" tabindex="-1"></a>  <span class="at">cutHeight =</span> ctrl_wgcna<span class="sc">$</span>cuttree<span class="sc">$</span>cut_height,</span>
<span id="cb184-494"><a href="#cb184-494" aria-hidden="true" tabindex="-1"></a>  <span class="at">minClusterSize =</span> ctrl_wgcna<span class="sc">$</span>cuttree<span class="sc">$</span>min_cluster_size,</span>
<span id="cb184-495"><a href="#cb184-495" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"hybrid"</span>,</span>
<span id="cb184-496"><a href="#cb184-496" aria-hidden="true" tabindex="-1"></a>  <span class="at">distM =</span> tom_dis,</span>
<span id="cb184-497"><a href="#cb184-497" aria-hidden="true" tabindex="-1"></a>  <span class="at">deepSplit =</span> ctrl_wgcna<span class="sc">$</span>cuttree<span class="sc">$</span>deep_split,</span>
<span id="cb184-498"><a href="#cb184-498" aria-hidden="true" tabindex="-1"></a>  <span class="at">pamRespectsDendro =</span> <span class="cn">FALSE</span></span>
<span id="cb184-499"><a href="#cb184-499" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-500"><a href="#cb184-500" aria-hidden="true" tabindex="-1"></a>dyn_col <span class="ot">&lt;-</span> <span class="fu">labels2colors</span>(dyn_mod)</span>
<span id="cb184-501"><a href="#cb184-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-502"><a href="#cb184-502" aria-hidden="true" tabindex="-1"></a><span class="co"># me: module eigengenes (also used to merge dyn_col)</span></span>
<span id="cb184-503"><a href="#cb184-503" aria-hidden="true" tabindex="-1"></a>dyn_mge <span class="ot">&lt;-</span> dta_expr <span class="sc">|&gt;</span> WGCNA<span class="sc">::</span><span class="fu">mergeCloseModules</span>(dyn_col)</span>
<span id="cb184-504"><a href="#cb184-504" aria-hidden="true" tabindex="-1"></a>meig <span class="ot">&lt;-</span> dyn_mge<span class="sc">$</span>newMEs</span>
<span id="cb184-505"><a href="#cb184-505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-506"><a href="#cb184-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-507"><a href="#cb184-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, gene_dendro, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb184-508"><a href="#cb184-508" aria-hidden="true" tabindex="-1"></a><span class="co"># Not exported yet</span></span>
<span id="cb184-509"><a href="#cb184-509" aria-hidden="true" tabindex="-1"></a>WGCNA<span class="sc">::</span><span class="fu">plotDendroAndColors</span>(</span>
<span id="cb184-510"><a href="#cb184-510" aria-hidden="true" tabindex="-1"></a>  <span class="at">dendro =</span> gene_hc,</span>
<span id="cb184-511"><a href="#cb184-511" aria-hidden="true" tabindex="-1"></a>  <span class="at">colors =</span> dyn_mge<span class="sc">$</span>color,</span>
<span id="cb184-512"><a href="#cb184-512" aria-hidden="true" tabindex="-1"></a>  <span class="at">dendroLabels =</span> <span class="cn">FALSE</span>,</span>
<span id="cb184-513"><a href="#cb184-513" aria-hidden="true" tabindex="-1"></a>  <span class="at">addGuide =</span> <span class="cn">TRUE</span>,</span>
<span id="cb184-514"><a href="#cb184-514" aria-hidden="true" tabindex="-1"></a>  <span class="at">guideHang =</span> <span class="fl">0.05</span>,</span>
<span id="cb184-515"><a href="#cb184-515" aria-hidden="true" tabindex="-1"></a>  <span class="at">groupLabels =</span> <span class="st">""</span>,</span>
<span id="cb184-516"><a href="#cb184-516" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex.rowText =</span> <span class="fl">0.5</span>,</span>
<span id="cb184-517"><a href="#cb184-517" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex.colorLabels =</span> <span class="fl">0.5</span>,</span>
<span id="cb184-518"><a href="#cb184-518" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex.dendroLabels =</span> <span class="fl">0.9</span>,</span>
<span id="cb184-519"><a href="#cb184-519" aria-hidden="true" tabindex="-1"></a>  <span class="at">marAll =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb184-520"><a href="#cb184-520" aria-hidden="true" tabindex="-1"></a>  <span class="at">axes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb184-521"><a href="#cb184-521" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="cn">NULL</span>,</span>
<span id="cb184-522"><a href="#cb184-522" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="cn">NULL</span></span>
<span id="cb184-523"><a href="#cb184-523" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-524"><a href="#cb184-524" aria-hidden="true" tabindex="-1"></a>graphics<span class="sc">::</span><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb184-525"><a href="#cb184-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-526"><a href="#cb184-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-527"><a href="#cb184-527" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Eigengenes exploration</span></span>
<span id="cb184-528"><a href="#cb184-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-529"><a href="#cb184-529" aria-hidden="true" tabindex="-1"></a><span class="fu">##### OID 3 - Heatmap</span></span>
<span id="cb184-530"><a href="#cb184-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-531"><a href="#cb184-531" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eig_traits_heatmap_functions}</span></span>
<span id="cb184-532"><a href="#cb184-532" aria-hidden="true" tabindex="-1"></a>theme_custom_dend <span class="ot">&lt;-</span> <span class="cf">function</span>(gg, ...) {</span>
<span id="cb184-533"><a href="#cb184-533" aria-hidden="true" tabindex="-1"></a>  gg <span class="sc">+</span></span>
<span id="cb184-534"><a href="#cb184-534" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb184-535"><a href="#cb184-535" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb184-536"><a href="#cb184-536" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb184-537"><a href="#cb184-537" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb184-538"><a href="#cb184-538" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb184-539"><a href="#cb184-539" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb184-540"><a href="#cb184-540" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="st">"transparent"</span></span>
<span id="cb184-541"><a href="#cb184-541" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb184-542"><a href="#cb184-542" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb184-543"><a href="#cb184-543" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="st">"transparent"</span></span>
<span id="cb184-544"><a href="#cb184-544" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb184-545"><a href="#cb184-545" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb184-546"><a href="#cb184-546" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="st">"transparent"</span></span>
<span id="cb184-547"><a href="#cb184-547" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb184-548"><a href="#cb184-548" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb184-549"><a href="#cb184-549" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(...)</span>
<span id="cb184-550"><a href="#cb184-550" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-551"><a href="#cb184-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-552"><a href="#cb184-552" aria-hidden="true" tabindex="-1"></a><span class="co">#' @describeIn wrap_wgcna improved correlation matrix.</span></span>
<span id="cb184-553"><a href="#cb184-553" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param mat_y,mat_x the matrix used in rows or columns.</span></span>
<span id="cb184-554"><a href="#cb184-554" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param draw (`logical`)</span></span>
<span id="cb184-555"><a href="#cb184-555" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param newpage (`logical`)</span></span>
<span id="cb184-556"><a href="#cb184-556" aria-hidden="true" tabindex="-1"></a><span class="co">#' @import ggplot2</span></span>
<span id="cb184-557"><a href="#cb184-557" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb184-558"><a href="#cb184-558" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-559"><a href="#cb184-559" aria-hidden="true" tabindex="-1"></a>gg_eigen <span class="ot">&lt;-</span> <span class="cf">function</span>(mat_y, mat_x, <span class="at">draw =</span> <span class="cn">FALSE</span>, <span class="at">newpage =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb184-560"><a href="#cb184-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-561"><a href="#cb184-561" aria-hidden="true" tabindex="-1"></a>  dta <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">cor</span>(mat_y, mat_x, <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)</span>
<span id="cb184-562"><a href="#cb184-562" aria-hidden="true" tabindex="-1"></a>  dta <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(</span>
<span id="cb184-563"><a href="#cb184-563" aria-hidden="true" tabindex="-1"></a>    dta, <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">"eig"</span>, <span class="st">"traits"</span>), <span class="at">value.name =</span> <span class="st">"cor"</span></span>
<span id="cb184-564"><a href="#cb184-564" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-565"><a href="#cb184-565" aria-hidden="true" tabindex="-1"></a>  dta<span class="sc">$</span>cor_pval <span class="ot">&lt;-</span> WGCNA<span class="sc">::</span><span class="fu">corPvalueStudent</span>(dta<span class="sc">$</span>cor, <span class="at">nSamples =</span> <span class="fu">nrow</span>(mat_x))</span>
<span id="cb184-566"><a href="#cb184-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-567"><a href="#cb184-567" aria-hidden="true" tabindex="-1"></a>  dendro_y   <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">d =</span> stats<span class="sc">::</span><span class="fu">as.dist</span>(<span class="dv">1</span> <span class="sc">-</span> stats<span class="sc">::</span><span class="fu">cor</span>(mat_y)))</span>
<span id="cb184-568"><a href="#cb184-568" aria-hidden="true" tabindex="-1"></a>  dendro_y   <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">as.dendrogram</span>(dendro_y);</span>
<span id="cb184-569"><a href="#cb184-569" aria-hidden="true" tabindex="-1"></a>  y_neworder <span class="ot">&lt;-</span> <span class="fu">labels</span>(dendro_y)</span>
<span id="cb184-570"><a href="#cb184-570" aria-hidden="true" tabindex="-1"></a>  dendro_y   <span class="ot">&lt;-</span> ggdendro<span class="sc">::</span><span class="fu">ggdendrogram</span>(<span class="at">data =</span> dendro_y, <span class="at">rotate =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb184-571"><a href="#cb184-571" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="fl">0.2</span>), <span class="at">units=</span><span class="st">"lines"</span>))</span>
<span id="cb184-572"><a href="#cb184-572" aria-hidden="true" tabindex="-1"></a>  dendro_y <span class="ot">&lt;-</span> <span class="fu">theme_custom_dend</span>(<span class="at">gg =</span> dendro_y)</span>
<span id="cb184-573"><a href="#cb184-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-574"><a href="#cb184-574" aria-hidden="true" tabindex="-1"></a>  dendro_x <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">as.dist</span>(<span class="dv">1</span> <span class="sc">-</span> stats<span class="sc">::</span><span class="fu">cor</span>(mat_x))</span>
<span id="cb184-575"><a href="#cb184-575" aria-hidden="true" tabindex="-1"></a>  dendro_x <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">d =</span> stats<span class="sc">::</span><span class="fu">dist</span>(<span class="at">x =</span> dendro_x))</span>
<span id="cb184-576"><a href="#cb184-576" aria-hidden="true" tabindex="-1"></a>  dendro_x <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">as.dendrogram</span>(dendro_x)</span>
<span id="cb184-577"><a href="#cb184-577" aria-hidden="true" tabindex="-1"></a>  x_neworder <span class="ot">&lt;-</span> <span class="fu">labels</span>(dendro_x)</span>
<span id="cb184-578"><a href="#cb184-578" aria-hidden="true" tabindex="-1"></a>  dendro_x <span class="ot">&lt;-</span> ggdendro<span class="sc">::</span><span class="fu">ggdendrogram</span>(<span class="at">data =</span> dendro_x, <span class="at">rotate =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb184-579"><a href="#cb184-579" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="sc">-</span>.<span class="dv">8</span>,<span class="dv">0</span>), <span class="at">units=</span><span class="st">"lines"</span>))</span>
<span id="cb184-580"><a href="#cb184-580" aria-hidden="true" tabindex="-1"></a>  dendro_x <span class="ot">&lt;-</span> <span class="fu">theme_custom_dend</span>(<span class="at">gg =</span> dendro_x)</span>
<span id="cb184-581"><a href="#cb184-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-582"><a href="#cb184-582" aria-hidden="true" tabindex="-1"></a>  dta<span class="sc">$</span>traits <span class="ot">&lt;-</span> <span class="fu">factor</span>(dta<span class="sc">$</span>traits, <span class="at">levels =</span> x_neworder)</span>
<span id="cb184-583"><a href="#cb184-583" aria-hidden="true" tabindex="-1"></a>  dta<span class="sc">$</span>eig <span class="ot">&lt;-</span> <span class="fu">factor</span>(dta<span class="sc">$</span>eig, <span class="at">levels =</span> y_neworder)</span>
<span id="cb184-584"><a href="#cb184-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-585"><a href="#cb184-585" aria-hidden="true" tabindex="-1"></a>  dta<span class="sc">$</span>cor_pval_2d <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">round</span>(dta<span class="sc">$</span>cor_pval, <span class="dv">2</span>), <span class="at">nsmall =</span> <span class="dv">2</span>)</span>
<span id="cb184-586"><a href="#cb184-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-587"><a href="#cb184-587" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create heatmap plot</span></span>
<span id="cb184-588"><a href="#cb184-588" aria-hidden="true" tabindex="-1"></a>  heatmap.plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb184-589"><a href="#cb184-589" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dta,</span>
<span id="cb184-590"><a href="#cb184-590" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes_string</span>(<span class="at">x =</span> <span class="st">"traits"</span>, <span class="at">y =</span> <span class="st">"eig"</span>)</span>
<span id="cb184-591"><a href="#cb184-591" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">geom_tile</span>(<span class="at">data =</span> dta, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">col =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb184-592"><a href="#cb184-592" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(</span>
<span id="cb184-593"><a href="#cb184-593" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> dta[dta<span class="sc">$</span>cor_pval <span class="sc">&lt;</span> <span class="fl">0.1</span>, ],</span>
<span id="cb184-594"><a href="#cb184-594" aria-hidden="true" tabindex="-1"></a>      <span class="at">mapping =</span> <span class="fu">aes_string</span>(<span class="at">fill =</span> <span class="st">"cor"</span>)</span>
<span id="cb184-595"><a href="#cb184-595" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="fu">geom_text</span>(</span>
<span id="cb184-596"><a href="#cb184-596" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> dta[dta<span class="sc">$</span>cor_pval <span class="sc">&lt;</span> <span class="fl">0.1</span>, ],</span>
<span id="cb184-597"><a href="#cb184-597" aria-hidden="true" tabindex="-1"></a>      <span class="at">mapping =</span> <span class="fu">aes_string</span>(<span class="at">label =</span> <span class="st">"cor_pval_2d"</span>),</span>
<span id="cb184-598"><a href="#cb184-598" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">2</span></span>
<span id="cb184-599"><a href="#cb184-599" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb184-600"><a href="#cb184-600" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, .<span class="dv">2</span>),</span>
<span id="cb184-601"><a href="#cb184-601" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"Corr."</span>,</span>
<span id="cb184-602"><a href="#cb184-602" aria-hidden="true" tabindex="-1"></a>      <span class="at">guide =</span> <span class="fu">guide_colourbar</span>(<span class="at">barheight =</span> <span class="dv">10</span>),</span>
<span id="cb184-603"><a href="#cb184-603" aria-hidden="true" tabindex="-1"></a>      <span class="at">option =</span> <span class="st">"B"</span>,</span>
<span id="cb184-604"><a href="#cb184-604" aria-hidden="true" tabindex="-1"></a>      <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb184-605"><a href="#cb184-605" aria-hidden="true" tabindex="-1"></a>      <span class="at">lim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb184-606"><a href="#cb184-606" aria-hidden="true" tabindex="-1"></a>      <span class="at">begin =</span> .<span class="dv">1</span>,</span>
<span id="cb184-607"><a href="#cb184-607" aria-hidden="true" tabindex="-1"></a>      <span class="at">end =</span> .<span class="dv">9</span></span>
<span id="cb184-608"><a href="#cb184-608" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span> <span class="fu">coord_cartesian</span>(</span>
<span id="cb184-609"><a href="#cb184-609" aria-hidden="true" tabindex="-1"></a>      <span class="at">expand =</span> <span class="cn">FALSE</span></span>
<span id="cb184-610"><a href="#cb184-610" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb184-611"><a href="#cb184-611" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb184-612"><a href="#cb184-612" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb184-613"><a href="#cb184-613" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb184-614"><a href="#cb184-614" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"left"</span>,</span>
<span id="cb184-615"><a href="#cb184-615" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb184-616"><a href="#cb184-616" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb184-617"><a href="#cb184-617" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="st">"transparent"</span></span>
<span id="cb184-618"><a href="#cb184-618" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb184-619"><a href="#cb184-619" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb184-620"><a href="#cb184-620" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="st">"transparent"</span></span>
<span id="cb184-621"><a href="#cb184-621" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb184-622"><a href="#cb184-622" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb184-623"><a href="#cb184-623" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="st">"transparent"</span></span>
<span id="cb184-624"><a href="#cb184-624" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb184-625"><a href="#cb184-625" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.key.width =</span> grid<span class="sc">::</span><span class="fu">unit</span>(.<span class="dv">3</span>, <span class="st">"cm"</span>),</span>
<span id="cb184-626"><a href="#cb184-626" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb184-627"><a href="#cb184-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-628"><a href="#cb184-628" aria-hidden="true" tabindex="-1"></a>  a1 <span class="ot">&lt;-</span> <span class="fu">ggplotGrob</span>(heatmap.plot)</span>
<span id="cb184-629"><a href="#cb184-629" aria-hidden="true" tabindex="-1"></a>  a2 <span class="ot">&lt;-</span> <span class="fu">ggplotGrob</span>(dendro_y)</span>
<span id="cb184-630"><a href="#cb184-630" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fu">cbind</span>(a1, a2, <span class="at">size =</span> <span class="st">"max"</span>)</span>
<span id="cb184-631"><a href="#cb184-631" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplotGrob</span>(dendro_x)</span>
<span id="cb184-632"><a href="#cb184-632" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_cols</span>(</span>
<span id="cb184-633"><a href="#cb184-633" aria-hidden="true" tabindex="-1"></a>    b,</span>
<span id="cb184-634"><a href="#cb184-634" aria-hidden="true" tabindex="-1"></a>    <span class="at">widths =</span> a1<span class="sc">$</span>widths[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(a1<span class="sc">$</span>widths)<span class="sc">-</span><span class="fu">length</span>(b<span class="sc">$</span>widths))],</span>
<span id="cb184-635"><a href="#cb184-635" aria-hidden="true" tabindex="-1"></a>    <span class="at">pos =</span> <span class="dv">0</span></span>
<span id="cb184-636"><a href="#cb184-636" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-637"><a href="#cb184-637" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_cols</span>(b, <span class="at">widths =</span> a2<span class="sc">$</span>widths, <span class="at">pos =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb184-638"><a href="#cb184-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-639"><a href="#cb184-639" aria-hidden="true" tabindex="-1"></a>  ab <span class="ot">&lt;-</span> <span class="fu">rbind</span>(b, a, <span class="at">size =</span> <span class="st">"last"</span>)</span>
<span id="cb184-640"><a href="#cb184-640" aria-hidden="true" tabindex="-1"></a>  ab <span class="ot">&lt;-</span> <span class="fu">rbind</span>(b, a, <span class="at">size =</span> <span class="st">"last"</span>, <span class="at">z =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>))</span>
<span id="cb184-641"><a href="#cb184-641" aria-hidden="true" tabindex="-1"></a>  ab<span class="sc">$</span>heights[<span class="dv">7</span>] <span class="ot">&lt;-</span> <span class="fu">unit</span>(<span class="dv">3</span>, <span class="st">"lines"</span>)</span>
<span id="cb184-642"><a href="#cb184-642" aria-hidden="true" tabindex="-1"></a>  ab<span class="sc">$</span>widths[<span class="dv">16</span>] <span class="ot">&lt;-</span> <span class="fu">unit</span>(<span class="dv">3</span>, <span class="st">"lines"</span>)</span>
<span id="cb184-643"><a href="#cb184-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-644"><a href="#cb184-644" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (draw) {</span>
<span id="cb184-645"><a href="#cb184-645" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (newpage) grid<span class="sc">::</span><span class="fu">grid.newpage</span>()</span>
<span id="cb184-646"><a href="#cb184-646" aria-hidden="true" tabindex="-1"></a>    grid<span class="sc">::</span><span class="fu">grid.draw</span>(ab)</span>
<span id="cb184-647"><a href="#cb184-647" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb184-648"><a href="#cb184-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-649"><a href="#cb184-649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb184-650"><a href="#cb184-650" aria-hidden="true" tabindex="-1"></a>    <span class="at">gg =</span> ab,</span>
<span id="cb184-651"><a href="#cb184-651" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dta</span>
<span id="cb184-652"><a href="#cb184-652" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-653"><a href="#cb184-653" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-654"><a href="#cb184-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-655"><a href="#cb184-655" aria-hidden="true" tabindex="-1"></a>prep_col <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">UseMethod</span>(<span class="st">"prep_col"</span>, x)</span>
<span id="cb184-656"><a href="#cb184-656" aria-hidden="true" tabindex="-1"></a>prep_col.numeric <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">identity</span>(x)</span>
<span id="cb184-657"><a href="#cb184-657" aria-hidden="true" tabindex="-1"></a>prep_col.factor <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">as.numeric</span>(x)</span>
<span id="cb184-658"><a href="#cb184-658" aria-hidden="true" tabindex="-1"></a>prep_col.character <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb184-659"><a href="#cb184-659" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(x)</span>
<span id="cb184-660"><a href="#cb184-660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep_col</span>(x)</span>
<span id="cb184-661"><a href="#cb184-661" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-662"><a href="#cb184-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-663"><a href="#cb184-663" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-664"><a href="#cb184-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-665"><a href="#cb184-665" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, wgcna_heatmap_graph}</span></span>
<span id="cb184-666"><a href="#cb184-666" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">gg_eigen</span>(</span>
<span id="cb184-667"><a href="#cb184-667" aria-hidden="true" tabindex="-1"></a>  dta_traits <span class="sc">|&gt;</span></span>
<span id="cb184-668"><a href="#cb184-668" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(</span>
<span id="cb184-669"><a href="#cb184-669" aria-hidden="true" tabindex="-1"></a>      diabcd, diab, age, trainn,</span>
<span id="cb184-670"><a href="#cb184-670" aria-hidden="true" tabindex="-1"></a>      chol, glu0, glu120, glu30, glu60, hba1c, hdl,</span>
<span id="cb184-671"><a href="#cb184-671" aria-hidden="true" tabindex="-1"></a>      homab, homair, insulin0, insulin120, insulin30, insulin60, ldl,</span>
<span id="cb184-672"><a href="#cb184-672" aria-hidden="true" tabindex="-1"></a>      matsuda, trig, bmi, bodyfatp, dcal, dcarbt, dfatt,</span>
<span id="cb184-673"><a href="#cb184-673" aria-hidden="true" tabindex="-1"></a>      dprot, fatacfr, fatmass, leanmass, smmass, vat, vo2maxe,</span>
<span id="cb184-674"><a href="#cb184-674" aria-hidden="true" tabindex="-1"></a>      vo2maxlbm, vo2maxml, weight</span>
<span id="cb184-675"><a href="#cb184-675" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span></span>
<span id="cb184-676"><a href="#cb184-676" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(prep_col)<span class="sc">|&gt;</span></span>
<span id="cb184-677"><a href="#cb184-677" aria-hidden="true" tabindex="-1"></a>    <span class="fu">DataFrame</span>(<span class="at">row.names =</span> <span class="fu">rownames</span>(dta_traits)) <span class="sc">|&gt;</span></span>
<span id="cb184-678"><a href="#cb184-678" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>(),</span>
<span id="cb184-679"><a href="#cb184-679" aria-hidden="true" tabindex="-1"></a>  meig</span>
<span id="cb184-680"><a href="#cb184-680" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-681"><a href="#cb184-681" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-682"><a href="#cb184-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-685"><a href="#cb184-685" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-686"><a href="#cb184-686" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb184-687"><a href="#cb184-687" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-688"><a href="#cb184-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-689"><a href="#cb184-689" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, export_wgcna_heatmap_graph}</span></span>
<span id="cb184-690"><a href="#cb184-690" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">clean_slate</span>() <span class="sc">|&gt;</span></span>
<span id="cb184-691"><a href="#cb184-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_figure</span>(res<span class="sc">$</span>gg)</span>
<span id="cb184-692"><a href="#cb184-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-693"><a href="#cb184-693" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_pad</span>(oid, <span class="dv">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span>)</span>
<span id="cb184-694"><a href="#cb184-694" aria-hidden="true" tabindex="-1"></a><span class="fu">export_as</span>(</span>
<span id="cb184-695"><a href="#cb184-695" aria-hidden="true" tabindex="-1"></a>  p,</span>
<span id="cb184-696"><a href="#cb184-696" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="fu">file.path</span>(cfg_prog<span class="sc">$</span>paths<span class="sc">$</span>grh, <span class="fu">paste0</span>(params<span class="sc">$</span>basenm, <span class="st">"_"</span>, oid, <span class="st">".pdf"</span>)),</span>
<span id="cb184-697"><a href="#cb184-697" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_graph_alone =</span> </span>
<span id="cb184-698"><a href="#cb184-698" aria-hidden="true" tabindex="-1"></a>    <span class="fu">file.path</span>(cfg_prog<span class="sc">$</span>paths<span class="sc">$</span>grh, <span class="fu">paste0</span>(params<span class="sc">$</span>basenm, <span class="st">"_"</span>, oid, <span class="st">"_af.pdf"</span>))</span>
<span id="cb184-699"><a href="#cb184-699" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-700"><a href="#cb184-700" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-701"><a href="#cb184-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-702"><a href="#cb184-702" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb184-703"><a href="#cb184-703" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11.7</span></span>
<span id="cb184-704"><a href="#cb184-704" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8.3</span></span>
<span id="cb184-705"><a href="#cb184-705" aria-hidden="true" tabindex="-1"></a><span class="fu">show_slate</span>(p)</span>
<span id="cb184-706"><a href="#cb184-706" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-707"><a href="#cb184-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-708"><a href="#cb184-708" aria-hidden="true" tabindex="-1"></a><span class="fu">##### OID 4 - Excel file</span></span>
<span id="cb184-709"><a href="#cb184-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-712"><a href="#cb184-712" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-713"><a href="#cb184-713" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb184-714"><a href="#cb184-714" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="st">"miRNA at baseline - WGCNA modules"</span></span>
<span id="cb184-715"><a href="#cb184-715" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-716"><a href="#cb184-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-717"><a href="#cb184-717" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, export_data}</span></span>
<span id="cb184-718"><a href="#cb184-718" aria-hidden="true" tabindex="-1"></a>spl_mod <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb184-719"><a href="#cb184-719" aria-hidden="true" tabindex="-1"></a>  dyn_mge<span class="sc">$</span>oldMEs <span class="sc">|&gt;</span></span>
<span id="cb184-720"><a href="#cb184-720" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb184-721"><a href="#cb184-721" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"sample"</span>) <span class="sc">|&gt;</span></span>
<span id="cb184-722"><a href="#cb184-722" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb184-723"><a href="#cb184-723" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="sc">-</span><span class="st">"sample"</span>,</span>
<span id="cb184-724"><a href="#cb184-724" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">"module"</span></span>
<span id="cb184-725"><a href="#cb184-725" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb184-726"><a href="#cb184-726" aria-hidden="true" tabindex="-1"></a>    <span class="fu">within</span>(type <span class="ot">&lt;-</span> <span class="st">"raw_me"</span>),</span>
<span id="cb184-727"><a href="#cb184-727" aria-hidden="true" tabindex="-1"></a>  dyn_mge<span class="sc">$</span>newMEs <span class="sc">|&gt;</span></span>
<span id="cb184-728"><a href="#cb184-728" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb184-729"><a href="#cb184-729" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"sample"</span>) <span class="sc">|&gt;</span></span>
<span id="cb184-730"><a href="#cb184-730" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb184-731"><a href="#cb184-731" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="sc">-</span><span class="st">"sample"</span>,</span>
<span id="cb184-732"><a href="#cb184-732" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">"module"</span></span>
<span id="cb184-733"><a href="#cb184-733" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb184-734"><a href="#cb184-734" aria-hidden="true" tabindex="-1"></a>    <span class="fu">within</span>(type <span class="ot">&lt;-</span> <span class="st">"merged_me"</span>)</span>
<span id="cb184-735"><a href="#cb184-735" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-736"><a href="#cb184-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-737"><a href="#cb184-737" aria-hidden="true" tabindex="-1"></a>ft_mod <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb184-738"><a href="#cb184-738" aria-hidden="true" tabindex="-1"></a>  <span class="at">feature =</span> <span class="fu">colnames</span>(dta_expr),</span>
<span id="cb184-739"><a href="#cb184-739" aria-hidden="true" tabindex="-1"></a>  <span class="at">raw_me =</span> dyn_col,</span>
<span id="cb184-740"><a href="#cb184-740" aria-hidden="true" tabindex="-1"></a>  <span class="at">merged_me =</span> dyn_mge<span class="sc">$</span>colors</span>
<span id="cb184-741"><a href="#cb184-741" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-742"><a href="#cb184-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-743"><a href="#cb184-743" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_pad</span>(oid, <span class="dv">2</span>, <span class="st">"left"</span>, <span class="st">"0"</span>)</span>
<span id="cb184-744"><a href="#cb184-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-745"><a href="#cb184-745" aria-hidden="true" tabindex="-1"></a><span class="fu">export_xl</span>(</span>
<span id="cb184-746"><a href="#cb184-746" aria-hidden="true" tabindex="-1"></a>  <span class="at">ft_mod =</span> ft_mod,</span>
<span id="cb184-747"><a href="#cb184-747" aria-hidden="true" tabindex="-1"></a>  <span class="at">spl_mod =</span> spl_mod,</span>
<span id="cb184-748"><a href="#cb184-748" aria-hidden="true" tabindex="-1"></a>  <span class="at">info =</span> <span class="fu">c</span>(</span>
<span id="cb184-749"><a href="#cb184-749" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> title,</span>
<span id="cb184-750"><a href="#cb184-750" aria-hidden="true" tabindex="-1"></a>    <span class="at">ft_mod =</span> <span class="fu">wrap_long_lines</span>(</span>
<span id="cb184-751"><a href="#cb184-751" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Associate genetic features with calculated module (a feature belongs to</span></span>
<span id="cb184-752"><a href="#cb184-752" aria-hidden="true" tabindex="-1"></a><span class="st">      a module)"</span></span>
<span id="cb184-753"><a href="#cb184-753" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb184-754"><a href="#cb184-754" aria-hidden="true" tabindex="-1"></a>    <span class="at">spl_mod =</span> <span class="st">"Sample eigengen value (eigengen _expression profile_)"</span>,</span>
<span id="cb184-755"><a href="#cb184-755" aria-hidden="true" tabindex="-1"></a>    <span class="at">source =</span> <span class="st">"UMB-BESD"</span></span>
<span id="cb184-756"><a href="#cb184-756" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb184-757"><a href="#cb184-757" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> cfg_prog<span class="sc">$</span>paths<span class="sc">$</span>grh,</span>
<span id="cb184-758"><a href="#cb184-758" aria-hidden="true" tabindex="-1"></a>  <span class="at">basenm =</span> <span class="fu">paste0</span>(params<span class="sc">$</span>basenm, <span class="st">"_"</span>, oid),</span>
<span id="cb184-759"><a href="#cb184-759" aria-hidden="true" tabindex="-1"></a>  <span class="at">rdata =</span> <span class="cn">TRUE</span></span>
<span id="cb184-760"><a href="#cb184-760" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-761"><a href="#cb184-761" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-762"><a href="#cb184-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-763"><a href="#cb184-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-764"><a href="#cb184-764" aria-hidden="true" tabindex="-1"></a><span class="fu">### mRNA / Baseline</span></span>
<span id="cb184-765"><a href="#cb184-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-766"><a href="#cb184-766" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, mrna_settings, eval=TRUE}</span></span>
<span id="cb184-767"><a href="#cb184-767" aria-hidden="true" tabindex="-1"></a><span class="co">#' # https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/FemaleLiver-01-dataInput.pdf</span></span>
<span id="cb184-768"><a href="#cb184-768" aria-hidden="true" tabindex="-1"></a><span class="co">#' # WGCNA: gene in rows, sample in cols</span></span>
<span id="cb184-769"><a href="#cb184-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-770"><a href="#cb184-770" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> cfg_prog<span class="sc">$</span>rna</span>
<span id="cb184-771"><a href="#cb184-771" aria-hidden="true" tabindex="-1"></a>ngs_assay <span class="ot">&lt;-</span> <span class="st">"mrna"</span></span>
<span id="cb184-772"><a href="#cb184-772" aria-hidden="true" tabindex="-1"></a>ctrl_wgcna <span class="ot">&lt;-</span> cfg_prog<span class="sc">$</span>rna<span class="sc">$</span>wgcna<span class="sc">$</span>baseline<span class="sc">$</span>mrna</span>
<span id="cb184-773"><a href="#cb184-773" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-774"><a href="#cb184-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-775"><a href="#cb184-775" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filter}</span></span>
<span id="cb184-776"><a href="#cb184-776" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-777"><a href="#cb184-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-780"><a href="#cb184-780" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-781"><a href="#cb184-781" aria-hidden="true" tabindex="-1"></a>expr_desc <span class="ot">&lt;-</span> <span class="st">"mRNA / Baseline - VST"</span></span>
<span id="cb184-782"><a href="#cb184-782" aria-hidden="true" tabindex="-1"></a>exportas <span class="ot">&lt;-</span> <span class="st">"dta_11_01.RData"</span></span>
<span id="cb184-783"><a href="#cb184-783" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-784"><a href="#cb184-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-785"><a href="#cb184-785" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, save_expr_dta}</span></span>
<span id="cb184-786"><a href="#cb184-786" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(dta_expr, <span class="st">"desc"</span>) <span class="ot">&lt;-</span> expr_desc</span>
<span id="cb184-787"><a href="#cb184-787" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(dta_expr, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Variance-Stabilised Transformed expression matrix"</span></span>
<span id="cb184-788"><a href="#cb184-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-789"><a href="#cb184-789" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(dta_expr[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb184-790"><a href="#cb184-790" aria-hidden="true" tabindex="-1"></a>filenm <span class="ot">&lt;-</span> <span class="fu">file.path</span>(cfg_prog<span class="sc">$</span>paths<span class="sc">$</span>dta, exportas)</span>
<span id="cb184-791"><a href="#cb184-791" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(dta_expr, <span class="at">file =</span> filenm)</span>
<span id="cb184-792"><a href="#cb184-792" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Export: "</span>, filenm)</span>
<span id="cb184-793"><a href="#cb184-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-794"><a href="#cb184-794" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(expr_desc, exportas)</span>
<span id="cb184-795"><a href="#cb184-795" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-796"><a href="#cb184-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-797"><a href="#cb184-797" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Sample clustering (OID 5)</span></span>
<span id="cb184-798"><a href="#cb184-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-799"><a href="#cb184-799" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, sample_clustering, eval=TRUE}</span></span>
<span id="cb184-800"><a href="#cb184-800" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-801"><a href="#cb184-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-804"><a href="#cb184-804" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-805"><a href="#cb184-805" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb184-806"><a href="#cb184-806" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="st">"mRNA / Baseline -Clustering dendrogram of samples based on their</span></span>
<span id="cb184-807"><a href="#cb184-807" aria-hidden="true" tabindex="-1"></a><span class="st">  Euclidean distance and trait heatmap"</span></span>
<span id="cb184-808"><a href="#cb184-808" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-809"><a href="#cb184-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-810"><a href="#cb184-810" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, export_sample_clustering_graph}</span></span>
<span id="cb184-811"><a href="#cb184-811" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-812"><a href="#cb184-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-813"><a href="#cb184-813" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb184-814"><a href="#cb184-814" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11.7</span></span>
<span id="cb184-815"><a href="#cb184-815" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8.3</span></span>
<span id="cb184-816"><a href="#cb184-816" aria-hidden="true" tabindex="-1"></a><span class="fu">show_slate</span>(p)</span>
<span id="cb184-817"><a href="#cb184-817" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-818"><a href="#cb184-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-819"><a href="#cb184-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-820"><a href="#cb184-820" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Gene Clustering</span></span>
<span id="cb184-821"><a href="#cb184-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-822"><a href="#cb184-822" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Soft threshold determination (OID 6)</span></span>
<span id="cb184-823"><a href="#cb184-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-824"><a href="#cb184-824" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, sft_determination}</span></span>
<span id="cb184-825"><a href="#cb184-825" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-826"><a href="#cb184-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-829"><a href="#cb184-829" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-830"><a href="#cb184-830" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb184-831"><a href="#cb184-831" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="st">"mRNA / Baseline - Soft threshold determination"</span></span>
<span id="cb184-832"><a href="#cb184-832" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-833"><a href="#cb184-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-834"><a href="#cb184-834" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, export_sft_graph}</span></span>
<span id="cb184-835"><a href="#cb184-835" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-836"><a href="#cb184-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-837"><a href="#cb184-837" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb184-838"><a href="#cb184-838" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11.7</span></span>
<span id="cb184-839"><a href="#cb184-839" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8.3</span></span>
<span id="cb184-840"><a href="#cb184-840" aria-hidden="true" tabindex="-1"></a><span class="fu">show_slate</span>(p)</span>
<span id="cb184-841"><a href="#cb184-841" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-842"><a href="#cb184-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-843"><a href="#cb184-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-844"><a href="#cb184-844" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Network</span></span>
<span id="cb184-845"><a href="#cb184-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-846"><a href="#cb184-846" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, network}</span></span>
<span id="cb184-847"><a href="#cb184-847" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-848"><a href="#cb184-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-849"><a href="#cb184-849" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, gene_dendro, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb184-850"><a href="#cb184-850" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-851"><a href="#cb184-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-852"><a href="#cb184-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-853"><a href="#cb184-853" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Eigengenes exploration</span></span>
<span id="cb184-854"><a href="#cb184-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-855"><a href="#cb184-855" aria-hidden="true" tabindex="-1"></a><span class="fu">##### OID 7 - Heatmap</span></span>
<span id="cb184-856"><a href="#cb184-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-857"><a href="#cb184-857" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eig_traits_heatmap}</span></span>
<span id="cb184-858"><a href="#cb184-858" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-859"><a href="#cb184-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-860"><a href="#cb184-860" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, wgcna_heatmap_graph_oid7}</span></span>
<span id="cb184-861"><a href="#cb184-861" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">gg_eigen</span>(</span>
<span id="cb184-862"><a href="#cb184-862" aria-hidden="true" tabindex="-1"></a>  dta_traits <span class="sc">|&gt;</span></span>
<span id="cb184-863"><a href="#cb184-863" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(</span>
<span id="cb184-864"><a href="#cb184-864" aria-hidden="true" tabindex="-1"></a>      diabcd, diab, age, trainn,</span>
<span id="cb184-865"><a href="#cb184-865" aria-hidden="true" tabindex="-1"></a>      chol, glu0, glu120, glu30, glu60, hba1c, hdl,</span>
<span id="cb184-866"><a href="#cb184-866" aria-hidden="true" tabindex="-1"></a>      homab, homair, insulin0, insulin120, insulin30, insulin60, ldl,</span>
<span id="cb184-867"><a href="#cb184-867" aria-hidden="true" tabindex="-1"></a>      matsuda, trig, bmi, bodyfatp, dcal, dcarbt, dfatt,</span>
<span id="cb184-868"><a href="#cb184-868" aria-hidden="true" tabindex="-1"></a>      dprot, fatacfr, fatmass, leanmass, smmass, vat, vo2maxe,</span>
<span id="cb184-869"><a href="#cb184-869" aria-hidden="true" tabindex="-1"></a>      vo2maxlbm, vo2maxml, weight</span>
<span id="cb184-870"><a href="#cb184-870" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span></span>
<span id="cb184-871"><a href="#cb184-871" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(prep_col)<span class="sc">|&gt;</span></span>
<span id="cb184-872"><a href="#cb184-872" aria-hidden="true" tabindex="-1"></a>    <span class="fu">DataFrame</span>(<span class="at">row.names =</span> <span class="fu">rownames</span>(dta_traits)) <span class="sc">|&gt;</span></span>
<span id="cb184-873"><a href="#cb184-873" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>(),</span>
<span id="cb184-874"><a href="#cb184-874" aria-hidden="true" tabindex="-1"></a>  meig</span>
<span id="cb184-875"><a href="#cb184-875" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-876"><a href="#cb184-876" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-877"><a href="#cb184-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-880"><a href="#cb184-880" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-881"><a href="#cb184-881" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb184-882"><a href="#cb184-882" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-883"><a href="#cb184-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-884"><a href="#cb184-884" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, export_wgcna_heatmap_graph}</span></span>
<span id="cb184-885"><a href="#cb184-885" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-886"><a href="#cb184-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-887"><a href="#cb184-887" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb184-888"><a href="#cb184-888" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11.7</span></span>
<span id="cb184-889"><a href="#cb184-889" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8.3</span></span>
<span id="cb184-890"><a href="#cb184-890" aria-hidden="true" tabindex="-1"></a><span class="fu">show_slate</span>(p)</span>
<span id="cb184-891"><a href="#cb184-891" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-892"><a href="#cb184-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-893"><a href="#cb184-893" aria-hidden="true" tabindex="-1"></a><span class="fu">##### OID 8 - Excel file</span></span>
<span id="cb184-894"><a href="#cb184-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-897"><a href="#cb184-897" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-898"><a href="#cb184-898" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb184-899"><a href="#cb184-899" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="st">"mRNA at baseline - WGCNA modules"</span></span>
<span id="cb184-900"><a href="#cb184-900" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-901"><a href="#cb184-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-902"><a href="#cb184-902" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, export_data}</span></span>
<span id="cb184-903"><a href="#cb184-903" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-904"><a href="#cb184-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-905"><a href="#cb184-905" aria-hidden="true" tabindex="-1"></a><span class="fu">### miRNA / CHG</span></span>
<span id="cb184-906"><a href="#cb184-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-907"><a href="#cb184-907" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, mirna_chg_settings, eval=TRUE}</span></span>
<span id="cb184-908"><a href="#cb184-908" aria-hidden="true" tabindex="-1"></a><span class="co">#' # https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/FemaleLiver-01-dataInput.pdf</span></span>
<span id="cb184-909"><a href="#cb184-909" aria-hidden="true" tabindex="-1"></a><span class="co">#' # WGCNA: gene in rows, sample in cols</span></span>
<span id="cb184-910"><a href="#cb184-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-911"><a href="#cb184-911" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> cfg_prog<span class="sc">$</span>rna</span>
<span id="cb184-912"><a href="#cb184-912" aria-hidden="true" tabindex="-1"></a>ngs_assay <span class="ot">&lt;-</span> <span class="st">"allmirna"</span></span>
<span id="cb184-913"><a href="#cb184-913" aria-hidden="true" tabindex="-1"></a>ctrl_wgcna <span class="ot">&lt;-</span> cfg_prog<span class="sc">$</span>rna<span class="sc">$</span>wgcna<span class="sc">$</span>chg<span class="sc">$</span>allmirna <span class="co"># </span><span class="al">TODO</span></span>
<span id="cb184-914"><a href="#cb184-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-915"><a href="#cb184-915" aria-hidden="true" tabindex="-1"></a><span class="co"># Specific to sample_clustering</span></span>
<span id="cb184-916"><a href="#cb184-916" aria-hidden="true" tabindex="-1"></a>col_fill <span class="ot">&lt;-</span> <span class="st">"glu120_chg"</span></span>
<span id="cb184-917"><a href="#cb184-917" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-918"><a href="#cb184-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-919"><a href="#cb184-919" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, prep_data_chg}</span></span>
<span id="cb184-920"><a href="#cb184-920" aria-hidden="true" tabindex="-1"></a>filter_for_paired_visits <span class="ot">&lt;-</span> <span class="cf">function</span>(mae) {</span>
<span id="cb184-921"><a href="#cb184-921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_that</span>(<span class="fu">all</span>(<span class="fu">table</span>(<span class="fu">colData</span>(mae)<span class="sc">$</span>subjid) <span class="sc">&lt;=</span> <span class="dv">2</span>))</span>
<span id="cb184-922"><a href="#cb184-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-923"><a href="#cb184-923" aria-hidden="true" tabindex="-1"></a>  subj <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="fu">colData</span>(mae)<span class="sc">$</span>subjid)</span>
<span id="cb184-924"><a href="#cb184-924" aria-hidden="true" tabindex="-1"></a>  subj <span class="ot">&lt;-</span> <span class="fu">names</span>(subj[subj <span class="sc">==</span> <span class="dv">2</span>])</span>
<span id="cb184-925"><a href="#cb184-925" aria-hidden="true" tabindex="-1"></a>  mae <span class="ot">&lt;-</span> mae[, <span class="fu">colData</span>(mae)<span class="sc">$</span>subjid <span class="sc">%in%</span> subj, ]</span>
<span id="cb184-926"><a href="#cb184-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-927"><a href="#cb184-927" aria-hidden="true" tabindex="-1"></a>  chk_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(mae))</span>
<span id="cb184-928"><a href="#cb184-928" aria-hidden="true" tabindex="-1"></a>  check <span class="ot">&lt;-</span> <span class="fu">split</span>(chk_df, <span class="at">f =</span> chk_df<span class="sc">$</span>avisit)</span>
<span id="cb184-929"><a href="#cb184-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-930"><a href="#cb184-930" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verify the selection:</span></span>
<span id="cb184-931"><a href="#cb184-931" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_that</span>(<span class="fu">all</span>(</span>
<span id="cb184-932"><a href="#cb184-932" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(check, <span class="at">subj =</span> subj,\(x, subj) <span class="fu">all</span>(subj <span class="sc">%in%</span> x<span class="sc">$</span>subjid))</span>
<span id="cb184-933"><a href="#cb184-933" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb184-934"><a href="#cb184-934" aria-hidden="true" tabindex="-1"></a>  mae</span>
<span id="cb184-935"><a href="#cb184-935" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-936"><a href="#cb184-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-937"><a href="#cb184-937" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb184-938"><a href="#cb184-938" aria-hidden="true" tabindex="-1"></a>dta <span class="ot">&lt;-</span> besd_mae <span class="sc">|&gt;</span></span>
<span id="cb184-939"><a href="#cb184-939" aria-hidden="true" tabindex="-1"></a>  (\(mae) mae[ , , ngs_assay])() <span class="sc">|&gt;</span></span>
<span id="cb184-940"><a href="#cb184-940" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_for_depth</span>(ngs_assay, ctrl<span class="sc">$</span>depth_threshold[[ngs_assay]]) <span class="sc">|&gt;</span></span>
<span id="cb184-941"><a href="#cb184-941" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_for_paired_visits</span>() <span class="sc">|&gt;</span></span>
<span id="cb184-942"><a href="#cb184-942" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_for_low_expr</span>(ngs_assay, ctrl<span class="sc">$</span>cpm_threshold[[ngs_assay]]) <span class="sc">|&gt;</span></span>
<span id="cb184-943"><a href="#cb184-943" aria-hidden="true" tabindex="-1"></a>  (\(mae) {</span>
<span id="cb184-944"><a href="#cb184-944" aria-hidden="true" tabindex="-1"></a>    <span class="co"># VST transformation</span></span>
<span id="cb184-945"><a href="#cb184-945" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colData</span>(mae) <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(<span class="fu">colData</span>(mae))</span>
<span id="cb184-946"><a href="#cb184-946" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colData</span>(mae)<span class="sc">$</span>avisit_ <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb184-947"><a href="#cb184-947" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colData</span>(mae)<span class="sc">$</span>avisit,</span>
<span id="cb184-948"><a href="#cb184-948" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">levels</span>(<span class="fu">colData</span>(mae)<span class="sc">$</span>avisit),</span>
<span id="cb184-949"><a href="#cb184-949" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">sub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, <span class="fu">levels</span>(<span class="fu">colData</span>(mae)<span class="sc">$</span>avisit))</span>
<span id="cb184-950"><a href="#cb184-950" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb184-951"><a href="#cb184-951" aria-hidden="true" tabindex="-1"></a>    coldata <span class="ot">&lt;-</span> <span class="fu">colData</span>(mae)[<span class="fu">c</span>(<span class="st">"diabcd"</span>, <span class="st">"subjid"</span>, <span class="st">"avisit_"</span>)]</span>
<span id="cb184-952"><a href="#cb184-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-953"><a href="#cb184-953" aria-hidden="true" tabindex="-1"></a>    mae[[ngs_assay]] <span class="ot">&lt;-</span> DESeq2<span class="sc">::</span><span class="fu">DESeqDataSetFromMatrix</span>(</span>
<span id="cb184-954"><a href="#cb184-954" aria-hidden="true" tabindex="-1"></a>      <span class="at">countData =</span> mae[[ngs_assay]],</span>
<span id="cb184-955"><a href="#cb184-955" aria-hidden="true" tabindex="-1"></a>      <span class="at">colData =</span> <span class="fu">colData</span>(<span class="at">x =</span> mae),</span>
<span id="cb184-956"><a href="#cb184-956" aria-hidden="true" tabindex="-1"></a>      <span class="at">design =</span> stats<span class="sc">::</span><span class="fu">formula</span>(<span class="sc">~</span> subjid <span class="sc">+</span> avisit_)</span>
<span id="cb184-957"><a href="#cb184-957" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb184-958"><a href="#cb184-958" aria-hidden="true" tabindex="-1"></a>      DESeq2<span class="sc">::</span><span class="fu">varianceStabilizingTransformation</span>(<span class="at">blind =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb184-959"><a href="#cb184-959" aria-hidden="true" tabindex="-1"></a>      SummarizedExperiment<span class="sc">::</span><span class="fu">assay</span>()</span>
<span id="cb184-960"><a href="#cb184-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-961"><a href="#cb184-961" aria-hidden="true" tabindex="-1"></a>    mae</span>
<span id="cb184-962"><a href="#cb184-962" aria-hidden="true" tabindex="-1"></a>  })() <span class="sc">|&gt;</span></span>
<span id="cb184-963"><a href="#cb184-963" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_for_coldata</span>(<span class="st">"diabcd"</span>, <span class="at">is =</span> <span class="fu">c</span>(<span class="st">"NGT"</span>, <span class="st">"T2D"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb184-964"><a href="#cb184-964" aria-hidden="true" tabindex="-1"></a>  (\(mae) {</span>
<span id="cb184-965"><a href="#cb184-965" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get traits: BL, M3, CHG:</span></span>
<span id="cb184-966"><a href="#cb184-966" aria-hidden="true" tabindex="-1"></a>    bl <span class="ot">&lt;-</span> mae[, <span class="fu">colData</span>(mae)<span class="sc">$</span>avisit <span class="sc">==</span> <span class="st">"Baseline"</span>, ]</span>
<span id="cb184-967"><a href="#cb184-967" aria-hidden="true" tabindex="-1"></a>    m3 <span class="ot">&lt;-</span> mae[, <span class="fu">colData</span>(mae)<span class="sc">$</span>avisit <span class="sc">==</span> <span class="st">"Month 3"</span>, ]</span>
<span id="cb184-968"><a href="#cb184-968" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assert_that</span>(<span class="fu">all</span>(<span class="fu">colData</span>(bl)<span class="sc">$</span>subjid <span class="sc">==</span> <span class="fu">colData</span>(m3)<span class="sc">$</span>subjid))</span>
<span id="cb184-969"><a href="#cb184-969" aria-hidden="true" tabindex="-1"></a>    mat <span class="ot">&lt;-</span> m3[[ngs_assay]] <span class="sc">-</span> bl[[ngs_assay]]</span>
<span id="cb184-970"><a href="#cb184-970" aria-hidden="true" tabindex="-1"></a>    nm <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">colData</span>(mae)<span class="sc">$</span>subjid, <span class="at">nm =</span> <span class="fu">rownames</span>(<span class="fu">colData</span>(mae)))</span>
<span id="cb184-971"><a href="#cb184-971" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(mat) <span class="ot">&lt;-</span> nm[<span class="fu">colnames</span>(mat)]</span>
<span id="cb184-972"><a href="#cb184-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-973"><a href="#cb184-973" aria-hidden="true" tabindex="-1"></a>    get_vars_when <span class="ot">&lt;-</span> <span class="cf">function</span>(mae,</span>
<span id="cb184-974"><a href="#cb184-974" aria-hidden="true" tabindex="-1"></a>                              <span class="at">fun =</span> is.numeric,</span>
<span id="cb184-975"><a href="#cb184-975" aria-hidden="true" tabindex="-1"></a>                              <span class="at">col_names =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb184-976"><a href="#cb184-976" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">&lt;-</span> <span class="fu">colData</span>(mae)</span>
<span id="cb184-977"><a href="#cb184-977" aria-hidden="true" tabindex="-1"></a>      <span class="fu">assert_that</span>(<span class="fu">all</span>(<span class="fu">table</span>(df<span class="sc">$</span>subjid) <span class="sc">&lt;=</span> <span class="dv">1</span>))</span>
<span id="cb184-978"><a href="#cb184-978" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rownames</span>(df) <span class="ot">&lt;-</span> df<span class="sc">$</span>subjid</span>
<span id="cb184-979"><a href="#cb184-979" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">&lt;-</span> df[, <span class="fu">sapply</span>(df, fun)]</span>
<span id="cb184-980"><a href="#cb184-980" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (col_names)</span>
<span id="cb184-981"><a href="#cb184-981" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">tolower</span>(<span class="fu">colnames</span>(df)), <span class="st">"_"</span>, <span class="fu">substitute</span>(mae))</span>
<span id="cb184-982"><a href="#cb184-982" aria-hidden="true" tabindex="-1"></a>      df</span>
<span id="cb184-983"><a href="#cb184-983" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb184-984"><a href="#cb184-984" aria-hidden="true" tabindex="-1"></a>    m3_cd <span class="ot">&lt;-</span> <span class="fu">get_vars_when</span>(m3, is.numeric) <span class="co"># m3_col data</span></span>
<span id="cb184-985"><a href="#cb184-985" aria-hidden="true" tabindex="-1"></a>    bl_cd <span class="ot">&lt;-</span> <span class="fu">get_vars_when</span>(bl, is.numeric)</span>
<span id="cb184-986"><a href="#cb184-986" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bl qualitative (diabcd and other)</span></span>
<span id="cb184-987"><a href="#cb184-987" aria-hidden="true" tabindex="-1"></a>    bl_ql <span class="ot">&lt;-</span> <span class="fu">get_vars_when</span>(bl, <span class="fu">Negate</span>(is.numeric), <span class="at">col_names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb184-988"><a href="#cb184-988" aria-hidden="true" tabindex="-1"></a>    traits <span class="ot">&lt;-</span> <span class="fu">Map</span>(<span class="at">a =</span> m3_cd, <span class="at">b =</span> bl_cd, <span class="at">f =</span> \(a, b) a <span class="sc">-</span> b) <span class="sc">|&gt;</span></span>
<span id="cb184-989"><a href="#cb184-989" aria-hidden="true" tabindex="-1"></a>      S4Vectors<span class="sc">::</span><span class="fu">DataFrame</span>() <span class="sc">|&gt;</span></span>
<span id="cb184-990"><a href="#cb184-990" aria-hidden="true" tabindex="-1"></a>      (\(df, ...) {</span>
<span id="cb184-991"><a href="#cb184-991" aria-hidden="true" tabindex="-1"></a>        args <span class="ot">&lt;-</span> <span class="fu">list</span>(...)</span>
<span id="cb184-992"><a href="#cb184-992" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"_m3"</span>, <span class="st">"_chg"</span>, <span class="fu">colnames</span>(df))</span>
<span id="cb184-993"><a href="#cb184-993" aria-hidden="true" tabindex="-1"></a>        df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(cbind, <span class="fu">c</span>(args, <span class="fu">list</span>(df)))</span>
<span id="cb184-994"><a href="#cb184-994" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Constant columns are not interesting for gene variation association</span></span>
<span id="cb184-995"><a href="#cb184-995" aria-hidden="true" tabindex="-1"></a>        df[<span class="fu">sapply</span>(df, sd) <span class="sc">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb184-996"><a href="#cb184-996" aria-hidden="true" tabindex="-1"></a>      })(bl_cd, m3_cd) <span class="sc">|&gt;</span></span>
<span id="cb184-997"><a href="#cb184-997" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(bl_ql)</span>
<span id="cb184-998"><a href="#cb184-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-999"><a href="#cb184-999" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MultiAssayExperiment</span>(</span>
<span id="cb184-1000"><a href="#cb184-1000" aria-hidden="true" tabindex="-1"></a>      <span class="at">experiments =</span> <span class="fu">ExperimentList</span>(<span class="at">vst =</span> mat),</span>
<span id="cb184-1001"><a href="#cb184-1001" aria-hidden="true" tabindex="-1"></a>      <span class="at">colData =</span> traits</span>
<span id="cb184-1002"><a href="#cb184-1002" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb184-1003"><a href="#cb184-1003" aria-hidden="true" tabindex="-1"></a>  })()</span>
<span id="cb184-1004"><a href="#cb184-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1005"><a href="#cb184-1005" aria-hidden="true" tabindex="-1"></a><span class="co">#' WGCNA Expression data.</span></span>
<span id="cb184-1006"><a href="#cb184-1006" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-1007"><a href="#cb184-1007" aria-hidden="true" tabindex="-1"></a><span class="co">#' A matrix or data frame in which columns are genes and rows ar samples.</span></span>
<span id="cb184-1008"><a href="#cb184-1008" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-1009"><a href="#cb184-1009" aria-hidden="true" tabindex="-1"></a>dta_expr <span class="ot">&lt;-</span> <span class="fu">t</span>(dta[[<span class="st">"vst"</span>]])</span>
<span id="cb184-1010"><a href="#cb184-1010" aria-hidden="true" tabindex="-1"></a><span class="fu">assert_that</span>(WGCNA<span class="sc">::</span><span class="fu">goodSamplesGenes</span>(dta_expr, <span class="at">verbose =</span> <span class="dv">0</span>)<span class="sc">$</span>allOK)</span>
<span id="cb184-1011"><a href="#cb184-1011" aria-hidden="true" tabindex="-1"></a>dta_traits <span class="ot">&lt;-</span> <span class="fu">colData</span>(dta) <span class="sc">|&gt;</span> <span class="fu">droplevels</span>()</span>
<span id="cb184-1012"><a href="#cb184-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1013"><a href="#cb184-1013" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1014"><a href="#cb184-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1015"><a href="#cb184-1015" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Sample Clustering (OID 9)</span></span>
<span id="cb184-1016"><a href="#cb184-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1017"><a href="#cb184-1017" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, sample_clustering, eval=TRUE}</span></span>
<span id="cb184-1018"><a href="#cb184-1018" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1019"><a href="#cb184-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1022"><a href="#cb184-1022" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-1023"><a href="#cb184-1023" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> <span class="dv">9</span></span>
<span id="cb184-1024"><a href="#cb184-1024" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="st">"miRNA / Change from Baseline - Clustering dendrogram of samples based</span></span>
<span id="cb184-1025"><a href="#cb184-1025" aria-hidden="true" tabindex="-1"></a><span class="st">  on their Euclidean distance and trait heatmap"</span></span>
<span id="cb184-1026"><a href="#cb184-1026" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1027"><a href="#cb184-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1028"><a href="#cb184-1028" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, export_sample_clustering_graph}</span></span>
<span id="cb184-1029"><a href="#cb184-1029" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1030"><a href="#cb184-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1031"><a href="#cb184-1031" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb184-1032"><a href="#cb184-1032" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11.7</span></span>
<span id="cb184-1033"><a href="#cb184-1033" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8.3</span></span>
<span id="cb184-1034"><a href="#cb184-1034" aria-hidden="true" tabindex="-1"></a><span class="fu">show_slate</span>(p)</span>
<span id="cb184-1035"><a href="#cb184-1035" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1036"><a href="#cb184-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1037"><a href="#cb184-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1038"><a href="#cb184-1038" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Gene Clustering</span></span>
<span id="cb184-1039"><a href="#cb184-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1040"><a href="#cb184-1040" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Soft threshold determination (OID 10)</span></span>
<span id="cb184-1041"><a href="#cb184-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1042"><a href="#cb184-1042" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, sft_determination}</span></span>
<span id="cb184-1043"><a href="#cb184-1043" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1044"><a href="#cb184-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1047"><a href="#cb184-1047" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-1048"><a href="#cb184-1048" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb184-1049"><a href="#cb184-1049" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="st">"Micro-RNA / Change from Baseline - Soft threshold determination"</span></span>
<span id="cb184-1050"><a href="#cb184-1050" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1051"><a href="#cb184-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1052"><a href="#cb184-1052" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, export_sft_graph}</span></span>
<span id="cb184-1053"><a href="#cb184-1053" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1054"><a href="#cb184-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1055"><a href="#cb184-1055" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb184-1056"><a href="#cb184-1056" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11.7</span></span>
<span id="cb184-1057"><a href="#cb184-1057" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8.3</span></span>
<span id="cb184-1058"><a href="#cb184-1058" aria-hidden="true" tabindex="-1"></a><span class="fu">show_slate</span>(p)</span>
<span id="cb184-1059"><a href="#cb184-1059" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1060"><a href="#cb184-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1061"><a href="#cb184-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1062"><a href="#cb184-1062" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Network</span></span>
<span id="cb184-1063"><a href="#cb184-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1064"><a href="#cb184-1064" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, network}</span></span>
<span id="cb184-1065"><a href="#cb184-1065" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1066"><a href="#cb184-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1067"><a href="#cb184-1067" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, gene_dendro, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb184-1068"><a href="#cb184-1068" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1069"><a href="#cb184-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1070"><a href="#cb184-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1071"><a href="#cb184-1071" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Eigengenes exploration</span></span>
<span id="cb184-1072"><a href="#cb184-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1073"><a href="#cb184-1073" aria-hidden="true" tabindex="-1"></a><span class="fu">##### OID 11 - Heatmap</span></span>
<span id="cb184-1074"><a href="#cb184-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1075"><a href="#cb184-1075" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eig_traits_heatmap}</span></span>
<span id="cb184-1076"><a href="#cb184-1076" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1077"><a href="#cb184-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1078"><a href="#cb184-1078" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, wgcna_heatmap_graph_oid11}</span></span>
<span id="cb184-1079"><a href="#cb184-1079" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">gg_eigen</span>(</span>
<span id="cb184-1080"><a href="#cb184-1080" aria-hidden="true" tabindex="-1"></a>  dta_traits <span class="sc">|&gt;</span></span>
<span id="cb184-1081"><a href="#cb184-1081" aria-hidden="true" tabindex="-1"></a>    (\(df) df[<span class="fu">sapply</span>(</span>
<span id="cb184-1082"><a href="#cb184-1082" aria-hidden="true" tabindex="-1"></a>       df,</span>
<span id="cb184-1083"><a href="#cb184-1083" aria-hidden="true" tabindex="-1"></a>       <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="fu">is.numeric</span>(x)) <span class="fu">sd</span>(x) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fu">length</span>(<span class="fu">unique</span>(x)) <span class="sc">&gt;</span> <span class="dv">1</span></span>
<span id="cb184-1084"><a href="#cb184-1084" aria-hidden="true" tabindex="-1"></a>     )]) () <span class="sc">|&gt;</span></span>
<span id="cb184-1085"><a href="#cb184-1085" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(prep_col)<span class="sc">|&gt;</span></span>
<span id="cb184-1086"><a href="#cb184-1086" aria-hidden="true" tabindex="-1"></a>    <span class="fu">DataFrame</span>(<span class="at">row.names =</span> <span class="fu">rownames</span>(dta_traits)) <span class="sc">|&gt;</span></span>
<span id="cb184-1087"><a href="#cb184-1087" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>(),</span>
<span id="cb184-1088"><a href="#cb184-1088" aria-hidden="true" tabindex="-1"></a>  meig</span>
<span id="cb184-1089"><a href="#cb184-1089" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-1090"><a href="#cb184-1090" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1091"><a href="#cb184-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1094"><a href="#cb184-1094" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-1095"><a href="#cb184-1095" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> <span class="dv">11</span></span>
<span id="cb184-1096"><a href="#cb184-1096" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1097"><a href="#cb184-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1098"><a href="#cb184-1098" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, export_wgcna_heatmap_graph}</span></span>
<span id="cb184-1099"><a href="#cb184-1099" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1100"><a href="#cb184-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1101"><a href="#cb184-1101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb184-1102"><a href="#cb184-1102" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11.7</span></span>
<span id="cb184-1103"><a href="#cb184-1103" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8.3</span></span>
<span id="cb184-1104"><a href="#cb184-1104" aria-hidden="true" tabindex="-1"></a><span class="fu">show_slate</span>(p)</span>
<span id="cb184-1105"><a href="#cb184-1105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1106"><a href="#cb184-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1107"><a href="#cb184-1107" aria-hidden="true" tabindex="-1"></a><span class="fu">##### OID 12 - Excel file</span></span>
<span id="cb184-1108"><a href="#cb184-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1111"><a href="#cb184-1111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-1112"><a href="#cb184-1112" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb184-1113"><a href="#cb184-1113" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="st">"miRNA Change from Baseline - WGCNA modules"</span></span>
<span id="cb184-1114"><a href="#cb184-1114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1115"><a href="#cb184-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1116"><a href="#cb184-1116" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, export_data}</span></span>
<span id="cb184-1117"><a href="#cb184-1117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1118"><a href="#cb184-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1119"><a href="#cb184-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1120"><a href="#cb184-1120" aria-hidden="true" tabindex="-1"></a><span class="fu">### mRNA / CHG</span></span>
<span id="cb184-1121"><a href="#cb184-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1122"><a href="#cb184-1122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, mrna_chg_settings, eval=TRUE}</span></span>
<span id="cb184-1123"><a href="#cb184-1123" aria-hidden="true" tabindex="-1"></a><span class="co">#' # https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/FemaleLiver-01-dataInput.pdf</span></span>
<span id="cb184-1124"><a href="#cb184-1124" aria-hidden="true" tabindex="-1"></a><span class="co">#' # WGCNA: gene in rows, sample in cols</span></span>
<span id="cb184-1125"><a href="#cb184-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1126"><a href="#cb184-1126" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> cfg_prog<span class="sc">$</span>rna</span>
<span id="cb184-1127"><a href="#cb184-1127" aria-hidden="true" tabindex="-1"></a>ngs_assay <span class="ot">&lt;-</span> <span class="st">"mrna"</span></span>
<span id="cb184-1128"><a href="#cb184-1128" aria-hidden="true" tabindex="-1"></a>ctrl_wgcna <span class="ot">&lt;-</span> cfg_prog<span class="sc">$</span>rna<span class="sc">$</span>wgcna<span class="sc">$</span>chg<span class="sc">$</span>mrna</span>
<span id="cb184-1129"><a href="#cb184-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1130"><a href="#cb184-1130" aria-hidden="true" tabindex="-1"></a><span class="co"># Specific to sample_clustering</span></span>
<span id="cb184-1131"><a href="#cb184-1131" aria-hidden="true" tabindex="-1"></a>col_fill <span class="ot">&lt;-</span> <span class="st">"glu120_chg"</span></span>
<span id="cb184-1132"><a href="#cb184-1132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1133"><a href="#cb184-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1134"><a href="#cb184-1134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, prep_data_chg}</span></span>
<span id="cb184-1135"><a href="#cb184-1135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1136"><a href="#cb184-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1137"><a href="#cb184-1137" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Sample Clustering (OID 13)</span></span>
<span id="cb184-1138"><a href="#cb184-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1139"><a href="#cb184-1139" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, sample_clustering, eval=TRUE}</span></span>
<span id="cb184-1140"><a href="#cb184-1140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1141"><a href="#cb184-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1144"><a href="#cb184-1144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-1145"><a href="#cb184-1145" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> <span class="dv">13</span></span>
<span id="cb184-1146"><a href="#cb184-1146" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="st">"mRNA / Change from Baseline - Clustering dendrogram of samples based</span></span>
<span id="cb184-1147"><a href="#cb184-1147" aria-hidden="true" tabindex="-1"></a><span class="st">  on their Euclidean distance and trait heatmap"</span></span>
<span id="cb184-1148"><a href="#cb184-1148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1149"><a href="#cb184-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1150"><a href="#cb184-1150" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, export_sample_clustering_graph}</span></span>
<span id="cb184-1151"><a href="#cb184-1151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1152"><a href="#cb184-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1153"><a href="#cb184-1153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb184-1154"><a href="#cb184-1154" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11.7</span></span>
<span id="cb184-1155"><a href="#cb184-1155" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8.3</span></span>
<span id="cb184-1156"><a href="#cb184-1156" aria-hidden="true" tabindex="-1"></a><span class="fu">show_slate</span>(p)</span>
<span id="cb184-1157"><a href="#cb184-1157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1158"><a href="#cb184-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1159"><a href="#cb184-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1160"><a href="#cb184-1160" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Gene Clustering</span></span>
<span id="cb184-1161"><a href="#cb184-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1162"><a href="#cb184-1162" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Soft threshold determination (OID 14)</span></span>
<span id="cb184-1163"><a href="#cb184-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1164"><a href="#cb184-1164" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, sft_determination}</span></span>
<span id="cb184-1165"><a href="#cb184-1165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1166"><a href="#cb184-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1169"><a href="#cb184-1169" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-1170"><a href="#cb184-1170" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> <span class="dv">14</span></span>
<span id="cb184-1171"><a href="#cb184-1171" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="st">"mRNA / Change from Baseline - Soft threshold determination"</span></span>
<span id="cb184-1172"><a href="#cb184-1172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1173"><a href="#cb184-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1174"><a href="#cb184-1174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, export_sft_graph}</span></span>
<span id="cb184-1175"><a href="#cb184-1175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1176"><a href="#cb184-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1177"><a href="#cb184-1177" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb184-1178"><a href="#cb184-1178" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11.7</span></span>
<span id="cb184-1179"><a href="#cb184-1179" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8.3</span></span>
<span id="cb184-1180"><a href="#cb184-1180" aria-hidden="true" tabindex="-1"></a><span class="fu">show_slate</span>(p)</span>
<span id="cb184-1181"><a href="#cb184-1181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1182"><a href="#cb184-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1183"><a href="#cb184-1183" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Network</span></span>
<span id="cb184-1184"><a href="#cb184-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1185"><a href="#cb184-1185" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, network}</span></span>
<span id="cb184-1186"><a href="#cb184-1186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1187"><a href="#cb184-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1188"><a href="#cb184-1188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, gene_dendro, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb184-1189"><a href="#cb184-1189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1190"><a href="#cb184-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1191"><a href="#cb184-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1192"><a href="#cb184-1192" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Eigengenes exploration</span></span>
<span id="cb184-1193"><a href="#cb184-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1194"><a href="#cb184-1194" aria-hidden="true" tabindex="-1"></a><span class="fu">##### OID 15 - Heatmap</span></span>
<span id="cb184-1195"><a href="#cb184-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1196"><a href="#cb184-1196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eig_traits_heatmap}</span></span>
<span id="cb184-1197"><a href="#cb184-1197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1198"><a href="#cb184-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1199"><a href="#cb184-1199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, wgcna_heatmap_graph_oid15}</span></span>
<span id="cb184-1200"><a href="#cb184-1200" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">gg_eigen</span>(</span>
<span id="cb184-1201"><a href="#cb184-1201" aria-hidden="true" tabindex="-1"></a>  dta_traits <span class="sc">|&gt;</span></span>
<span id="cb184-1202"><a href="#cb184-1202" aria-hidden="true" tabindex="-1"></a>    (\(df) df[<span class="fu">sapply</span>(</span>
<span id="cb184-1203"><a href="#cb184-1203" aria-hidden="true" tabindex="-1"></a>       df,</span>
<span id="cb184-1204"><a href="#cb184-1204" aria-hidden="true" tabindex="-1"></a>       <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="fu">is.numeric</span>(x)) <span class="fu">sd</span>(x) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fu">length</span>(<span class="fu">unique</span>(x)) <span class="sc">&gt;</span> <span class="dv">1</span></span>
<span id="cb184-1205"><a href="#cb184-1205" aria-hidden="true" tabindex="-1"></a>     )]) () <span class="sc">|&gt;</span></span>
<span id="cb184-1206"><a href="#cb184-1206" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(prep_col)<span class="sc">|&gt;</span></span>
<span id="cb184-1207"><a href="#cb184-1207" aria-hidden="true" tabindex="-1"></a>    <span class="fu">DataFrame</span>(<span class="at">row.names =</span> <span class="fu">rownames</span>(dta_traits)) <span class="sc">|&gt;</span></span>
<span id="cb184-1208"><a href="#cb184-1208" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>(),</span>
<span id="cb184-1209"><a href="#cb184-1209" aria-hidden="true" tabindex="-1"></a>  meig</span>
<span id="cb184-1210"><a href="#cb184-1210" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-1211"><a href="#cb184-1211" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1212"><a href="#cb184-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1215"><a href="#cb184-1215" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-1216"><a href="#cb184-1216" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb184-1217"><a href="#cb184-1217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1218"><a href="#cb184-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1219"><a href="#cb184-1219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, export_wgcna_heatmap_graph}</span></span>
<span id="cb184-1220"><a href="#cb184-1220" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1221"><a href="#cb184-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1222"><a href="#cb184-1222" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=cfg_prog$knitr$results!="hide"}</span></span>
<span id="cb184-1223"><a href="#cb184-1223" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11.7</span></span>
<span id="cb184-1224"><a href="#cb184-1224" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8.3</span></span>
<span id="cb184-1225"><a href="#cb184-1225" aria-hidden="true" tabindex="-1"></a><span class="fu">show_slate</span>(p)</span>
<span id="cb184-1226"><a href="#cb184-1226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1227"><a href="#cb184-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1228"><a href="#cb184-1228" aria-hidden="true" tabindex="-1"></a><span class="fu">##### OID 16 - Excel file</span></span>
<span id="cb184-1229"><a href="#cb184-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1232"><a href="#cb184-1232" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-1233"><a href="#cb184-1233" aria-hidden="true" tabindex="-1"></a>oid <span class="ot">&lt;-</span> <span class="dv">16</span></span>
<span id="cb184-1234"><a href="#cb184-1234" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="st">"mRNA Change from Baseline - WGCNA modules"</span></span>
<span id="cb184-1235"><a href="#cb184-1235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1236"><a href="#cb184-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1237"><a href="#cb184-1237" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, export_data}</span></span>
<span id="cb184-1238"><a href="#cb184-1238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1239"><a href="#cb184-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1240"><a href="#cb184-1240" aria-hidden="true" tabindex="-1"></a><span class="fu">### Legacy</span></span>
<span id="cb184-1241"><a href="#cb184-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1242"><a href="#cb184-1242" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, include=FALSE}</span></span>
<span id="cb184-1243"><a href="#cb184-1243" aria-hidden="true" tabindex="-1"></a>control_wgcna <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb184-1244"><a href="#cb184-1244" aria-hidden="true" tabindex="-1"></a>  power,</span>
<span id="cb184-1245"><a href="#cb184-1245" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"signed"</span>,</span>
<span id="cb184-1246"><a href="#cb184-1246" aria-hidden="true" tabindex="-1"></a>  <span class="at">TOMType =</span> <span class="st">"signed"</span>,</span>
<span id="cb184-1247"><a href="#cb184-1247" aria-hidden="true" tabindex="-1"></a>  <span class="at">corFnc =</span> <span class="fu">c</span>(<span class="st">"pearson"</span> <span class="ot">=</span> <span class="st">"cor"</span>, <span class="st">"bicor"</span> <span class="ot">=</span> <span class="st">"bicor"</span>)[<span class="dv">1</span>], </span>
<span id="cb184-1248"><a href="#cb184-1248" aria-hidden="true" tabindex="-1"></a>  <span class="at">deepSplit =</span> <span class="dv">1</span>, <span class="co"># wa 2 for Medium sensitivity</span></span>
<span id="cb184-1249"><a href="#cb184-1249" aria-hidden="true" tabindex="-1"></a>  <span class="at">cutHeight =</span> <span class="fl">0.995</span>, <span class="co"># Default 0.995</span></span>
<span id="cb184-1250"><a href="#cb184-1250" aria-hidden="true" tabindex="-1"></a>  <span class="at">minClusterSize =</span> <span class="dv">20</span>, <span class="co"># min(20, ncol(datExpr)/2 ) </span></span>
<span id="cb184-1251"><a href="#cb184-1251" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb184-1252"><a href="#cb184-1252" aria-hidden="true" tabindex="-1"></a>  ) {</span>
<span id="cb184-1253"><a href="#cb184-1253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>(<span class="fu">environment</span>())</span>
<span id="cb184-1254"><a href="#cb184-1254" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-1255"><a href="#cb184-1255" aria-hidden="true" tabindex="-1"></a><span class="co">#' WGCNA Wrappers</span></span>
<span id="cb184-1256"><a href="#cb184-1256" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb184-1257"><a href="#cb184-1257" aria-hidden="true" tabindex="-1"></a><span class="co">#' Set of function for standardised pre/post processing of WGCNA results.</span></span>
<span id="cb184-1258"><a href="#cb184-1258" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-1259"><a href="#cb184-1259" aria-hidden="true" tabindex="-1"></a><span class="co">#' @name wrap_wgcna</span></span>
<span id="cb184-1260"><a href="#cb184-1260" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-1261"><a href="#cb184-1261" aria-hidden="true" tabindex="-1"></a><span class="cn">NULL</span></span>
<span id="cb184-1262"><a href="#cb184-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1263"><a href="#cb184-1263" aria-hidden="true" tabindex="-1"></a><span class="co">#' @describeIn wrap_wgcna sample dendrogram with trait color matrix.</span></span>
<span id="cb184-1264"><a href="#cb184-1264" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param x (`list`) suitable for `besd_wgcna`.</span></span>
<span id="cb184-1265"><a href="#cb184-1265" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb184-1266"><a href="#cb184-1266" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-1267"><a href="#cb184-1267" aria-hidden="true" tabindex="-1"></a>wrap_sample_dendro <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb184-1268"><a href="#cb184-1268" aria-hidden="true" tabindex="-1"></a>  trait_colors <span class="ot">&lt;-</span> WGCNA<span class="sc">::</span><span class="fu">numbers2colors</span>(x<span class="sc">$</span>traits)</span>
<span id="cb184-1269"><a href="#cb184-1269" aria-hidden="true" tabindex="-1"></a>  WGCNA<span class="sc">::</span><span class="fu">plotDendroAndColors</span>(</span>
<span id="cb184-1270"><a href="#cb184-1270" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>clust_ind, trait_colors,</span>
<span id="cb184-1271"><a href="#cb184-1271" aria-hidden="true" tabindex="-1"></a>    <span class="at">groupLabels =</span> <span class="fu">names</span>(x<span class="sc">$</span>traits)</span>
<span id="cb184-1272"><a href="#cb184-1272" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1273"><a href="#cb184-1273" aria-hidden="true" tabindex="-1"></a>  graphics<span class="sc">::</span><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb184-1274"><a href="#cb184-1274" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-1275"><a href="#cb184-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1276"><a href="#cb184-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1277"><a href="#cb184-1277" aria-hidden="true" tabindex="-1"></a><span class="co">#' VST Norm</span></span>
<span id="cb184-1278"><a href="#cb184-1278" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-1279"><a href="#cb184-1279" aria-hidden="true" tabindex="-1"></a><span class="co">#' Feature count normalization.</span></span>
<span id="cb184-1280"><a href="#cb184-1280" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-1281"><a href="#cb184-1281" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param mae (`MultiAssayExperiment`)</span></span>
<span id="cb184-1282"><a href="#cb184-1282" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param assay (`character`)</span></span>
<span id="cb184-1283"><a href="#cb184-1283" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param adam (`list`)</span></span>
<span id="cb184-1284"><a href="#cb184-1284" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-1285"><a href="#cb184-1285" aria-hidden="true" tabindex="-1"></a><span class="co">#' @details The VST normalization stems from the differential expression</span></span>
<span id="cb184-1286"><a href="#cb184-1286" aria-hidden="true" tabindex="-1"></a><span class="co">#' object preparation so as to insure consistency of methods.</span></span>
<span id="cb184-1287"><a href="#cb184-1287" aria-hidden="true" tabindex="-1"></a><span class="co">#' The call to the adam datasets is necessary as `CHG` data were not included</span></span>
<span id="cb184-1288"><a href="#cb184-1288" aria-hidden="true" tabindex="-1"></a><span class="co">#' in the MAE (it would be possible to add it there but I wonder what would</span></span>
<span id="cb184-1289"><a href="#cb184-1289" aria-hidden="true" tabindex="-1"></a><span class="co">#' be the consequences in terms of analysis result of adding theme).</span></span>
<span id="cb184-1290"><a href="#cb184-1290" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-1291"><a href="#cb184-1291" aria-hidden="true" tabindex="-1"></a><span class="co">#' @note Initially prepared for WGCNA, it was evidenced it is more generally</span></span>
<span id="cb184-1292"><a href="#cb184-1292" aria-hidden="true" tabindex="-1"></a><span class="co">#' applied for a recurrent contrast (baseline data and training-induced</span></span>
<span id="cb184-1293"><a href="#cb184-1293" aria-hidden="true" tabindex="-1"></a><span class="co">#' variations.</span></span>
<span id="cb184-1294"><a href="#cb184-1294" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-1295"><a href="#cb184-1295" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return</span></span>
<span id="cb184-1296"><a href="#cb184-1296" aria-hidden="true" tabindex="-1"></a><span class="co">#' Every item of the list is a set of expression data and clinical</span></span>
<span id="cb184-1297"><a href="#cb184-1297" aria-hidden="true" tabindex="-1"></a><span class="co">#' parameters (aka traits).</span></span>
<span id="cb184-1298"><a href="#cb184-1298" aria-hidden="true" tabindex="-1"></a><span class="co">#' Item a: </span></span>
<span id="cb184-1299"><a href="#cb184-1299" aria-hidden="true" tabindex="-1"></a><span class="co">#' baseline feature expression and clinical parameter.</span></span>
<span id="cb184-1300"><a href="#cb184-1300" aria-hidden="true" tabindex="-1"></a><span class="co">#' Item b: </span></span>
<span id="cb184-1301"><a href="#cb184-1301" aria-hidden="true" tabindex="-1"></a><span class="co">#' training-induced expression variation profile across</span></span>
<span id="cb184-1302"><a href="#cb184-1302" aria-hidden="true" tabindex="-1"></a><span class="co">#' all samples (arm blind).</span></span>
<span id="cb184-1303"><a href="#cb184-1303" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-1304"><a href="#cb184-1304" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom stats reshape</span></span>
<span id="cb184-1305"><a href="#cb184-1305" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom SummarizedExperiment assay</span></span>
<span id="cb184-1306"><a href="#cb184-1306" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb184-1307"><a href="#cb184-1307" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-1308"><a href="#cb184-1308" aria-hidden="true" tabindex="-1"></a>vst_norm <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb184-1309"><a href="#cb184-1309" aria-hidden="true" tabindex="-1"></a>  mae,</span>
<span id="cb184-1310"><a href="#cb184-1310" aria-hidden="true" tabindex="-1"></a>  <span class="at">adam =</span> <span class="fu">list</span>(</span>
<span id="cb184-1311"><a href="#cb184-1311" aria-hidden="true" tabindex="-1"></a>    <span class="at">adsl =</span> adsl,</span>
<span id="cb184-1312"><a href="#cb184-1312" aria-hidden="true" tabindex="-1"></a>    <span class="at">adlb =</span> adlb,</span>
<span id="cb184-1313"><a href="#cb184-1313" aria-hidden="true" tabindex="-1"></a>    <span class="at">advs =</span> advs</span>
<span id="cb184-1314"><a href="#cb184-1314" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb184-1315"><a href="#cb184-1315" aria-hidden="true" tabindex="-1"></a>  <span class="at">assay =</span> <span class="fu">c</span>(<span class="st">"allmirna"</span>, <span class="st">"mrna"</span>)) { </span>
<span id="cb184-1316"><a href="#cb184-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1317"><a href="#cb184-1317" aria-hidden="true" tabindex="-1"></a>  assay <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(assay)</span>
<span id="cb184-1318"><a href="#cb184-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1319"><a href="#cb184-1319" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Expressions as in DE: the data preparation stems from the differential</span></span>
<span id="cb184-1320"><a href="#cb184-1320" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expression preparation function.</span></span>
<span id="cb184-1321"><a href="#cb184-1321" aria-hidden="true" tabindex="-1"></a>  data_as_de <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb184-1322"><a href="#cb184-1322" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> <span class="fu">setNames</span>(<span class="at">nm =</span> assay),</span>
<span id="cb184-1323"><a href="#cb184-1323" aria-hidden="true" tabindex="-1"></a>    <span class="at">mae =</span> mae,</span>
<span id="cb184-1324"><a href="#cb184-1324" aria-hidden="true" tabindex="-1"></a>    <span class="at">FUN =</span> <span class="cf">function</span>(x, mae) {</span>
<span id="cb184-1325"><a href="#cb184-1325" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lapply</span>(</span>
<span id="cb184-1326"><a href="#cb184-1326" aria-hidden="true" tabindex="-1"></a>        <span class="at">X =</span> <span class="fu">c</span>(<span class="at">Training_all =</span> <span class="fu">list</span>(</span>
<span id="cb184-1327"><a href="#cb184-1327" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="fu">levels</span>(MultiAssayExperiment<span class="sc">::</span><span class="fu">colData</span>(mae)<span class="sc">$</span>AVISIT), <span class="st">"no-arm"</span>)</span>
<span id="cb184-1328"><a href="#cb184-1328" aria-hidden="true" tabindex="-1"></a>            )),</span>
<span id="cb184-1329"><a href="#cb184-1329" aria-hidden="true" tabindex="-1"></a>        <span class="at">mae =</span> mae,</span>
<span id="cb184-1330"><a href="#cb184-1330" aria-hidden="true" tabindex="-1"></a>        <span class="at">assay =</span> x,</span>
<span id="cb184-1331"><a href="#cb184-1331" aria-hidden="true" tabindex="-1"></a>        <span class="at">control =</span> <span class="fu">control_rna</span>(<span class="at">verbose =</span> <span class="cn">TRUE</span>),</span>
<span id="cb184-1332"><a href="#cb184-1332" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> prepare_de</span>
<span id="cb184-1333"><a href="#cb184-1333" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb184-1334"><a href="#cb184-1334" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb184-1335"><a href="#cb184-1335" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1336"><a href="#cb184-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1337"><a href="#cb184-1337" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Instead of model fit, get the vst transformed results.</span></span>
<span id="cb184-1338"><a href="#cb184-1338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gc</span>(<span class="at">reset =</span> <span class="cn">TRUE</span>)</span>
<span id="cb184-1339"><a href="#cb184-1339" aria-hidden="true" tabindex="-1"></a>  get_vst <span class="ot">&lt;-</span> <span class="cf">function</span>(x, assay) {</span>
<span id="cb184-1340"><a href="#cb184-1340" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>vst <span class="ot">&lt;-</span> DESeq2<span class="sc">::</span><span class="fu">varianceStabilizingTransformation</span>(x<span class="sc">$</span>dds, <span class="at">blind =</span> <span class="cn">FALSE</span>)</span>
<span id="cb184-1341"><a href="#cb184-1341" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>mae[[assay]] <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">assay</span>(x<span class="sc">$</span>vst)</span>
<span id="cb184-1342"><a href="#cb184-1342" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb184-1343"><a href="#cb184-1343" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb184-1344"><a href="#cb184-1344" aria-hidden="true" tabindex="-1"></a>  vst <span class="ot">&lt;-</span> <span class="fu">get_vst</span>(<span class="at">x =</span> data_as_de[[assay]]<span class="sc">$</span>Training_all, <span class="at">assay =</span> assay)</span>
<span id="cb184-1345"><a href="#cb184-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1346"><a href="#cb184-1346" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb184-1347"><a href="#cb184-1347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1348"><a href="#cb184-1348" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First item</span></span>
<span id="cb184-1349"><a href="#cb184-1349" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> vst<span class="sc">$</span>mae</span>
<span id="cb184-1350"><a href="#cb184-1350" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> y[,</span>
<span id="cb184-1351"><a href="#cb184-1351" aria-hidden="true" tabindex="-1"></a>    MultiAssayExperiment<span class="sc">::</span><span class="fu">colData</span>(y)<span class="sc">$</span>AVISIT <span class="sc">==</span> <span class="st">"BASELINE"</span> <span class="sc">&amp;</span></span>
<span id="cb184-1352"><a href="#cb184-1352" aria-hidden="true" tabindex="-1"></a>      MultiAssayExperiment<span class="sc">::</span><span class="fu">colData</span>(y)<span class="sc">$</span>ARMCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"NGT"</span>, <span class="st">"T2D"</span>),</span>
<span id="cb184-1353"><a href="#cb184-1353" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb184-1354"><a href="#cb184-1354" aria-hidden="true" tabindex="-1"></a>  expr <span class="ot">&lt;-</span> <span class="fu">t</span>(y[[assay]])</span>
<span id="cb184-1355"><a href="#cb184-1355" aria-hidden="true" tabindex="-1"></a>  traits <span class="ot">&lt;-</span> MultiAssayExperiment<span class="sc">::</span><span class="fu">colData</span>(y)</span>
<span id="cb184-1356"><a href="#cb184-1356" aria-hidden="true" tabindex="-1"></a>  traits <span class="ot">&lt;-</span> traits[</span>
<span id="cb184-1357"><a href="#cb184-1357" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">colnames</span>(traits) <span class="sc">%in%</span></span>
<span id="cb184-1358"><a href="#cb184-1358" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb184-1359"><a href="#cb184-1359" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SUBJID"</span>, <span class="st">"AVISIT"</span>, <span class="st">"sample"</span>, <span class="st">"AVISITNUM"</span>, <span class="st">"USUBJID"</span>, <span class="st">"SEX"</span>, <span class="st">"ARM"</span>,</span>
<span id="cb184-1360"><a href="#cb184-1360" aria-hidden="true" tabindex="-1"></a>        <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">"^.*SC$"</span>, <span class="at">x =</span> <span class="fu">names</span>(traits), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb184-1361"><a href="#cb184-1361" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb184-1362"><a href="#cb184-1362" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb184-1363"><a href="#cb184-1363" aria-hidden="true" tabindex="-1"></a>  traits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb184-1364"><a href="#cb184-1364" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(traits, <span class="cf">function</span>(x) <span class="fu">as_scaled_numeric</span>(x)),</span>
<span id="cb184-1365"><a href="#cb184-1365" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="fu">row.names</span>(traits)</span>
<span id="cb184-1366"><a href="#cb184-1366" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1367"><a href="#cb184-1367" aria-hidden="true" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">all</span>(<span class="fu">rownames</span>(traits) <span class="sc">==</span> <span class="fu">rownames</span>(expr)))</span>
<span id="cb184-1368"><a href="#cb184-1368" aria-hidden="true" tabindex="-1"></a>  result<span class="sc">$</span>a <span class="ot">&lt;-</span>  <span class="fu">list</span>(</span>
<span id="cb184-1369"><a href="#cb184-1369" aria-hidden="true" tabindex="-1"></a>    <span class="at">expr =</span> expr,</span>
<span id="cb184-1370"><a href="#cb184-1370" aria-hidden="true" tabindex="-1"></a>    <span class="at">traits =</span> traits</span>
<span id="cb184-1371"><a href="#cb184-1371" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1372"><a href="#cb184-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1373"><a href="#cb184-1373" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Second item</span></span>
<span id="cb184-1374"><a href="#cb184-1374" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Expression From VST.</span></span>
<span id="cb184-1375"><a href="#cb184-1375" aria-hidden="true" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">assert_that</span>(</span>
<span id="cb184-1376"><a href="#cb184-1376" aria-hidden="true" tabindex="-1"></a>    <span class="fu">all</span>(<span class="fu">table</span>(MultiAssayExperiment<span class="sc">::</span><span class="fu">colData</span>(vst<span class="sc">$</span>mae)<span class="sc">$</span>USUBJID) <span class="sc">==</span> <span class="dv">2</span>)</span>
<span id="cb184-1377"><a href="#cb184-1377" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1378"><a href="#cb184-1378" aria-hidden="true" tabindex="-1"></a>  subj <span class="ot">&lt;-</span> <span class="fu">unique</span>(MultiAssayExperiment<span class="sc">::</span><span class="fu">colData</span>(vst<span class="sc">$</span>mae)<span class="sc">$</span>USUBJID)</span>
<span id="cb184-1379"><a href="#cb184-1379" aria-hidden="true" tabindex="-1"></a>  ls_avisit <span class="ot">&lt;-</span> MultiAssayExperiment<span class="sc">::</span><span class="fu">colData</span>(vst<span class="sc">$</span>mae)</span>
<span id="cb184-1380"><a href="#cb184-1380" aria-hidden="true" tabindex="-1"></a>  ls_avisit <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(ls_avisit)</span>
<span id="cb184-1381"><a href="#cb184-1381" aria-hidden="true" tabindex="-1"></a>  ls_avisit <span class="ot">&lt;-</span> <span class="fu">split</span>(ls_avisit, <span class="at">f =</span> ls_avisit<span class="sc">$</span>AVISIT)</span>
<span id="cb184-1382"><a href="#cb184-1382" aria-hidden="true" tabindex="-1"></a>  bl <span class="ot">&lt;-</span> <span class="fu">rownames</span>(ls_avisit<span class="sc">$</span>BASELINE)[<span class="fu">match</span>(subj, ls_avisit<span class="sc">$</span>BASELINE<span class="sc">$</span>USUBJID)]</span>
<span id="cb184-1383"><a href="#cb184-1383" aria-hidden="true" tabindex="-1"></a>  m3 <span class="ot">&lt;-</span> <span class="fu">rownames</span>(ls_avisit<span class="sc">$</span><span class="st">`</span><span class="at">MONTH 3</span><span class="st">`</span>)[<span class="fu">match</span>(subj, ls_avisit<span class="sc">$</span><span class="st">`</span><span class="at">MONTH 3</span><span class="st">`</span><span class="sc">$</span>USUBJID)]</span>
<span id="cb184-1384"><a href="#cb184-1384" aria-hidden="true" tabindex="-1"></a>  expr <span class="ot">&lt;-</span> vst<span class="sc">$</span>mae[[assay]]</span>
<span id="cb184-1385"><a href="#cb184-1385" aria-hidden="true" tabindex="-1"></a>  expr <span class="ot">&lt;-</span> expr[, m3] <span class="sc">-</span> expr[, bl]</span>
<span id="cb184-1386"><a href="#cb184-1386" aria-hidden="true" tabindex="-1"></a>  expr <span class="ot">&lt;-</span> <span class="fu">t</span>(expr)</span>
<span id="cb184-1387"><a href="#cb184-1387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(expr) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(</span>
<span id="cb184-1388"><a href="#cb184-1388" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="st">"^(X[0-9]*)v.*$"</span>,</span>
<span id="cb184-1389"><a href="#cb184-1389" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">rownames</span>(expr),</span>
<span id="cb184-1390"><a href="#cb184-1390" aria-hidden="true" tabindex="-1"></a>    <span class="at">replacement =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span></span>
<span id="cb184-1391"><a href="#cb184-1391" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1392"><a href="#cb184-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1393"><a href="#cb184-1393" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Traits CHG.</span></span>
<span id="cb184-1394"><a href="#cb184-1394" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Long-format ADaM, key is UBSUJID x AVISIT.</span></span>
<span id="cb184-1395"><a href="#cb184-1395" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lab test data are added.</span></span>
<span id="cb184-1396"><a href="#cb184-1396" aria-hidden="true" tabindex="-1"></a>  adsl <span class="ot">&lt;-</span> adam<span class="sc">$</span>adsl</span>
<span id="cb184-1397"><a href="#cb184-1397" aria-hidden="true" tabindex="-1"></a>  adlb <span class="ot">&lt;-</span> adam<span class="sc">$</span>adlb</span>
<span id="cb184-1398"><a href="#cb184-1398" aria-hidden="true" tabindex="-1"></a>  advs <span class="ot">&lt;-</span> adam<span class="sc">$</span>advs</span>
<span id="cb184-1399"><a href="#cb184-1399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1400"><a href="#cb184-1400" aria-hidden="true" tabindex="-1"></a>  anl <span class="ot">&lt;-</span> adlb[</span>
<span id="cb184-1401"><a href="#cb184-1401" aria-hidden="true" tabindex="-1"></a>    adlb<span class="sc">$</span>AVISIT <span class="sc">==</span> <span class="st">"MONTH 3"</span> <span class="sc">&amp;</span></span>
<span id="cb184-1402"><a href="#cb184-1402" aria-hidden="true" tabindex="-1"></a>      adlb<span class="sc">$</span>PARAMCD <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb184-1403"><a href="#cb184-1403" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CHOL"</span>, <span class="st">"HBA1C"</span>, <span class="st">"HDL"</span>, <span class="st">"HOMAB"</span>, <span class="st">"HOMAIR"</span>, <span class="st">"LDL"</span>, <span class="st">"MATSUDA"</span>, <span class="st">"TRIG"</span></span>
<span id="cb184-1404"><a href="#cb184-1404" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb184-1405"><a href="#cb184-1405" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb184-1406"><a href="#cb184-1406" aria-hidden="true" tabindex="-1"></a>  anl <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb184-1407"><a href="#cb184-1407" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> anl[<span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"PARAMCD"</span>, <span class="st">"CHG"</span>, <span class="st">"PCHG"</span>)],</span>
<span id="cb184-1408"><a href="#cb184-1408" aria-hidden="true" tabindex="-1"></a>    <span class="at">v.names =</span> <span class="fu">c</span>(<span class="st">"CHG"</span>, <span class="st">"PCHG"</span>),</span>
<span id="cb184-1409"><a href="#cb184-1409" aria-hidden="true" tabindex="-1"></a>    <span class="at">timevar =</span> <span class="st">"PARAMCD"</span>,</span>
<span id="cb184-1410"><a href="#cb184-1410" aria-hidden="true" tabindex="-1"></a>    <span class="at">idvar =</span> <span class="st">"USUBJID"</span>,</span>
<span id="cb184-1411"><a href="#cb184-1411" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> <span class="st">"wide"</span></span>
<span id="cb184-1412"><a href="#cb184-1412" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1413"><a href="#cb184-1413" aria-hidden="true" tabindex="-1"></a>  adam <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb184-1414"><a href="#cb184-1414" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> adsl[<span class="fu">c</span>(</span>
<span id="cb184-1415"><a href="#cb184-1415" aria-hidden="true" tabindex="-1"></a>      <span class="st">"USUBJID"</span>, <span class="st">"SUBJID"</span>, <span class="st">"AGE"</span>, <span class="st">"SEX"</span>, <span class="st">"ARM"</span>, <span class="st">"ARMCD"</span>,</span>
<span id="cb184-1416"><a href="#cb184-1416" aria-hidden="true" tabindex="-1"></a>      <span class="st">"T2DFH"</span>, <span class="st">"NTRAIN"</span></span>
<span id="cb184-1417"><a href="#cb184-1417" aria-hidden="true" tabindex="-1"></a>      )],</span>
<span id="cb184-1418"><a href="#cb184-1418" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> anl,</span>
<span id="cb184-1419"><a href="#cb184-1419" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"USUBJID"</span></span>
<span id="cb184-1420"><a href="#cb184-1420" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1421"><a href="#cb184-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1422"><a href="#cb184-1422" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the timepoint-defined LB data.</span></span>
<span id="cb184-1423"><a href="#cb184-1423" aria-hidden="true" tabindex="-1"></a>  anl <span class="ot">&lt;-</span> adlb[</span>
<span id="cb184-1424"><a href="#cb184-1424" aria-hidden="true" tabindex="-1"></a>    adlb<span class="sc">$</span>AVISIT <span class="sc">==</span> <span class="st">"MONTH 3"</span> <span class="sc">&amp;</span></span>
<span id="cb184-1425"><a href="#cb184-1425" aria-hidden="true" tabindex="-1"></a>      adlb<span class="sc">$</span>PARAMCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"GLUC"</span>, <span class="st">"INSULIN"</span>),</span>
<span id="cb184-1426"><a href="#cb184-1426" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb184-1427"><a href="#cb184-1427" aria-hidden="true" tabindex="-1"></a>  anl<span class="sc">$</span>PARAMCD <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="co"># nolint</span></span>
<span id="cb184-1428"><a href="#cb184-1428" aria-hidden="true" tabindex="-1"></a>    anl<span class="sc">$</span>PARAMCD, anl<span class="sc">$</span>ATPTNUM, <span class="at">sep =</span> <span class="st">"_"</span></span>
<span id="cb184-1429"><a href="#cb184-1429" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1430"><a href="#cb184-1430" aria-hidden="true" tabindex="-1"></a>  anl <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb184-1431"><a href="#cb184-1431" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> anl[<span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"PARAMCD"</span>, <span class="st">"CHG"</span>, <span class="st">"PCHG"</span>)],</span>
<span id="cb184-1432"><a href="#cb184-1432" aria-hidden="true" tabindex="-1"></a>    <span class="at">v.names =</span> <span class="fu">c</span>(<span class="st">"CHG"</span>, <span class="st">"PCHG"</span>),</span>
<span id="cb184-1433"><a href="#cb184-1433" aria-hidden="true" tabindex="-1"></a>    <span class="at">timevar =</span> <span class="st">"PARAMCD"</span>,</span>
<span id="cb184-1434"><a href="#cb184-1434" aria-hidden="true" tabindex="-1"></a>    <span class="at">idvar =</span> <span class="st">"USUBJID"</span>,</span>
<span id="cb184-1435"><a href="#cb184-1435" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> <span class="st">"wide"</span></span>
<span id="cb184-1436"><a href="#cb184-1436" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1437"><a href="#cb184-1437" aria-hidden="true" tabindex="-1"></a>  adam <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x =</span> adam, <span class="at">y =</span> anl, <span class="at">by =</span> <span class="st">"USUBJID"</span>)</span>
<span id="cb184-1438"><a href="#cb184-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1439"><a href="#cb184-1439" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Vital Sign data are added.</span></span>
<span id="cb184-1440"><a href="#cb184-1440" aria-hidden="true" tabindex="-1"></a>  anl <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb184-1441"><a href="#cb184-1441" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> advs[</span>
<span id="cb184-1442"><a href="#cb184-1442" aria-hidden="true" tabindex="-1"></a>      advs<span class="sc">$</span>AVISIT <span class="sc">==</span> <span class="st">"MONTH 3"</span>,</span>
<span id="cb184-1443"><a href="#cb184-1443" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"PARAMCD"</span>, <span class="st">"CHG"</span>, <span class="st">"PCHG"</span>)],</span>
<span id="cb184-1444"><a href="#cb184-1444" aria-hidden="true" tabindex="-1"></a>    <span class="at">v.names =</span> <span class="fu">c</span>(<span class="st">"CHG"</span>, <span class="st">"PCHG"</span>),</span>
<span id="cb184-1445"><a href="#cb184-1445" aria-hidden="true" tabindex="-1"></a>    <span class="at">timevar =</span> <span class="st">"PARAMCD"</span>,</span>
<span id="cb184-1446"><a href="#cb184-1446" aria-hidden="true" tabindex="-1"></a>    <span class="at">idvar =</span> <span class="st">"USUBJID"</span>,</span>
<span id="cb184-1447"><a href="#cb184-1447" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> <span class="st">"wide"</span></span>
<span id="cb184-1448"><a href="#cb184-1448" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1449"><a href="#cb184-1449" aria-hidden="true" tabindex="-1"></a>  adam <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x =</span> adam, <span class="at">y =</span> anl, <span class="at">by =</span> <span class="st">"USUBJID"</span>)</span>
<span id="cb184-1450"><a href="#cb184-1450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1451"><a href="#cb184-1451" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clean ADaM names.</span></span>
<span id="cb184-1452"><a href="#cb184-1452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(adam) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(</span>
<span id="cb184-1453"><a href="#cb184-1453" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="st">"^CHG</span><span class="sc">\\</span><span class="st">.(.*)$"</span>,</span>
<span id="cb184-1454"><a href="#cb184-1454" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">colnames</span>(adam),</span>
<span id="cb184-1455"><a href="#cb184-1455" aria-hidden="true" tabindex="-1"></a>    <span class="at">replacement =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span></span>
<span id="cb184-1456"><a href="#cb184-1456" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1457"><a href="#cb184-1457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(adam) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(</span>
<span id="cb184-1458"><a href="#cb184-1458" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="st">"^PCHG</span><span class="sc">\\</span><span class="st">.(.*)$"</span>,</span>
<span id="cb184-1459"><a href="#cb184-1459" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">colnames</span>(adam),</span>
<span id="cb184-1460"><a href="#cb184-1460" aria-hidden="true" tabindex="-1"></a>    <span class="at">replacement =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">1_PCHG"</span></span>
<span id="cb184-1461"><a href="#cb184-1461" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1462"><a href="#cb184-1462" aria-hidden="true" tabindex="-1"></a>  adam<span class="sc">$</span>ARMCD <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(adam<span class="sc">$</span>ARMCD)<span class="co"># nolint</span></span>
<span id="cb184-1463"><a href="#cb184-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1464"><a href="#cb184-1464" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Traits matrix (numeric).</span></span>
<span id="cb184-1465"><a href="#cb184-1465" aria-hidden="true" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">max</span>(<span class="fu">table</span>(adam<span class="sc">$</span>USUBJID)) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb184-1466"><a href="#cb184-1466" aria-hidden="true" tabindex="-1"></a>  traits <span class="ot">&lt;-</span> adam[<span class="fu">match</span>(subj, adam<span class="sc">$</span>USUBJID), ]</span>
<span id="cb184-1467"><a href="#cb184-1467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(traits) <span class="ot">&lt;-</span> traits<span class="sc">$</span>SUBJID</span>
<span id="cb184-1468"><a href="#cb184-1468" aria-hidden="true" tabindex="-1"></a>  traits <span class="ot">&lt;-</span> traits[</span>
<span id="cb184-1469"><a href="#cb184-1469" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">colnames</span>(traits) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"SUBJID"</span>, <span class="st">"USUBJID"</span>, <span class="st">"SEX"</span>, <span class="st">"ARM"</span>)</span>
<span id="cb184-1470"><a href="#cb184-1470" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb184-1471"><a href="#cb184-1471" aria-hidden="true" tabindex="-1"></a>  traits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb184-1472"><a href="#cb184-1472" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(traits, <span class="cf">function</span>(x) <span class="fu">as_scaled_numeric</span>(x)),</span>
<span id="cb184-1473"><a href="#cb184-1473" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="fu">row.names</span>(traits)</span>
<span id="cb184-1474"><a href="#cb184-1474" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1475"><a href="#cb184-1475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1476"><a href="#cb184-1476" aria-hidden="true" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">all</span>(<span class="fu">rownames</span>(traits) <span class="sc">==</span> <span class="fu">rownames</span>(expr)))</span>
<span id="cb184-1477"><a href="#cb184-1477" aria-hidden="true" tabindex="-1"></a>  result<span class="sc">$</span>b <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb184-1478"><a href="#cb184-1478" aria-hidden="true" tabindex="-1"></a>    <span class="at">expr =</span> expr,</span>
<span id="cb184-1479"><a href="#cb184-1479" aria-hidden="true" tabindex="-1"></a>    <span class="at">traits =</span> traits</span>
<span id="cb184-1480"><a href="#cb184-1480" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1481"><a href="#cb184-1481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1482"><a href="#cb184-1482" aria-hidden="true" tabindex="-1"></a>  result</span>
<span id="cb184-1483"><a href="#cb184-1483" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-1484"><a href="#cb184-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1485"><a href="#cb184-1485" aria-hidden="true" tabindex="-1"></a>besd_wgcna <span class="ot">&lt;-</span> <span class="fu">vst_norm</span>(<span class="at">mae =</span> besd_mae, <span class="at">assay =</span> <span class="st">"mrna"</span>)</span>
<span id="cb184-1486"><a href="#cb184-1486" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb184-1487"><a href="#cb184-1487" aria-hidden="true" tabindex="-1"></a>assertthat<span class="sc">::</span><span class="fu">assert_that</span>(</span>
<span id="cb184-1488"><a href="#cb184-1488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">all</span>(</span>
<span id="cb184-1489"><a href="#cb184-1489" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(</span>
<span id="cb184-1490"><a href="#cb184-1490" aria-hidden="true" tabindex="-1"></a>      besd_wgcna,</span>
<span id="cb184-1491"><a href="#cb184-1491" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(x) </span>
<span id="cb184-1492"><a href="#cb184-1492" aria-hidden="true" tabindex="-1"></a>        WGCNA<span class="sc">::</span><span class="fu">goodSamplesGenes</span>(x<span class="sc">$</span>expr, <span class="at">verbose =</span> <span class="dv">0</span>)<span class="sc">$</span>allOK</span>
<span id="cb184-1493"><a href="#cb184-1493" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb184-1494"><a href="#cb184-1494" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1495"><a href="#cb184-1495" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-1496"><a href="#cb184-1496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1497"><a href="#cb184-1497" aria-hidden="true" tabindex="-1"></a><span class="co">#' Add clust_ind to besd_wgcna.</span></span>
<span id="cb184-1498"><a href="#cb184-1498" aria-hidden="true" tabindex="-1"></a>besd_wgcna <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb184-1499"><a href="#cb184-1499" aria-hidden="true" tabindex="-1"></a>  besd_wgcna,</span>
<span id="cb184-1500"><a href="#cb184-1500" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) {</span>
<span id="cb184-1501"><a href="#cb184-1501" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>clust_ind <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(x<span class="sc">$</span>expr), <span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb184-1502"><a href="#cb184-1502" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb184-1503"><a href="#cb184-1503" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb184-1504"><a href="#cb184-1504" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-1505"><a href="#cb184-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1506"><a href="#cb184-1506" aria-hidden="true" tabindex="-1"></a>besd_wgcna<span class="sc">$</span>a<span class="sc">$</span>sft_val <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb184-1507"><a href="#cb184-1507" aria-hidden="true" tabindex="-1"></a>besd_wgcna<span class="sc">$</span>b<span class="sc">$</span>sft_val <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb184-1508"><a href="#cb184-1508" aria-hidden="true" tabindex="-1"></a>besd_wgcna  <span class="ot">&lt;-</span> <span class="fu">lapply</span>(besd_wgcna, wrap_sft)</span>
<span id="cb184-1509"><a href="#cb184-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1510"><a href="#cb184-1510" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>(); <span class="fu">gc</span>(<span class="at">reset =</span> <span class="cn">TRUE</span>)</span>
<span id="cb184-1511"><a href="#cb184-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1512"><a href="#cb184-1512" aria-hidden="true" tabindex="-1"></a><span class="co">#' @describeIn wrap_wgcna add `sft` to `besd_wgcna`;</span></span>
<span id="cb184-1513"><a href="#cb184-1513" aria-hidden="true" tabindex="-1"></a><span class="co">#'   semi-automatic procedure for sft.</span></span>
<span id="cb184-1514"><a href="#cb184-1514" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb184-1515"><a href="#cb184-1515" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-1516"><a href="#cb184-1516" aria-hidden="true" tabindex="-1"></a>wrap_sft <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb184-1517"><a href="#cb184-1517" aria-hidden="true" tabindex="-1"></a>  sft_power <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(<span class="fu">seq_len</span>(<span class="dv">10</span>), <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">30</span>, <span class="dv">2</span>), x<span class="sc">$</span>sft_val))</span>
<span id="cb184-1518"><a href="#cb184-1518" aria-hidden="true" tabindex="-1"></a>  sft_power <span class="ot">&lt;-</span> sft_power[<span class="fu">order</span>(sft_power)]</span>
<span id="cb184-1519"><a href="#cb184-1519" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>sft <span class="ot">&lt;-</span> WGCNA<span class="sc">::</span><span class="fu">pickSoftThreshold</span>(</span>
<span id="cb184-1520"><a href="#cb184-1520" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>expr,</span>
<span id="cb184-1521"><a href="#cb184-1521" aria-hidden="true" tabindex="-1"></a>    <span class="at">powerVector =</span> sft_power,</span>
<span id="cb184-1522"><a href="#cb184-1522" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="dv">5</span></span>
<span id="cb184-1523"><a href="#cb184-1523" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1524"><a href="#cb184-1524" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb184-1525"><a href="#cb184-1525" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-1526"><a href="#cb184-1526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1527"><a href="#cb184-1527" aria-hidden="true" tabindex="-1"></a><span class="co">#' @describeIn wrap_wgcna plot the soft-threshold determining procedure.</span></span>
<span id="cb184-1528"><a href="#cb184-1528" aria-hidden="true" tabindex="-1"></a><span class="co">#' @import ggplot2</span></span>
<span id="cb184-1529"><a href="#cb184-1529" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb184-1530"><a href="#cb184-1530" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-1531"><a href="#cb184-1531" aria-hidden="true" tabindex="-1"></a>wrap_gg_sft <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb184-1532"><a href="#cb184-1532" aria-hidden="true" tabindex="-1"></a>  dta <span class="ot">&lt;-</span> x<span class="sc">$</span>sft<span class="sc">$</span>fitIndices</span>
<span id="cb184-1533"><a href="#cb184-1533" aria-hidden="true" tabindex="-1"></a>  dta<span class="sc">$</span>signed_rsq <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">sign</span>(dta<span class="sc">$</span>slope) <span class="sc">*</span> dta<span class="sc">$</span>SFT.R.sq</span>
<span id="cb184-1534"><a href="#cb184-1534" aria-hidden="true" tabindex="-1"></a>  dta <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb184-1535"><a href="#cb184-1535" aria-hidden="true" tabindex="-1"></a>    dta[<span class="fu">c</span>(<span class="st">"Power"</span>, <span class="st">"signed_rsq"</span>, <span class="st">"mean.k."</span>)],</span>
<span id="cb184-1536"><a href="#cb184-1536" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"signed_rsq"</span>, <span class="st">"mean.k."</span>),</span>
<span id="cb184-1537"><a href="#cb184-1537" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"criteria"</span>,</span>
<span id="cb184-1538"><a href="#cb184-1538" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb184-1539"><a href="#cb184-1539" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1540"><a href="#cb184-1540" aria-hidden="true" tabindex="-1"></a>  dta<span class="sc">$</span>criteria <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb184-1541"><a href="#cb184-1541" aria-hidden="true" tabindex="-1"></a>    dta<span class="sc">$</span>criteria,</span>
<span id="cb184-1542"><a href="#cb184-1542" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"signed_rsq"</span>, <span class="st">"mean.k."</span>),</span>
<span id="cb184-1543"><a href="#cb184-1543" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Scale independence"</span>, <span class="st">"Mean connectivity"</span>)</span>
<span id="cb184-1544"><a href="#cb184-1544" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1545"><a href="#cb184-1545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1546"><a href="#cb184-1546" aria-hidden="true" tabindex="-1"></a>  dta_hline <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb184-1547"><a href="#cb184-1547" aria-hidden="true" tabindex="-1"></a>    <span class="at">criteria =</span> <span class="fu">factor</span>(</span>
<span id="cb184-1548"><a href="#cb184-1548" aria-hidden="true" tabindex="-1"></a>      <span class="fu">levels</span>(dta<span class="sc">$</span>criteria)[<span class="dv">1</span>],</span>
<span id="cb184-1549"><a href="#cb184-1549" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">levels</span>(dta<span class="sc">$</span>criteria)</span>
<span id="cb184-1550"><a href="#cb184-1550" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb184-1551"><a href="#cb184-1551" aria-hidden="true" tabindex="-1"></a>    <span class="at">yintercept =</span> </span>
<span id="cb184-1552"><a href="#cb184-1552" aria-hidden="true" tabindex="-1"></a>      dta<span class="sc">$</span>value[dta<span class="sc">$</span>criteria <span class="sc">==</span> <span class="fu">levels</span>(dta<span class="sc">$</span>criteria)[<span class="dv">1</span>] <span class="sc">&amp;</span> dta<span class="sc">$</span>Power <span class="sc">==</span> x<span class="sc">$</span>sft_val],</span>
<span id="cb184-1553"><a href="#cb184-1553" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x<span class="sc">$</span>sft_val</span>
<span id="cb184-1554"><a href="#cb184-1554" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1555"><a href="#cb184-1555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb184-1556"><a href="#cb184-1556" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dta,</span>
<span id="cb184-1557"><a href="#cb184-1557" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes_string</span>(<span class="at">x =</span> <span class="st">"Power"</span>, <span class="at">y =</span> <span class="st">"value"</span>, <span class="at">label =</span> <span class="st">"Power"</span>)</span>
<span id="cb184-1558"><a href="#cb184-1558" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="fu">geom_hline</span>(</span>
<span id="cb184-1559"><a href="#cb184-1559" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dta_hline,</span>
<span id="cb184-1560"><a href="#cb184-1560" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes_string</span>(<span class="at">yintercept =</span> <span class="st">"yintercept"</span>)</span>
<span id="cb184-1561"><a href="#cb184-1561" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="fu">geom_line</span>(</span>
<span id="cb184-1562"><a href="#cb184-1562" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray60"</span>, <span class="at">lty =</span> <span class="dv">2</span></span>
<span id="cb184-1563"><a href="#cb184-1563" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="fu">geom_text</span>(</span>
<span id="cb184-1564"><a href="#cb184-1564" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="fu">geom_label</span>(</span>
<span id="cb184-1565"><a href="#cb184-1565" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dta_hline,</span>
<span id="cb184-1566"><a href="#cb184-1566" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes_string</span>(<span class="at">y =</span> <span class="st">"yintercept"</span>, <span class="at">x =</span> <span class="st">"x"</span>, <span class="at">label =</span> <span class="st">"x"</span>)</span>
<span id="cb184-1567"><a href="#cb184-1567" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="fu">facet_wrap</span>(</span>
<span id="cb184-1568"><a href="#cb184-1568" aria-hidden="true" tabindex="-1"></a>    criteria <span class="sc">~</span>  ., <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb184-1569"><a href="#cb184-1569" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1570"><a href="#cb184-1570" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-1571"><a href="#cb184-1571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1572"><a href="#cb184-1572" aria-hidden="true" tabindex="-1"></a><span class="co">#' @describeIn wrap_wgcna add `wgcna` to `besd_wgcna`.</span></span>
<span id="cb184-1573"><a href="#cb184-1573" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param data (`list`)\cr expression profile.</span></span>
<span id="cb184-1574"><a href="#cb184-1574" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param control (`list`)\cr control as prepared by [control_wgcna()].</span></span>
<span id="cb184-1575"><a href="#cb184-1575" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom stats cor</span></span>
<span id="cb184-1576"><a href="#cb184-1576" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb184-1577"><a href="#cb184-1577" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-1578"><a href="#cb184-1578" aria-hidden="true" tabindex="-1"></a>estimate_wgcna <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb184-1579"><a href="#cb184-1579" aria-hidden="true" tabindex="-1"></a>  data,</span>
<span id="cb184-1580"><a href="#cb184-1580" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">control_wgcna</span>()) {</span>
<span id="cb184-1581"><a href="#cb184-1581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1582"><a href="#cb184-1582" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (control<span class="sc">$</span>verbose) <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">----Adjacency: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb184-1583"><a href="#cb184-1583" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (control<span class="sc">$</span>corFnc <span class="sc">==</span> <span class="st">"bicor"</span>) bicor <span class="ot">&lt;-</span> WGCNA<span class="sc">::</span>bicor</span>
<span id="cb184-1584"><a href="#cb184-1584" aria-hidden="true" tabindex="-1"></a>  adj <span class="ot">&lt;-</span> WGCNA<span class="sc">::</span><span class="fu">adjacency</span>(</span>
<span id="cb184-1585"><a href="#cb184-1585" aria-hidden="true" tabindex="-1"></a>    <span class="at">datExpr =</span> data,</span>
<span id="cb184-1586"><a href="#cb184-1586" aria-hidden="true" tabindex="-1"></a>    <span class="at">power =</span> control<span class="sc">$</span>power,</span>
<span id="cb184-1587"><a href="#cb184-1587" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> control<span class="sc">$</span>type,</span>
<span id="cb184-1588"><a href="#cb184-1588" aria-hidden="true" tabindex="-1"></a>    <span class="at">corFnc =</span> control<span class="sc">$</span>corFnc</span>
<span id="cb184-1589"><a href="#cb184-1589" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1590"><a href="#cb184-1590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1591"><a href="#cb184-1591" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Turn adjacency into topological overlap</span></span>
<span id="cb184-1592"><a href="#cb184-1592" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (control<span class="sc">$</span>verbose) <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">----TOM: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb184-1593"><a href="#cb184-1593" aria-hidden="true" tabindex="-1"></a>  TOM <span class="ot">&lt;-</span>  WGCNA<span class="sc">::</span><span class="fu">TOMsimilarity</span>(</span>
<span id="cb184-1594"><a href="#cb184-1594" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjMat =</span> adj,</span>
<span id="cb184-1595"><a href="#cb184-1595" aria-hidden="true" tabindex="-1"></a>    <span class="at">TOMType =</span> control<span class="sc">$</span>TOMType</span>
<span id="cb184-1596"><a href="#cb184-1596" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1597"><a href="#cb184-1597" aria-hidden="true" tabindex="-1"></a>  dissTOM <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> TOM</span>
<span id="cb184-1598"><a href="#cb184-1598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1599"><a href="#cb184-1599" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Call the hierarchical clustering function</span></span>
<span id="cb184-1600"><a href="#cb184-1600" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (control<span class="sc">$</span>verbose) <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">----hclust: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb184-1601"><a href="#cb184-1601" aria-hidden="true" tabindex="-1"></a>  dendro <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">hclust</span>(stats<span class="sc">::</span><span class="fu">as.dist</span>(dissTOM), <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb184-1602"><a href="#cb184-1602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1603"><a href="#cb184-1603" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Module identification using dynamic tree cut:</span></span>
<span id="cb184-1604"><a href="#cb184-1604" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (control<span class="sc">$</span>verbose) <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">----cutreeDynamic: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb184-1605"><a href="#cb184-1605" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We like large modules, so we set the minimum module size relatively high:</span></span>
<span id="cb184-1606"><a href="#cb184-1606" aria-hidden="true" tabindex="-1"></a>  dynamicMods <span class="ot">&lt;-</span> dynamicTreeCut<span class="sc">::</span><span class="fu">cutreeDynamic</span>(</span>
<span id="cb184-1607"><a href="#cb184-1607" aria-hidden="true" tabindex="-1"></a>    <span class="at">dendro =</span> dendro,</span>
<span id="cb184-1608"><a href="#cb184-1608" aria-hidden="true" tabindex="-1"></a>    <span class="at">distM =</span> dissTOM,</span>
<span id="cb184-1609"><a href="#cb184-1609" aria-hidden="true" tabindex="-1"></a>    <span class="at">cutHeight =</span> control<span class="sc">$</span>cutHeight,</span>
<span id="cb184-1610"><a href="#cb184-1610" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"hybrid"</span>,</span>
<span id="cb184-1611"><a href="#cb184-1611" aria-hidden="true" tabindex="-1"></a>    <span class="at">deepSplit =</span> control<span class="sc">$</span>deepSplit,</span>
<span id="cb184-1612"><a href="#cb184-1612" aria-hidden="true" tabindex="-1"></a>    <span class="at">pamRespectsDendro =</span> <span class="cn">FALSE</span>,</span>
<span id="cb184-1613"><a href="#cb184-1613" aria-hidden="true" tabindex="-1"></a>    <span class="at">minClusterSize =</span> control<span class="sc">$</span>minClusterSize</span>
<span id="cb184-1614"><a href="#cb184-1614" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1615"><a href="#cb184-1615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1616"><a href="#cb184-1616" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert numeric lables into colors</span></span>
<span id="cb184-1617"><a href="#cb184-1617" aria-hidden="true" tabindex="-1"></a>  dynamicColors <span class="ot">&lt;-</span> WGCNA<span class="sc">::</span><span class="fu">labels2colors</span>(dynamicMods)</span>
<span id="cb184-1618"><a href="#cb184-1618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1619"><a href="#cb184-1619" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate eigengenes</span></span>
<span id="cb184-1620"><a href="#cb184-1620" aria-hidden="true" tabindex="-1"></a>  MEList <span class="ot">&lt;-</span> WGCNA<span class="sc">::</span><span class="fu">moduleEigengenes</span>(<span class="at">expr =</span> data, <span class="at">colors =</span> dynamicColors)</span>
<span id="cb184-1621"><a href="#cb184-1621" aria-hidden="true" tabindex="-1"></a>  MEs <span class="ot">&lt;-</span> MEList<span class="sc">$</span>eigengenes</span>
<span id="cb184-1622"><a href="#cb184-1622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1623"><a href="#cb184-1623" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate dissimilarity of module eigengenes</span></span>
<span id="cb184-1624"><a href="#cb184-1624" aria-hidden="true" tabindex="-1"></a>  MEDiss <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">cor</span>(MEs);</span>
<span id="cb184-1625"><a href="#cb184-1625" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cluster module eigengenes</span></span>
<span id="cb184-1626"><a href="#cb184-1626" aria-hidden="true" tabindex="-1"></a>  METree <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">hclust</span>(stats<span class="sc">::</span><span class="fu">as.dist</span>(MEDiss), <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb184-1627"><a href="#cb184-1627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1628"><a href="#cb184-1628" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Call an automatic merging function</span></span>
<span id="cb184-1629"><a href="#cb184-1629" aria-hidden="true" tabindex="-1"></a>  merge <span class="ot">&lt;-</span> WGCNA<span class="sc">::</span><span class="fu">mergeCloseModules</span>(</span>
<span id="cb184-1630"><a href="#cb184-1630" aria-hidden="true" tabindex="-1"></a>    data,</span>
<span id="cb184-1631"><a href="#cb184-1631" aria-hidden="true" tabindex="-1"></a>    dynamicColors</span>
<span id="cb184-1632"><a href="#cb184-1632" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1633"><a href="#cb184-1633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1634"><a href="#cb184-1634" aria-hidden="true" tabindex="-1"></a>  color_group <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb184-1635"><a href="#cb184-1635" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Dynamic Tree Cut"</span> <span class="ot">=</span> dynamicColors,</span>
<span id="cb184-1636"><a href="#cb184-1636" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Merged dynamic"</span> <span class="ot">=</span> merge<span class="sc">$</span>color</span>
<span id="cb184-1637"><a href="#cb184-1637" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1638"><a href="#cb184-1638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb184-1639"><a href="#cb184-1639" aria-hidden="true" tabindex="-1"></a>    <span class="at">dendro =</span> dendro,</span>
<span id="cb184-1640"><a href="#cb184-1640" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> color_group,</span>
<span id="cb184-1641"><a href="#cb184-1641" aria-hidden="true" tabindex="-1"></a>    <span class="at">mod_merge =</span> merge,</span>
<span id="cb184-1642"><a href="#cb184-1642" aria-hidden="true" tabindex="-1"></a>    <span class="at">MEs =</span> MEs</span>
<span id="cb184-1643"><a href="#cb184-1643" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb184-1644"><a href="#cb184-1644" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-1645"><a href="#cb184-1645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1646"><a href="#cb184-1646" aria-hidden="true" tabindex="-1"></a><span class="co">#' @describeIn wrap_wgcna convenient Controls</span></span>
<span id="cb184-1647"><a href="#cb184-1647" aria-hidden="true" tabindex="-1"></a><span class="co">#' @inheritParams WGCNA::adjacency</span></span>
<span id="cb184-1648"><a href="#cb184-1648" aria-hidden="true" tabindex="-1"></a><span class="co">#' @inheritParams WGCNA::TOMsimilarity</span></span>
<span id="cb184-1649"><a href="#cb184-1649" aria-hidden="true" tabindex="-1"></a><span class="co">#' @inheritParams dynamicTreeCut::cutreeDynamic</span></span>
<span id="cb184-1650"><a href="#cb184-1650" aria-hidden="true" tabindex="-1"></a><span class="co">#' @inheritParams WGCNA::mergeCloseModules</span></span>
<span id="cb184-1651"><a href="#cb184-1651" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb184-1652"><a href="#cb184-1652" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb184-1653"><a href="#cb184-1653" aria-hidden="true" tabindex="-1"></a>control_wgcna <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb184-1654"><a href="#cb184-1654" aria-hidden="true" tabindex="-1"></a>  power,</span>
<span id="cb184-1655"><a href="#cb184-1655" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"signed"</span>,</span>
<span id="cb184-1656"><a href="#cb184-1656" aria-hidden="true" tabindex="-1"></a>  <span class="at">TOMType =</span> <span class="st">"signed"</span>,</span>
<span id="cb184-1657"><a href="#cb184-1657" aria-hidden="true" tabindex="-1"></a>  <span class="at">corFnc =</span> <span class="fu">c</span>(<span class="st">"pearson"</span> <span class="ot">=</span> <span class="st">"cor"</span>, <span class="st">"bicor"</span> <span class="ot">=</span> <span class="st">"bicor"</span>)[<span class="dv">1</span>], </span>
<span id="cb184-1658"><a href="#cb184-1658" aria-hidden="true" tabindex="-1"></a>  <span class="at">deepSplit =</span> <span class="dv">1</span>, <span class="co"># wa 2 for Medium sensitivity</span></span>
<span id="cb184-1659"><a href="#cb184-1659" aria-hidden="true" tabindex="-1"></a>  <span class="at">cutHeight =</span> <span class="fl">0.995</span>, <span class="co"># Default 0.995</span></span>
<span id="cb184-1660"><a href="#cb184-1660" aria-hidden="true" tabindex="-1"></a>  <span class="at">minClusterSize =</span> <span class="dv">20</span>, <span class="co"># min(20, ncol(datExpr)/2 ) </span></span>
<span id="cb184-1661"><a href="#cb184-1661" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb184-1662"><a href="#cb184-1662" aria-hidden="true" tabindex="-1"></a>  ) {</span>
<span id="cb184-1663"><a href="#cb184-1663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>(<span class="fu">environment</span>())</span>
<span id="cb184-1664"><a href="#cb184-1664" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-1665"><a href="#cb184-1665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1666"><a href="#cb184-1666" aria-hidden="true" tabindex="-1"></a>besd_wgcna <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb184-1667"><a href="#cb184-1667" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> besd_wgcna,</span>
<span id="cb184-1668"><a href="#cb184-1668" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb184-1669"><a href="#cb184-1669" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>wgcna <span class="ot">&lt;-</span> <span class="fu">estimate_wgcna</span>(</span>
<span id="cb184-1670"><a href="#cb184-1670" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> x<span class="sc">$</span>expr,</span>
<span id="cb184-1671"><a href="#cb184-1671" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">control_wgcna</span>(<span class="at">power =</span> x<span class="sc">$</span>sft_val)</span>
<span id="cb184-1672"><a href="#cb184-1672" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb184-1673"><a href="#cb184-1673" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gc</span>(); <span class="fu">gc</span>(<span class="at">reset =</span> <span class="cn">TRUE</span>)</span>
<span id="cb184-1674"><a href="#cb184-1674" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb184-1675"><a href="#cb184-1675" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb184-1676"><a href="#cb184-1676" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-1677"><a href="#cb184-1677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1678"><a href="#cb184-1678" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb184-1679"><a href="#cb184-1679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1680"><a href="#cb184-1680" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Data preparation</span></span>
<span id="cb184-1681"><a href="#cb184-1681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1682"><a href="#cb184-1682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1683"><a href="#cb184-1683" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session Informations</span></span>
<span id="cb184-1684"><a href="#cb184-1684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-1687"><a href="#cb184-1687" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb184-1688"><a href="#cb184-1688" aria-hidden="true" tabindex="-1"></a>sessioninfo<span class="sc">::</span><span class="fu">session_info</span>()</span>
<span id="cb184-1689"><a href="#cb184-1689" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
      <div class="nav-footer-center">Copyright 2022, FCA Collin, Ph.D.</div>
  </div>
</footer>


</body></html>