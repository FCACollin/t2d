[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "T2D: Exercise and Genetic Expression Profile",
    "section": "",
    "text": "Development version:\n\nonly the program is displayed within these pages.\nno data is attached to the repository or displayed within the pages.\nno output is displayed within the pages.\n\nOutputs will be included and made available within the program if the associated manuscript is accepted for publication in peer-review journal.\n\nThe analysis was realized with R (v4.2.0, R Core Team 2022). Note the use of the additional packages downloaded from the RStudio package manager repository (freeze date 2022-05-04, repos) and complemented by Bioconductor packages (release 3.15):\n\nBiocParallel\n\ncar for regression model test (version 3.0-13, Fox and Weisberg 2019)\n\n\ncowplot for figure composition (version 1.1.1, Wilke 2020)\n\n\nDESeq2 for differential expression analysis and variance stabilizing transformation (version 1.36.0, Love, Huber, and Anders 2014)\n\n\nemmeans for least-Squares Means (LSM) estimations (version 1.7.3, Lenth 2022)\n\n\nflextable for output table formatting (version 0.7.0, Gohel 2022)\n\n\nggplot2 for graphics (version 3.3.6, Wickham 2016)\n\nhexbin\nlintr\nmissMDA\nmultcomp\nmultcompView\n\nMultiAssayExperiment for management of multi-omics experiment objects (version 1.22.0, Ramos et al. 2017)\n\n\ntidyr for data wrangling (version 1.2.0, Wickham and Girlich 2022)\n\n\nWGCNA for gene clustering Langfelder and Horvath (2012).\n\nTo install:\n\nWGCNA\ndynamicTreeCut\n\nThe computational environment was containerized into a Docker image build upon rocker/verse:4.2.0.\n\nShow the codeparams <- yaml::read_yaml(\"_prog.yml\")\nparams$paths |>\n  lapply(\\(x) if (!dir.exists(x)) dir.create(x))\n\n$tlg\nNULL\n\n$tab\nNULL\n\n$grh\nNULL\n\n$dta\nNULL\n\n\n\n\n\n\n\n\nFox, John, and Sanford Weisberg. 2019. An R Companion to Applied Regression. Third. Thousand Oaks CA: Sage. https://socialsciences.mcmaster.ca/jfox/Books/Companion/.\n\n\nGohel, David. 2022. Flextable: Functions for Tabular Reporting.\n\n\nLangfelder, Peter, and Steve Horvath. 2008. “WGCNA: An r Package for Weighted Correlation Network Analysis.” BMC Bioinformatics, no. 1: 559. https://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-9-559.\n\n\n———. 2012. “Fast R Functions for Robust Correlations and Hierarchical Clustering.” Journal of Statistical Software 46 (11): 1–17. https://www.jstatsoft.org/v46/i11/.\n\n\nLenth, Russell V. 2022. Emmeans: Estimated Marginal Means, Aka Least-Squares Means. https://github.com/rvlenth/emmeans.\n\n\nLove, Michael I., Wolfgang Huber, and Simon Anders. 2014. “Moderated Estimation of Fold Change and Dispersion for RNA-Seq Data with DESeq2.” Genome Biology 15: 550. https://doi.org/10.1186/s13059-014-0550-8.\n\n\nR Core Team. 2022. R: A Language and Environment for Statistical Computing. Vienna, Austria: R Foundation for Statistical Computing. https://www.R-project.org/.\n\n\nRamos, Marcel, Lucas Schiffer, Angela Re, Rimsha Azhar, Azfar Basunia, Carmen Rodriguez Cabrera, Tiffany Chan, et al. 2017. “Software for the Integration of Multi-Omics Experiments in Bioconductor.” Cancer Research 77(21); e39-42.\n\n\nWickham, Hadley. 2016. Ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York. https://ggplot2.tidyverse.org.\n\n\nWickham, Hadley, and Maximilian Girlich. 2022. Tidyr: Tidy Messy Dataversion.\n\n\nWilke, Claus O. 2020. Cowplot: Streamlined Plot Theme and Plot Annotations for ’Ggplot2’. https://wilkelab.org/cowplot/."
  },
  {
    "objectID": "t2d_03_bds.html",
    "href": "t2d_03_bds.html",
    "title": "\n1  Missingness in adlb and advs\n",
    "section": "",
    "text": "Data missingness was addressed by a missing‑data imputation algorithm, employed to impute missing values while minimizing bias on results (R package missMDA, Josse and Husson 2016)); “observed cases” and “imputed data” later refers to the exclusion/inclusion of imputed data.\nThe analysis was realized with R (v4.2.0, R Core Team 2022). Note the use of the additional package downloaded from the RStudio package manager repository (freeze date 2022-05-04, repos):\n\n\nggplot2 for graphics (version 3.3.6, Wickham 2016)."
  },
  {
    "objectID": "t2d_03_bds.html#program-settings",
    "href": "t2d_03_bds.html#program-settings",
    "title": "\n1  Missingness in adlb and advs\n",
    "section": "\n1.2 Program settings",
    "text": "1.2 Program settings\n\nShow the codeparams <- yaml::read_yaml(\"_prog.yml\")\ndevtools::load_all(\"src/pkg/dbs.data\")\n\nℹ Loading dbs.data\n\nShow the codedevtools::load_all(\"src/pkg/latarnia.utils\")\n\nℹ Loading latarnia.utils\nLoading required package: grid\n\nLoading required package: shiny\n\nShow the codeknitr::opts_chunk$set(results = params$knitr$results)"
  },
  {
    "objectID": "t2d_03_bds.html#data-preparation",
    "href": "t2d_03_bds.html#data-preparation",
    "title": "\n1  Missingness in adlb and advs\n",
    "section": "\n1.3 Data Preparation",
    "text": "1.3 Data Preparation\n\nShow the codeadsl <- dbs.data::adsl\nadvs <- dbs.data::advs\nadlb <- dbs.data::adlb"
  },
  {
    "objectID": "t2d_03_bds.html#figure-03-output-01",
    "href": "t2d_03_bds.html#figure-03-output-01",
    "title": "\n1  Missingness in adlb and advs\n",
    "section": "\n1.4 Figure 03 output 01",
    "text": "1.4 Figure 03 output 01\n\nShow the codelibrary(ggplot2)\ngg <- rbind(adlb, advs) |>\n  ggplot(aes(subjid, paramcd, fill = dtype)) +\n  scale_fill_manual(values = c(\"white\", \"gray75\")) +\n  geom_tile(color = \"gray50\") +\n  theme_minimal() +\n  theme(\n    text = element_text(size = 7),\n    axis.title = element_blank(),\n    axis.text.x = element_text(angle = 90, hjust = 1),\n    legend.position = \"none\",\n    legend.title = element_blank()\n  )\n\n\n\nShow the codep <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 3.1\",\n      \"Colored raster - Data missingness per Subject and Parameter\",\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_figure(gg, width = unit(5.2, \"inches\"), height = unit(3.5, \"inches\")) |>\n  add_footer(\n    paste0(\"Program t2d_03_bds / Env ayup_dbs:\", params$dock$version),\n    params$version\n  )\n\n\n\nShow the codeexport_as(\n  p,\n  file = file.path(params$paths$grh, \"fig_03_01.pdf\"),\n  file_graph_alone = file.path(params$paths$grh, \"fig_03_01_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_03_01.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_03_01_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)"
  },
  {
    "objectID": "t2d_03_bds.html#session-informations",
    "href": "t2d_03_bds.html#session-informations",
    "title": "\n1  Missingness in adlb and advs\n",
    "section": "\n1.5 Session Informations",
    "text": "1.5 Session Informations\n\nShow the codesessioninfo::session_info()\n\n\n\n\n\n\n\n\nJosse, Julie, and François Husson. 2016. “missMDA: A Package for Handling Missing Values in Multivariate Data Analysis.” Journal of Statistical Software 70 (1): 1–31. https://doi.org/10.18637/jss.v070.i01.\n\n\nR Core Team. 2022. R: A Language and Environment for Statistical Computing. Vienna, Austria: R Foundation for Statistical Computing. https://www.R-project.org/.\n\n\nWickham, Hadley. 2016. Ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York. https://ggplot2.tidyverse.org."
  },
  {
    "objectID": "t2d_08_dmg.html",
    "href": "t2d_08_dmg.html",
    "title": "\n2  Demographics and Baseline Anthropometrics\n",
    "section": "",
    "text": "Demographics data characterized the diabetes groups in terms of age, number of training composing the exercise intervention, BMI and diet at baseline. This was completed by a fine description of the baseline anthropometrics leading differences between diabetes groups. Both characterizations relied on one-way analysis of variance, the diabetes effect significance was ruled by a Fisher test, least mean square estimations were obtained for every diabetes group along with their 95% confidence interval, and pairwise difference estimation and significance relied on Tukey’s method.\nThe analysis was realized with R (v4.2.0, R Core Team 2022). Note the use of the additional packages downloaded from the RStudio package manager repository (freeze date 2022-05-04, repos):\n\n\ncar for regression model test (version 3.0-13, Fox and Weisberg 2019)\n\n\nemmeans for least-Squares Means (LSM) estimations (version 1.7.3, Lenth 2022)\n\n\nflextable for output table formatting (version 0.7.0, Gohel 2022)\n\n\ntidyr for data wrangling (version 1.2.0, Wickham and Girlich 2022).\n\nTarget:\n\n\n\nTable: Demographics and baseline anthropometrics are tested via an Anova.\n\n\nSupp. Table: Post-hoc estimations / tests by diabetes groups.\n\n\nSupp. Table: extension of the anova to additional ADVS/ADLB parameters.\n\nSpecifications:\n\nVariable order\n\n\n\nShow the codeparams <- yaml::read_yaml(\"_prog.yml\")\ndevtools::load_all(\"src/pkg/dbs.data\")\n\nℹ Loading dbs.data\n\nShow the codedevtools::load_all(\"src/pkg/latarnia.utils\")\n\nℹ Loading latarnia.utils\nLoading required package: grid\n\nLoading required package: shiny\n\nShow the codeknitr::opts_chunk$set(results = params$knitr$results)\n\n\n\nShow the codeadsl <- dbs.data::adsl\nadvs <- dbs.data::advs\nadlb <- dbs.data::adlb\n\n\n\nShow the codeads <- adlb |>\n  rbind(advs) |>\n  subset(dtype == \"\" & avisit == \"Baseline\") |>\n  subset(select = c(subjid, paramcd, avisit, aval, dtype)) |>\n  rbind(\n    adsl |>\n      subset(select = -c(diab, diabcd)) |>\n      tidyr::pivot_longer(\n        cols = c(\"age\", \"trainn\"), names_to = \"paramcd\", values_to = \"aval\"\n      ) |>\n      within(dtype <- \"\") |>\n      within(avisit <- \"Baseline\")\n  ) |>\n  (\\(x) merge(x = adsl[c(\"subjid\", \"diabcd\")], y = x, by = \"subjid\"))() |>\n  (\\(df, fct = \"diabcd\") {\n    df[paste0(fct, \"_n\")] <- factor_n(df, fct, id = \"subjid\", sep = \" \")\n    df\n  })() |>\n  within(\n    paramcd <- factor(\n      paramcd,\n      levels = c(\n        \"age\", \"trainn\", \"GLU0\", \"GLU30\", \"GLU60\", \"GLU120\",\n        \"INSULIN0\", \"INSULIN30\", \"INSULIN60\", \"INSULIN120\",\n        \"HBA1C\", \"HOMAB\", \"HOMAIR\", \"MATSUDA\",\n        \"TRIG\", \"CHOL\", \"LDL\", \"HDL\", \"VO2MAXE\", \"WEIGHT\", \"BMI\",\n        \"FATMASS\", \"BODYFATP\", \"LEANMASS\", \"VAT\",\n        \"DCAL\", \"FATACFR\", \"DCARBT\", \"DFATT\", \"DPROT\", \"SMMASS\",\n        \"VO2MAXLBM\", \"VO2MAXML\"\n      )\n    ) \n  ) |>\n  (\\(df) df[order(df$paramcd), ])()\n\n\n\nShow the codeformat_pval <- function(x) {\n  p <- round(x, 5)\n  ifelse(\n    test = p < 0.0001,\n    yes = \"<0.0001\",\n    no = ifelse(\n      test = p < 0.001,\n      yes = format(round(p, 4), nsmall = 4),\n      no = ifelse(\n        test = p < 0.01,\n        yes = format(round(p, 3), nsmall = 3),\n        no = format(round(p, 2), nsmall = 2)\n      )\n    )\n  )\n}\n\nlm_by_paramcd <- function(x,\n                          dep_var = \"aval\",\n                          indep_var = \"diabcd_n\",\n                          covariate = NULL) {\n  \n  formula <- paste(\n    dep_var, \"~\", \n    if (!is.null(covariate)) paste(covariate, \"+\"),\n    indep_var\n  )\n  formula <- as.formula(formula)\n  \n  lapply(\n    x,\n    \\(x) list(data = x, lm = lm(formula, data = x))\n  )\n}\n\nmake_specs <- function(var) as.formula(paste(\"~\", var))\nlsm_by_param <- function(x, indep_var = \"diabcd_n\") {\n  lapply(\n    x,\n    \\(x) {\n      mod_em <- emmeans::emmeans(x$lm, specs = make_specs(indep_var))\n      y <- as.data.frame(mod_em)\n      cbind(\n        paramcd = unique(x$data$paramcd),\n        y,\n        diabcd_f = car::Anova(x$lm)[indep_var, \"Pr(>F)\"]\n      )\n    }\n  )\n}\n\nlsm_pairs_by_param <- function(x, indep_var = \"diabcd_n\")\n  lapply(\n    x,\n    \\(x) {\n      mod_em <- emmeans::emmeans(\n        x$lm, specs = indep_var, contr = \"revpairwise\"\n      )\n      y <- merge(\n        as.data.frame(mod_em$contrast)[c(\"contrast\", \"p.value\")],\n        confint(mod_em)$contrasts\n      )\n      cbind(paramcd = unique(x$data$paramcd), y)\n    }\n  )"
  },
  {
    "objectID": "t2d_08_dmg.html#tab-08-01---demographics-and-baseline-anthropometrics-by-diabetes-group",
    "href": "t2d_08_dmg.html#tab-08-01---demographics-and-baseline-anthropometrics-by-diabetes-group",
    "title": "\n2  Demographics and Baseline Anthropometrics\n",
    "section": "\n2.2 Tab 08 01 - Demographics and Baseline Anthropometrics by Diabetes Group",
    "text": "2.2 Tab 08 01 - Demographics and Baseline Anthropometrics by Diabetes Group\n\nShow the codetab_08_01_raw <- ads |>\n  subset(\n    paramcd %in% c(\n      \"age\", \"trainn\", \"GLU0\", \"GLU30\", \"GLU60\", \"GLU120\",\n      \"INSULIN0\", \"INSULIN30\", \"INSULIN60\", \"INSULIN120\",\n      \"HBA1C\", \"HOMAB\", \"HOMAIR\", \"MATSUDA\",\n      \"TRIG\", \"CHOL\", \"LDL\", \"HDL\", \"VO2MAXE\", \"WEIGHT\", \"BMI\",\n      \"FATMASS\", \"BODYFATP\", \"LEANMASS\", \"VAT\"\n    )\n  ) |>\n  (\\(x) split(x, f = x$paramcd, drop = TRUE))() |>\n  lm_by_paramcd() |>\n  lsm_by_param() |>\n  (\\(x) Reduce(rbind, x))()\n\nlibrary(tidyr)\n\n\nAttaching package: 'tidyr'\n\n\nThe following object is masked from 'package:testthat':\n\n    matches\n\nShow the codetab_08_01 <- tab_08_01_raw |>\n  (\\(df) df[order(df$diabcd_n), ])() |>\n  within({\n    val <- paste0(\n      signif(emmean, 3),\n      \" (\", signif(lower.CL, 3), \", \", signif(upper.CL, 3), \")\"\n    )\n    pval <- format_pval(diabcd_f)\n  }) |>\n  pivot_wider(\n    id_cols = c(\"paramcd\", \"pval\", \"diabcd_f\"),\n    values_from = \"val\",\n    names_from = \"diabcd_n\"\n  )\ntab_08_01\n\n\n\nShow the codelibrary(flextable)\n\n\nAttaching package: 'flextable'\n\n\nThe following objects are masked from 'package:latarnia.utils':\n\n    add_footer, add_header\n\nShow the codetab_08_01_ft <- tab_08_01 |>\n  subset(select = -diabcd_f) |>\n  flextable() |>\n  autofit() |>\n  add_header_lines(wrap_long_lines(\n    \"Analysis Set: Full Analysis Set - Observed Cases at baseline\"\n  )) |>\n  set_caption(\n    caption = wrap_long_lines(\n      \"Tab 08 01 - Analysis of Variance / Least Means Square estimations\n      (95% Confidence Interval) of Demographics Parameters and Baseline\n      Anthropometrics by Diabetes Group\"\n    )\n  ) |>\n  footnote(\n    part = \"header\",\n    i = 2, j = 2,\n    value = as_paragraph(\n      \"Note: pval, p value of diabetes group effect test by F test.\"\n    ),\n    ref_symbols = \"a\"\n  ) |>\n  footnote(\n    value = as_paragraph(\n      \"Source: ADSL and ADVS/ADLB observed cases at baseline.\"\n    ),\n    ref_symbols = \"\"\n  ) |>\n  theme_booktabs()\ntab_08_01_ft\n\n\n\nShow the codebnm <- \"tab_08_01\"\ndir_tab <- params$paths$tab\ndir_dta <- params$paths$dta\n\nfile.path(dir_tab, paste0(bnm, \"_ft.RData\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save(tab_08_01_ft, file = .)\n\n[output] Table saved as ../tlg/tables/tab_08_01_ft.RData\n\nShow the codefile.path(dir_dta, paste0(bnm, \".RData\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save(tab_08_01, file = .)\n\n[output] Table saved as ../data/tab_08_01.RData\n\nShow the codefile.path(dir_tab, paste(bnm, sep = \".\", \"docx\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save_as_docx(tab_08_01_ft, path = .)\n\n[output] Table saved as ../tlg/tables/tab_08_01.docx\n\nShow the codefile.path(dir_tab, paste(bnm, sep = \".\", \"html\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save_as_html(tab_08_01_ft, path = .)\n\n[output] Table saved as ../tlg/tables/tab_08_01.html\n\nShow the codefile.path(dir_dta, paste(bnm, sep = \".\", \"csv\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  write.csv(tab_08_01, file = ., row.names = FALSE)\n\n[output] Table saved as ../data/tab_08_01.csv"
  },
  {
    "objectID": "t2d_08_dmg.html#tab-08-02---post-hoc-demographics-and-baseline-anthropometrics-by-diabetes-group",
    "href": "t2d_08_dmg.html#tab-08-02---post-hoc-demographics-and-baseline-anthropometrics-by-diabetes-group",
    "title": "\n2  Demographics and Baseline Anthropometrics\n",
    "section": "\n2.3 Tab 08 02 - Post-hoc: Demographics and Baseline Anthropometrics by Diabetes Group",
    "text": "2.3 Tab 08 02 - Post-hoc: Demographics and Baseline Anthropometrics by Diabetes Group\n\nShow the codetab_08_02_raw <- ads |>\n  subset(\n    paramcd %in% c(\n      \"age\", \"trainn\", \"GLU0\", \"GLU30\", \"GLU60\", \"GLU120\",\n      \"INSULIN0\", \"INSULIN30\", \"INSULIN60\", \"INSULIN120\",\n      \"HBA1C\", \"HOMAB\", \"HOMAIR\", \"MATSUDA\",\n      \"TRIG\", \"CHOL\", \"LDL\", \"HDL\", \"VO2MAXE\", \"WEIGHT\", \"BMI\",\n      \"FATMASS\", \"BODYFATP\", \"LEANMASS\", \"VAT\"\n    )\n  ) |>\n  (\\(x) split(x, f = x$paramcd, drop = TRUE))() |>\n  lm_by_paramcd(indep_var = \"diabcd\") |>\n  lsm_pairs_by_param(indep_var = \"diabcd\")  |>\n  (\\(x) Reduce(rbind, x))()\n\nlibrary(tidyr)\ntab_08_02 <- tab_08_02_raw |>\n  subset(select = c(\n    paramcd, contrast, estimate, SE, df, p.value, lower.CL, upper.CL\n  ))\n\nlibrary(flextable)\ntab_08_02_ft <- tab_08_02 |>\n  (\\(x) split(x, f = x$paramcd))() |>\n  lapply(\n    \\(x) {\n      x$p.value <- format(round(x$p.value, 5))\n      x$estimate <- format(signif(x$estimate, 5))\n      x$SE <- format(signif(x$SE, 6))\n      x$lower.CL <- format(signif(x$lower.CL, 5))\n      x$upper.CL <- format(signif(x$upper.CL, 5))\n      x\n    }) |>\n  (\\(x) Reduce(rbind, x))()|>\n  flextable() |>\n  fontsize(size = 9, part = \"all\") |>\n  autofit() |>\n  add_header_lines(\n    \"Analysis Set: Full Analysis Set - Observed Cases at baseline\"\n  ) |>\n  set_caption(\n    caption = wrap_long_lines(\n      \"Tab 08 02 - Post-hoc tests for the Analysis of Variance of\n      Demographics and Baseline Anthropometrics by Diabetes Group\"\n    )\n  ) |>\n  add_footer_lines(c(\n    \"CL, 95% Confidence Limit; SE, Standard Error.\",\n    wrap_long_lines(\n      \"Note: P value adjustment by Tukey's method for comparing a family of\n      3 estimates.\"\n    ),\n    \"Source: ADSL and ADVS/ADLB observed cases at baseline.\" \n  )) |>\n  theme_booktabs()\n\ntab_08_02_ft\n\n\n\nShow the codebnm <- \"tab_08_02\"\ndir_tab <- params$paths$tab\ndir_dta <- params$paths$dta\n\nfile.path(dir_tab, paste0(bnm, \"_ft.RData\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save(tab_08_02_ft, file = .)\n\n[output] Table saved as ../tlg/tables/tab_08_02_ft.RData\n\nShow the codefile.path(dir_dta, paste0(bnm, \".RData\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save(tab_08_02, file = .)\n\n[output] Table saved as ../data/tab_08_02.RData\n\nShow the codefile.path(dir_tab, paste(bnm, sep = \".\", \"docx\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save_as_docx(tab_08_02_ft, path = .)\n\n[output] Table saved as ../tlg/tables/tab_08_02.docx\n\nShow the codefile.path(dir_tab, paste(bnm, sep = \".\", \"html\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save_as_html(tab_08_02_ft, path = .)\n\n[output] Table saved as ../tlg/tables/tab_08_02.html\n\nShow the codefile.path(dir_dta, paste(bnm, sep = \".\", \"csv\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  write.csv(tab_08_02, file = ., row.names = FALSE)\n\n[output] Table saved as ../data/tab_08_02.csv"
  },
  {
    "objectID": "t2d_08_dmg.html#tab-08-03---demographics-and-baseline-anthropometrics-by-diabetes-group-additional-parameters",
    "href": "t2d_08_dmg.html#tab-08-03---demographics-and-baseline-anthropometrics-by-diabetes-group-additional-parameters",
    "title": "\n2  Demographics and Baseline Anthropometrics\n",
    "section": "\n2.4 Tab 08 03 - Demographics and Baseline Anthropometrics by Diabetes Group (additional parameters)",
    "text": "2.4 Tab 08 03 - Demographics and Baseline Anthropometrics by Diabetes Group (additional parameters)\n\nShow the codetab_08_03_raw <- ads |>\n  subset(\n    !paramcd %in% c(\n      \"age\", \"trainn\", \"GLU0\", \"GLU30\", \"GLU60\", \"GLU120\",\n      \"INSULIN0\", \"INSULIN30\", \"INSULIN60\", \"INSULIN120\",\n      \"HBA1C\", \"HOMAB\", \"HOMAIR\", \"MATSUDA\",\n      \"TRIG\", \"CHOL\", \"LDL\", \"HDL\", \"VO2MAXE\", \"WEIGHT\", \"BMI\",\n      \"FATMASS\", \"BODYFATP\", \"LEANMASS\", \"VAT\"\n    )\n  ) |>\n  (\\(x) split(x, f = x$paramcd, drop = TRUE))() |>\n  lm_by_paramcd() |>\n  lsm_by_param() |>\n  (\\(x) Reduce(rbind, x))()\n\nlibrary(tidyr)\ntab_08_03 <- tab_08_03_raw |>\n  (\\(df) df[order(df$diabcd_n), ])() |>\n  within({\n    val <- paste0(\n      signif(emmean, 3),\n      \" (\", signif(lower.CL, 3), \", \", signif(upper.CL, 3), \")\"\n    )\n    pval <- format_pval(diabcd_f)\n  }) |>\n  pivot_wider(\n    id_cols = c(\"paramcd\", \"pval\", \"diabcd_f\"),\n    values_from = \"val\",\n    names_from = \"diabcd_n\"\n  )\ntab_08_03\n\n\n\nShow the codelibrary(flextable)\ntab_08_03_ft <- tab_08_03 |>\n  subset(select = -diabcd_f) |>\n  flextable() |>\n  autofit() |>\n  add_header_lines(wrap_long_lines(\n    \"Analysis Set: Full Analysis Set - Observed Cases at baseline\"\n  )) |>\n  set_caption(\n    caption = wrap_long_lines(\n      \"Tab 08 03 - Analysis of Variance / Least Means Square estimations\n      (95% Confidence Interval) of Demographics Parameters and Baseline\n      Anthropometrics by Diabetes Group for Supplementary Parameters\"\n    )\n  ) |>\n  footnote(\n    part = \"header\",\n    i = 2, j = 2,\n    value = as_paragraph(\n      \"Note: pval, p value of diabetes group effect test by F test.\"\n    ),\n    ref_symbols = \"a\"\n  ) |>\n  add_footer_lines(\"Source: ADSL and ADVS/ADLB observed cases at baseline.\") |>\n  theme_booktabs()\ntab_08_03_ft\n\n\n\nShow the codebnm <- \"tab_08_03\"\ndir_tab <- params$paths$tab\ndir_dta <- params$paths$dta\n\nfile.path(dir_tab, paste0(bnm, \"_ft.RData\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save(tab_08_03_ft, file = .)\n\n[output] Table saved as ../tlg/tables/tab_08_03_ft.RData\n\nShow the codefile.path(dir_dta, paste0(bnm, \".RData\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save(tab_08_03, file = .)\n\n[output] Table saved as ../data/tab_08_03.RData\n\nShow the codefile.path(dir_tab, paste(bnm, sep = \".\", \"docx\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save_as_docx(tab_08_03_ft, path = .)\n\n[output] Table saved as ../tlg/tables/tab_08_03.docx\n\nShow the codefile.path(dir_tab, paste(bnm, sep = \".\", \"html\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save_as_html(tab_08_03_ft, path = .)\n\n[output] Table saved as ../tlg/tables/tab_08_03.html\n\nShow the codefile.path(dir_dta, paste(bnm, sep = \".\", \"csv\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  write.csv(tab_08_03, file = ., row.names = FALSE)\n\n[output] Table saved as ../data/tab_08_03.csv"
  },
  {
    "objectID": "t2d_08_dmg.html#tab-08-04---post-hoc-demographics-and-baseline-anthropometrics-by-diabetes-group-additional-parameters",
    "href": "t2d_08_dmg.html#tab-08-04---post-hoc-demographics-and-baseline-anthropometrics-by-diabetes-group-additional-parameters",
    "title": "\n2  Demographics and Baseline Anthropometrics\n",
    "section": "\n2.5 Tab 08 04 - Post-hoc: Demographics and Baseline Anthropometrics by Diabetes Group (additional parameters)",
    "text": "2.5 Tab 08 04 - Post-hoc: Demographics and Baseline Anthropometrics by Diabetes Group (additional parameters)\n\nShow the codetab_08_04_raw <- ads |>\n  subset(\n    ! paramcd %in% c(\n      \"age\", \"trainn\", \"GLU0\", \"GLU30\", \"GLU60\", \"GLU120\",\n      \"INSULIN0\", \"INSULIN30\", \"INSULIN60\", \"INSULIN120\",\n      \"HBA1C\", \"HOMAB\", \"HOMAIR\", \"MATSUDA\",\n      \"TRIG\", \"CHOL\", \"LDL\", \"HDL\", \"VO2MAXE\", \"WEIGHT\", \"BMI\",\n      \"FATMASS\", \"BODYFATP\", \"LEANMASS\", \"VAT\"\n    )\n  ) |>\n  (\\(x) split(x, f = x$paramcd, drop = TRUE))() |>\n  lm_by_paramcd(indep_var = \"diabcd\") |>\n  lsm_pairs_by_param(indep_var = \"diabcd\") |>\n  (\\(x) Reduce(rbind, x))()\n\nlibrary(tidyr)\ntab_08_04 <- tab_08_04_raw |>\n  subset(select = c(\n    paramcd, contrast, estimate, SE, df, p.value, lower.CL, upper.CL\n  ))\n\nlibrary(flextable)\ntab_08_04_ft <- tab_08_04 |>\n  (\\(x) split(x, f = x$paramcd))() |>\n  lapply(\n    \\(x) {\n      x$p.value <- format(round(x$p.value, 5))\n      x$estimate <- format(signif(x$estimate, 5))\n      x$SE <- format(signif(x$SE, 6))\n      x$lower.CL <- format(signif(x$lower.CL, 5))\n      x$upper.CL <- format(signif(x$upper.CL, 5))\n      x\n    }) |>\n  (\\(x) Reduce(rbind, x))()|>\n  flextable() |>\n  fontsize(size = 9, part = \"all\") |>\n  autofit() |>\n  add_header_lines(\n    \"Analysis Set: Full Analysis Set - Observed Cases at baseline\"\n  ) |>\n  set_caption(\n    caption = wrap_long_lines(\n      \"Tab 08 04 - Post-hoc tests for the Analysis of Variance of\n      Demographics and Baseline Anthropometrics by Diabetes Group\"\n    )\n  ) |>\n  footnote(\n    value = as_paragraph(wrap_long_lines(\n      \"CL, 95% Confidence Limit; SE, Standard Error.\"\n    )),\n    ref_symbols = \"\"\n  ) |>\n  footnote(\n    value = as_paragraph(wrap_long_lines(\n      \"Note: P value adjustment by Tukey's method for comparing a family of\n      3 estimates.\"\n    )),\n    ref_symbols = \"\"\n  )|>\n  footnote(\n    value = as_paragraph(wrap_long_lines(\n      \"Source: ADSL and ADVS/ADLB observed cases at\n      baseline.\"\n    )),\n    ref_symbols = \"\"\n  ) |>\n  theme_booktabs()\n\ntab_08_04_ft\n\n\n\nShow the codebnm <- \"tab_08_04\"\ndir_tab <- params$paths$tab\ndir_dta <- params$paths$dta\n\nfile.path(dir_tab, paste0(bnm, \"_ft.RData\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save(tab_08_04_ft, file = .)\n\n[output] Table saved as ../tlg/tables/tab_08_04_ft.RData\n\nShow the codefile.path(dir_dta, paste0(bnm, \".RData\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save(tab_08_04, file = .)\n\n[output] Table saved as ../data/tab_08_04.RData\n\nShow the codefile.path(dir_tab, paste(bnm, sep = \".\", \"docx\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save_as_docx(tab_08_04_ft, path = .)\n\n[output] Table saved as ../tlg/tables/tab_08_04.docx\n\nShow the codefile.path(dir_tab, paste(bnm, sep = \".\", \"html\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save_as_html(tab_08_04_ft, path = .)\n\n[output] Table saved as ../tlg/tables/tab_08_04.html\n\nShow the codefile.path(dir_dta, paste(bnm, sep = \".\", \"csv\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  write.csv(tab_08_04, file = ., row.names = FALSE)\n\n[output] Table saved as ../data/tab_08_04.csv"
  },
  {
    "objectID": "t2d_08_dmg.html#session-informations",
    "href": "t2d_08_dmg.html#session-informations",
    "title": "\n2  Demographics and Baseline Anthropometrics\n",
    "section": "\n2.6 Session Informations",
    "text": "2.6 Session Informations\n\nShow the codesessioninfo::session_info()\n\n\n\n\n\n\n\n\nFox, John, and Sanford Weisberg. 2019. An R Companion to Applied Regression. Third. Thousand Oaks CA: Sage. https://socialsciences.mcmaster.ca/jfox/Books/Companion/.\n\n\nGohel, David. 2022. Flextable: Functions for Tabular Reporting.\n\n\nLenth, Russell V. 2022. Emmeans: Estimated Marginal Means, Aka Least-Squares Means. https://github.com/rvlenth/emmeans.\n\n\nR Core Team. 2022. R: A Language and Environment for Statistical Computing. Vienna, Austria: R Foundation for Statistical Computing. https://www.R-project.org/.\n\n\nWickham, Hadley, and Maximilian Girlich. 2022. Tidyr: Tidy Messy Dataversion."
  },
  {
    "objectID": "t2d_09_chg.html",
    "href": "t2d_09_chg.html",
    "title": "\n3  Anthropometrics Changes From Baseline\n",
    "section": "",
    "text": "Diabetes group estimations in anthropometrics changes from baseline were obtained and tested by analysis of covariance models (Ancova), relying once more on the Fisher test; to increase accuracy and statistical power, estimations were adjusted for baseline values (Vickers 2001; Van Breukelen 2006; Committee for Medicinal Products for Human Use (CHMP) 2015; O’Connell et al. 2017).\nThe analysis was realized with R (v4.2.0, R Core Team 2022). Note the use of the additional packages downloaded from the RStudio package manager repository (freeze date 2022-05-04, repos):\n\n\ncar for regression model test (version 3.0-13, Fox and Weisberg 2019)\n\n\nemmeans for least-Squares Means (LSM) estimations (version 1.7.3, Lenth 2022)\n\n\nflextable for output table formatting (version 0.7.0, Gohel 2022)\n\n\ntidyr for data wrangling (version 1.2.0, Wickham and Girlich 2022)."
  },
  {
    "objectID": "t2d_09_chg.html#settings",
    "href": "t2d_09_chg.html#settings",
    "title": "\n3  Anthropometrics Changes From Baseline\n",
    "section": "\n3.2 Settings",
    "text": "3.2 Settings\n\nShow the codecfg_prog <- yaml::read_yaml(\"_prog.yml\")\ndevtools::load_all(\"src/pkg/dbs.data\")\n\nℹ Loading dbs.data\n\nShow the codedevtools::load_all(\"src/pkg/latarnia.utils\")\n\nℹ Loading latarnia.utils\nLoading required package: grid\n\nLoading required package: shiny\n\nShow the codesource(\"R/inches.R\")\n\nknitr::opts_chunk$set(results = cfg_prog$knitr$results)"
  },
  {
    "objectID": "t2d_09_chg.html#data",
    "href": "t2d_09_chg.html#data",
    "title": "\n3  Anthropometrics Changes From Baseline\n",
    "section": "\n3.3 Data",
    "text": "3.3 Data\n\nShow the codeadsl <- dbs.data::adsl\nadvs <- dbs.data::advs\nadlb <- dbs.data::adlb\n\n\n\nShow the codeads <- adlb |>\n  rbind(advs) |>\n  subset(basetype == \"\" & avisit != \"Baseline\") |>\n  subset(select = c(subjid, paramcd, avisit, base, chg)) |>\n  (\\(x) merge(x = adsl[c(\"subjid\", \"diabcd\")], y = x, by = \"subjid\"))() |>\n  (\\(df, fct = \"diabcd\") {\n    df[paste0(fct, \"_n\")] <- factor_n(df, fct, id = \"subjid\", sep = \" \")\n    df\n  })()\n\nhead(ads)"
  },
  {
    "objectID": "t2d_09_chg.html#helper-functions",
    "href": "t2d_09_chg.html#helper-functions",
    "title": "\n3  Anthropometrics Changes From Baseline\n",
    "section": "\n3.4 Helper functions",
    "text": "3.4 Helper functions\n\nShow the codeformat_pval <- function(x) {\n  p <- round(x, 5)\n  ifelse(\n    test = p < 0.0001,\n    yes = \"<0.0001\",\n    no = ifelse(\n      test = p < 0.001,\n      yes = format(round(p, 4), nsmall = 4),\n      no = ifelse(\n        test = p < 0.01,\n        yes = format(round(p, 3), nsmall = 3),\n        no = format(round(p, 2), nsmall = 2)\n      )\n    )\n  )\n}\n\nlm_by_paramcd <- function(x,\n                          dep_var = \"aval\",\n                          indep_var = \"diabcd_n\",\n                          covariate = NULL) {\n  \n  formula <- paste(\n    dep_var, \"~\", \n    if (!is.null(covariate)) paste(covariate, \"+\"),\n    indep_var\n  )\n  formula <- as.formula(formula)\n  \n  lapply(x, \\(x) list(data = x, lm = lm(formula, data = x)))\n}\n\nmake_specs <- function(var) as.formula(paste(\"~\", var))\nlsm_by_param <- function(x, indep_var = \"diabcd_n\") {\n  lapply(\n    x,\n    \\(x) {\n      mod_em <- emmeans::emmeans(x$lm, specs = make_specs(indep_var))\n      y <- as.data.frame(mod_em)\n      cbind(\n        paramcd = unique(x$data$paramcd),\n        y,\n        diabcd_f = car::Anova(x$lm)[indep_var, \"Pr(>F)\"]\n      )\n    }\n  )\n}"
  },
  {
    "objectID": "t2d_09_chg.html#tab-09-01---ancova---anthropometrics-changes-from-baseline-by-diabetes-group",
    "href": "t2d_09_chg.html#tab-09-01---ancova---anthropometrics-changes-from-baseline-by-diabetes-group",
    "title": "\n3  Anthropometrics Changes From Baseline\n",
    "section": "\n3.5 Tab 09 01 - Ancova - Anthropometrics Changes from Baseline by Diabetes Group",
    "text": "3.5 Tab 09 01 - Ancova - Anthropometrics Changes from Baseline by Diabetes Group\n\nShow the codetab_09_01_raw <- ads |>\n  (\\(x) split(x, f = x$paramcd))() |>\n  lm_by_paramcd(dep_var = \"chg\", covariate = \"base\", indep_var = \"diabcd_n\") |>\n  lsm_by_param(indep_var = \"diabcd_n\") |>\n  (\\(x) Reduce(rbind, x))()\n\ntab_09_01 <- tab_09_01_raw |>\n  (\\(df) df[order(df$diabcd_n), ])() |>\n  within({\n    val <- paste0(\n      signif(emmean, 3),\n      \" (\", signif(lower.CL, 3), \", \", signif(upper.CL, 3), \")\"\n    )\n    pval <- format_pval(diabcd_f)\n  }) |>\n  tidyr::pivot_wider(\n    id_cols = c(\"paramcd\", \"pval\", \"diabcd_f\"),\n    values_from = \"val\",\n    names_from = \"diabcd_n\"\n  ) |>\n  (\\(x) x[order(x$diabcd_f), ])()\ntab_09_01\n\n\n\nShow the codelibrary(flextable)\n\n\nAttaching package: 'flextable'\n\n\nThe following objects are masked from 'package:latarnia.utils':\n\n    add_footer, add_header\n\nShow the codewrap_line <- function(x) paste(strwrap(x, width = 80), collapse = \" \")\ntab_09_01_ft <- tab_09_01 |>\n  subset(select = -diabcd_f) |>\n  flextable() |>\n  autofit() |>\n  footnote(\n    part = \"header\",\n    i = 1, j = 2,\n    value = as_paragraph(\n      \"Note: pval, p value of diabetes group effect test by F test.\"\n    ),\n    ref_symbols = \"a\"\n  ) |>\n  add_footer_lines(c(\n    wrap_line(\"Source: Full Analysis Set, observed cases at baseline and post\n    intervention.\"),\n    \"Note: rows are ordered by increasing p values, most significant on top.\"\n  )) |>\n  add_header_lines(\"Analysis Set: Full Analysis Set - Observed Cases\") |>\n  set_caption(\n    caption =  wrap_long_lines(\n      \"Tab 09 01 - Analysis of Covariance / Least Means Square estimations of\n      Anthropometrics Changes from Baseline by Diagnosis Group at\n      Month 3 (95% Confidence Interval) Adjusted for Baseline\"\n    )\n  ) |>\n  theme_booktabs()\ntab_09_01_ft\n\n\n\nShow the codebnm <- \"tab_09_01\"\ndir_tab <- cfg_prog$paths$tab\ndir_dta <- cfg_prog$paths$dta\n\nfile.path(dir_tab, paste0(bnm, \"_ft.RData\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save(tab_09_01_ft, file = .)\n\n[output] Table saved as ../tlg/tables/tab_09_01_ft.RData\n\nShow the codefile.path(dir_dta, paste0(bnm, \".RData\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save(tab_09_01, file = .)\n\n[output] Table saved as ../data/tab_09_01.RData\n\nShow the codefile.path(dir_tab, paste(bnm, sep = \".\", \"docx\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save_as_docx(tab_09_01_ft, path = .)\n\n[output] Table saved as ../tlg/tables/tab_09_01.docx\n\nShow the codefile.path(dir_tab, paste(bnm, sep = \".\", \"html\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  save_as_html(tab_09_01_ft, path = .)\n\n[output] Table saved as ../tlg/tables/tab_09_01.html\n\nShow the codefile.path(dir_dta, paste(bnm, sep = \".\", \"csv\")) %T>%\n  message(\"[output] Table saved as \", .) %>%\n  write.csv(tab_09_01, file = ., row.names = FALSE)\n\n[output] Table saved as ../data/tab_09_01.csv\n\n\n\nShow the codedetach(package:flextable)"
  },
  {
    "objectID": "t2d_09_chg.html#example-glucose-120---fig-09-01",
    "href": "t2d_09_chg.html#example-glucose-120---fig-09-01",
    "title": "\n3  Anthropometrics Changes From Baseline\n",
    "section": "\n3.6 Example: Glucose 120 - Fig 09 01",
    "text": "3.6 Example: Glucose 120 - Fig 09 01\n\nShow the codelibrary(ggplot2)\ndta <- dbs.data::adlb |>\n  subset(\n    paramcd == \"GLU120\" &\n      dtype == \"\" &\n      avisit == \"Month 3\" &\n      basetype == \"\"\n  ) |>\n  merge(x = adsl[c(\"subjid\", \"diabcd\")], y = _, by = \"subjid\")\n\ndta$lm_pred <- predict(lm(aval ~ base, data = dta))\nlim <- range(c(dta$aval, dta$base))\n\ngg1 <- ggplot(dta, aes(base, aval, color = diabcd)) +\n  geom_point() +\n  ylab(\"Post exercise intervention\") +\n  xlab(\"Baseline\") +\n  geom_segment(aes(xend = base, yend = lm_pred)) + \n  geom_smooth(method = \"lm\", se = FALSE, color = \"black\", linetype = 1) +\n  scale_color_viridis_d(begin = .1, end = .9, direction = -1) +\n  coord_cartesian(xlim = lim, ylim = lim) +\n  theme_minimal() +\n  theme(legend.position = \"top\")\n\ngg2 <- ggplot(dta, aes(base, fill = diabcd, color = diabcd)) +\n  geom_boxplot(alpha = .5, show.legend = FALSE) +\n  coord_cartesian(xlim = lim) +\n  ylab(\"diabcd\") +\n  scale_color_viridis_d(begin = .1, end = .9, direction = -1) +\n  scale_fill_viridis_d(begin = .1, end = .9, direction = -1) +\n  theme_minimal() +\n  theme(\n    legend.position = \"top\",\n    axis.title.x = element_blank(),\n    axis.text.y = element_blank(),\n    panel.grid = element_blank()\n  )\n\ngg <- cowplot::plot_grid(\n  gg1, gg2,\n  nrow = 2,\n  align = \"v\",\n  rel_heights = c(1, .15)\n)\n\n`geom_smooth()` using formula 'y ~ x'\n\nShow the codep <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 9.1\",\n      strwrap(\n        \"Scatter plot - Glucose 120 at Month 3 in relation to Baseline by\n        treatment group\", width = 80\n      ),\n      \"Analysis Set: Full Analysis Set - Observed Cases\"\n    )\n  ) |>\n  add_figure(gg, height = inches(5.5), width = inches(4.5))|>\n  add_note(c(\n    \"Note: the table prog 08 output 01 focuses on the x-axis and check for\n     differences at baseline, the boxplots gives an overview of these\n     baseline variation.\",\n    \"Note: the table tab prog 09 output 01 shows the effect of exercise in\n     each group. The p.values is provided and accounts for the diagnostic group\n     effect, while taking into account the fact that the higher the value at\n     baseline, the higher after the exercise intervention. Actually, \n     the analysis of covariance model focus on how much above or below the\n     general regression (black line) is positionned a diagnosis group.\n     E.g., +20 for T2D indicates that the result after exercise is 20 units\n     higher than expected if there were no diagnostic group effect; ... however,\n     the confidence interval extend from -13.5 and +53.8 which means that\n     i) if we repeated the study, 100 times, it would result 95 times from\n     -13.5 to 53.8\n     ii) the interval includes 0 so we can't conclude to a significant\n     increase or decrease in Glucose 120 due to the exercise intervention.\"\n  )) |>\n  add_footer(\n    c(\n      \"Program t2d_09_chg / Env ayup_dbs:v0.1.0-alpha\",\n      format(Sys.time(), format = \"%Y-%m-%d %H:%M (%Z)\")\n    ),\n    cfg_prog$version\n  )\n\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, \"fig_09_01.pdf\"),\n  file_graph_alone = file.path(cfg_prog$paths$grh, \"fig_09_01_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_09_01.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_09_01_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)"
  },
  {
    "objectID": "t2d_09_chg.html#session-informations",
    "href": "t2d_09_chg.html#session-informations",
    "title": "\n3  Anthropometrics Changes From Baseline\n",
    "section": "\n3.7 Session Informations",
    "text": "3.7 Session Informations\n\nShow the codesessioninfo::session_info()"
  },
  {
    "objectID": "t2d_09_chg.html#untidied-information-about-analysis-of-change-from-baseline",
    "href": "t2d_09_chg.html#untidied-information-about-analysis-of-change-from-baseline",
    "title": "\n3  Anthropometrics Changes From Baseline\n",
    "section": "\n3.8 Untidied information about analysis of change from baseline",
    "text": "3.8 Untidied information about analysis of change from baseline\nQuestions: for the analysis of a post-treatment values, should we analyse the change from baseline or percentage change from baseline? Should we adjust for the baseline?\nBack to 2003, in the context of randomized clinical trial, the European Medicines Agency (COMMITTEE FOR PROPRIETARY MEDICINAL PRODUCTS 2003), when the endpoint is studied as a change from baseline, the adjustment for baseline improves the accuracy in comparison to non-baseline adjustment; estimates becomes also equivalent to the standard linear model, the choice of change from baseline analysis or raw value is then only a question of interpretability. They renewed the recommendation in 2015 (Committee for Medicinal Products for Human Use (CHMP) 2015).\nFrom the academic side, the topic was repeatedly studied:\n\nVan Breukelen (2006): > “In randomized studies both methods [Anova, no BL adjustment vs Ancova] > are unbiased, but ANCOVA has more power”\nLiu et al. (2009) also highlighted the benefits of adjustment for baseline as a covariate.\nthis was later confirmed by Zhang et al. (2014).\nMore recently O’Connell et al. (2017) also defended the superiority of the Ancova-change: \\(y_i = \\beta_0 + \\beta_1 X_i + \\beta_2 Y_{0i,=BL} + \\varepsilon_i\\)\n\n\n_“Consistent with existing literature, our results demonstrate that each method leads to unbiased treatment effect estimates, and based on precision of estimates, 95% coverage probability, and power, ANCOVA modeling of either change scores or post-treatment score as the outcome, prove to be the most effective._”\n\nMost of the authors above are specifically working on randomized trial, Vickers (2001) also brought some light on the topic, and highlighted in addition that: working with percentage change is generally a bad idea. The extended to a theoretical works also indicated that the percentage change from baseline “will also fail to protect from bias in the case of baseline imbalance and will lead to an excess of trials with non-normally distributed outcome data”.\n\n\n\n\n\n\nCommittee for Medicinal Products for Human Use (CHMP). 2015. “Guideline on Adjustment for Baseline Covariates in Clinical Trials.” European Medicines Agency. https://www.ema.europa.eu/en/documents/scientific-guideline/guideline-adjustment-baseline-covariates-clinical-trials_en.pdf.\n\n\nCOMMITTEE FOR PROPRIETARY MEDICINAL PRODUCTS. 2003. “POINTS TO CONSIDER ON ADJUSTMENT FOR BASELINE COVARIATES.” The European Agency for the Evaluation of Medicinal Products Evaluation of Medicines for Human Use. https://www.ema.europa.eu/en/documents/scientific-guideline/points-consider-adjustment-baseline-covariates_en.pdf.\n\n\nFox, John, and Sanford Weisberg. 2019. An R Companion to Applied Regression. Third. Thousand Oaks CA: Sage. https://socialsciences.mcmaster.ca/jfox/Books/Companion/.\n\n\nGohel, David. 2022. Flextable: Functions for Tabular Reporting.\n\n\nLenth, Russell V. 2022. Emmeans: Estimated Marginal Means, Aka Least-Squares Means. https://github.com/rvlenth/emmeans.\n\n\nLiu, Guanghan F, Kaifeng Lu, Robin Mogg, Madhuja Mallick, and Devan V Mehrotra. 2009. “Should Baseline Be a Covariate or Dependent Variable in Analyses of Change from Baseline in Clinical Trials?” Statistics in Medicine 28 (20): 2509–30. https://doi.org/10.1002/sim.3639.\n\n\nO’Connell, Nathaniel S, Lin Dai, Yunyun Jiang, Jaime L Speiser, Ralph Ward, Wei Wei, Rachel Carroll, and Mulugeta Gebregziabher. 2017. “Methods for Analysis of Pre-Post Data in Clinical Research: A Comparison of Five Common Methods.” Journal of Biometrics & Biostatistics 8 (1): 1. https://doi.org/10.4172/2155-6180.1000334.\n\n\nR Core Team. 2022. R: A Language and Environment for Statistical Computing. Vienna, Austria: R Foundation for Statistical Computing. https://www.R-project.org/.\n\n\nVan Breukelen, G. 2006. “ANCOVA Versus Change from Baseline: More Power Inrandomized Studies, More Bias in Nonrandomized Studies.” Journal of ClinicalEpidemiology, 59–920. https://doi.org/10.1016/j.jclinepi.2006.02.007.\n\n\nVickers, Andrew J. 2001. “The Use of Percentage Change from Baseline as an Outcome in a Controlled Trial Is Statistically Inefficient: A Simulation Study.” BMC Medical Research Methodology 1 (1): 1–4. https://doi.org/10.1186/1471-2288-1-6.\n\n\nWickham, Hadley, and Maximilian Girlich. 2022. Tidyr: Tidy Messy Dataversion.\n\n\nZhang, Shiyuan, James Paul, Manyat Nantha-Aree, Norman Buckley, Uswa Shahzad, Ji Cheng, Justin DeBeer, et al. 2014. “Empirical Comparison of Four Baseline Covariate Adjustment Methods in Analysis of Continuous Outcomes in Randomized Controlled Trials.” Clinical Epidemiology 6: 227. https://doi.org/10.2147/clep.s56554."
  },
  {
    "objectID": "t2d_06_rna.html",
    "href": "t2d_06_rna.html",
    "title": "\n4  RNASeq - Refresher\n",
    "section": "",
    "text": "Show the codeparams <- yaml::read_yaml(\"_prog.yml\")"
  },
  {
    "objectID": "t2d_06_rna.html#rna-seq---local-study-of-confounder-adjustments-impact",
    "href": "t2d_06_rna.html#rna-seq---local-study-of-confounder-adjustments-impact",
    "title": "\n4  RNASeq - Refresher\n",
    "section": "\n4.1 RNA Seq - Local Study of Confounder Adjustment’s Impact",
    "text": "4.1 RNA Seq - Local Study of Confounder Adjustment’s Impact\nTarget:\n\n\n\nrefresh the differential expression analysis technics with DESeq2.\n\n\nupgrade environment for differential expression analysis.\n\n\nevaluate the impact of confounder adjustment on a specific use case: compare miRNA expression between T2D and NGT at baseline.\n\n\nShow the codedevtools::load_all(\"src/pkg/dbs.data\")\n\nℹ Loading dbs.data\n\nShow the codedevtools::load_all(\"src/pkg/latarnia.utils\")\n\nℹ Loading latarnia.utils\nLoading required package: grid\n\nLoading required package: shiny\n\nShow the codeknitr::opts_chunk$set(results = params$knitr$results)\nlibrary(assertthat)\nsource(\"R/ngs.R\")\n\n\n\n4.1.1 Data preparation\n\nShow the codeadsl <- dbs.data::adsl\nadvs <- dbs.data::advs\nadlb <- dbs.data::adlb\n\n#' Subjid and Visit to Sample\n#' \nsubjvis_to_spl <- function(df) paste0(df$subjid, \"v\", df$avisitn)\n\nads <- adlb |>\n  subset(\n    paramcd %in% c(\n      \"CHOL\", \"HBA1C\", \"HDL\", \"HOMAB\", \"HOMAIR\", \"LDL\", \"MATSUDA\", \"TRIG\"\n    )\n  ) %>%\n  rbind(advs) |>\n  subset(select = -c(ct, dtype, param, base, basetype, chg, pchg)) |>\n  tidyr::pivot_wider(names_from = \"paramcd\", values_from = \"aval\") |>\n  (\\(df) merge(adsl, df, by = \"subjid\"))() |>\n  (\\(df) S4Vectors::DataFrame(df, row.names = subjvis_to_spl(df)))() |>\n  (\\(df) {\n    assertthat::assert_that(all(table(subjvis_to_spl(df)) == 1))\n    df\n  })()\n\nads\n\n\n\nShow the coderna <- list(# There will be mi-RNA data.\n  mrna = dbs.data::mrna_raw,\n  premirna = dbs.data::premirna_raw,\n  mirna = dbs.data::mirna_raw\n)\n\nrna[c(\"premirna\", \"mirna\")] <- lapply(\n  X = rna[c(\"premirna\", \"mirna\")],\n  FUN = format_mirna\n)\n\n# Rows represent genes.\nrna <- lapply(X = rna, FUN = function(x) y <- x[rowSums(x) > 0, ])\nrna <- lapply(X = rna, as.matrix)\nassertthat::assert_that(all(colnames(rna$premirna) == colnames(rna$mirna)))\nrna$allmirna <- rbind(rna$premirna, rna$mirna)\nlibrary(testthat)\ntest_that(\"rna features discriminated in noexpr, expr\", {\n  lapply(\n    X = rna,\n    FUN = function(x) expect_true(all(rowSums(x) > 0))\n  )\n})\n\n\n\nShow the codelibrary(MultiAssayExperiment)\n\nLoading required package: SummarizedExperiment\n\n\nLoading required package: MatrixGenerics\n\n\nLoading required package: matrixStats\n\n\n\nAttaching package: 'MatrixGenerics'\n\n\nThe following objects are masked from 'package:matrixStats':\n\n    colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse,\n    colCounts, colCummaxs, colCummins, colCumprods, colCumsums,\n    colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs,\n    colMads, colMaxs, colMeans2, colMedians, colMins, colOrderStats,\n    colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds,\n    colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads,\n    colWeightedMeans, colWeightedMedians, colWeightedSds,\n    colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet,\n    rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods,\n    rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,\n    rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins,\n    rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks,\n    rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars,\n    rowWeightedMads, rowWeightedMeans, rowWeightedMedians,\n    rowWeightedSds, rowWeightedVars\n\n\nLoading required package: GenomicRanges\n\n\nLoading required package: stats4\n\n\nLoading required package: BiocGenerics\n\n\n\nAttaching package: 'BiocGenerics'\n\n\nThe following objects are masked from 'package:stats':\n\n    IQR, mad, sd, var, xtabs\n\n\nThe following objects are masked from 'package:base':\n\n    anyDuplicated, append, as.data.frame, basename, cbind, colnames,\n    dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep,\n    grepl, intersect, is.unsorted, lapply, Map, mapply, match, mget,\n    order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,\n    rbind, Reduce, rownames, sapply, setdiff, sort, table, tapply,\n    union, unique, unsplit, which.max, which.min\n\n\nLoading required package: S4Vectors\n\n\n\nAttaching package: 'S4Vectors'\n\n\nThe following objects are masked from 'package:base':\n\n    expand.grid, I, unname\n\n\nLoading required package: IRanges\n\n\nLoading required package: GenomeInfoDb\n\n\nLoading required package: Biobase\n\n\nWelcome to Bioconductor\n\n    Vignettes contain introductory material; view with\n    'browseVignettes()'. To cite Bioconductor, see\n    'citation(\"Biobase\")', and for packages 'citation(\"pkgname\")'.\n\n\n\nAttaching package: 'Biobase'\n\n\nThe following object is masked from 'package:MatrixGenerics':\n\n    rowMedians\n\n\nThe following objects are masked from 'package:matrixStats':\n\n    anyMissing, rowMedians\n\nShow the code#' (Sample-)Map Arrays\n#'\n#' Use the colnames of `x` to deduce the `primary` and `colnames`.\n#' This is used to generate the sample mapping between colData and Experiments.\n#'\n#' @param x (`dataframe`).\n#'\n#' @note In our case, primary and colnames are equivalent, colnames could\n#' be different from primary names when a biological sample has different\n#' names in the biological assays (e.g. machine constraint, technical\n#' repetitions).\n#'\n#' @seealso [MultiAssayExperiment::listToMap()]\n#' @examples\n#' \\dontrun{\n#' lapply(rna, map_arrays)\n#' MultiAssayExperiment::listToMap(lapply(rna, map_arrays))\n#' }\n#'\nmap_arrays <- function(x) {\n  y <- data.frame(colname = colnames(x))\n  y$primary <- y$colname\n  y\n}\n\nbesd_mae <- MultiAssayExperiment(\n  experiments = ExperimentList(rna),\n  colData = ads,\n  sampleMap = listToMap(lapply(rna, map_arrays))\n)\n\nbesd_mae"
  },
  {
    "objectID": "t2d_06_rna.html#de-baseline-all-micro-rna-no-confounding-factor-dds_1",
    "href": "t2d_06_rna.html#de-baseline-all-micro-rna-no-confounding-factor-dds_1",
    "title": "\n4  RNASeq - Refresher\n",
    "section": "\n4.2 DE: Baseline, all micro RNA, no confounding factor (dds_1)",
    "text": "4.2 DE: Baseline, all micro RNA, no confounding factor (dds_1)\n\nShow the codectrl <- yaml::read_yaml(\"_prog.yml\")$rna\n\nngs_assay <- \"allmirna\"\n\nfilter_for_depth <- function(mae, assay, depth_threshold) {\n  mae[, colSums(mae[[ngs_assay]]) > depth_threshold, ]\n}\n\nfilter_for_visit <- function(mae, visit) {\n  mae[, colData(mae)$avisit == visit, ]\n}\n\nfilter_for_low_expr <- function(mae, assay, cpm_threshold, frac_cols = 1 / 2) {\n  # Genes expressed at least cpm_threshold in frac_cols columns\n  mae[\n    rowSums(cpm(mae[[assay]]) > cpm_threshold) >\n      ncol(mae[[assay]]) * frac_cols,\n    ,\n  ]\n}\n\nads <- besd_mae |>\n  (\\(mae) mae[ , , ngs_assay])() |>\n  filter_for_depth(\"allmirna\", ctrl$depth_threshold[[ngs_assay]]) |>\n  filter_for_visit(\"Baseline\") |>\n  filter_for_low_expr(\"allmirna\", ctrl$cpm_threshold[[ngs_assay]])\n\nWarning: 'experiments' dropped; see 'metadata'\n\n\nharmonizing input:\n  removing 282 sampleMap rows not in names(experiments)\n\nShow the codeads\n\ndds_1 <- DESeq2::DESeqDataSetFromMatrix(\n  countData = ads[[ngs_assay]],\n  colData = colData(ads),\n  design = stats::formula(~ diabcd)\n)\n\ndds_1_res <- DESeq2::DESeq(\n  object = dds_1,\n  quiet = FALSE, # default: FALSE\n  minReplicatesForReplace = 7, # default: 7\n  useT = FALSE, # default: FALSE\n  minmu = 0.5, # default: 0.5\n  parallel = TRUE,\n  BPPARAM = BiocParallel::bpparam()\n)\n\nestimating size factors\n\n\nestimating dispersions\n\n\ngene-wise dispersion estimates: 2 workers\n\n\nmean-dispersion relationship\n\n\n-- note: fitType='parametric', but the dispersion trend was not well captured by the\n   function: y = a/x + b, and a local regression fit was automatically substituted.\n   specify fitType='local' or 'mean' to avoid this message next time.\n\n\nfinal dispersion estimates, fitting model and testing: 2 workers\n\n\n-- replacing outliers and refitting for 13 genes\n-- DESeq argument 'minReplicatesForReplace' = 7 \n-- original counts are preserved in counts(dds)\n\n\nestimating dispersions\n\n\nfitting model and testing\n\nShow the codedds_1_de <- DESeq2::results(\n  dds_1_res,\n  contrast = c(\"diabcd\", test = \"T2D\", ref = \"NGT\"),\n  pAdjustMethod = ctrl$adj_meth\n) |>\n  (\\(df) {\n    df$feature <- rownames(df)\n    df\n  }) () |>\n  within(log_padj <- -1 * log10(padj))\n\nlibrary(ggplot2)\ndds_1_gg <-\n  dds_1_de |> as.data.frame() |>\n  ggplot(mapping = aes(log2FoldChange, log_padj, fill = log10(..count..))) +\n  geom_hline(yintercept = -1 * log10(c(0.05, 0.001)), lty = 2, lwd = .5) +\n  geom_vline(xintercept = c(-1, 1), lty = 2) +\n  annotate(\n    geom  = \"label\", x = -Inf, y = -1 * log10(0.05),\n    label = \"p = 0.05\",\n    fill = \"white\", hjust = \"left\", size = 2, alpha = 1\n  ) +\n  annotate(\n    geom  = \"label\", x = -Inf, y = -1 * log10(0.001),\n    label = \"p = 0.001\",\n    fill = \"white\", hjust = \"left\", size = 2, alpha = 1\n  ) +\n  xlab(\"Log2-fold-change\") +\n  ylab(expression(-1 %*% log10(padj))) +\n  stat_bin_hex() +\n  scale_fill_gradient(low = \"black\", high = \"gray90\") +\n  theme_minimal() +\n  theme(legend.position = \"bottom\", asp = 2 / 3)\n\n\n\nShow the codedds_1_gg"
  },
  {
    "objectID": "t2d_06_rna.html#de-baseline-all-micro-rna-accounting-for-age-bmi-dcal-trainn-dds_2",
    "href": "t2d_06_rna.html#de-baseline-all-micro-rna-accounting-for-age-bmi-dcal-trainn-dds_2",
    "title": "\n4  RNASeq - Refresher\n",
    "section": "\n4.3 DE: Baseline, all micro RNA, accounting for Age, BMI, DCAL, Trainn (dds_2)",
    "text": "4.3 DE: Baseline, all micro RNA, accounting for Age, BMI, DCAL, Trainn (dds_2)\n\nShow the codectrl <- yaml::read_yaml(\"_prog.yml\")$rna\n\nngs_assay <- \"allmirna\"\n\nfilter_for_depth <- function(mae, assay, depth_threshold) {\n  mae[, colSums(mae[[ngs_assay]]) > depth_threshold, ]\n}\n\nfilter_for_visit <- function(mae, visit) {\n  mae[, colData(mae)$avisit == visit, ]\n}\n\nfilter_for_low_expr <- function(mae, assay, cpm_threshold, frac_cols = 1 / 2) {\n  # Genes expressed at least cpm_threshold in frac_cols columns\n  mae[\n    rowSums(cpm(mae[[assay]]) > cpm_threshold) >\n      ncol(mae[[assay]]) * frac_cols,\n    ,\n  ]\n}\n\nscale_confounder <- function(mae, confounder) {\n  for (i in seq_along(confounder)) {\n    cfd <- confounder[i]\n    colData(mae)[cfd] <- scale(colData(mae)[cfd])\n  }\n  mae\n}\nads <- besd_mae |>\n  (\\(mae) mae[ , , ngs_assay])() |>\n  filter_for_depth(\"allmirna\", ctrl$depth_threshold[[ngs_assay]]) |>\n  filter_for_visit(\"Baseline\") |>\n  filter_for_low_expr(\"allmirna\", ctrl$cpm_threshold[[ngs_assay]]) |>\n  scale_confounder(confounder = c(\"age\", \"trainn\", \"BMI\", \"DCAL\"))\n\nWarning: 'experiments' dropped; see 'metadata'\n\n\nharmonizing input:\n  removing 282 sampleMap rows not in names(experiments)\n\nShow the codeads\n\ndds_2 <- DESeq2::DESeqDataSetFromMatrix(\n  countData = ads[[ngs_assay]],\n  colData = colData(ads),\n  design = stats::formula(~ age + BMI + trainn + DCAL + diabcd)\n)\n\ndds_2_res <- DESeq2::DESeq(\n  object = dds_2,\n  quiet = FALSE, # default: FALSE\n  minReplicatesForReplace = 7, # default: 7\n  useT = FALSE, # default: FALSE\n  minmu = 0.5, # default: 0.5\n  parallel = TRUE,\n  BPPARAM = BiocParallel::bpparam()\n)\n\nestimating size factors\n\n\nestimating dispersions\n\n\ngene-wise dispersion estimates: 2 workers\n\n\nmean-dispersion relationship\n\n\n-- note: fitType='parametric', but the dispersion trend was not well captured by the\n   function: y = a/x + b, and a local regression fit was automatically substituted.\n   specify fitType='local' or 'mean' to avoid this message next time.\n\n\nfinal dispersion estimates, fitting model and testing: 2 workers\n\nShow the codedds_2_de <- DESeq2::results(\n  dds_2_res,\n  contrast = c(\"diabcd\", test = \"T2D\", ref = \"NGT\"),\n  pAdjustMethod = ctrl$adj_meth\n) |>\n  (\\(df) {\n    df$feature <- rownames(df)\n    df\n  }) () |>\n  within(log_padj <- -1 * log10(padj))\n\nlibrary(ggplot2)\ndds_2_gg <-\n  dds_2_de |> as.data.frame() |>\n  ggplot(mapping = aes(log2FoldChange, log_padj, fill = log10(..count..))) +\n  geom_hline(yintercept = -1 * log10(c(0.05, 0.001)), lty = 2, lwd = .5) +\n  geom_vline(xintercept = c(-1, 1), lty = 2) +\n  annotate(\n    geom  = \"label\", x = -Inf, y = -1 * log10(0.05),\n    label = \"p = 0.05\",\n    fill = \"white\", hjust = \"left\", size = 2, alpha = 1\n  ) +\n  annotate(\n    geom  = \"label\", x = -Inf, y = -1 * log10(0.001),\n    label = \"p = 0.001\",\n    fill = \"white\", hjust = \"left\", size = 2, alpha = 1\n  ) +\n  xlab(\"Log2-fold-change\") +\n  ylab(expression(-1 %*% log10(padj))) +\n  stat_bin_hex() +\n  scale_fill_gradient(low = \"black\", high = \"gray90\") +\n  theme_minimal() +\n  theme(legend.position = \"bottom\", asp = 2 / 3)\n\n\n\nShow the codedds_2_gg"
  },
  {
    "objectID": "t2d_06_rna.html#comparison-withwithout-confounding-factors",
    "href": "t2d_06_rna.html#comparison-withwithout-confounding-factors",
    "title": "\n4  RNASeq - Refresher\n",
    "section": "\n4.4 Comparison with/without confounding factors",
    "text": "4.4 Comparison with/without confounding factors\n\nShow the codetheme_fun <- function(...) {\n  theme_minimal() +\n    theme(\n      title = element_text(size = 9),\n      text = element_text(size = 9)\n    ) +\n    theme(...)\n}\n\ngg_1_2 <- rbind(\n  within(as.data.frame(dds_1_de), facet <- \"No confounding factors\"),\n  within(as.data.frame(dds_2_de), facet <- \"~Age + BMI + DCAL + Train\")\n) |>\n  ggplot(mapping = aes(log2FoldChange, log_padj, fill = log10(..count..))) +\n  geom_hline(yintercept = -1 * log10(c(0.05, 0.001)), lty = 2, lwd = .5) +\n  geom_vline(xintercept = c(-1, 1), lty = 2) +\n  annotate(\n    geom  = \"label\", x = -Inf, y = -1 * log10(0.05),\n    label = \"p = 0.05\",\n    fill = \"white\", hjust = \"left\", size = 2, alpha = 1\n  ) +\n  annotate(\n    geom  = \"label\", x = -Inf, y = -1 * log10(0.001),\n    label = \"p = 0.001\",\n    fill = \"white\", hjust = \"left\", size = 2, alpha = 1\n  ) +\n  xlab(\"Log2-fold-change\") +\n  ylab(expression(-1 %*% log10(padj))) +\n  stat_bin_hex() +\n  scale_fill_gradient(low = \"black\", high = \"gray90\") +\n  facet_wrap(facet ~ ., ncol = 2) +\n  theme_fun(\n    legend.position = \"bottom\"\n  ) +\n  theme(\n    legend.key.width = unit(5, \"lines\"),\n    legend.key.height = unit(.8, \"lines\")\n  )\n\nres <- merge(\n  as.data.frame(dds_1_de),\n  as.data.frame(dds_2_de),\n  by = \"feature\",\n  all = TRUE,\n  suffixes = c(\".asis\", \".cfd\")\n)\n\n\nfun_label <- function(df,\n                      x = \"log2FoldChange.asis\",\n                      y = \"log2FoldChange.cfd\") {\n  cor_fun <- function(meth = \"pearson\") {\n    round(cor(df[[x]], df[[y]], method = meth), 2)\n  }\n  paste0(\n    \"atop(\",\n    \"r == \", cor_fun(), \",\",\n    \"rho == \", cor_fun(\"spearman\"),\n    \")\"\n  )\n}\n\nlim <- range(unlist(res[c(\"log2FoldChange.asis\", \"log2FoldChange.cfd\")]))\ngg_cor_lfc <- ggplot(res, aes(log2FoldChange.asis, log2FoldChange.cfd)) +\n  geom_hex() +\n  scale_fill_viridis_c(option = \"F\", begin = .1, end = .9) +\n  geom_abline(slope = 1, intercept = 0, col = \"red\") +\n  annotate(\n    \"label\", x = -Inf, y = Inf, hjust = 0, vjust = 1,\n    label = fun_label(res),\n    parse = TRUE,\n    family = \"mono\",\n    size = 3\n  )+\n  coord_cartesian(xlim = lim, ylim = lim) +\n  labs(\n    title = \"Log Fold Change (LFC)\",\n    subtitle = \"With / Without Adjustment for Confounding Factors\",\n    x = \"No Adjustment\",\n    y = \"Adjusted for Confounding Factors\"\n  ) +\n  theme_fun(asp = 1)\n\nlim <- range(unlist(res[c(\"log_padj.asis\", \"log_padj.cfd\")]))\ngg_cor_pval <- ggplot(res, aes(log_padj.asis, log_padj.cfd)) +\n  geom_hex() +\n  scale_fill_viridis_c(option = \"D\", begin = .1, end = .9) +\n  geom_abline(slope = 1, intercept = 0, col = \"green2\") +\n  annotate(\n    \"label\", x = -Inf, y = Inf, hjust = 0, vjust = 1,\n    label = fun_label(res, \"log_padj.asis\", \"log_padj.cfd\"),\n    parse = TRUE,\n    family = \"mono\",\n    size = 3\n  )+\n  coord_cartesian(xlim = lim, ylim = lim, clip = \"off\") +\n  labs(\n    title = expression(\"Significance: \"*-1 %.% log10(padj)),\n    subtitle = \"With / Without Adjustment for Confounding Factors\",\n    x = \"No Adjustment\",\n    y = \"Adjusted for Confounding Factors\"\n  ) +\n  theme_fun(asp = 1)\n\nlibrary(cowplot)\np <- plot_grid(\n  plot_grid(gg_1_2) + theme(plot.background = element_rect(color = \"black\")),\n  plot_grid(\n    plot_grid(gg_cor_lfc) +\n      theme(plot.background = element_rect(color = \"black\")),\n    plot_grid(gg_cor_pval) +\n      theme(plot.background = element_rect(color = \"black\")),\n    labels = c(\"B\", \"C\")\n  ),\n  ncol = 1, rel_heights = c(3, 2),\n  labels = c(\"A\", NA)\n)\n\n\np <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 6.1\",\n      strwrap(\n        \"Volcano plot - Level and significance of Differential Expression among\n        all miRNA at Baseline between T2D and NGT\", width = 80\n      ),\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_note(c(\n    \"A: Left panel accounts for Age, BMI, DCAL (diet) and number of trainings in\n    the estimation and test of the differential expression of every gene; it\n    may present marginal differences with the version presented 2 years ago\n    likely due to slight variations in stochastic elements (e.g. missing\n    data imputation).\",\n    \"A: Right panel discards any confounding factors.\",\n    \"B, C: Scatter plots comparing\n    the Log Fold Change estimations (B)/\n    the significance (C, the higher the more significant)\n    with (y axis) without (x axis) adjustment for confounding factors with\n    annotation corresponding to the Pearson's correlation (r) and\n    Spearman's rank correlation (rho).\",\n    \"Hexbin representation: the intensity of each hexagonal bin accounts for\n    the number of genes found in the area it covers.\"\n  )) |>\n  add_figure(p, height = .9) |>\n  add_footer(\n    \"Program t2d_06_rna / Env ayup_dbs:v0.1.0-alpha\",\n    params$version\n  )\n\nWarning: Removed 1 rows containing missing values (geom_text).\n\nShow the codeexport_as(\n  p,\n  file = file.path(params$paths$grh, \"fig_06_01.pdf\"),\n  file_graph_alone = file.path(params$paths$grh, \"fig_06_01_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_06_01.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_06_01_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)"
  },
  {
    "objectID": "t2d_06_rna.html#session-informations",
    "href": "t2d_06_rna.html#session-informations",
    "title": "\n4  RNASeq - Refresher\n",
    "section": "\n4.5 Session Informations",
    "text": "4.5 Session Informations\n\nShow the codesessioninfo::session_info()"
  },
  {
    "objectID": "t2d_07_mir.html",
    "href": "t2d_07_mir.html",
    "title": "\n5  mRNA / micro RNA\n",
    "section": "",
    "text": "Show the codecfg_prog <- yaml::read_yaml(\"_prog.yml\")\n\n\nThe variation in messenger RNA (mRNA) and micro-RNA (miRNA) abundance measured by RNA-Seq associated either with the dysglycemia and/or the 3-month exercise intervention were investigated by a Differential Expression analysis (DE). At baseline, the DE models included only the effect of the dysglycemia-constrast group, consistently with the Anova model applied for demographics and baseline anthropometrics. To do so, genetic features which were never found expressed were discarded. Then RNA-Seq libraries were included if reaching a read depth threshold (total number of reads per sample) fixed by visual examination of the association between sample gene diversity and sample depth. For the remaining libraries, genetic features were included if the count per million reads (CPM) was greater than 2 in at least 50% of the samples. The DE analysis implementation proposed by Love, Huber, and Anders (2014) with the R package DESeq2 was used to fit the models; it is based on a negative binomial distribution accounting for read variability, dispersion corrected after trends seen across all samples and genes (Dündar, Skrabanek, and Zumbo 2018). In addition, the number of tested genes being high, raw p.values were adjusted according to Benjamini and Hochberg’s method also known as False-Discovery Rate (FDR).\nThe analysis was realized with R (v4.2.0, R Core Team 2022). Note the use of the additional packages downloaded from the RStudio package manager repository (freeze date 2022-05-04, repos):\n\n\nDESeq2 for differential expression analysis and variance stabilizing transformation (version 1.36.0, Love, Huber, and Anders 2014)\n\n\nggplot2 for graphics (version 3.3.6, Wickham 2016)\n\n\nMultiAssayExperiment for management of multi-omics experiment objects (version 1.22.0, Ramos et al. 2017).\n\nTarget:\n\n\n\nmiRNA DE at baseline without confounding factors.\n\n\nmRNA DE at baseline without confounding factors.\n\n\nmiRNA DE at month 3 without confounding factors.\n\n\nmRNA DE at month 3 without confounding factors.\n\n\nmiRNA DE variation induced by the exercise intervention.\n\n\nmRNA DE variation induced by the exercise intervention.\n\n\nShow the codedevtools::load_all(\"src/pkg/dbs.data\")\n\nℹ Loading dbs.data\n\nShow the codedevtools::load_all(\"src/pkg/latarnia.utils\")\n\nℹ Loading latarnia.utils\nLoading required package: grid\n\nLoading required package: shiny\n\nShow the codeknitr::opts_chunk$set(results = cfg_prog$knitr$results)\nlibrary(assertthat)\nlibrary(ggplot2)\nsource(\"R/ngs.R\")\nsource(\"R/inches.R\")\nsource(\"R/export_xl.R\")\n\n\n\n\n\nShow the code# Help for data pre-processing\nfilter_for_depth <- function(mae, assay, min_depth) {\n  mae[, colSums(mae[[ngs_assay]]) > min_depth, ]\n}\n\nfilter_for_coldata <- function(mae, col = \"avisit\", is) {\n  mae[, colData(mae)[[col]] %in% is, ]\n}\n\nfilter_for_low_expr <- function(mae, assay, min_cpm,\n                                frac_cols = cfg_prog$rna$cpm_threshold$fraccol\n) {\n  # Genes expressed at least cpm_threshold in frac_cols columns\n  mae[\n    rowSums(cpm(mae[[assay]]) > min_cpm) >\n      ncol(mae[[assay]]) * frac_cols,\n    ,\n  ]\n}\n\n# Differential expression helper functions:\nde_by_ctrs <- function(df,\n                       ctrs,\n                       adj_meth = ctrl$adj_meth) {\n  lapply(\n    ctrs,\n    fit = df,\n    adj_meth = adj_meth,\n    FUN = function(x, fit, adj_meth) {\n      y <- DESeq2::results(fit, contrast = x, pAdjustMethod = adj_meth)\n      y$feature <- rownames(y)\n      y$log_padj <- -1 * log10(y$padj)\n      y$ctrs <- paste(x[\"test\"], \"vs\", x[\"ref\"])\n      as.data.frame(y)\n    }\n  )\n}\n\n\n\n\nShow the codeadsl <- dbs.data::adsl\nadvs <- dbs.data::advs\nadlb <- dbs.data::adlb\n\n#' Subjid and Visit to Sample\n#' \nsubjvis_to_spl <- function(df) paste0(df$subjid, \"v\", df$avisitn)\n\nads <- adlb |>\n  rbind(advs) |>\n  subset(select = -c(ct, dtype, param, base, basetype, chg, pchg)) |>\n  tidyr::pivot_wider(names_from = \"paramcd\", values_from = \"aval\") |>\n  merge(adsl, y = _, by = \"subjid\") |>\n  (\\(df) S4Vectors::DataFrame(df, row.names = subjvis_to_spl(df)))() |>\n  subset(select = c(subjid, diabcd, diab, avisitn, avisit)) |>\n  (\\(df) {\n    assertthat::assert_that(all(table(subjvis_to_spl(df)) == 1))\n    df\n  })()\n\nrm(adsl, advs, adlb)\nads\n\n\n\nShow the coderna <- list(\n  mrna = dbs.data::mrna_raw,\n  premirna = dbs.data::premirna_raw,\n  mirna = dbs.data::mirna_raw\n)\n\nrna[c(\"premirna\", \"mirna\")] <- lapply(\n  X = rna[c(\"premirna\", \"mirna\")],\n  FUN = format_mirna\n)\n\n# Rows represent genes\nrna <- lapply(X = rna, FUN = function(x) y <- x[rowSums(x) > 0, ])\nrna <- lapply(X = rna, as.matrix)\nassertthat::assert_that(all(colnames(rna$premirna) == colnames(rna$mirna)))\nrna$allmirna <- rbind(rna$premirna, rna$mirna)\n\nlibrary(testthat)\ntest_that(\"rna features discriminated in noexpr, expr\", {\n  lapply(X = rna, FUN = \\(x) expect_true(all(rowSums(x) > 0)))\n})\n\n\n\nShow the codelibrary(MultiAssayExperiment)\n\nLoading required package: SummarizedExperiment\n\n\nLoading required package: MatrixGenerics\n\n\nLoading required package: matrixStats\n\n\n\nAttaching package: 'MatrixGenerics'\n\n\nThe following objects are masked from 'package:matrixStats':\n\n    colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse,\n    colCounts, colCummaxs, colCummins, colCumprods, colCumsums,\n    colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs,\n    colMads, colMaxs, colMeans2, colMedians, colMins, colOrderStats,\n    colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds,\n    colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads,\n    colWeightedMeans, colWeightedMedians, colWeightedSds,\n    colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet,\n    rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods,\n    rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,\n    rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins,\n    rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks,\n    rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars,\n    rowWeightedMads, rowWeightedMeans, rowWeightedMedians,\n    rowWeightedSds, rowWeightedVars\n\n\nLoading required package: GenomicRanges\n\n\nLoading required package: stats4\n\n\nLoading required package: BiocGenerics\n\n\n\nAttaching package: 'BiocGenerics'\n\n\nThe following objects are masked from 'package:stats':\n\n    IQR, mad, sd, var, xtabs\n\n\nThe following objects are masked from 'package:base':\n\n    anyDuplicated, append, as.data.frame, basename, cbind, colnames,\n    dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep,\n    grepl, intersect, is.unsorted, lapply, Map, mapply, match, mget,\n    order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,\n    rbind, Reduce, rownames, sapply, setdiff, sort, table, tapply,\n    union, unique, unsplit, which.max, which.min\n\n\nLoading required package: S4Vectors\n\n\n\nAttaching package: 'S4Vectors'\n\n\nThe following objects are masked from 'package:base':\n\n    expand.grid, I, unname\n\n\nLoading required package: IRanges\n\n\nLoading required package: GenomeInfoDb\n\n\nLoading required package: Biobase\n\n\nWelcome to Bioconductor\n\n    Vignettes contain introductory material; view with\n    'browseVignettes()'. To cite Bioconductor, see\n    'citation(\"Biobase\")', and for packages 'citation(\"pkgname\")'.\n\n\n\nAttaching package: 'Biobase'\n\n\nThe following object is masked from 'package:MatrixGenerics':\n\n    rowMedians\n\n\nThe following objects are masked from 'package:matrixStats':\n\n    anyMissing, rowMedians\n\nShow the code#' (Sample-)Map Arrays\n#'\n#' Use the column names of `x` to deduce the `primary` and `colnames`.\n#' This is used to generate the sample mapping between colData and Experiments.\n#'\n#' @param x (`dataframe`).\n#'\n#' @note In our case, primary and colnames are equivalent, colnames could\n#' be different from primary names when a biological sample has different\n#' names in the biological assays (e.g. machine constraint, technical\n#' repetitions).\n#'\n#' @seealso [MultiAssayExperiment::listToMap()]\n#' @examples\n#' \\dontrun{\n#'   lapply(rna, map_arrays)\n#'   MultiAssayExperiment::listToMap(lapply(rna, map_arrays))\n#' }\n#'\nmap_arrays <- function(x) {\n  y <- data.frame(colname = colnames(x))\n  y$primary <- y$colname\n  y\n}\n\nbesd_mae <- MultiAssayExperiment(\n  experiments = ExperimentList(rna),\n  colData = ads,\n  sampleMap = listToMap(lapply(rna, map_arrays))\n)\n\nrm(rna, ads)\nbesd_mae"
  },
  {
    "objectID": "t2d_07_mir.html#sample-depth-threshold-determination",
    "href": "t2d_07_mir.html#sample-depth-threshold-determination",
    "title": "\n5  mRNA / micro RNA\n",
    "section": "\n5.2 Sample depth threshold determination",
    "text": "5.2 Sample depth threshold determination\nA scatter plot representing sample gene diversity in relationship with sample depth evidenced a threshold for miRNA reads at 5e+06 reads for which approximately a million read increase was associated with more than a 2-fold increase in gene diversity. The depth threshold for mRNA was fixed at , although with a less important but still substantial drop in gene variety below that threshold.\n\n5.2.1 miRNA\n\nShow the codeassay <- \"allmirna\"\n\n\n\n\nStatic figure\nInteractive figure\n\n\n\n\nShow the codevline <- cfg_prog$rna$depth_threshold[[assay]]\ndtaplot <- assays(besd_mae)[[assay]]\ndtaplot <- data.frame(\n  n_gene = colSums(dtaplot > 0),\n  depth  = colSums(dtaplot)\n)\n\ndtaplot <- cbind(\n  dtaplot,\n  data.frame(colData(besd_mae)[rownames(dtaplot),])\n)\n\ngg <- ggplot(\n  data = dtaplot,\n  mapping = aes(x = depth, y = n_gene, colour = diab)\n) +\n  geom_point() +\n  geom_vline(xintercept = vline) +\n  xlab(\"Sample depth\") +\n  ylab(\"Gene diversity (number of genes with reads)\") +\n  coord_cartesian(ylim = c(0, NA)) +\n  theme_minimal() +\n  theme(legend.position = \"top\")\n\ngg\n\n\n\n\n\nShow the codeplotly::ggplotly(gg)\n\n\n\n\n\n\nShow the coderm(vline, dtaplot, assay, gg)\n\nWarning in rm(vline, dtaplot, assay, gg): object 'vline' not found\n\n\nWarning in rm(vline, dtaplot, assay, gg): object 'dtaplot' not found\n\n\nWarning in rm(vline, dtaplot, assay, gg): object 'gg' not found\n\n\n\n5.2.2 mRNA\n\n\nStatic figure\nInteractive figure\n\n\n\n\nShow the codeassay <- \"mrna\"\n\n\n\nShow the codevline <- cfg_prog$rna$depth_threshold[[assay]]\ndtaplot <- assays(besd_mae)[[assay]]\ndtaplot <- data.frame(\n  n_gene = colSums(dtaplot > 0),\n  depth  = colSums(dtaplot)\n)\n\ndtaplot <- cbind(\n  dtaplot,\n  data.frame(colData(besd_mae)[rownames(dtaplot),])\n)\n\ngg <- ggplot(\n  data = dtaplot,\n  mapping = aes(x = depth, y = n_gene, colour = diab)\n) +\n  geom_point() +\n  geom_vline(xintercept = vline) +\n  xlab(\"Sample depth\") +\n  ylab(\"Gene diversity (number of genes with reads)\") +\n  coord_cartesian(ylim = c(0, NA)) +\n  theme_minimal() +\n  theme(legend.position = \"top\")\n\ngg\n\n\n\n\n\nShow the codeplotly::ggplotly(gg)\n\n\n\n\n\n:::"
  },
  {
    "objectID": "t2d_07_mir.html#dds_1---de-baseline-all-micro-rna",
    "href": "t2d_07_mir.html#dds_1---de-baseline-all-micro-rna",
    "title": "\n5  mRNA / micro RNA\n",
    "section": "\n5.3 dds_1 - DE: Baseline, all micro RNA",
    "text": "5.3 dds_1 - DE: Baseline, all micro RNA\n\nShow the codectrl <- cfg_prog$rna\nngs_assay <- \"allmirna\"\n\ndds_1_fit <- besd_mae |>\n  (\\(mae) mae[ , , ngs_assay])() |>\n  filter_for_depth(\n    assay = ngs_assay,\n    min_depth = ctrl$depth_threshold[[ngs_assay]]\n  ) |>\n  filter_for_coldata(col = \"avisit\", is = \"Baseline\") |>\n  filter_for_low_expr(\n    assay = ngs_assay,\n    min_cpm = ctrl$cpm_threshold[[ngs_assay]],\n    frac_cols = ctrl$cpm_threshold$fraccol\n  ) |>\n  (\\(mae) DESeq2::DESeqDataSetFromMatrix(\n    countData = mae[[ngs_assay]],\n    colData = colData(x = mae),\n    design = stats::formula(~ diabcd)\n  ) )() |>\n  DESeq2::DESeq(\n    parallel = TRUE,\n    BPPARAM = BiocParallel::bpparam(),\n    fitType = \"local\"\n  )\n\nWarning: 'experiments' dropped; see 'metadata'\n\n\nharmonizing input:\n  removing 282 sampleMap rows not in names(experiments)\n\n\nestimating size factors\n\n\nestimating dispersions\n\n\ngene-wise dispersion estimates: 2 workers\n\n\nmean-dispersion relationship\n\n\nfinal dispersion estimates, fitting model and testing: 2 workers\n\n\n-- replacing outliers and refitting for 13 genes\n-- DESeq argument 'minReplicatesForReplace' = 7 \n-- original counts are preserved in counts(dds)\n\n\nestimating dispersions\n\n\nfitting model and testing\n\n\n\nShow the codedds_1_est <- dds_1_fit |>\n  de_by_ctrs(\n    ctrs = list(\n      c(\"diabcd\", test = \"T2D\", ref = \"NGT\"),\n      c(\"diabcd\", test = \"T2D\", ref = \"IGT\"),\n      c(\"diabcd\", test = \"IGT\", ref = \"NGT\")\n    )\n  ) |>\n  Reduce(rbind, x = _) |>\n  within({\n    label_xp(lfcSE) <- \"Log Fold Change Standard Error\"\n    label_xp(ctrs) <- \"Contrast\"\n    label_xp(padj) <- \"Adjusted p.value (False-Discovery Rate)\"\n    label_xp(log_padj) <- \"-1 * log10(padj)\"\n  })\n\n\n\n5.3.1 Fig 07 01\n\nShow the codepval <- c(0.05, 0.001)\nlog_adj <- pretty(dds_1_est$log_padj)\nbrk <- setNames(\n  c(log_adj, -1 * log10(pval)),\n  c(log_adj, paste0(\"padj=\", pval))\n)\ndds_1_gg <-\n  dds_1_est |>\n  ggplot(aes(log2FoldChange, log_padj, fill = log10(..count..))) +\n  geom_vline(xintercept = c(-1, 1), lty = 2) +\n  xlab(\"Log2-fold-change\") +\n  ylab(expression(-1 %*% log10(padj))) +\n  stat_bin_hex() +\n  scale_fill_gradient(low = \"black\", high = \"gray90\") +\n  scale_y_continuous(breaks = brk) +\n  facet_grid(. ~ ctrs) +\n  theme_minimal() +\n  theme(\n    text = element_text(size = 7),\n    title =  element_text(size = 7),\n    legend.position = \"bottom\",\n    legend.key.height = unit(.5, \"lines\"),\n    legend.key.width = unit(3, \"lines\"),\n    legend.text.align = 0,\n    panel.grid.minor = element_blank()\n  )\n\n\n\nShow the codep <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 7.1\",\n      strwrap(\n        \"Volcano plot - Response Size and Significance of Differential\n        Expression among all miRNA at Baseline\", width = 80\n      ),\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_figure(dds_1_gg, height = inches(3), width = inches(6)) |>\n  add_footer(\n    c(\n      \"Program t2d_07_mir / Env ayup_dbs:v0.1.0-alpha\",\n      format(Sys.time(), format = \"%Y-%m-%d %H:%M (%Z)\")\n    ),\n    cfg_prog$version\n  )\n\n\n\nShow the codeexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, \"fig_07_01.pdf\"),\n  file_graph_alone = file.path(cfg_prog$paths$grh, \"fig_07_01_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_07_01.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_07_01_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\nShow the codeexport_xl(\n  fig_07_01 = dds_1_est,\n  info = c(\n    title =\n      \"miRNA at baseline - differential expression by diabetes group\",\n    source = \"UMB-BESD\"\n  ),\n  dir = cfg_prog$paths$grh,\n  basenm = \"fig_07_01\"\n)\n\nExcel output: ../tlg/graph/fig_07_01.xlsx\n\n\n\n5.3.2 Fig 07 02\n\nShow the codepval <- c(0.05, 0.001)\nlog_adj <- pretty(dds_1_est$log_padj)\nbrk <- setNames(\n  c(log_adj, -1 * log10(pval)),\n  c(log_adj, paste0(\"padj=\", pval))\n)\n\ndds_1_est$label <- gsub(\n  \"hsa-(mir|miR|let)-\",\n  dds_1_est$feature,\n  replacement = \"\"\n)\ndds_1_est$type <- substr(dds_1_est$feature, start = 5, stop = 7)\nhead(dds_1_est)\n\ndds_1_gg <- ggplot(\n  dds_1_est,\n  mapping = aes(x = log2FoldChange, y = log_padj, col = type)\n) +\n  geom_vline(xintercept = c(-1, 1), lty = 2) +\n  xlab(\"Log2-fold-change\") +\n  ylab(expression(-1 %*% log10(padj))) +\n  stat_bin_hex(mapping = aes(fill = log10(..count..)), color = \"transparent\") +\n  geom_point(\n    data = subset(dds_1_est, padj < 0.001 & abs(log2FoldChange) > 1),\n    size = 1,\n    shape = 3\n  ) +\n  geom_text(\n    data = subset(dds_1_est, padj < 0.001 & abs(log2FoldChange) > 1),\n    aes(label = label),\n    vjust = -0.5,\n    size = 2,\n    show.legend = FALSE\n  ) +\n  scale_fill_gradient(low = \"black\", high = \"gray90\") +\n  scale_color_manual(values = c(\"#FF5003\", \"#003F7D\")) +\n  scale_y_continuous(breaks = brk) +\n  facet_wrap(. ~ ctrs, ncol = 3) +\n  coord_cartesian(clip = \"off\") +\n  theme_minimal() +\n  theme(\n    text = element_text(size = 7),\n    title =  element_text(size = 7),\n    legend.position = \"bottom\",\n    legend.key.height = unit(.5, \"lines\"),\n    legend.key.width = unit(2, \"lines\"),\n    legend.text.align = 0,\n    panel.grid.minor = element_blank()\n  )\n\np <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 7.2\",\n      strwrap(\n        \"Volcano plot - Response Size and Significance of Differential\n        Expression among all miRNA at Baseline\", width = 80\n      ),\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_figure(dds_1_gg, height = inches(3), width = inches(6)) |>\n  add_footer(\n    c(\n      \"Program t2d_07_mir / Env ayup_dbs:v0.1.0-alpha\",\n      format(Sys.time(), format = \"%Y-%m-%d %H:%M (%Z)\")\n    ),\n    cfg_prog$version\n  )\n\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, \"fig_07_02.pdf\"),\n  file_graph_alone = file.path(cfg_prog$paths$grh, \"fig_07_02_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_07_02.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_07_02_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\nShow the coderm(ctrl, ngs_assay, dds_1_fit, pval, log_adj, brk, dds_1_gg, p)\ngc()\nls()"
  },
  {
    "objectID": "t2d_07_mir.html#dds_2---de-baseline-mrna",
    "href": "t2d_07_mir.html#dds_2---de-baseline-mrna",
    "title": "\n5  mRNA / micro RNA\n",
    "section": "\n5.4 dds_2 - DE: Baseline, mRNA",
    "text": "5.4 dds_2 - DE: Baseline, mRNA\n\nShow the codectrl <- cfg_prog$rna\nngs_assay <- \"mrna\"\n\ndds_2_fit <- besd_mae |>\n  (\\(mae) mae[ , , ngs_assay])() |>\n  filter_for_depth(\n    assay = ngs_assay,\n    min_depth = ctrl$depth_threshold[[ngs_assay]]\n  ) |>\n  filter_for_coldata(col = \"avisit\", is = \"Baseline\") |>\n  filter_for_low_expr(\n    assay = ngs_assay,\n    min_cpm = ctrl$cpm_threshold[[ngs_assay]]\n  ) |>\n  (\\(mae) DESeq2::DESeqDataSetFromMatrix(\n    countData = mae[[ngs_assay]],\n    colData = colData(x = mae),\n    design = stats::formula(~ diabcd)\n  ) )() |>\n  DESeq2::DESeq(\n    parallel = TRUE,\n    BPPARAM = BiocParallel::bpparam()\n  )\n\nWarning: 'experiments' dropped; see 'metadata'\n\n\nharmonizing input:\n  removing 282 sampleMap rows not in names(experiments)\n\n\nestimating size factors\n\n\nestimating dispersions\n\n\ngene-wise dispersion estimates: 2 workers\n\n\nmean-dispersion relationship\n\n\nfinal dispersion estimates, fitting model and testing: 2 workers\n\n\n-- replacing outliers and refitting for 13 genes\n-- DESeq argument 'minReplicatesForReplace' = 7 \n-- original counts are preserved in counts(dds)\n\n\nestimating dispersions\n\n\nfitting model and testing\n\n\n\nShow the codedds_2_est <- dds_2_fit |>\n  de_by_ctrs(\n    ctrs = list(\n      c(\"diabcd\", test = \"T2D\", ref = \"NGT\"),\n      c(\"diabcd\", test = \"T2D\", ref = \"IGT\"),\n      c(\"diabcd\", test = \"IGT\", ref = \"NGT\")\n    )\n  ) |>\n  Reduce(rbind, x = _) |>\n  within({\n    label_xp(lfcSE) <- \"Log Fold Change Standard Error\"\n    label_xp(ctrs) <- \"Contrast\"\n    label_xp(padj) <- \"Adjusted p.value (False-Discovery Rate)\"\n    label_xp(log_padj) <- \"-1 * log10(padj)\"\n  })\n\n\n\nShow the codehead(dds_2_est)\n\n\nndegenes <- dds_2_est |>\n  subset(round(padj, 5) < 0.001) |>\n  with(unique(feature)) |>\n  length()\n\n\nsprintf(\"%.2f\", round(ndegenes / ngenes * 100, 2))\n\nsplit(dds_2_est, dds_2_est$ctrs) |>\n  lapply(\\(x) {\n    dim(x)\n    head(x)\n    table(cut(x$padj, breaks = c(0, 0.001, 0.05, 1)))\n  })\n\n\n\npct_de_genes <- sprintf(\"%.2f\", round(ndegenes / ngenes * 100, 2))\n\n\ngenes_nsub <- nrow(besd_mae[[ngs_assay]])\ngenes_de_n <- c(\n  Overall = dds_2_est |>\n      subset(round(padj, 5) < 0.001) |>\n      with(unique(feature)) |>\n      length()\n  ,\n  split(dds_2_est, dds_2_est$ctrs) |>\n    sapply(\\(x) {\n      x <- subset(x, round(padj, 5) < 0.001)\n      length(unique(x$feature))\n    })\n)\n\ngenes_nsub\ngenes_de_n\ngenes_de_pct <- sprintf(\"%.2f\", genes_de_n / genes_nsub * 100)\n\n\n\n5.4.1 Fig 07 03\n\nShow the codepval <- c(0.05, 0.001)\nlog_adj <- pretty(dds_2_est$log_padj)\nbrk <- setNames(\n  c(log_adj, -1 * log10(pval)),\n  c(log_adj, paste0(\"padj=\", pval))\n)\n\ndds_2_gg <-\n  dds_2_est |>\n  ggplot(aes(log2FoldChange, log_padj, fill = log10(..count..))) +\n  geom_vline(xintercept = c(-1, 1), lty = 2) +\n  xlab(\"Log2-fold-change\") +\n  ylab(expression(-1 %*% log10(padj))) +\n  stat_bin_hex() +\n  scale_fill_gradient(low = \"black\", high = \"gray90\") +\n  scale_y_continuous(breaks = brk) +\n  facet_grid(. ~ ctrs) +\n  theme_minimal() +\n  theme(\n    text = element_text(size = 7),\n    title =  element_text(size = 7),\n    legend.position = \"bottom\",\n    legend.key.height = unit(.5, \"lines\"),\n    legend.key.width = unit(3, \"lines\"),\n    legend.text.align = 0,\n    panel.grid.minor = element_blank()\n  )\n\n\n\nShow the codep <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 7.3\",\n      strwrap(\n        \"Volcano plot - Response Size and Significance of Differential\n        Expression among mRNA at Baseline\", width = 80\n      ),\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_figure(dds_2_gg, height = inches(3), width = inches(6)) |>\n  add_footer(\n    c(\n      \"Program t2d_07_mir / Env ayup_dbs:v0.1.0-alpha\",\n      format(Sys.time(), format = \"%Y-%m-%d %H:%M (%Z)\")\n    ),\n    cfg_prog$version\n  )\n\n\n\nShow the codeexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, \"fig_07_03.pdf\"),\n  file_graph_alone = file.path(cfg_prog$paths$grh, \"fig_07_03_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_07_03.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_07_03_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\nShow the codeexport_xl(\n  fig_07_03 = dds_2_est,\n  info = c(\n    title =\n      \"mRNA at baseline - differential expression by diabetes group\",\n    source = \"UMB-BESD\"\n  ),\n  dir = cfg_prog$paths$grh,\n  basenm = \"fig_07_03\"\n)\n\nExcel output: ../tlg/graph/fig_07_03.xlsx\n\n\n\n5.4.2 Fig 07 04\n\nShow the codedds_2_est$label <- gsub(\"ENSG0+\", \"\", dds_2_est$feature)\nhead(dds_2_est)\n\npval <- c(0.05, 0.001)\nlog_adj <- pretty(dds_2_est$log_padj)\nbrk <- setNames(\n  c(log_adj, -1 * log10(pval)),\n  c(log_adj, paste0(\"padj=\", pval))\n)\n\ndds_2_gg <- ggplot(dds_2_est, mapping = aes(x = log2FoldChange, y = log_padj)) +\n  geom_vline(xintercept = c(-1, 1), lty = 2) +\n  xlab(\"Log2-fold-change\") +\n  ylab(expression(-1 %*% log10(padj))) +\n  stat_bin_hex(mapping = aes(fill = log10(..count..)), color = \"transparent\") +\n  geom_point(\n    data = subset(dds_2_est, padj < 0.001 & abs(log2FoldChange) > 2),\n    size = 1,\n    shape = 3,\n    color = \"royalblue\"\n  ) +\n  geom_text(\n    data = subset(dds_2_est, padj < 0.001 & abs(log2FoldChange) > 2),\n    aes(label = label),\n    vjust = -0.5,\n    size = 2,\n    color = \"royalblue\",\n    show.legend = FALSE\n  ) +\n  scale_fill_gradient(low = \"black\", high = \"gray90\") +\n  scale_color_manual(values = c(\"#FF5003\", \"#003F7D\")) +\n  scale_y_continuous(breaks = brk) +\n  facet_wrap(. ~ ctrs, ncol = 3) +\n  coord_cartesian(clip = \"off\") +\n  theme_minimal() +\n  theme(\n    text = element_text(size = 7),\n    title =  element_text(size = 7),\n    legend.position = \"bottom\",\n    legend.key.height = unit(.5, \"lines\"),\n    legend.key.width = unit(2, \"lines\"),\n    legend.text.align = 0,\n    panel.grid.minor = element_blank()\n  )\n\np <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 7.4\",\n      strwrap(\n        \"Volcano plot - Response Size and Significance of Differential\n        Expression among all miRNA at Baseline\", width = 80\n      ),\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_figure(dds_2_gg, height = inches(3), width = inches(6)) |>\n  add_footer(\n    c(\n      \"Program t2d_07_mir / Env ayup_dbs:v0.1.0-alpha\",\n      format(Sys.time(), format = \"%Y-%m-%d %H:%M (%Z)\")\n    ),\n    cfg_prog$version\n  )\n\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, \"fig_07_04.pdf\"),\n  file_graph_alone = file.path(cfg_prog$paths$grh, \"fig_07_04_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_07_04.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_07_04_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)"
  },
  {
    "objectID": "t2d_07_mir.html#dds_3---de-month-3-all-micro-rna",
    "href": "t2d_07_mir.html#dds_3---de-month-3-all-micro-rna",
    "title": "\n5  mRNA / micro RNA\n",
    "section": "\n5.5 dds_3 - DE: Month 3, all micro RNA",
    "text": "5.5 dds_3 - DE: Month 3, all micro RNA\n\nShow the codectrl <- cfg_prog$rna\nngs_assay <- \"allmirna\"\n\ndds_3_fit <- besd_mae |>\n  (\\(mae) mae[ , , ngs_assay])() |>\n  filter_for_depth(\n    assay = ngs_assay,\n    min_depth = ctrl$depth_threshold[[ngs_assay]]\n  ) |>\n  filter_for_coldata(col = \"avisit\", is = \"Month 3\") |>\n  filter_for_low_expr(\n    assay = ngs_assay,\n    min_cpm = ctrl$cpm_threshold[[ngs_assay]]\n  ) |>\n  (\\(mae) DESeq2::DESeqDataSetFromMatrix(\n    countData = mae[[ngs_assay]],\n    colData = colData(x = mae),\n    design = stats::formula(~ diabcd)\n  ) )() |>\n  DESeq2::DESeq(\n    parallel = TRUE,\n    BPPARAM = BiocParallel::bpparam(),\n    fitType = \"local\"\n  )\n\nWarning: 'experiments' dropped; see 'metadata'\n\n\nharmonizing input:\n  removing 282 sampleMap rows not in names(experiments)\n\n\nestimating size factors\n\n\nestimating dispersions\n\n\ngene-wise dispersion estimates: 2 workers\n\n\nmean-dispersion relationship\n\n\nfinal dispersion estimates, fitting model and testing: 2 workers\n\n\n-- replacing outliers and refitting for 13 genes\n-- DESeq argument 'minReplicatesForReplace' = 7 \n-- original counts are preserved in counts(dds)\n\n\nestimating dispersions\n\n\nfitting model and testing\n\n\n\nShow the codedds_3_est <-\n  dds_3_fit |>\n  de_by_ctrs(\n    ctrs = list(\n      c(\"diabcd\", test = \"T2D\", ref = \"NGT\"),\n      c(\"diabcd\", test = \"T2D\", ref = \"IGT\"),\n      c(\"diabcd\", test = \"IGT\", ref = \"NGT\")\n    )\n  ) |>\n  Reduce(rbind, x = _) |>\n  within({\n    label_xp(lfcSE) <- \"Log Fold Change Standard Error\"\n    label_xp(ctrs) <- \"Contrast\"\n    label_xp(padj) <- \"Adjusted p.value (False-Discovery Rate)\"\n    label_xp(log_padj) <- \"-1 * log10(padj)\"\n  })\n\n\n\n5.5.1 Fig 07 05\n\nShow the codepval <- c(0.05, 0.001)\nlog_adj <- pretty(dds_3_est$log_padj)\nbrk <- setNames(\n  c(log_adj, -1 * log10(pval)),\n  c(log_adj, paste0(\"padj=\", pval))\n)\ndds_3_gg <-\n  dds_3_est |>\n  ggplot(aes(log2FoldChange, log_padj, fill = log10(..count..))) +\n  geom_vline(xintercept = c(-1, 1), lty = 2) +\n  xlab(\"Log2-fold-change\") +\n  ylab(expression(-1 %*% log10(padj))) +\n  stat_bin_hex() +\n  scale_fill_gradient(low = \"black\", high = \"gray90\") +\n  scale_y_continuous(breaks = brk) +\n  facet_grid(. ~ ctrs) +\n  theme_minimal() +\n  theme(\n    text = element_text(size = 7),\n    title =  element_text(size = 7),\n    legend.position = \"bottom\",\n    legend.key.height = unit(.5, \"lines\"),\n    legend.key.width = unit(3, \"lines\"),\n    legend.text.align = 0,\n    panel.grid.minor = element_blank()\n  )\n\np <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 7.5\",\n      strwrap(\n        \"Volcano plot - Response Size and Significance of Differential\n        Expression among all miRNA at Month 3\", width = 80\n      ),\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_figure(dds_3_gg, height = inches(3), width = inches(6)) |>\n  add_footer(\n    c(\n      \"Program t2d_07_mir / Env ayup_dbs:v0.1.0-alpha\",\n      format(Sys.time(), format = \"%Y-%m-%d %H:%M (%Z)\")\n    ),\n    cfg_prog$version\n  )\n\nWarning: Removed 350 rows containing non-finite values (stat_binhex).\n\nShow the codeexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, \"fig_07_05.pdf\"),\n  file_graph_alone = file.path(cfg_prog$paths$grh, \"fig_07_05_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_07_05.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_07_05_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\nShow the codeexport_xl(\n  fig_07_05 = dds_3_est,\n  info = c(\n    title =\n      \"All miRNA at month 3 - differential expression by diabetes group\",\n    source = \"UMB-BESD\"\n  ),\n  dir = cfg_prog$paths$grh,\n  basenm = \"fig_07_05\"\n)\n\nExcel output: ../tlg/graph/fig_07_05.xlsx\n\n\n\n5.5.2 Fig 07 06\n\nShow the codepval <- c(0.05, 0.001)\nlog_adj <- pretty(dds_3_est$log_padj)\nbrk <- setNames(\n  c(log_adj, -1 * log10(pval)),\n  c(log_adj, paste0(\"padj=\", pval))\n)\n\ndds_3_est$label <- gsub(\n  \"hsa-(mir|miR|let)-\",\n  dds_3_est$feature,\n  replacement = \"\"\n)\ndds_3_est$type <- substr(dds_3_est$feature, start = 5, stop = 7)\nhead(dds_3_est)\n\ndds_3_gg <- ggplot(\n  dds_3_est,\n  mapping = aes(x = log2FoldChange, y = log_padj, col = type)\n) +\n  geom_vline(xintercept = c(-1, 1), lty = 2) +\n  xlab(\"Log2-fold-change\") +\n  ylab(expression(-1 %*% log10(padj))) +\n  stat_bin_hex(mapping = aes(fill = log10(..count..)), color = \"transparent\") +\n  geom_point(\n    data = subset(dds_3_est, padj < 0.001 & abs(log2FoldChange) > 1),\n    size = 1,\n    shape = 3\n  ) +\n  geom_text(\n    data = subset(dds_3_est, padj < 0.001 & abs(log2FoldChange) > 1),\n    aes(label = label),\n    vjust = -0.5,\n    size = 2,\n    show.legend = FALSE\n  ) +\n  scale_fill_gradient(low = \"black\", high = \"gray90\") +\n  scale_color_manual(values = c(\"#FF5003\", \"#003F7D\")) +\n  scale_y_continuous(breaks = brk) +\n  facet_wrap(. ~ ctrs, ncol = 3) +\n  coord_cartesian(clip = \"off\") +\n  theme_minimal() +\n  theme(\n    text = element_text(size = 7),\n    title =  element_text(size = 7),\n    legend.position = \"bottom\",\n    legend.key.height = unit(.5, \"lines\"),\n    legend.key.width = unit(2, \"lines\"),\n    legend.text.align = 0,\n    panel.grid.minor = element_blank()\n  )\n\np <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 7.6\",\n      strwrap(\n        \"Volcano plot - Response Size and Significance of Differential\n        Expression among all miRNA at Month 3\", width = 80\n      ),\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_figure(dds_3_gg, height = inches(3), width = inches(6)) |>\n  add_footer(\n    c(\n      \"Program t2d_07_mir / Env ayup_dbs:v0.1.0-alpha\",\n      format(Sys.time(), format = \"%Y-%m-%d %H:%M (%Z)\")\n    ),\n    cfg_prog$version\n  )\n\nWarning: Removed 350 rows containing non-finite values (stat_binhex).\n\nShow the codeexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, \"fig_07_06.pdf\"),\n  file_graph_alone = file.path(cfg_prog$paths$grh, \"fig_07_06_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_07_06.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_07_06_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)"
  },
  {
    "objectID": "t2d_07_mir.html#dds_4---de-month-3-mrna",
    "href": "t2d_07_mir.html#dds_4---de-month-3-mrna",
    "title": "\n5  mRNA / micro RNA\n",
    "section": "\n5.6 dds_4 - DE: Month 3, mRNA",
    "text": "5.6 dds_4 - DE: Month 3, mRNA\n\nShow the codectrl <- cfg_prog$rna\nngs_assay <- \"mrna\"\n\ndds_4_fit <- besd_mae |>\n  (\\(mae) mae[ , , ngs_assay])() |>\n  filter_for_depth(\n    assay = ngs_assay,\n    min_depth = ctrl$depth_threshold[[ngs_assay]]\n  ) |>\n  filter_for_coldata(col = \"avisit\", is = \"Month 3\") |>\n  filter_for_low_expr(\n    assay = ngs_assay,\n    min_cpm = ctrl$cpm_threshold[[ngs_assay]]\n  ) |>\n  (\\(mae) DESeq2::DESeqDataSetFromMatrix(\n    countData = mae[[ngs_assay]],\n    colData = colData(x = mae),\n    design = stats::formula(~ diabcd)\n  ) )() |>\n  DESeq2::DESeq(\n    parallel = TRUE,\n    BPPARAM = BiocParallel::bpparam()\n  )\n\nWarning: 'experiments' dropped; see 'metadata'\n\n\nharmonizing input:\n  removing 282 sampleMap rows not in names(experiments)\n\n\nestimating size factors\n\n\nestimating dispersions\n\n\ngene-wise dispersion estimates: 2 workers\n\n\nmean-dispersion relationship\n\n\nfinal dispersion estimates, fitting model and testing: 2 workers\n\n\n-- replacing outliers and refitting for 21 genes\n-- DESeq argument 'minReplicatesForReplace' = 7 \n-- original counts are preserved in counts(dds)\n\n\nestimating dispersions\n\n\nfitting model and testing\n\n\n\nShow the codedds_4_est <-\n  dds_4_fit |>\n  de_by_ctrs(\n    ctrs = list(\n      c(\"diabcd\", test = \"T2D\", ref = \"NGT\"),\n      c(\"diabcd\", test = \"T2D\", ref = \"IGT\"),\n      c(\"diabcd\", test = \"IGT\", ref = \"NGT\")\n    )\n  ) |>\n  Reduce(rbind, x = _) |>\n  within({\n    label_xp(lfcSE) <- \"Log Fold Change Standard Error\"\n    label_xp(ctrs) <- \"Contrast\"\n    label_xp(padj) <- \"Adjusted p.value (False-Discovery Rate)\"\n    label_xp(log_padj) <- \"-1 * log10(padj)\"\n  })\n\n\n\n5.6.1 Fig 07 07\n\nShow the codepval <- c(0.05, 0.001)\nlog_adj <- pretty(dds_4_est$log_padj)\nbrk <- setNames(\n  c(log_adj, -1 * log10(pval)),\n  c(log_adj, paste0(\"padj=\", pval))\n)\n\ndds_4_gg <- dds_4_est |>\n  # All pval close to 1 disturbe the hex-density plots\n  (\\(df) {\n    assert_that(all(df$padj[df$ctrs == \"IGT vs NGT\"] > 0.991))\n    df\n  })() |>\n  subset(ctrs != \"IGT vs NGT\") |>\n  ggplot(aes(log2FoldChange, log_padj, fill = log10(..count..))) +\n  geom_vline(xintercept = c(-1, 1), lty = 2) +\n  xlab(\"Log2-fold-change\") +\n  ylab(expression(-1 %*% log10(padj))) +\n  stat_bin_hex() +\n  scale_fill_gradient(low = \"black\", high = \"gray90\") +\n  scale_y_continuous(breaks = brk) +\n  facet_grid(. ~ ctrs) +\n  theme_minimal() +\n  theme(\n    text = element_text(size = 7),\n    title =  element_text(size = 7),\n    legend.position = \"bottom\",\n    legend.key.height = unit(.5, \"lines\"),\n    legend.key.width = unit(3, \"lines\"),\n    legend.text.align = 0,\n    panel.grid.minor = element_blank()\n  )\n\np <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 7.7\",\n      strwrap(\n        \"Volcano plot - Response Size and Significance of Differential\n        Expression among all mRNA at Month 3\", width = 80\n      ),\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_figure(dds_4_gg, height = inches(3), width = inches(6)) |>\n  add_note(c(\n    \"NOTE: all feature comparisons between IGT and NGT were characterised by\n    adjusted p.values greater than 0.99; to preserve the hexagonal-density\n    plot, this comparison was not represented.\"\n  )) |>\n  add_footer(\n    c(\n      \"Program t2d_07_mir / Env ayup_dbs:v0.1.0-alpha\",\n      format(Sys.time(), format = \"%Y-%m-%d %H:%M (%Z)\")\n    ),\n    cfg_prog$version\n  )\n\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, \"fig_07_07.pdf\"),\n  file_graph_alone = file.path(cfg_prog$paths$grh, \"fig_07_07_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_07_07.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_07_07_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\nShow the codeexport_xl(\n  fig_07_07 = dds_4_est,\n  info = c(\n    title =\n      \"mRNA at month 3 - differential expression by diabetes group\",\n    source = \"UMB-BESD\"\n  ),\n  dir = cfg_prog$paths$grh,\n  basenm = \"fig_07_07\"\n)\n\nExcel output: ../tlg/graph/fig_07_07.xlsx\n\n\n\n5.6.2 Fig 07 08\n\nShow the codedds_4_est$label <- gsub(\"ENSG0+\", \"\", dds_4_est$feature)\nhead(dds_4_est)\n\npval <- c(0.05, 0.001)\nlog_adj <- pretty(dds_4_est$log_padj)\nbrk <- setNames(\n  c(log_adj, -1 * log10(pval)),\n  c(log_adj, paste0(\"padj=\", pval))\n)\n\ndds_4_gg <- dds_4_est |>\n  # All pval close to 1 disturbe the hex-density plots\n  (\\(df) {\n    assert_that(all(df$padj[df$ctrs == \"IGT vs NGT\"] > 0.991))\n    df\n  })() |>\n  subset(ctrs != \"IGT vs NGT\") |>\n  ggplot(mapping = aes(x = log2FoldChange, y = log_padj)) +\n  geom_vline(xintercept = c(-1, 1), lty = 2) +\n  xlab(\"Log2-fold-change\") +\n  ylab(expression(-1 %*% log10(padj))) +\n  stat_bin_hex(mapping = aes(fill = log10(..count..)), color = \"transparent\") +\n  geom_point(\n    data = subset(dds_4_est, padj < 0.001 & abs(log2FoldChange) > 2),\n    size = 1,\n    shape = 3,\n    color = \"royalblue\"\n  ) +\n  geom_text(\n    data = subset(dds_4_est, padj < 0.001 & abs(log2FoldChange) > 2),\n    aes(label = label),\n    vjust = -0.5,\n    size = 2,\n    color = \"royalblue\",\n    show.legend = FALSE\n  ) +\n  scale_fill_gradient(low = \"black\", high = \"gray90\") +\n  scale_color_manual(values = c(\"#FF5003\", \"#003F7D\")) +\n  scale_y_continuous(breaks = brk) +\n  facet_wrap(. ~ ctrs, ncol = 3) +\n  coord_cartesian(clip = \"off\") +\n  theme_minimal() +\n  theme(\n    text = element_text(size = 7),\n    title =  element_text(size = 7),\n    legend.position = \"bottom\",\n    legend.key.height = unit(.5, \"lines\"),\n    legend.key.width = unit(2, \"lines\"),\n    legend.text.align = 0,\n    panel.grid.minor = element_blank()\n  )\n\np <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 7.8\",\n      strwrap(\n        \"Volcano plot - Response Size and Significance of Differential\n        Expression among mRNA at Month 3\", width = 80\n      ),\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_figure(dds_4_gg, height = inches(3), width = inches(6)) |>\n  add_note(c(\n    \"NOTE: all feature comparisons between IGT and NGT were characterised by\n    adjusted p.values greater than 0.99; to preserve the hexagonal-density\n    plot, this comparison was not represented.\"\n  )) |>\n  add_footer(\n    c(\n      \"Program t2d_07_mir / Env ayup_dbs:v0.1.0-alpha\",\n      format(Sys.time(), format = \"%Y-%m-%d %H:%M (%Z)\")\n    ),\n    cfg_prog$version\n  )\n\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, \"fig_07_08.pdf\"),\n  file_graph_alone = file.path(cfg_prog$paths$grh, \"fig_07_08_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_07_08.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_07_08_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)"
  },
  {
    "objectID": "t2d_07_mir.html#dds_5---de-exercise-intervention-all-micro-rna",
    "href": "t2d_07_mir.html#dds_5---de-exercise-intervention-all-micro-rna",
    "title": "\n5  mRNA / micro RNA\n",
    "section": "\n5.7 dds_5 - DE: Exercise intervention, all micro RNA",
    "text": "5.7 dds_5 - DE: Exercise intervention, all micro RNA\n\nShow the codectrl <- cfg_prog$rna\nngs_assay <- \"allmirna\"\n\nfilter_for_paired_visits <- function(mae) {\n  assert_that(all(table(colData(mae)$subjid) <= 2))\n  \n  subj <- table(colData(mae)$subjid)\n  subj <- names(subj[subj == 2])\n  mae <- mae[, colData(mae)$subjid %in% subj, ]\n  \n  chk_df <- as.data.frame(colData(mae))\n  check <- split(chk_df, f = chk_df$avisit)\n  \n  # Verify the selection:\n  assert_that(all(\n    sapply(check, subj = subj,\\(x, subj) all(subj %in% x$subjid))\n  ))\n  mae\n}\n\ndds_5_fit <- besd_mae |>\n  (\\(mae) mae[ , , ngs_assay])() |>\n  filter_for_depth(ngs_assay, ctrl$depth_threshold[[ngs_assay]]) |>\n  filter_for_paired_visits() |>\n  filter_for_low_expr(ngs_assay, ctrl$cpm_threshold[[ngs_assay]]) |>\n  (\\(mae) {\n    # <https://support.bioconductor.org/p/84241/#84296>\n    # Or:\n    # vignette('DESeq2'),\n    # > Section: \"Group-specific condition effects, individuals nested\n    # > within groups\"\n    colData(mae) <- droplevels(colData(mae))\n    colData(mae)$subjid <- as.character(colData(mae)$subjid)\n    colData(mae)$avisit_ <- factor(\n      colData(mae)$avisit,\n      levels = levels(colData(mae)$avisit),\n      labels = sub(\" \", \"_\", levels(colData(mae)$avisit))\n    )\n    coldata <- colData(mae)[c(\"diabcd\", \"subjid\", \"avisit_\")]\n    \n    coldata <- do.call(\n      rbind,\n      by(\n        data = coldata,\n        INDICES = list(coldata$diabcd),\n        FUN = function(x) {\n          subjid <- as.factor(x$subjid)# nolint\n          x$P.n <- factor(# nolint\n            subjid,\n            levels = levels(subjid),\n            labels = paste0(\"P.\", 1:nlevels(subjid))\n          )\n          x[order(x$subjid, x$diabcd), ]\n        }\n      )\n    )\n    \n    coldata <- coldata[rownames(colData(mae)), ]\n    dsgn <- stats::model.matrix(\n      ~diabcd + diabcd:P.n + diabcd:avisit_,\n      coldata\n    )\n    dsgn <- dsgn[, colSums(dsgn) != 0]\n    \n    DESeq2::DESeqDataSetFromMatrix(\n      countData = mae[[ngs_assay]],\n      colData = colData(x = mae),\n      design = dsgn\n    )\n  })() |>\n  DESeq2::DESeq(\n    parallel = TRUE,\n    BPPARAM = BiocParallel::bpparam(),\n    fitType = \"local\",\n    betaPrior = FALSE\n  )\n\nWarning: 'experiments' dropped; see 'metadata'\n\n\nharmonizing input:\n  removing 282 sampleMap rows not in names(experiments)\n\n\nusing supplied model matrix\n\n\nestimating size factors\n\n\nestimating dispersions\n\n\ngene-wise dispersion estimates: 2 workers\n\n\nmean-dispersion relationship\n\n\nfinal dispersion estimates, fitting model and testing: 2 workers\n\nShow the codede_by_name <- function(df,\n                       name,\n                       adj_meth = ctrl$adj_meth) {\n  lapply(\n    name,\n    fit = df,\n    adj_meth = adj_meth,\n    FUN = function(x, fit, adj_meth) {\n      y <- DESeq2::results(fit, name = x, pAdjustMethod = adj_meth)\n      y$feature <- rownames(y)\n      y$log_padj <- -1 * log10(y$padj)\n      y$ctrs <- gsub(\n        pattern = \"^diabcd(...)\\\\.avisit.*$\",\n        x = x,\n        replacement = \"chg \\\\1\"\n      )\n      as.data.frame(y)\n    }\n  )\n}\n\ndds_5_est <-\n  dds_5_fit |>\n  de_by_name(\n    name = c(\n      chg_ngt = \"diabcdNGT.avisit_Month_3\",\n      chg_igt = \"diabcdIGT.avisit_Month_3\",\n      chg_t2d = \"diabcdT2D.avisit_Month_3\"\n    )\n  ) |>\n  Reduce(rbind, x = _) |>\n  within(\n    ctrs <- factor(ctrs, levels = paste(\"chg\", c(\"NGT\", \"IGT\", \"T2D\")))\n  ) |>\n  within({\n    label_xp(lfcSE) <- \"Log Fold Change Standard Error\"\n    label_xp(ctrs) <- \"Contrast\"\n    label_xp(padj) <- \"Adjusted p.value (False-Discovery Rate)\"\n    label_xp(log_padj) <- \"-1 * log10(padj)\"\n  })\n\n\n\n5.7.1 Fig 07 09\n\nShow the codepval <- c(0.05, 0.001)\nlog_adj <- pretty(dds_5_est$log_padj)\nbrk <- setNames(\n  c(log_adj, -1 * log10(pval)),\n  c(log_adj, paste0(\"padj=\", pval))\n)\n\ndds_5_gg <-\n  dds_5_est |>\n  ggplot(aes(log2FoldChange, log_padj, fill = log10(..count..))) +\n  geom_vline(xintercept = c(-1, 1), lty = 2) +\n  xlab(\"Log2-fold-change\") +\n  ylab(expression(-1 %*% log10(padj))) +\n  stat_bin_hex() +\n  scale_fill_gradient(low = \"black\", high = \"gray90\") +\n  scale_y_continuous(breaks = brk) +\n  facet_grid(. ~ ctrs) +\n  theme_minimal() +\n  theme(\n    text = element_text(size = 7),\n    title =  element_text(size = 7),\n    legend.position = \"bottom\",\n    legend.key.height = unit(.5, \"lines\"),\n    legend.key.width = unit(3, \"lines\"),\n    legend.text.align = 0,\n    panel.grid.minor = element_blank()\n  )\n\np <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 7.9\",\n      strwrap(\n        \"Volcano plot - Size and Significance of Differential\n        Expression among micro RNA in response to the exercise\n        intervention (CHG)\", width = 80\n      ),\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_figure(dds_5_gg, height = inches(3), width = inches(6)) |>\n  add_footer(\n    c(\n      \"Program t2d_07_mir / Env ayup_dbs:v0.1.0-alpha\",\n      format(Sys.time(), format = \"%Y-%m-%d %H:%M (%Z)\")\n    ),\n    cfg_prog$version\n  )\n\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, \"fig_07_09.pdf\"),\n  file_graph_alone = file.path(cfg_prog$paths$grh, \"fig_07_09_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_07_09.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_07_09_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\nShow the codeexport_xl(\n  fig_07_09 = dds_5_est,\n  info = c(\n    title = paste(\n      \"All miRNA Change from Baseline - differential expression by diabetes\",\n      \"group\"\n    ),\n    source = \"UMB-BESD\"\n  ),\n  dir = cfg_prog$paths$grh,\n  basenm = \"fig_07_09\"\n)\n\nExcel output: ../tlg/graph/fig_07_09.xlsx\n\n\n\n5.7.2 Fig 07 10\n\nShow the codepval <- c(0.05, 0.001)\nlog_adj <- pretty(dds_5_est$log_padj)\nbrk <- setNames(\n  c(log_adj, -1 * log10(pval)),\n  c(log_adj, paste0(\"padj=\", pval))\n)\n\ndds_5_est$label <- gsub(\n  \"hsa-(mir|miR|let)-\",\n  dds_5_est$feature,\n  replacement = \"\"\n)\ndds_5_est$type <- substr(dds_5_est$feature, start = 5, stop = 7)\nhead(dds_5_est)\n\ndds_5_txt <- subset(dds_5_est, padj < 0.05 & abs(log2FoldChange) > .5)\n\ndds_5_gg <- ggplot(\n  dds_5_est,\n  mapping = aes(x = log2FoldChange, y = log_padj, col = type)\n) +\n  geom_vline(xintercept = c(-1, 1), lty = 2) +\n  xlab(\"Log2-fold-change\") +\n  ylab(expression(-1 %*% log10(padj))) +\n  stat_bin_hex(mapping = aes(fill = log10(..count..)), color = \"transparent\") +\n  geom_point(data = dds_5_txt, size = 1, shape = 3) +\n  geom_text(\n    data = dds_5_txt,\n    aes(label = label),\n    vjust = -0.5,\n    size = 2,\n    show.legend = FALSE\n  ) +\n  scale_fill_gradient(low = \"black\", high = \"gray90\") +\n  scale_color_manual(values = c(\"#FF5003\", \"#003F7D\")) +\n  scale_y_continuous(breaks = brk) +\n  facet_wrap(. ~ ctrs, ncol = 3) +\n  coord_cartesian(clip = \"off\") +\n  theme_minimal() +\n  theme(\n    text = element_text(size = 7),\n    title =  element_text(size = 7),\n    legend.position = \"bottom\",\n    legend.key.height = unit(.5, \"lines\"),\n    legend.key.width = unit(2, \"lines\"),\n    legend.text.align = 0,\n    panel.grid.minor = element_blank()\n  )\n\np <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 7.10\",\n      strwrap(\n        \"Volcano plot - Size and Significance of Differential\n        Expression among micro RNA in response to the exercise\n        intervention (CHG)\", width = 80\n      ),\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_figure(dds_5_gg, height = inches(3), width = inches(6)) |>\n  add_footer(\n    c(\n      \"Program t2d_07_mir / Env ayup_dbs:v0.1.0-alpha\",\n      format(Sys.time(), format = \"%Y-%m-%d %H:%M (%Z)\")\n    ),\n    cfg_prog$version\n  )\n\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, \"fig_07_10.pdf\"),\n  file_graph_alone = file.path(cfg_prog$paths$grh, \"fig_07_10_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_07_10.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_07_10_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)"
  },
  {
    "objectID": "t2d_07_mir.html#dds_6---de-exercise-intervention-mrna",
    "href": "t2d_07_mir.html#dds_6---de-exercise-intervention-mrna",
    "title": "\n5  mRNA / micro RNA\n",
    "section": "\n5.8 dds_6 - DE: Exercise intervention, mRNA",
    "text": "5.8 dds_6 - DE: Exercise intervention, mRNA\n\nShow the codectrl <- cfg_prog$rna\nngs_assay <- \"mrna\"\n\nfilter_for_paired_visits <- function(mae) {\n  assert_that(all(table(colData(mae)$subjid) <= 2))\n  \n  subj <- table(colData(mae)$subjid)\n  subj <- names(subj[subj == 2])\n  mae <- mae[, colData(mae)$subjid %in% subj, ]\n  \n  chk_df <- as.data.frame(colData(mae))\n  check <- split(chk_df, f = chk_df$avisit)\n  \n  # Verify the selection:\n  assert_that(all(\n    sapply(check, subj = subj,\\(x, subj) all(subj %in% x$subjid))\n  ))\n  mae\n}\n\ndds_6_fit <- besd_mae |>\n  (\\(mae) mae[ , , ngs_assay])() |>\n  filter_for_depth(ngs_assay, ctrl$depth_threshold[[ngs_assay]]) |>\n  filter_for_paired_visits() |>\n  filter_for_low_expr(ngs_assay, ctrl$cpm_threshold[[ngs_assay]]) |>\n  (\\(mae) {\n    # <https://support.bioconductor.org/p/84241/#84296>\n    # Or:\n    # vignette('DESeq2'),\n    # > Section: \"Group-specific condition effects, individuals nested\n    # > within groups\"\n    colData(mae) <- droplevels(colData(mae))\n    colData(mae)$subjid <- as.character(colData(mae)$subjid)\n    colData(mae)$avisit_ <- factor(\n      colData(mae)$avisit,\n      levels = levels(colData(mae)$avisit),\n      labels = sub(\" \", \"_\", levels(colData(mae)$avisit))\n    )\n    coldata <- colData(mae)[c(\"diabcd\", \"subjid\", \"avisit_\")]\n    \n    coldata <- do.call(\n      rbind,\n      by(\n        data = coldata,\n        INDICES = list(coldata$diabcd),\n        FUN = function(x) {\n          subjid <- as.factor(x$subjid)# nolint\n          x$P.n <- factor(# nolint\n            subjid,\n            levels = levels(subjid),\n            labels = paste0(\"P.\", 1:nlevels(subjid))\n          )\n          x[order(x$subjid, x$diabcd), ]\n        }\n      )\n    )\n    \n    coldata <- coldata[rownames(colData(mae)), ]\n    dsgn <- stats::model.matrix(\n      ~diabcd + diabcd:P.n + diabcd:avisit_,\n      coldata\n    )\n    dsgn <- dsgn[, colSums(dsgn) != 0]\n    \n    DESeq2::DESeqDataSetFromMatrix(\n      countData = mae[[ngs_assay]],\n      colData = colData(x = mae),\n      design = dsgn\n    )\n  })() |>\n  DESeq2::DESeq(\n    parallel = TRUE,\n    BPPARAM = BiocParallel::bpparam(),\n    fitType = \"local\",\n    betaPrior = FALSE\n  )\n\nWarning: 'experiments' dropped; see 'metadata'\n\n\nharmonizing input:\n  removing 282 sampleMap rows not in names(experiments)\n\n\nusing supplied model matrix\n\n\nestimating size factors\n\n\nestimating dispersions\n\n\ngene-wise dispersion estimates: 2 workers\n\n\nmean-dispersion relationship\n\n\nfinal dispersion estimates, fitting model and testing: 2 workers\n\nShow the codedds_6_est <-\n  dds_6_fit |>\n  de_by_name(\n    name = c(\n      chg_ngt = \"diabcdNGT.avisit_Month_3\",\n      chg_igt = \"diabcdIGT.avisit_Month_3\",\n      chg_t2d = \"diabcdT2D.avisit_Month_3\"\n    )\n  ) |>\n  Reduce(rbind, x = _) |>\n  within(\n    ctrs <- factor(ctrs, levels = paste(\"chg\", c(\"NGT\", \"IGT\", \"T2D\")))\n  ) |>\n  within({\n    label_xp(lfcSE) <- \"Log Fold Change Standard Error\"\n    label_xp(ctrs) <- \"Contrast\"\n    label_xp(padj) <- \"Adjusted p.value (False-Discovery Rate)\"\n    label_xp(log_padj) <- \"-1 * log10(padj)\"\n  })\n\n\n\n5.8.1 Fig 07 11\n\nShow the codepval <- c(0.05, 0.001)\nlog_adj <- pretty(dds_6_est$log_padj)\nbrk <- setNames(\n  c(log_adj, -1 * log10(pval)),\n  c(log_adj, paste0(\"padj=\", pval))\n)\n\ndds_6_gg <-\n  dds_6_est |>\n  ggplot(aes(log2FoldChange, log_padj, fill = log10(..count..))) +\n  geom_vline(xintercept = c(-1, 1), lty = 2) +\n  xlab(\"Log2-fold-change\") +\n  ylab(expression(-1 %*% log10(padj))) +\n  stat_bin_hex() +\n  scale_fill_gradient(low = \"black\", high = \"gray90\") +\n  scale_y_continuous(breaks = brk) +\n  facet_grid(. ~ ctrs) +\n  theme_minimal() +\n  theme(\n    text = element_text(size = 7),\n    title =  element_text(size = 7),\n    legend.position = \"bottom\",\n    legend.key.height = unit(.5, \"lines\"),\n    legend.key.width = unit(3, \"lines\"),\n    legend.text.align = 0,\n    panel.grid.minor = element_blank()\n  )\n\np <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 7.11\",\n      strwrap(\n        \"Volcano plot - Size and Significance of Differential\n        Expression among mRNA in response to the exercise\n        intervention (CHG)\", width = 80\n      ),\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_figure(dds_6_gg, height = inches(3), width = inches(6)) |>\n  add_footer(\n    c(\n      \"Program t2d_07_mir / Env ayup_dbs:v0.1.0-alpha\",\n      format(Sys.time(), format = \"%Y-%m-%d %H:%M (%Z)\")\n    ),\n    cfg_prog$version\n  )\n\nWarning: Removed 1646 rows containing non-finite values (stat_binhex).\n\nShow the codeexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, \"fig_07_11.pdf\"),\n  file_graph_alone = file.path(cfg_prog$paths$grh, \"fig_07_11_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_07_11.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_07_11_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\nShow the codeexport_xl(\n  fig_07_11 = dds_6_est,\n  info = c(\n    title = paste(\n      \"mRNA Change from Baseline - differential expression by diabetes\",\n      \"group\"\n    ),\n    source = \"UMB-BESD\"\n  ),\n  dir = cfg_prog$paths$grh,\n  basenm = \"fig_07_11\"\n)\n\nExcel output: ../tlg/graph/fig_07_11.xlsx\n\n\n\n5.8.2 Fig 07 12\n\nShow the codepval <- c(0.05, 0.001)\nlog_adj <- pretty(dds_6_est$log_padj)\nbrk <- setNames(\n  c(log_adj, -1 * log10(pval)),\n  c(log_adj, paste0(\"padj=\", pval))\n)\n\ndds_6_est$label <- gsub(\"ENSG0+\", \"\", dds_6_est$feature)\ndds_6_est$type <- substr(dds_6_est$feature, start = 5, stop = 7)\n\ndds_6_txt <- subset(dds_6_est, padj < 0.05 & abs(log2FoldChange) > 1)\n\ndds_6_gg <- ggplot(\n  dds_6_est,\n  mapping = aes(x = log2FoldChange, y = log_padj, col = type)\n) +\n  geom_vline(xintercept = c(-1, 1), lty = 2) +\n  xlab(\"Log2-fold-change\") +\n  ylab(expression(-1 %*% log10(padj))) +\n  stat_bin_hex(mapping = aes(fill = log10(..count..)), color = \"transparent\") +\n  geom_point(data = dds_6_txt, size = 1, shape = 3) +\n  geom_text(\n    data = dds_6_txt,\n    aes(label = label),\n    vjust = -0.5,\n    size = 2,\n    show.legend = FALSE\n  ) +\n  scale_fill_gradient(low = \"black\", high = \"gray90\") +\n  scale_color_manual(values = c(\"#FF5003\", \"#003F7D\")) +\n  scale_y_continuous(breaks = brk) +\n  facet_wrap(. ~ ctrs, ncol = 3) +\n  coord_cartesian(clip = \"off\") +\n  theme_minimal() +\n  theme(\n    text = element_text(size = 7),\n    title =  element_text(size = 7),\n    legend.position = \"bottom\",\n    legend.key.height = unit(.5, \"lines\"),\n    legend.key.width = unit(2, \"lines\"),\n    legend.text.align = 0,\n    panel.grid.minor = element_blank()\n  )\n\np <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 7.12\",\n      strwrap(\n        \"Volcano plot - Size and Significance of Differential\n        Expression among mRNA in response to the exercise\n        intervention (CHG)\", width = 80\n      ),\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_figure(dds_6_gg, height = inches(3), width = inches(6)) |>\n  add_footer(\n    c(\n      \"Program t2d_07_mir / Env ayup_dbs:v0.1.0-alpha\",\n      format(Sys.time(), format = \"%Y-%m-%d %H:%M (%Z)\")\n    ),\n    cfg_prog$version\n  )\n\nWarning: Removed 1646 rows containing non-finite values (stat_binhex).\n\nShow the codeexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, \"fig_07_12.pdf\"),\n  file_graph_alone = file.path(cfg_prog$paths$grh, \"fig_07_12_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_07_12.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_07_12_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\nShow the coderm(ctrl, ngs_assay, dds_6_fit, pval, log_adj, brk, dds_6_gg, p)\ngc()\nls()"
  },
  {
    "objectID": "t2d_07_mir.html#session-informations",
    "href": "t2d_07_mir.html#session-informations",
    "title": "\n5  mRNA / micro RNA\n",
    "section": "\n5.9 Session Informations",
    "text": "5.9 Session Informations\n\nShow the codesessioninfo::session_info()\n\n\n\n\n\n\n\n\nDündar, Friederike, Luce Skrabanek, and Paul Zumbo. 2018. “Introduction to Differential Gene Expression Analysis Using RNA-Seq.” Internet.\n\n\nLove, Michael I., Wolfgang Huber, and Simon Anders. 2014. “Moderated Estimation of Fold Change and Dispersion for RNA-Seq Data with DESeq2.” Genome Biology 15: 550. https://doi.org/10.1186/s13059-014-0550-8.\n\n\nR Core Team. 2022. R: A Language and Environment for Statistical Computing. Vienna, Austria: R Foundation for Statistical Computing. https://www.R-project.org/.\n\n\nRamos, Marcel, Lucas Schiffer, Angela Re, Rimsha Azhar, Azfar Basunia, Carmen Rodriguez Cabrera, Tiffany Chan, et al. 2017. “Software for the Integration of Multi-Omics Experiments in Bioconductor.” Cancer Research 77(21); e39-42.\n\n\nWickham, Hadley. 2016. Ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York. https://ggplot2.tidyverse.org."
  },
  {
    "objectID": "t2d_11_wcn.html",
    "href": "t2d_11_wcn.html",
    "title": "\n6  WGCNA\n",
    "section": "",
    "text": "“The Weighted Correlation Network Analysis (WGCNA) [11,12] corresponds to a data reduction method and unsupervised classification method. It simplifies the interpretation of thousands of gene responses to a dozen of synthetic groups (or modules) of genes. The net establishes connections between genes-genes are connected if their expression is correlated. Genes can be more or less intensively connected depending on the value of the correlation (the weights). The connectivity between genes is then interpreted into a distance, and the distance is used to group genes into modules. This is how a high number of genes can be reduced into a small number of clusters whose expression is quantified by the Eigengenes (first principal component within the module). It relies on the assumption that highly correlated genes within a module are involved in common biological processes.” Niemira et al. (2020)\n\nTwo gene co-expression networks were obtained, 1) the first one based on baseline samples for NGT and T2D subject samples and 2) the second on training-induced expression variation independently from the study arm. In detail:\n\nbaseline samples for NGT and T2D were selected, the same inclusion criteria as in the section “Differential expression analysis” were used. Gene expression was transformed using variance stabilizing transformation. The optimal soft-threshold adjacency matrix was graphically determined, then the network was estimated resulting in gene modules and corresponding Eigengenes. The cutreeDynamic algorithm was used for tree pruning of the gene hierarchical clustering dendrogram resulting in co-expression modules; correlated modules (r > 0.80) were merged. The quantitative clinical parameters were centred to the average and scaled-to-variance while factors were decomposed into dummy variables so as to study the association between gene modules and clinical traits quantified with Pearson’s correlation coefficient.\ntraining-induced variation was studied similarly, the approach above was applicable here also, using the difference between variance-stabilizing transformed expression matrix as input to the procedure.\n\nNote: it is not possible to use the differentially expressed genes as a starting point. The WGCNA method includes a disclaimer preventing the use of pre-filtered / selected genes based on DEG analysis result.\nThe module identification was followed by gene set enrichment analysis. To do so, the correlation between gene expression (Variance-Stabilized Transformed values, VST) and the eigengene estimated in every module was used as a measure of module membership. Then, for every module, genesets as defined by the Gene Ontology (GO) project were selected if at least 10 genes belonged to the module. Then, the GSEA procedure was run while considering all expressed genes with existing entrez gene id and determining an enrichment score and associated p.value based on 10000 random permutations. The result focused specifically on enriched and up-regulated genesets, i.e. genesets with over representation of genes with higher correlation with the eigengene within each module.\nThe analysis was realized with R (v4.2.0, R Core Team 2022). Note the use of the additional packages downloaded from the RStudio package manager repository (freeze date 2022-05-04, repos):\n\n\nMultiAssayExperiment for management of multi-omics experiment objects (version 1.22.0, Ramos et al. 2017)\n\n\nDESeq2 for differential expression analysis and variance stabilizing transformation (version 1.36.0, Love, Huber, and Anders 2014)\n\n\ncowplot for figure composition (version 1.1.1, Wilke 2020)\n\n\nggplot2 for graphics (version 3.3.6, Wickham 2016)\n\n\nWGCNA for gene clustering Langfelder and Horvath (2012).\n\n\nShow the codecfg_prog <- yaml::read_yaml(\"_prog.yml\")\n\n\n\nShow the codedevtools::load_all(\"src/pkg/dbs.data\")\n\nℹ Loading dbs.data\n\nShow the codedevtools::load_all(\"src/pkg/latarnia.utils\")\n\nℹ Loading latarnia.utils\nLoading required package: grid\n\nLoading required package: shiny\n\nShow the codeknitr::opts_chunk$set(results = cfg_prog$knitr$results)\n\nsource(\"R/ngs.R\")\nsource(\"R/inches.R\")\nsource(\"R/export_xl.R\")\n\n\n\n\n\nShow the code# Help for data pre-processing\nfilter_for_depth <- function(mae, assay, depth_threshold) {\n  mae[, colSums(mae[[ngs_assay]]) > depth_threshold, ]\n}\n\nfilter_for_visit <- function(mae, visit) {\n  mae[, colData(mae)$avisit == visit, ]\n}\n\nfilter_for_coldata <- function(mae, col, is) {\n  mae[, colData(mae)[[col]] %in% is, ]\n}\n\nfilter_for_low_expr <- function(mae, assay, cpm_threshold,\n                                frac_cols = cfg_prog$rna$cpm_threshold$fraccol\n) {\n  # Genes expressed at least cpm_threshold in frac_cols columns\n  mae[\n    rowSums(cpm(mae[[assay]]) > cpm_threshold) >\n      ncol(mae[[assay]]) * frac_cols,\n    ,\n  ]\n}\n\n\n\n\nShow the codeadsl <- dbs.data::adsl\nadvs <- dbs.data::advs\nadlb <- dbs.data::adlb\n\n#' Subjid and Visit to Sample\n#' \nsubjvis_to_spl <- function(df) paste0(df$subjid, \"v\", df$avisitn)\n\nads <- adlb |>\n  rbind(advs) |>\n  subset(select = -c(ct, dtype, param, base, basetype, chg, pchg)) |>\n  tidyr::pivot_wider(names_from = \"paramcd\", values_from = \"aval\") |>\n  merge(adsl, y = _, by = \"subjid\") |>\n  (\\(df) S4Vectors::DataFrame(df, row.names = subjvis_to_spl(df)))() |>\n  (\\(df) {\n    assertthat::assert_that(all(table(subjvis_to_spl(df)) == 1))\n    df\n  })()\n\n\n\nShow the coderna <- list(\n  mrna = dbs.data::mrna_raw,\n  premirna = dbs.data::premirna_raw,\n  mirna = dbs.data::mirna_raw\n)\n\nrna[c(\"premirna\", \"mirna\")] <- lapply(\n  X = rna[c(\"premirna\", \"mirna\")],\n  FUN = format_mirna\n)\n\n# Rows represent genes\nrna <- lapply(X = rna, FUN = function(x) y <- x[rowSums(x) > 0, ])\nrna <- lapply(X = rna, as.matrix)\nassertthat::assert_that(all(colnames(rna$premirna) == colnames(rna$mirna)))\nrna$allmirna <- rbind(rna$premirna, rna$mirna)\n\nlibrary(testthat)\ntest_that(\"rna features discriminated in noexpr, expr\", {\n  lapply(X = rna, FUN = \\(x) expect_true(all(rowSums(x) > 0)))\n})\n\n\n\nShow the codelibrary(MultiAssayExperiment)\n\nLoading required package: SummarizedExperiment\n\n\nLoading required package: MatrixGenerics\n\n\nLoading required package: matrixStats\n\n\n\nAttaching package: 'MatrixGenerics'\n\n\nThe following objects are masked from 'package:matrixStats':\n\n    colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse,\n    colCounts, colCummaxs, colCummins, colCumprods, colCumsums,\n    colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs,\n    colMads, colMaxs, colMeans2, colMedians, colMins, colOrderStats,\n    colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds,\n    colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads,\n    colWeightedMeans, colWeightedMedians, colWeightedSds,\n    colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet,\n    rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods,\n    rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,\n    rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins,\n    rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks,\n    rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars,\n    rowWeightedMads, rowWeightedMeans, rowWeightedMedians,\n    rowWeightedSds, rowWeightedVars\n\n\nLoading required package: GenomicRanges\n\n\nLoading required package: stats4\n\n\nLoading required package: BiocGenerics\n\n\n\nAttaching package: 'BiocGenerics'\n\n\nThe following objects are masked from 'package:stats':\n\n    IQR, mad, sd, var, xtabs\n\n\nThe following objects are masked from 'package:base':\n\n    anyDuplicated, append, as.data.frame, basename, cbind, colnames,\n    dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep,\n    grepl, intersect, is.unsorted, lapply, Map, mapply, match, mget,\n    order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,\n    rbind, Reduce, rownames, sapply, setdiff, sort, table, tapply,\n    union, unique, unsplit, which.max, which.min\n\n\nLoading required package: S4Vectors\n\n\n\nAttaching package: 'S4Vectors'\n\n\nThe following objects are masked from 'package:base':\n\n    expand.grid, I, unname\n\n\nLoading required package: IRanges\n\n\nLoading required package: GenomeInfoDb\n\n\nLoading required package: Biobase\n\n\nWelcome to Bioconductor\n\n    Vignettes contain introductory material; view with\n    'browseVignettes()'. To cite Bioconductor, see\n    'citation(\"Biobase\")', and for packages 'citation(\"pkgname\")'.\n\n\n\nAttaching package: 'Biobase'\n\n\nThe following object is masked from 'package:MatrixGenerics':\n\n    rowMedians\n\n\nThe following objects are masked from 'package:matrixStats':\n\n    anyMissing, rowMedians\n\nShow the code#' (Sample-)Map Arrays\n#'\n#' Use the column names of `x` to deduce the `primary` and `colnames`.\n#' This is used to generate the sample mapping between colData and Experiments.\n#'\n#' @param x (`dataframe`).\n#'\n#' @note In our case, primary and colnames are equivalent, colnames could\n#' be different from primary names when a biological sample has different\n#' names in the biological assays (e.g. machine constraint, technical\n#' repetitions).\n#'\n#' @seealso [MultiAssayExperiment::listToMap()]\n#' @examples\n#' \\dontrun{\n#'   lapply(rna, map_arrays)\n#'   MultiAssayExperiment::listToMap(lapply(rna, map_arrays))\n#' }\n#'\nmap_arrays <- function(x) {\n  y <- data.frame(colname = colnames(x))\n  y$primary <- y$colname\n  y\n}\n\ncolnames(ads) <- tolower(colnames(ads))\nbesd_mae <- MultiAssayExperiment(\n  experiments = ExperimentList(rna),\n  colData = ads,\n  sampleMap = listToMap(lapply(rna, map_arrays))\n)\n\nbesd_mae\n\n\n\n\nShow the code#' # https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/FemaleLiver-01-dataInput.pdf\n#' # WGCNA: gene in rows, sample in cols\n\nctrl <- cfg_prog$rna\nngs_assay <- \"allmirna\"\nctrl_wgcna <- cfg_prog$rna$wgcna$baseline$allmirna\n\n# Specific to sample_clustering\ncol_fill <- \"glu120\"\n\n\n\nShow the codedta <- besd_mae |>\n  (\\(mae) mae[ , , ngs_assay])() |>\n  filter_for_depth(ngs_assay, ctrl$depth_threshold[[ngs_assay]]) |>\n  filter_for_coldata(\"avisit\", is = \"Baseline\") |>\n  filter_for_coldata(\"diabcd\", is = c(\"NGT\", \"T2D\")) |>\n  filter_for_low_expr(ngs_assay, ctrl$cpm_threshold[[ngs_assay]]) |>\n  (\\(mae) {\n    mae[[ngs_assay]] <-\n      DESeq2::DESeqDataSetFromMatrix(\n        countData = mae[[ngs_assay]],\n        colData = colData(x = mae),\n        design = stats::formula(~ diabcd)\n      ) |>\n      DESeq2::varianceStabilizingTransformation(blind = FALSE) |>\n      SummarizedExperiment::assay()\n    mae\n  })()\n\nWarning: 'experiments' dropped; see 'metadata'\n\n\nharmonizing input:\n  removing 282 sampleMap rows not in names(experiments)\n\n\nfactor levels were dropped which had no samples\n\nShow the code#' WGCNA Expression data.\n#'\n#' A matrix or data frame in which columns are genes and rows ar samples.\n#'\ndta_expr <- t(dta[[ngs_assay]])\nassert_that(WGCNA::goodSamplesGenes(dta_expr, verbose = 0)$allOK)\n\n\n\nShow the codedta_traits <- colData(dta) |> droplevels()\n\n\n\n\nShow the codespl_clust <- hclust(dist(dta_expr), method = \"complete\")\n\n# Clustering Dendrogram of samples based on their Euclidean distance\ntheme_custom <- function(...) {\n    theme_dendro() +\n    theme(\n      plot.margin = unit(c(0, 0, 0, 0), \"null\"),\n      panel.spacing = unit(c(0, 0, 0, 0), \"null\")\n    ) +\n    theme(...)\n}\n\nlibrary(ggdendro)\nlibrary(ggplot2)\ndend <- spl_clust |> as.dendrogram()\n\ndta_traits$x <- rownames(dta_traits)\ndta_traits$x <- factor(dta_traits$x, levels = labels(dend))\ndta_traits <- as.data.frame(dta_traits)\n\nlim <- c(0, nobs(dend))\nddata <- ggdendro::dendro_data(dend, type = \"rectangle\")\n\np1 <- ggplot(ggdendro::segment(ddata)) +\n  geom_segment(aes(x = x, y = y, xend = xend, yend = yend)) +\n  coord_flip(clip = \"off\") +\n  scale_y_reverse(expand = expansion(0)) +\n  scale_x_continuous(\n    breaks = seq_len(nobs(dend)),\n    labels = ggdendro::label(ddata)$label,\n    lim = lim,\n    position = \"top\"\n  ) +\n  theme_custom(axis.text.y = element_text())\n\np2 <- ggplot(\n  dta_traits,\n  aes(\n    xmin = 0, xmax = 1,\n    ymin = as.numeric(x) - 1/2, ymax = as.numeric(x) + 1/2,\n    fill = diabcd\n  )\n) +\n  geom_rect(col = \"white\") +\n  scale_y_continuous(breaks = 1:34) +\n  scale_x_continuous(expand = expansion(0)) +\n  scale_fill_viridis_d(option = \"C\", direction = -1, begin = .2, end = .8) +\n  coord_cartesian(ylim = lim) +\n  theme_custom(legend.position = \"top\")\n\np4 <- ggplot(\n  dta_traits,\n  aes(\n    xmin = 0, xmax = 1,\n    ymin = as.numeric(x) - 1/2, ymax = as.numeric(x) + 1/2,\n    fill = !!as.name(col_fill)\n  )\n) +\n  geom_rect(col = \"white\") +\n  scale_y_continuous(breaks = 1:34) +\n  scale_x_continuous(expand = expansion(0)) +\n  scale_fill_viridis_c() +\n  coord_cartesian(ylim = lim) +\n  theme_custom(legend.position = \"top\")\n\np <- egg::ggarrange(\n  p1, p2, p4,\n  nrow = 1,\n  widths = c(2, 1, 1),\n  padding = unit(0, \"lines\"),\n  draw = FALSE\n)\n\n\n\nShow the codeoid <- 1\ntitle <- \"miRNA / Baseline - Clustering dendrogram of samples based on their\n  Euclidean distance and trait heatmap\"\n\n\n\nShow the codep <- clean_slate() |>\n  add_title(c(\n    paste0(\"Figure 11.\",   oid),\n    wrap_long_lines(title)\n  )) |>\n  add_figure(p, height = inches(5)) |>\n  add_note(c(\n    \"Note: VST transformed expression matrix used to estimate distances\n    between samples, _complete_ method was used for the hierarchical\n    clustering.\"\n  ))\n\noid <- stringr::str_pad(oid, 2, \"left\", \"0\")\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \".pdf\")),\n  file_graph_alone = \n    file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \"_af.pdf\"))\n)\n\n[log] output saved as: ../tlg/graph/t2d_11_01.pdf\n\n\n[log] output saved as: ../tlg/graph/t2d_11_01_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\n\n\nShow the codelibrary(WGCNA)\n\nLoading required package: dynamicTreeCut\n\n\nLoading required package: fastcluster\n\n\n\nAttaching package: 'fastcluster'\n\n\nThe following object is masked from 'package:stats':\n\n    hclust\n\n\n\nAttaching package: 'WGCNA'\n\n\nThe following object is masked from 'package:IRanges':\n\n    cor\n\n\nThe following object is masked from 'package:S4Vectors':\n\n    cor\n\n\nThe following object is masked from 'package:stats':\n\n    cor\n\nShow the codeenableWGCNAThreads()\n\npwr <- ctrl_wgcna$adjacency$power\nsft <- pickSoftThreshold(\n  dta_expr,\n  powerVector = c(c(1:10), seq(from = 12, to=20, by=2)),\n  verbose = 0\n)\n\nlibrary(ggplot2)\np1 <- ggplot(\n  sft$fitIndices,\n  aes(Power, - sign(slope) * SFT.R.sq, label = Power)\n) +\n  geom_hline(yintercept = .9, lty = 2) +\n  geom_hline(yintercept = c(0, 1), lty = 1) +\n  geom_line() +\n  geom_label(\n    data = sft$fitIndices |> subset(Power == pwr),\n    vjust = 0, nudge_y = .025\n  ) +\n  geom_segment(\n    data = sft$fitIndices |> subset(Power == pwr),\n    aes(xend = Power, yend = 0)\n  ) +\n  geom_segment(\n    data = sft$fitIndices |> subset(Power == pwr),\n    aes(xend = -Inf, yend = - sign(slope) * SFT.R.sq)\n  ) +\n  geom_point(aes(shape = Power == pwr), show.legend = FALSE, fill = \"white\") +\n  scale_shape_manual(values = c(\"TRUE\" = 21, \"FALSE\" = 3)) +\n  coord_cartesian(ylim = c(0, 1)) +\n  xlab(\"Soft Threshold (power)\") +\n  ylab(\"Scale Free Topology Model Fit\") +\n  ggtitle(\"Scale independence\") +\n  theme_minimal() +\n  theme(panel.grid.minor = element_blank())\n\np2 <- ggplot(\n  sft$fitIndices,\n  aes(Power, mean.k., label = Power, shape = Power == pwr)) +\n  geom_hline(yintercept = .9) +\n  geom_line() +\n  geom_segment(\n    data = sft$fitIndices |> subset(Power == pwr),\n    aes(xend = Power, yend = 0)\n  ) +\n  geom_segment(\n    data = sft$fitIndices |> subset(Power == pwr),\n    aes(xend = -Inf, yend = mean.k.)\n  ) +\n  geom_label(\n    data = sft$fitIndices |> subset(Power == pwr),\n    vjust = 0, hjust = 0, nudge_y = 1\n  ) +\n  geom_point(fill = \"white\", show.legend = FALSE) +\n  scale_shape_manual(values = c(\"TRUE\" = 21, \"FALSE\" = 3)) +\n  xlab(\"Soft Threshold (power)\") +\n  ylab(\"Mean connectivity\") +\n  ggtitle(\"Mean connectivity\") +\n  theme_minimal() +\n  theme(panel.grid.minor = element_blank())\n\np <- egg::ggarrange(p1, p2, nrow = 1, draw = FALSE)\n\n\n\nShow the codeoid <- 2\ntitle <- \"Micro-RNA / Baseline - Soft threshold determination\"\n\n\n\nShow the codep <- clean_slate() |>\n  add_title(c(\n    paste0(\"Figure 11.\", oid),\n    title\n  )) |>\n  add_figure(p, width = inches(6), height = inches(3))\n\noid <- stringr::str_pad(oid, 2, \"left\", \"0\")\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \".pdf\")),\n  file_graph_alone = \n    file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \"_af.pdf\"))\n)\n\n[log] output saved as: ../tlg/graph/t2d_11_02.pdf\n\n\n[log] output saved as: ../tlg/graph/t2d_11_02_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\n\nShow the code# gene dissimilarity\ntom_dis <- dta_expr |>\n  adjacency(\n    type = ctrl_wgcna$adjacency$type,\n    power = ctrl_wgcna$adjacency$power,\n    corFnc = ctrl_wgcna$adjacency$cor_fn$value\n  ) |>\n  TOMsimilarity(TOMType = ctrl_wgcna$tom$type) |>\n  (\\(tom) 1 - tom)()\n\ngene_hc <- tom_dis |>\n  as.dist() |>\n  hclust(method = \"average\")\n\n# gene clustering\ndyn_mod <- cutreeDynamic(\n  gene_hc,\n  cutHeight = ctrl_wgcna$cuttree$cut_height,\n  minClusterSize = ctrl_wgcna$cuttree$min_cluster_size,\n  method = \"hybrid\",\n  distM = tom_dis,\n  deepSplit = ctrl_wgcna$cuttree$deep_split,\n  pamRespectsDendro = FALSE\n)\ndyn_col <- labels2colors(dyn_mod)\n\n# me: module eigengenes (also used to merge dyn_col)\ndyn_mge <- dta_expr |> WGCNA::mergeCloseModules(dyn_col)\nmeig <- dyn_mge$newMEs\n\n\n\nShow the code# Not exported yet\nWGCNA::plotDendroAndColors(\n  dendro = gene_hc,\n  colors = dyn_mge$color,\n  dendroLabels = FALSE,\n  addGuide = TRUE,\n  guideHang = 0.05,\n  groupLabels = \"\",\n  cex.rowText = 0.5,\n  cex.colorLabels = 0.5,\n  cex.dendroLabels = 0.9,\n  marAll = c(1, 1, 1, 1),\n  axes = FALSE,\n  ylab = NULL,\n  main = NULL\n)\ngraphics::par(mfrow = c(1, 1))\n\n\n\n\n\nShow the codetheme_custom_dend <- function(gg, ...) {\n  gg +\n    scale_x_continuous(expand = c(0, 0.5)) +\n    scale_y_continuous(expand = c(0.02, 0)) +\n    theme(\n      axis.text.x = element_blank(),\n      axis.text.y = element_blank(),\n      legend.background = element_rect(\n        fill = \"transparent\", colour = \"transparent\"\n      ),\n      panel.background = element_rect(\n        fill = \"transparent\", colour = \"transparent\"\n      ),\n      plot.background = element_rect(\n        fill = \"transparent\", colour = \"transparent\"\n      )\n    ) +\n    theme(...)\n}\n\n#' @describeIn wrap_wgcna improved correlation matrix.\n#' @param mat_y,mat_x the matrix used in rows or columns.\n#' @param draw (`logical`)\n#' @param newpage (`logical`)\n#' @import ggplot2\n#' @export\n#'\ngg_eigen <- function(mat_y, mat_x, draw = FALSE, newpage = FALSE) {\n\n  dta <- stats::cor(mat_y, mat_x, use = \"pairwise.complete.obs\")\n  dta <- reshape2::melt(\n    dta, varnames = c(\"eig\", \"traits\"), value.name = \"cor\"\n  )\n  dta$cor_pval <- WGCNA::corPvalueStudent(dta$cor, nSamples = nrow(mat_x))\n\n  dendro_y   <- stats::hclust(d = stats::as.dist(1 - stats::cor(mat_y)))\n  dendro_y   <- stats::as.dendrogram(dendro_y);\n  y_neworder <- labels(dendro_y)\n  dendro_y   <- ggdendro::ggdendrogram(data = dendro_y, rotate = TRUE) +\n    theme(plot.margin = unit(c(0,0,0,-0.2), units=\"lines\"))\n  dendro_y <- theme_custom_dend(gg = dendro_y)\n\n  dendro_x <- stats::as.dist(1 - stats::cor(mat_x))\n  dendro_x <- stats::hclust(d = stats::dist(x = dendro_x))\n  dendro_x <- stats::as.dendrogram(dendro_x)\n  x_neworder <- labels(dendro_x)\n  dendro_x <- ggdendro::ggdendrogram(data = dendro_x, rotate = FALSE) +\n    theme(plot.margin = unit(c(0,0,-.8,0), units=\"lines\"))\n  dendro_x <- theme_custom_dend(gg = dendro_x)\n\n  dta$traits <- factor(dta$traits, levels = x_neworder)\n  dta$eig <- factor(dta$eig, levels = y_neworder)\n\n  dta$cor_pval_2d <- format(round(dta$cor_pval, 2), nsmall = 2)\n\n  # Create heatmap plot\n  heatmap.plot <- ggplot(\n    data = dta,\n    mapping = aes_string(x = \"traits\", y = \"eig\")\n  ) + geom_tile(data = dta, fill = \"transparent\", col = \"gray\") +\n    geom_tile(\n      data = dta[dta$cor_pval < 0.1, ],\n      mapping = aes_string(fill = \"cor\")\n    ) + geom_text(\n      data = dta[dta$cor_pval < 0.1, ],\n      mapping = aes_string(label = \"cor_pval_2d\"),\n      col = \"white\", size = 2\n    ) + scale_fill_viridis_c(\n      breaks = seq(-1, 1, .2),\n      name = \"Corr.\",\n      guide = guide_colourbar(barheight = 10),\n      option = \"B\",\n      direction = -1,\n      lim = c(-1, 1),\n      begin = .1,\n      end = .9\n    )+ coord_cartesian(\n      expand = FALSE\n    ) + theme(\n      axis.title.x = element_blank(),\n      axis.title.y = element_blank(),\n      panel.grid.major = element_blank(),\n      legend.position = \"left\",\n      axis.text.x = element_text(angle = 45, hjust = 1),\n      legend.background = element_rect(\n        fill = \"transparent\", colour = \"transparent\"\n      ),\n      panel.background = element_rect(\n        fill = \"transparent\", colour = \"transparent\"\n      ),\n      plot.background = element_rect(\n        fill = \"transparent\", colour = \"transparent\"\n      ),\n      legend.key.width = grid::unit(.3, \"cm\"),\n    )\n\n  a1 <- ggplotGrob(heatmap.plot)\n  a2 <- ggplotGrob(dendro_y)\n  a <- cbind(a1, a2, size = \"max\")\n  b <- ggplot2::ggplotGrob(dendro_x)\n  b <- gtable::gtable_add_cols(\n    b,\n    widths = a1$widths[1:(length(a1$widths)-length(b$widths))],\n    pos = 0\n  )\n  b <- gtable::gtable_add_cols(b, widths = a2$widths, pos = -1)\n\n  ab <- rbind(b, a, size = \"last\")\n  ab <- rbind(b, a, size = \"last\", z = c(1,10))\n  ab$heights[7] <- unit(3, \"lines\")\n  ab$widths[16] <- unit(3, \"lines\")\n\n  if (draw) {\n    if (newpage) grid::grid.newpage()\n    grid::grid.draw(ab)\n  }\n\n  list(\n    gg = ab,\n    data = dta\n  )\n}\n\nprep_col <- function(x) UseMethod(\"prep_col\", x)\nprep_col.numeric <- function(x) identity(x)\nprep_col.factor <- function(x) as.numeric(x)\nprep_col.character <- function(x) {\n  x <- as.factor(x)\n  prep_col(x)\n}\n\n\n\nShow the coderes <- gg_eigen(\n  dta_traits |>\n    subset(select = c(\n      diabcd, diab, age, trainn,\n      chol, glu0, glu120, glu30, glu60, hba1c, hdl,\n      homab, homair, insulin0, insulin120, insulin30, insulin60, ldl,\n      matsuda, trig, bmi, bodyfatp, dcal, dcarbt, dfatt,\n      dprot, fatacfr, fatmass, leanmass, smmass, vat, vo2maxe,\n      vo2maxlbm, vo2maxml, weight\n    )) |>\n    lapply(prep_col)|>\n    DataFrame(row.names = rownames(dta_traits)) |>\n    as.matrix(),\n  meig\n)\n\nScale for 'x' is already present. Adding another scale for 'x', which will\nreplace the existing scale.\n\n\nScale for 'y' is already present. Adding another scale for 'y', which will\nreplace the existing scale.\n\n\nScale for 'x' is already present. Adding another scale for 'x', which will\nreplace the existing scale.\n\n\nScale for 'y' is already present. Adding another scale for 'y', which will\nreplace the existing scale.\n\n\n\nShow the codeoid <- 3\n\n\n\nShow the codep <- clean_slate() |>\n  add_figure(res$gg)\n\noid <- stringr::str_pad(oid, 2, \"left\", \"0\")\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \".pdf\")),\n  file_graph_alone = \n    file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \"_af.pdf\"))\n)\n\n[log] output saved as: ../tlg/graph/t2d_11_03.pdf\n\n\n[log] output saved as: ../tlg/graph/t2d_11_03_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\n\nShow the codeoid <- 4\ntitle <- \"miRNA at baseline - WGCNA modules\"\n\n\n\nShow the codespl_mod <- rbind(\n  dyn_mge$oldMEs |>\n    as.data.frame() |>\n    tibble::rownames_to_column(\"sample\") |>\n    tidyr::pivot_longer(\n      cols = -\"sample\",\n      names_to = \"module\"\n    ) |>\n    within(type <- \"raw_me\"),\n  dyn_mge$newMEs |>\n    as.data.frame() |>\n    tibble::rownames_to_column(\"sample\") |>\n    tidyr::pivot_longer(\n      cols = -\"sample\",\n      names_to = \"module\"\n    ) |>\n    within(type <- \"merged_me\")\n)\n\nft_mod <- data.frame(\n  feature = colnames(dta_expr),\n  raw_me = dyn_col,\n  merged_me = dyn_mge$colors\n)\n\noid <- stringr::str_pad(oid, 2, \"left\", \"0\")\n\nexport_xl(\n  ft_mod = ft_mod,\n  spl_mod = spl_mod,\n  info = c(\n    title = title,\n    ft_mod = wrap_long_lines(\n      \"Associate genetic features with calculated module (a feature belongs to\n      a module)\"\n    ),\n    spl_mod = \"Sample eigengen value (eigengen _expression profile_)\",\n    source = \"UMB-BESD\"\n  ),\n  dir = cfg_prog$paths$grh,\n  basenm = paste0(params$basenm, \"_\", oid),\n  rdata = TRUE\n)\n\nRData output (binary: ../tlg/graph/t2d_11_04.RData\n\n\nExcel output: ../tlg/graph/t2d_11_04.xlsx\n\n\n\n\nShow the code#' # https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/FemaleLiver-01-dataInput.pdf\n#' # WGCNA: gene in rows, sample in cols\n\nctrl <- cfg_prog$rna\nngs_assay <- \"mrna\"\nctrl_wgcna <- cfg_prog$rna$wgcna$baseline$mrna\n\n\n\nShow the codedta <- besd_mae |>\n  (\\(mae) mae[ , , ngs_assay])() |>\n  filter_for_depth(ngs_assay, ctrl$depth_threshold[[ngs_assay]]) |>\n  filter_for_coldata(\"avisit\", is = \"Baseline\") |>\n  filter_for_coldata(\"diabcd\", is = c(\"NGT\", \"T2D\")) |>\n  filter_for_low_expr(ngs_assay, ctrl$cpm_threshold[[ngs_assay]]) |>\n  (\\(mae) {\n    mae[[ngs_assay]] <-\n      DESeq2::DESeqDataSetFromMatrix(\n        countData = mae[[ngs_assay]],\n        colData = colData(x = mae),\n        design = stats::formula(~ diabcd)\n      ) |>\n      DESeq2::varianceStabilizingTransformation(blind = FALSE) |>\n      SummarizedExperiment::assay()\n    mae\n  })()\n\nWarning: 'experiments' dropped; see 'metadata'\n\n\nharmonizing input:\n  removing 282 sampleMap rows not in names(experiments)\n\n\nfactor levels were dropped which had no samples\n\nShow the code#' WGCNA Expression data.\n#'\n#' A matrix or data frame in which columns are genes and rows ar samples.\n#'\ndta_expr <- t(dta[[ngs_assay]])\nassert_that(WGCNA::goodSamplesGenes(dta_expr, verbose = 0)$allOK)\n\ndta_traits <- colData(dta) |> droplevels()\n\n\n\nShow the codeexpr_desc <- \"mRNA / Baseline - VST\"\nexportas <- \"dta_11_01.RData\"\n\n\n\nShow the codeattr(dta_expr, \"desc\") <- expr_desc\nattr(dta_expr, \"label\") <- \"Variance-Stabilised Transformed expression matrix\"\n\nknitr::kable(dta_expr[1:5, 1:3])\nfilenm <- file.path(cfg_prog$paths$dta, exportas)\nsave(dta_expr, file = filenm)\nmessage(\"Export: \", filenm)\n\nExport: ../data/dta_11_01.RData\n\nShow the coderm(expr_desc, exportas)\n\n\n\n\nShow the codespl_clust <- hclust(dist(dta_expr), method = \"complete\")\n\n# Clustering Dendrogram of samples based on their Euclidean distance\ntheme_custom <- function(...) {\n    theme_dendro() +\n    theme(\n      plot.margin = unit(c(0, 0, 0, 0), \"null\"),\n      panel.spacing = unit(c(0, 0, 0, 0), \"null\")\n    ) +\n    theme(...)\n}\n\nlibrary(ggdendro)\nlibrary(ggplot2)\ndend <- spl_clust |> as.dendrogram()\n\ndta_traits$x <- rownames(dta_traits)\ndta_traits$x <- factor(dta_traits$x, levels = labels(dend))\ndta_traits <- as.data.frame(dta_traits)\n\nlim <- c(0, nobs(dend))\nddata <- ggdendro::dendro_data(dend, type = \"rectangle\")\n\np1 <- ggplot(ggdendro::segment(ddata)) +\n  geom_segment(aes(x = x, y = y, xend = xend, yend = yend)) +\n  coord_flip(clip = \"off\") +\n  scale_y_reverse(expand = expansion(0)) +\n  scale_x_continuous(\n    breaks = seq_len(nobs(dend)),\n    labels = ggdendro::label(ddata)$label,\n    lim = lim,\n    position = \"top\"\n  ) +\n  theme_custom(axis.text.y = element_text())\n\np2 <- ggplot(\n  dta_traits,\n  aes(\n    xmin = 0, xmax = 1,\n    ymin = as.numeric(x) - 1/2, ymax = as.numeric(x) + 1/2,\n    fill = diabcd\n  )\n) +\n  geom_rect(col = \"white\") +\n  scale_y_continuous(breaks = 1:34) +\n  scale_x_continuous(expand = expansion(0)) +\n  scale_fill_viridis_d(option = \"C\", direction = -1, begin = .2, end = .8) +\n  coord_cartesian(ylim = lim) +\n  theme_custom(legend.position = \"top\")\n\np4 <- ggplot(\n  dta_traits,\n  aes(\n    xmin = 0, xmax = 1,\n    ymin = as.numeric(x) - 1/2, ymax = as.numeric(x) + 1/2,\n    fill = !!as.name(col_fill)\n  )\n) +\n  geom_rect(col = \"white\") +\n  scale_y_continuous(breaks = 1:34) +\n  scale_x_continuous(expand = expansion(0)) +\n  scale_fill_viridis_c() +\n  coord_cartesian(ylim = lim) +\n  theme_custom(legend.position = \"top\")\n\np <- egg::ggarrange(\n  p1, p2, p4,\n  nrow = 1,\n  widths = c(2, 1, 1),\n  padding = unit(0, \"lines\"),\n  draw = FALSE\n)\n\n\n\nShow the codeoid <- 5\ntitle <- \"mRNA / Baseline -Clustering dendrogram of samples based on their\n  Euclidean distance and trait heatmap\"\n\n\n\nShow the codep <- clean_slate() |>\n  add_title(c(\n    paste0(\"Figure 11.\",   oid),\n    wrap_long_lines(title)\n  )) |>\n  add_figure(p, height = inches(5)) |>\n  add_note(c(\n    \"Note: VST transformed expression matrix used to estimate distances\n    between samples, _complete_ method was used for the hierarchical\n    clustering.\"\n  ))\n\noid <- stringr::str_pad(oid, 2, \"left\", \"0\")\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \".pdf\")),\n  file_graph_alone = \n    file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \"_af.pdf\"))\n)\n\n[log] output saved as: ../tlg/graph/t2d_11_05.pdf\n\n\n[log] output saved as: ../tlg/graph/t2d_11_05_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\n\n\nShow the codelibrary(WGCNA)\nenableWGCNAThreads()\n\npwr <- ctrl_wgcna$adjacency$power\nsft <- pickSoftThreshold(\n  dta_expr,\n  powerVector = c(c(1:10), seq(from = 12, to=20, by=2)),\n  verbose = 0\n)\n\nlibrary(ggplot2)\np1 <- ggplot(\n  sft$fitIndices,\n  aes(Power, - sign(slope) * SFT.R.sq, label = Power)\n) +\n  geom_hline(yintercept = .9, lty = 2) +\n  geom_hline(yintercept = c(0, 1), lty = 1) +\n  geom_line() +\n  geom_label(\n    data = sft$fitIndices |> subset(Power == pwr),\n    vjust = 0, nudge_y = .025\n  ) +\n  geom_segment(\n    data = sft$fitIndices |> subset(Power == pwr),\n    aes(xend = Power, yend = 0)\n  ) +\n  geom_segment(\n    data = sft$fitIndices |> subset(Power == pwr),\n    aes(xend = -Inf, yend = - sign(slope) * SFT.R.sq)\n  ) +\n  geom_point(aes(shape = Power == pwr), show.legend = FALSE, fill = \"white\") +\n  scale_shape_manual(values = c(\"TRUE\" = 21, \"FALSE\" = 3)) +\n  coord_cartesian(ylim = c(0, 1)) +\n  xlab(\"Soft Threshold (power)\") +\n  ylab(\"Scale Free Topology Model Fit\") +\n  ggtitle(\"Scale independence\") +\n  theme_minimal() +\n  theme(panel.grid.minor = element_blank())\n\np2 <- ggplot(\n  sft$fitIndices,\n  aes(Power, mean.k., label = Power, shape = Power == pwr)) +\n  geom_hline(yintercept = .9) +\n  geom_line() +\n  geom_segment(\n    data = sft$fitIndices |> subset(Power == pwr),\n    aes(xend = Power, yend = 0)\n  ) +\n  geom_segment(\n    data = sft$fitIndices |> subset(Power == pwr),\n    aes(xend = -Inf, yend = mean.k.)\n  ) +\n  geom_label(\n    data = sft$fitIndices |> subset(Power == pwr),\n    vjust = 0, hjust = 0, nudge_y = 1\n  ) +\n  geom_point(fill = \"white\", show.legend = FALSE) +\n  scale_shape_manual(values = c(\"TRUE\" = 21, \"FALSE\" = 3)) +\n  xlab(\"Soft Threshold (power)\") +\n  ylab(\"Mean connectivity\") +\n  ggtitle(\"Mean connectivity\") +\n  theme_minimal() +\n  theme(panel.grid.minor = element_blank())\n\np <- egg::ggarrange(p1, p2, nrow = 1, draw = FALSE)\n\n\n\nShow the codeoid <- 6\ntitle <- \"mRNA / Baseline - Soft threshold determination\"\n\n\n\nShow the codep <- clean_slate() |>\n  add_title(c(\n    paste0(\"Figure 11.\", oid),\n    title\n  )) |>\n  add_figure(p, width = inches(6), height = inches(3))\n\noid <- stringr::str_pad(oid, 2, \"left\", \"0\")\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \".pdf\")),\n  file_graph_alone = \n    file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \"_af.pdf\"))\n)\n\n[log] output saved as: ../tlg/graph/t2d_11_06.pdf\n\n\n[log] output saved as: ../tlg/graph/t2d_11_06_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\n\nShow the code# gene dissimilarity\ntom_dis <- dta_expr |>\n  adjacency(\n    type = ctrl_wgcna$adjacency$type,\n    power = ctrl_wgcna$adjacency$power,\n    corFnc = ctrl_wgcna$adjacency$cor_fn$value\n  ) |>\n  TOMsimilarity(TOMType = ctrl_wgcna$tom$type) |>\n  (\\(tom) 1 - tom)()\n\ngene_hc <- tom_dis |>\n  as.dist() |>\n  hclust(method = \"average\")\n\n# gene clustering\ndyn_mod <- cutreeDynamic(\n  gene_hc,\n  cutHeight = ctrl_wgcna$cuttree$cut_height,\n  minClusterSize = ctrl_wgcna$cuttree$min_cluster_size,\n  method = \"hybrid\",\n  distM = tom_dis,\n  deepSplit = ctrl_wgcna$cuttree$deep_split,\n  pamRespectsDendro = FALSE\n)\ndyn_col <- labels2colors(dyn_mod)\n\n# me: module eigengenes (also used to merge dyn_col)\ndyn_mge <- dta_expr |> WGCNA::mergeCloseModules(dyn_col)\nmeig <- dyn_mge$newMEs\n\n\n\nShow the code# Not exported yet\nWGCNA::plotDendroAndColors(\n  dendro = gene_hc,\n  colors = dyn_mge$color,\n  dendroLabels = FALSE,\n  addGuide = TRUE,\n  guideHang = 0.05,\n  groupLabels = \"\",\n  cex.rowText = 0.5,\n  cex.colorLabels = 0.5,\n  cex.dendroLabels = 0.9,\n  marAll = c(1, 1, 1, 1),\n  axes = FALSE,\n  ylab = NULL,\n  main = NULL\n)\ngraphics::par(mfrow = c(1, 1))\n\n\n\n\n\n\n\n\nShow the coderes <- gg_eigen(\n  dta_traits |>\n    subset(select = c(\n      diabcd, diab, age, trainn,\n      chol, glu0, glu120, glu30, glu60, hba1c, hdl,\n      homab, homair, insulin0, insulin120, insulin30, insulin60, ldl,\n      matsuda, trig, bmi, bodyfatp, dcal, dcarbt, dfatt,\n      dprot, fatacfr, fatmass, leanmass, smmass, vat, vo2maxe,\n      vo2maxlbm, vo2maxml, weight\n    )) |>\n    lapply(prep_col)|>\n    DataFrame(row.names = rownames(dta_traits)) |>\n    as.matrix(),\n  meig\n)\n\nScale for 'x' is already present. Adding another scale for 'x', which will\nreplace the existing scale.\n\n\nScale for 'y' is already present. Adding another scale for 'y', which will\nreplace the existing scale.\n\n\nScale for 'x' is already present. Adding another scale for 'x', which will\nreplace the existing scale.\n\n\nScale for 'y' is already present. Adding another scale for 'y', which will\nreplace the existing scale.\n\n\n\nShow the codeoid <- 7\n\n\n\nShow the codep <- clean_slate() |>\n  add_figure(res$gg)\n\noid <- stringr::str_pad(oid, 2, \"left\", \"0\")\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \".pdf\")),\n  file_graph_alone = \n    file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \"_af.pdf\"))\n)\n\n[log] output saved as: ../tlg/graph/t2d_11_07.pdf\n\n\n[log] output saved as: ../tlg/graph/t2d_11_07_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\n\nShow the codeoid <- 8\ntitle <- \"mRNA at baseline - WGCNA modules\"\n\n\n\nShow the codespl_mod <- rbind(\n  dyn_mge$oldMEs |>\n    as.data.frame() |>\n    tibble::rownames_to_column(\"sample\") |>\n    tidyr::pivot_longer(\n      cols = -\"sample\",\n      names_to = \"module\"\n    ) |>\n    within(type <- \"raw_me\"),\n  dyn_mge$newMEs |>\n    as.data.frame() |>\n    tibble::rownames_to_column(\"sample\") |>\n    tidyr::pivot_longer(\n      cols = -\"sample\",\n      names_to = \"module\"\n    ) |>\n    within(type <- \"merged_me\")\n)\n\nft_mod <- data.frame(\n  feature = colnames(dta_expr),\n  raw_me = dyn_col,\n  merged_me = dyn_mge$colors\n)\n\noid <- stringr::str_pad(oid, 2, \"left\", \"0\")\n\nexport_xl(\n  ft_mod = ft_mod,\n  spl_mod = spl_mod,\n  info = c(\n    title = title,\n    ft_mod = wrap_long_lines(\n      \"Associate genetic features with calculated module (a feature belongs to\n      a module)\"\n    ),\n    spl_mod = \"Sample eigengen value (eigengen _expression profile_)\",\n    source = \"UMB-BESD\"\n  ),\n  dir = cfg_prog$paths$grh,\n  basenm = paste0(params$basenm, \"_\", oid),\n  rdata = TRUE\n)\n\nRData output (binary: ../tlg/graph/t2d_11_08.RData\n\n\nExcel output: ../tlg/graph/t2d_11_08.xlsx\n\n\n\n\nShow the code#' # https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/FemaleLiver-01-dataInput.pdf\n#' # WGCNA: gene in rows, sample in cols\n\nctrl <- cfg_prog$rna\nngs_assay <- \"allmirna\"\nctrl_wgcna <- cfg_prog$rna$wgcna$chg$allmirna # TODO\n\n# Specific to sample_clustering\ncol_fill <- \"glu120_chg\"\n\n\n\nShow the codefilter_for_paired_visits <- function(mae) {\n  assert_that(all(table(colData(mae)$subjid) <= 2))\n\n  subj <- table(colData(mae)$subjid)\n  subj <- names(subj[subj == 2])\n  mae <- mae[, colData(mae)$subjid %in% subj, ]\n\n  chk_df <- as.data.frame(colData(mae))\n  check <- split(chk_df, f = chk_df$avisit)\n\n  # Verify the selection:\n  assert_that(all(\n    sapply(check, subj = subj,\\(x, subj) all(subj %in% x$subjid))\n  ))\n  mae\n}\n\ngc()\ndta <- besd_mae |>\n  (\\(mae) mae[ , , ngs_assay])() |>\n  filter_for_depth(ngs_assay, ctrl$depth_threshold[[ngs_assay]]) |>\n  filter_for_paired_visits() |>\n  filter_for_low_expr(ngs_assay, ctrl$cpm_threshold[[ngs_assay]]) |>\n  (\\(mae) {\n    # VST transformation\n    colData(mae) <- droplevels(colData(mae))\n    colData(mae)$avisit_ <- factor(\n      colData(mae)$avisit,\n      levels = levels(colData(mae)$avisit),\n      labels = sub(\" \", \"_\", levels(colData(mae)$avisit))\n    )\n    coldata <- colData(mae)[c(\"diabcd\", \"subjid\", \"avisit_\")]\n\n    mae[[ngs_assay]] <- DESeq2::DESeqDataSetFromMatrix(\n      countData = mae[[ngs_assay]],\n      colData = colData(x = mae),\n      design = stats::formula(~ subjid + avisit_)\n    ) |>\n      DESeq2::varianceStabilizingTransformation(blind = FALSE) |>\n      SummarizedExperiment::assay()\n\n    mae\n  })() |>\n  filter_for_coldata(\"diabcd\", is = c(\"NGT\", \"T2D\")) |>\n  (\\(mae) {\n    # Get traits: BL, M3, CHG:\n    bl <- mae[, colData(mae)$avisit == \"Baseline\", ]\n    m3 <- mae[, colData(mae)$avisit == \"Month 3\", ]\n    assert_that(all(colData(bl)$subjid == colData(m3)$subjid))\n    mat <- m3[[ngs_assay]] - bl[[ngs_assay]]\n    nm <- setNames(colData(mae)$subjid, nm = rownames(colData(mae)))\n    colnames(mat) <- nm[colnames(mat)]\n\n    get_vars_when <- function(mae,\n                              fun = is.numeric,\n                              col_names = TRUE) {\n      df <- colData(mae)\n      assert_that(all(table(df$subjid) <= 1))\n      rownames(df) <- df$subjid\n      df <- df[, sapply(df, fun)]\n      if (col_names)\n        colnames(df) <- paste0(tolower(colnames(df)), \"_\", substitute(mae))\n      df\n    }\n    m3_cd <- get_vars_when(m3, is.numeric) # m3_col data\n    bl_cd <- get_vars_when(bl, is.numeric)\n    # bl qualitative (diabcd and other)\n    bl_ql <- get_vars_when(bl, Negate(is.numeric), col_names = FALSE)\n    traits <- Map(a = m3_cd, b = bl_cd, f = \\(a, b) a - b) |>\n      S4Vectors::DataFrame() |>\n      (\\(df, ...) {\n        args <- list(...)\n        colnames(df) <- gsub(\"_m3\", \"_chg\", colnames(df))\n        df <- do.call(cbind, c(args, list(df)))\n        # Constant columns are not interesting for gene variation association\n        df[sapply(df, sd) > 0]\n      })(bl_cd, m3_cd) |>\n      cbind(bl_ql)\n\n    MultiAssayExperiment(\n      experiments = ExperimentList(vst = mat),\n      colData = traits\n    )\n  })()\n\nWarning: 'experiments' dropped; see 'metadata'\n\n\nharmonizing input:\n  removing 282 sampleMap rows not in names(experiments)\n\nShow the code#' WGCNA Expression data.\n#'\n#' A matrix or data frame in which columns are genes and rows ar samples.\n#'\ndta_expr <- t(dta[[\"vst\"]])\nassert_that(WGCNA::goodSamplesGenes(dta_expr, verbose = 0)$allOK)\ndta_traits <- colData(dta) |> droplevels()\n\n\n\n\nShow the codespl_clust <- hclust(dist(dta_expr), method = \"complete\")\n\n# Clustering Dendrogram of samples based on their Euclidean distance\ntheme_custom <- function(...) {\n    theme_dendro() +\n    theme(\n      plot.margin = unit(c(0, 0, 0, 0), \"null\"),\n      panel.spacing = unit(c(0, 0, 0, 0), \"null\")\n    ) +\n    theme(...)\n}\n\nlibrary(ggdendro)\nlibrary(ggplot2)\ndend <- spl_clust |> as.dendrogram()\n\ndta_traits$x <- rownames(dta_traits)\ndta_traits$x <- factor(dta_traits$x, levels = labels(dend))\ndta_traits <- as.data.frame(dta_traits)\n\nlim <- c(0, nobs(dend))\nddata <- ggdendro::dendro_data(dend, type = \"rectangle\")\n\np1 <- ggplot(ggdendro::segment(ddata)) +\n  geom_segment(aes(x = x, y = y, xend = xend, yend = yend)) +\n  coord_flip(clip = \"off\") +\n  scale_y_reverse(expand = expansion(0)) +\n  scale_x_continuous(\n    breaks = seq_len(nobs(dend)),\n    labels = ggdendro::label(ddata)$label,\n    lim = lim,\n    position = \"top\"\n  ) +\n  theme_custom(axis.text.y = element_text())\n\np2 <- ggplot(\n  dta_traits,\n  aes(\n    xmin = 0, xmax = 1,\n    ymin = as.numeric(x) - 1/2, ymax = as.numeric(x) + 1/2,\n    fill = diabcd\n  )\n) +\n  geom_rect(col = \"white\") +\n  scale_y_continuous(breaks = 1:34) +\n  scale_x_continuous(expand = expansion(0)) +\n  scale_fill_viridis_d(option = \"C\", direction = -1, begin = .2, end = .8) +\n  coord_cartesian(ylim = lim) +\n  theme_custom(legend.position = \"top\")\n\np4 <- ggplot(\n  dta_traits,\n  aes(\n    xmin = 0, xmax = 1,\n    ymin = as.numeric(x) - 1/2, ymax = as.numeric(x) + 1/2,\n    fill = !!as.name(col_fill)\n  )\n) +\n  geom_rect(col = \"white\") +\n  scale_y_continuous(breaks = 1:34) +\n  scale_x_continuous(expand = expansion(0)) +\n  scale_fill_viridis_c() +\n  coord_cartesian(ylim = lim) +\n  theme_custom(legend.position = \"top\")\n\np <- egg::ggarrange(\n  p1, p2, p4,\n  nrow = 1,\n  widths = c(2, 1, 1),\n  padding = unit(0, \"lines\"),\n  draw = FALSE\n)\n\n\n\nShow the codeoid <- 9\ntitle <- \"miRNA / Change from Baseline - Clustering dendrogram of samples based\n  on their Euclidean distance and trait heatmap\"\n\n\n\nShow the codep <- clean_slate() |>\n  add_title(c(\n    paste0(\"Figure 11.\",   oid),\n    wrap_long_lines(title)\n  )) |>\n  add_figure(p, height = inches(5)) |>\n  add_note(c(\n    \"Note: VST transformed expression matrix used to estimate distances\n    between samples, _complete_ method was used for the hierarchical\n    clustering.\"\n  ))\n\noid <- stringr::str_pad(oid, 2, \"left\", \"0\")\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \".pdf\")),\n  file_graph_alone = \n    file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \"_af.pdf\"))\n)\n\n[log] output saved as: ../tlg/graph/t2d_11_09.pdf\n\n\n[log] output saved as: ../tlg/graph/t2d_11_09_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\n\n\nShow the codelibrary(WGCNA)\nenableWGCNAThreads()\n\npwr <- ctrl_wgcna$adjacency$power\nsft <- pickSoftThreshold(\n  dta_expr,\n  powerVector = c(c(1:10), seq(from = 12, to=20, by=2)),\n  verbose = 0\n)\n\nlibrary(ggplot2)\np1 <- ggplot(\n  sft$fitIndices,\n  aes(Power, - sign(slope) * SFT.R.sq, label = Power)\n) +\n  geom_hline(yintercept = .9, lty = 2) +\n  geom_hline(yintercept = c(0, 1), lty = 1) +\n  geom_line() +\n  geom_label(\n    data = sft$fitIndices |> subset(Power == pwr),\n    vjust = 0, nudge_y = .025\n  ) +\n  geom_segment(\n    data = sft$fitIndices |> subset(Power == pwr),\n    aes(xend = Power, yend = 0)\n  ) +\n  geom_segment(\n    data = sft$fitIndices |> subset(Power == pwr),\n    aes(xend = -Inf, yend = - sign(slope) * SFT.R.sq)\n  ) +\n  geom_point(aes(shape = Power == pwr), show.legend = FALSE, fill = \"white\") +\n  scale_shape_manual(values = c(\"TRUE\" = 21, \"FALSE\" = 3)) +\n  coord_cartesian(ylim = c(0, 1)) +\n  xlab(\"Soft Threshold (power)\") +\n  ylab(\"Scale Free Topology Model Fit\") +\n  ggtitle(\"Scale independence\") +\n  theme_minimal() +\n  theme(panel.grid.minor = element_blank())\n\np2 <- ggplot(\n  sft$fitIndices,\n  aes(Power, mean.k., label = Power, shape = Power == pwr)) +\n  geom_hline(yintercept = .9) +\n  geom_line() +\n  geom_segment(\n    data = sft$fitIndices |> subset(Power == pwr),\n    aes(xend = Power, yend = 0)\n  ) +\n  geom_segment(\n    data = sft$fitIndices |> subset(Power == pwr),\n    aes(xend = -Inf, yend = mean.k.)\n  ) +\n  geom_label(\n    data = sft$fitIndices |> subset(Power == pwr),\n    vjust = 0, hjust = 0, nudge_y = 1\n  ) +\n  geom_point(fill = \"white\", show.legend = FALSE) +\n  scale_shape_manual(values = c(\"TRUE\" = 21, \"FALSE\" = 3)) +\n  xlab(\"Soft Threshold (power)\") +\n  ylab(\"Mean connectivity\") +\n  ggtitle(\"Mean connectivity\") +\n  theme_minimal() +\n  theme(panel.grid.minor = element_blank())\n\np <- egg::ggarrange(p1, p2, nrow = 1, draw = FALSE)\n\n\n\nShow the codeoid <- 10\ntitle <- \"Micro-RNA / Change from Baseline - Soft threshold determination\"\n\n\n\nShow the codep <- clean_slate() |>\n  add_title(c(\n    paste0(\"Figure 11.\", oid),\n    title\n  )) |>\n  add_figure(p, width = inches(6), height = inches(3))\n\noid <- stringr::str_pad(oid, 2, \"left\", \"0\")\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \".pdf\")),\n  file_graph_alone = \n    file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \"_af.pdf\"))\n)\n\n[log] output saved as: ../tlg/graph/t2d_11_10.pdf\n\n\n[log] output saved as: ../tlg/graph/t2d_11_10_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\n\nShow the code# gene dissimilarity\ntom_dis <- dta_expr |>\n  adjacency(\n    type = ctrl_wgcna$adjacency$type,\n    power = ctrl_wgcna$adjacency$power,\n    corFnc = ctrl_wgcna$adjacency$cor_fn$value\n  ) |>\n  TOMsimilarity(TOMType = ctrl_wgcna$tom$type) |>\n  (\\(tom) 1 - tom)()\n\ngene_hc <- tom_dis |>\n  as.dist() |>\n  hclust(method = \"average\")\n\n# gene clustering\ndyn_mod <- cutreeDynamic(\n  gene_hc,\n  cutHeight = ctrl_wgcna$cuttree$cut_height,\n  minClusterSize = ctrl_wgcna$cuttree$min_cluster_size,\n  method = \"hybrid\",\n  distM = tom_dis,\n  deepSplit = ctrl_wgcna$cuttree$deep_split,\n  pamRespectsDendro = FALSE\n)\ndyn_col <- labels2colors(dyn_mod)\n\n# me: module eigengenes (also used to merge dyn_col)\ndyn_mge <- dta_expr |> WGCNA::mergeCloseModules(dyn_col)\nmeig <- dyn_mge$newMEs\n\n\n\nShow the code# Not exported yet\nWGCNA::plotDendroAndColors(\n  dendro = gene_hc,\n  colors = dyn_mge$color,\n  dendroLabels = FALSE,\n  addGuide = TRUE,\n  guideHang = 0.05,\n  groupLabels = \"\",\n  cex.rowText = 0.5,\n  cex.colorLabels = 0.5,\n  cex.dendroLabels = 0.9,\n  marAll = c(1, 1, 1, 1),\n  axes = FALSE,\n  ylab = NULL,\n  main = NULL\n)\ngraphics::par(mfrow = c(1, 1))\n\n\n\n\n\n\n\n\nShow the coderes <- gg_eigen(\n  dta_traits |>\n    (\\(df) df[sapply(\n       df,\n       function(x) if (is.numeric(x)) sd(x) > 0 else length(unique(x)) > 1\n     )]) () |>\n    lapply(prep_col)|>\n    DataFrame(row.names = rownames(dta_traits)) |>\n    as.matrix(),\n  meig\n)\n\nScale for 'x' is already present. Adding another scale for 'x', which will\nreplace the existing scale.\n\n\nScale for 'y' is already present. Adding another scale for 'y', which will\nreplace the existing scale.\n\n\nScale for 'x' is already present. Adding another scale for 'x', which will\nreplace the existing scale.\n\n\nScale for 'y' is already present. Adding another scale for 'y', which will\nreplace the existing scale.\n\n\n\nShow the codeoid <- 11\n\n\n\nShow the codep <- clean_slate() |>\n  add_figure(res$gg)\n\noid <- stringr::str_pad(oid, 2, \"left\", \"0\")\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \".pdf\")),\n  file_graph_alone = \n    file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \"_af.pdf\"))\n)\n\n[log] output saved as: ../tlg/graph/t2d_11_11.pdf\n\n\n[log] output saved as: ../tlg/graph/t2d_11_11_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\n\nShow the codeoid <- 12\ntitle <- \"miRNA Change from Baseline - WGCNA modules\"\n\n\n\nShow the codespl_mod <- rbind(\n  dyn_mge$oldMEs |>\n    as.data.frame() |>\n    tibble::rownames_to_column(\"sample\") |>\n    tidyr::pivot_longer(\n      cols = -\"sample\",\n      names_to = \"module\"\n    ) |>\n    within(type <- \"raw_me\"),\n  dyn_mge$newMEs |>\n    as.data.frame() |>\n    tibble::rownames_to_column(\"sample\") |>\n    tidyr::pivot_longer(\n      cols = -\"sample\",\n      names_to = \"module\"\n    ) |>\n    within(type <- \"merged_me\")\n)\n\nft_mod <- data.frame(\n  feature = colnames(dta_expr),\n  raw_me = dyn_col,\n  merged_me = dyn_mge$colors\n)\n\noid <- stringr::str_pad(oid, 2, \"left\", \"0\")\n\nexport_xl(\n  ft_mod = ft_mod,\n  spl_mod = spl_mod,\n  info = c(\n    title = title,\n    ft_mod = wrap_long_lines(\n      \"Associate genetic features with calculated module (a feature belongs to\n      a module)\"\n    ),\n    spl_mod = \"Sample eigengen value (eigengen _expression profile_)\",\n    source = \"UMB-BESD\"\n  ),\n  dir = cfg_prog$paths$grh,\n  basenm = paste0(params$basenm, \"_\", oid),\n  rdata = TRUE\n)\n\nRData output (binary: ../tlg/graph/t2d_11_12.RData\n\n\nExcel output: ../tlg/graph/t2d_11_12.xlsx\n\n\n\n\nShow the code#' # https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/FemaleLiver-01-dataInput.pdf\n#' # WGCNA: gene in rows, sample in cols\n\nctrl <- cfg_prog$rna\nngs_assay <- \"mrna\"\nctrl_wgcna <- cfg_prog$rna$wgcna$chg$mrna\n\n# Specific to sample_clustering\ncol_fill <- \"glu120_chg\"\n\n\n\nShow the codefilter_for_paired_visits <- function(mae) {\n  assert_that(all(table(colData(mae)$subjid) <= 2))\n\n  subj <- table(colData(mae)$subjid)\n  subj <- names(subj[subj == 2])\n  mae <- mae[, colData(mae)$subjid %in% subj, ]\n\n  chk_df <- as.data.frame(colData(mae))\n  check <- split(chk_df, f = chk_df$avisit)\n\n  # Verify the selection:\n  assert_that(all(\n    sapply(check, subj = subj,\\(x, subj) all(subj %in% x$subjid))\n  ))\n  mae\n}\n\ngc()\ndta <- besd_mae |>\n  (\\(mae) mae[ , , ngs_assay])() |>\n  filter_for_depth(ngs_assay, ctrl$depth_threshold[[ngs_assay]]) |>\n  filter_for_paired_visits() |>\n  filter_for_low_expr(ngs_assay, ctrl$cpm_threshold[[ngs_assay]]) |>\n  (\\(mae) {\n    # VST transformation\n    colData(mae) <- droplevels(colData(mae))\n    colData(mae)$avisit_ <- factor(\n      colData(mae)$avisit,\n      levels = levels(colData(mae)$avisit),\n      labels = sub(\" \", \"_\", levels(colData(mae)$avisit))\n    )\n    coldata <- colData(mae)[c(\"diabcd\", \"subjid\", \"avisit_\")]\n\n    mae[[ngs_assay]] <- DESeq2::DESeqDataSetFromMatrix(\n      countData = mae[[ngs_assay]],\n      colData = colData(x = mae),\n      design = stats::formula(~ subjid + avisit_)\n    ) |>\n      DESeq2::varianceStabilizingTransformation(blind = FALSE) |>\n      SummarizedExperiment::assay()\n\n    mae\n  })() |>\n  filter_for_coldata(\"diabcd\", is = c(\"NGT\", \"T2D\")) |>\n  (\\(mae) {\n    # Get traits: BL, M3, CHG:\n    bl <- mae[, colData(mae)$avisit == \"Baseline\", ]\n    m3 <- mae[, colData(mae)$avisit == \"Month 3\", ]\n    assert_that(all(colData(bl)$subjid == colData(m3)$subjid))\n    mat <- m3[[ngs_assay]] - bl[[ngs_assay]]\n    nm <- setNames(colData(mae)$subjid, nm = rownames(colData(mae)))\n    colnames(mat) <- nm[colnames(mat)]\n\n    get_vars_when <- function(mae,\n                              fun = is.numeric,\n                              col_names = TRUE) {\n      df <- colData(mae)\n      assert_that(all(table(df$subjid) <= 1))\n      rownames(df) <- df$subjid\n      df <- df[, sapply(df, fun)]\n      if (col_names)\n        colnames(df) <- paste0(tolower(colnames(df)), \"_\", substitute(mae))\n      df\n    }\n    m3_cd <- get_vars_when(m3, is.numeric) # m3_col data\n    bl_cd <- get_vars_when(bl, is.numeric)\n    # bl qualitative (diabcd and other)\n    bl_ql <- get_vars_when(bl, Negate(is.numeric), col_names = FALSE)\n    traits <- Map(a = m3_cd, b = bl_cd, f = \\(a, b) a - b) |>\n      S4Vectors::DataFrame() |>\n      (\\(df, ...) {\n        args <- list(...)\n        colnames(df) <- gsub(\"_m3\", \"_chg\", colnames(df))\n        df <- do.call(cbind, c(args, list(df)))\n        # Constant columns are not interesting for gene variation association\n        df[sapply(df, sd) > 0]\n      })(bl_cd, m3_cd) |>\n      cbind(bl_ql)\n\n    MultiAssayExperiment(\n      experiments = ExperimentList(vst = mat),\n      colData = traits\n    )\n  })()\n\nWarning: 'experiments' dropped; see 'metadata'\n\n\nharmonizing input:\n  removing 282 sampleMap rows not in names(experiments)\n\nShow the code#' WGCNA Expression data.\n#'\n#' A matrix or data frame in which columns are genes and rows ar samples.\n#'\ndta_expr <- t(dta[[\"vst\"]])\nassert_that(WGCNA::goodSamplesGenes(dta_expr, verbose = 0)$allOK)\ndta_traits <- colData(dta) |> droplevels()\n\n\n\n\nShow the codespl_clust <- hclust(dist(dta_expr), method = \"complete\")\n\n# Clustering Dendrogram of samples based on their Euclidean distance\ntheme_custom <- function(...) {\n    theme_dendro() +\n    theme(\n      plot.margin = unit(c(0, 0, 0, 0), \"null\"),\n      panel.spacing = unit(c(0, 0, 0, 0), \"null\")\n    ) +\n    theme(...)\n}\n\nlibrary(ggdendro)\nlibrary(ggplot2)\ndend <- spl_clust |> as.dendrogram()\n\ndta_traits$x <- rownames(dta_traits)\ndta_traits$x <- factor(dta_traits$x, levels = labels(dend))\ndta_traits <- as.data.frame(dta_traits)\n\nlim <- c(0, nobs(dend))\nddata <- ggdendro::dendro_data(dend, type = \"rectangle\")\n\np1 <- ggplot(ggdendro::segment(ddata)) +\n  geom_segment(aes(x = x, y = y, xend = xend, yend = yend)) +\n  coord_flip(clip = \"off\") +\n  scale_y_reverse(expand = expansion(0)) +\n  scale_x_continuous(\n    breaks = seq_len(nobs(dend)),\n    labels = ggdendro::label(ddata)$label,\n    lim = lim,\n    position = \"top\"\n  ) +\n  theme_custom(axis.text.y = element_text())\n\np2 <- ggplot(\n  dta_traits,\n  aes(\n    xmin = 0, xmax = 1,\n    ymin = as.numeric(x) - 1/2, ymax = as.numeric(x) + 1/2,\n    fill = diabcd\n  )\n) +\n  geom_rect(col = \"white\") +\n  scale_y_continuous(breaks = 1:34) +\n  scale_x_continuous(expand = expansion(0)) +\n  scale_fill_viridis_d(option = \"C\", direction = -1, begin = .2, end = .8) +\n  coord_cartesian(ylim = lim) +\n  theme_custom(legend.position = \"top\")\n\np4 <- ggplot(\n  dta_traits,\n  aes(\n    xmin = 0, xmax = 1,\n    ymin = as.numeric(x) - 1/2, ymax = as.numeric(x) + 1/2,\n    fill = !!as.name(col_fill)\n  )\n) +\n  geom_rect(col = \"white\") +\n  scale_y_continuous(breaks = 1:34) +\n  scale_x_continuous(expand = expansion(0)) +\n  scale_fill_viridis_c() +\n  coord_cartesian(ylim = lim) +\n  theme_custom(legend.position = \"top\")\n\np <- egg::ggarrange(\n  p1, p2, p4,\n  nrow = 1,\n  widths = c(2, 1, 1),\n  padding = unit(0, \"lines\"),\n  draw = FALSE\n)\n\n\n\nShow the codeoid <- 13\ntitle <- \"mRNA / Change from Baseline - Clustering dendrogram of samples based\n  on their Euclidean distance and trait heatmap\"\n\n\n\nShow the codep <- clean_slate() |>\n  add_title(c(\n    paste0(\"Figure 11.\",   oid),\n    wrap_long_lines(title)\n  )) |>\n  add_figure(p, height = inches(5)) |>\n  add_note(c(\n    \"Note: VST transformed expression matrix used to estimate distances\n    between samples, _complete_ method was used for the hierarchical\n    clustering.\"\n  ))\n\noid <- stringr::str_pad(oid, 2, \"left\", \"0\")\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \".pdf\")),\n  file_graph_alone = \n    file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \"_af.pdf\"))\n)\n\n[log] output saved as: ../tlg/graph/t2d_11_13.pdf\n\n\n[log] output saved as: ../tlg/graph/t2d_11_13_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\n\n\nShow the codelibrary(WGCNA)\nenableWGCNAThreads()\n\npwr <- ctrl_wgcna$adjacency$power\nsft <- pickSoftThreshold(\n  dta_expr,\n  powerVector = c(c(1:10), seq(from = 12, to=20, by=2)),\n  verbose = 0\n)\n\nlibrary(ggplot2)\np1 <- ggplot(\n  sft$fitIndices,\n  aes(Power, - sign(slope) * SFT.R.sq, label = Power)\n) +\n  geom_hline(yintercept = .9, lty = 2) +\n  geom_hline(yintercept = c(0, 1), lty = 1) +\n  geom_line() +\n  geom_label(\n    data = sft$fitIndices |> subset(Power == pwr),\n    vjust = 0, nudge_y = .025\n  ) +\n  geom_segment(\n    data = sft$fitIndices |> subset(Power == pwr),\n    aes(xend = Power, yend = 0)\n  ) +\n  geom_segment(\n    data = sft$fitIndices |> subset(Power == pwr),\n    aes(xend = -Inf, yend = - sign(slope) * SFT.R.sq)\n  ) +\n  geom_point(aes(shape = Power == pwr), show.legend = FALSE, fill = \"white\") +\n  scale_shape_manual(values = c(\"TRUE\" = 21, \"FALSE\" = 3)) +\n  coord_cartesian(ylim = c(0, 1)) +\n  xlab(\"Soft Threshold (power)\") +\n  ylab(\"Scale Free Topology Model Fit\") +\n  ggtitle(\"Scale independence\") +\n  theme_minimal() +\n  theme(panel.grid.minor = element_blank())\n\np2 <- ggplot(\n  sft$fitIndices,\n  aes(Power, mean.k., label = Power, shape = Power == pwr)) +\n  geom_hline(yintercept = .9) +\n  geom_line() +\n  geom_segment(\n    data = sft$fitIndices |> subset(Power == pwr),\n    aes(xend = Power, yend = 0)\n  ) +\n  geom_segment(\n    data = sft$fitIndices |> subset(Power == pwr),\n    aes(xend = -Inf, yend = mean.k.)\n  ) +\n  geom_label(\n    data = sft$fitIndices |> subset(Power == pwr),\n    vjust = 0, hjust = 0, nudge_y = 1\n  ) +\n  geom_point(fill = \"white\", show.legend = FALSE) +\n  scale_shape_manual(values = c(\"TRUE\" = 21, \"FALSE\" = 3)) +\n  xlab(\"Soft Threshold (power)\") +\n  ylab(\"Mean connectivity\") +\n  ggtitle(\"Mean connectivity\") +\n  theme_minimal() +\n  theme(panel.grid.minor = element_blank())\n\np <- egg::ggarrange(p1, p2, nrow = 1, draw = FALSE)\n\n\n\nShow the codeoid <- 14\ntitle <- \"mRNA / Change from Baseline - Soft threshold determination\"\n\n\n\nShow the codep <- clean_slate() |>\n  add_title(c(\n    paste0(\"Figure 11.\", oid),\n    title\n  )) |>\n  add_figure(p, width = inches(6), height = inches(3))\n\noid <- stringr::str_pad(oid, 2, \"left\", \"0\")\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \".pdf\")),\n  file_graph_alone = \n    file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \"_af.pdf\"))\n)\n\n[log] output saved as: ../tlg/graph/t2d_11_14.pdf\n\n\n[log] output saved as: ../tlg/graph/t2d_11_14_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\n\nShow the code# gene dissimilarity\ntom_dis <- dta_expr |>\n  adjacency(\n    type = ctrl_wgcna$adjacency$type,\n    power = ctrl_wgcna$adjacency$power,\n    corFnc = ctrl_wgcna$adjacency$cor_fn$value\n  ) |>\n  TOMsimilarity(TOMType = ctrl_wgcna$tom$type) |>\n  (\\(tom) 1 - tom)()\n\ngene_hc <- tom_dis |>\n  as.dist() |>\n  hclust(method = \"average\")\n\n# gene clustering\ndyn_mod <- cutreeDynamic(\n  gene_hc,\n  cutHeight = ctrl_wgcna$cuttree$cut_height,\n  minClusterSize = ctrl_wgcna$cuttree$min_cluster_size,\n  method = \"hybrid\",\n  distM = tom_dis,\n  deepSplit = ctrl_wgcna$cuttree$deep_split,\n  pamRespectsDendro = FALSE\n)\ndyn_col <- labels2colors(dyn_mod)\n\n# me: module eigengenes (also used to merge dyn_col)\ndyn_mge <- dta_expr |> WGCNA::mergeCloseModules(dyn_col)\nmeig <- dyn_mge$newMEs\n\n\n\nShow the code# Not exported yet\nWGCNA::plotDendroAndColors(\n  dendro = gene_hc,\n  colors = dyn_mge$color,\n  dendroLabels = FALSE,\n  addGuide = TRUE,\n  guideHang = 0.05,\n  groupLabels = \"\",\n  cex.rowText = 0.5,\n  cex.colorLabels = 0.5,\n  cex.dendroLabels = 0.9,\n  marAll = c(1, 1, 1, 1),\n  axes = FALSE,\n  ylab = NULL,\n  main = NULL\n)\ngraphics::par(mfrow = c(1, 1))\n\n\n\n\n\n\n\n\nShow the coderes <- gg_eigen(\n  dta_traits |>\n    (\\(df) df[sapply(\n       df,\n       function(x) if (is.numeric(x)) sd(x) > 0 else length(unique(x)) > 1\n     )]) () |>\n    lapply(prep_col)|>\n    DataFrame(row.names = rownames(dta_traits)) |>\n    as.matrix(),\n  meig\n)\n\nScale for 'x' is already present. Adding another scale for 'x', which will\nreplace the existing scale.\n\n\nScale for 'y' is already present. Adding another scale for 'y', which will\nreplace the existing scale.\n\n\nScale for 'x' is already present. Adding another scale for 'x', which will\nreplace the existing scale.\n\n\nScale for 'y' is already present. Adding another scale for 'y', which will\nreplace the existing scale.\n\n\n\nShow the codeoid <- 15\n\n\n\nShow the codep <- clean_slate() |>\n  add_figure(res$gg)\n\noid <- stringr::str_pad(oid, 2, \"left\", \"0\")\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \".pdf\")),\n  file_graph_alone = \n    file.path(cfg_prog$paths$grh, paste0(params$basenm, \"_\", oid, \"_af.pdf\"))\n)\n\n[log] output saved as: ../tlg/graph/t2d_11_15.pdf\n\n\n[log] output saved as: ../tlg/graph/t2d_11_15_af.pdf (annot. free)\n\n\n\nShow the codeshow_slate(p)\n\n\n\n\nShow the codeoid <- 16\ntitle <- \"mRNA Change from Baseline - WGCNA modules\"\n\n\n\nShow the codespl_mod <- rbind(\n  dyn_mge$oldMEs |>\n    as.data.frame() |>\n    tibble::rownames_to_column(\"sample\") |>\n    tidyr::pivot_longer(\n      cols = -\"sample\",\n      names_to = \"module\"\n    ) |>\n    within(type <- \"raw_me\"),\n  dyn_mge$newMEs |>\n    as.data.frame() |>\n    tibble::rownames_to_column(\"sample\") |>\n    tidyr::pivot_longer(\n      cols = -\"sample\",\n      names_to = \"module\"\n    ) |>\n    within(type <- \"merged_me\")\n)\n\nft_mod <- data.frame(\n  feature = colnames(dta_expr),\n  raw_me = dyn_col,\n  merged_me = dyn_mge$colors\n)\n\noid <- stringr::str_pad(oid, 2, \"left\", \"0\")\n\nexport_xl(\n  ft_mod = ft_mod,\n  spl_mod = spl_mod,\n  info = c(\n    title = title,\n    ft_mod = wrap_long_lines(\n      \"Associate genetic features with calculated module (a feature belongs to\n      a module)\"\n    ),\n    spl_mod = \"Sample eigengen value (eigengen _expression profile_)\",\n    source = \"UMB-BESD\"\n  ),\n  dir = cfg_prog$paths$grh,\n  basenm = paste0(params$basenm, \"_\", oid),\n  rdata = TRUE\n)\n\nRData output (binary: ../tlg/graph/t2d_11_16.RData\n\n\nExcel output: ../tlg/graph/t2d_11_16.xlsx"
  },
  {
    "objectID": "t2d_11_wcn.html#session-informations",
    "href": "t2d_11_wcn.html#session-informations",
    "title": "\n6  WGCNA\n",
    "section": "\n6.2 Session Informations",
    "text": "6.2 Session Informations\n\nShow the codesessioninfo::session_info()\n\n\n\n\n\n\n\n\nLangfelder, Peter, and Steve Horvath. 2008. “WGCNA: An r Package for Weighted Correlation Network Analysis.” BMC Bioinformatics, no. 1: 559. https://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-9-559.\n\n\n———. 2012. “Fast R Functions for Robust Correlations and Hierarchical Clustering.” Journal of Statistical Software 46 (11): 1–17. https://www.jstatsoft.org/v46/i11/.\n\n\nLove, Michael I., Wolfgang Huber, and Simon Anders. 2014. “Moderated Estimation of Fold Change and Dispersion for RNA-Seq Data with DESeq2.” Genome Biology 15: 550. https://doi.org/10.1186/s13059-014-0550-8.\n\n\nNiemira, Magdalena, Francois Collin, Anna Szalkowska, Agnieszka Bielska, Karolina Chwialkowska, Joanna Reszec, Jacek Niklinski, Miroslaw Kwasniewski, and Adam Kretowski. 2020. “Molecular Signature of Subtypes of Non-Small-Cell Lung Cancer by Large-Scale Transcriptional Profiling: Identification of Key Modules and Genes by Weighted Gene Co-Expression Network Analysis (WGCNA).” Cancers 12 (1): 37. https://doi.org/10.3390/cancers12010037.\n\n\nR Core Team. 2022. R: A Language and Environment for Statistical Computing. Vienna, Austria: R Foundation for Statistical Computing. https://www.R-project.org/.\n\n\nRamos, Marcel, Lucas Schiffer, Angela Re, Rimsha Azhar, Azfar Basunia, Carmen Rodriguez Cabrera, Tiffany Chan, et al. 2017. “Software for the Integration of Multi-Omics Experiments in Bioconductor.” Cancer Research 77(21); e39-42.\n\n\nWickham, Hadley. 2016. Ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York. https://ggplot2.tidyverse.org.\n\n\nWilke, Claus O. 2020. Cowplot: Streamlined Plot Theme and Plot Annotations for ’Ggplot2’. https://wilkelab.org/cowplot/."
  },
  {
    "objectID": "t2d_13_gea.html",
    "href": "t2d_13_gea.html",
    "title": "\n7  GSEA / DE Results\n",
    "section": "",
    "text": "Show the codecfg_prog <- yaml::read_yaml(\"_prog.yml\")"
  },
  {
    "objectID": "t2d_13_gea.html#mrna-seq-gsea",
    "href": "t2d_13_gea.html#mrna-seq-gsea",
    "title": "\n7  GSEA / DE Results\n",
    "section": "\n7.1 mRNA Seq / GSEA",
    "text": "7.1 mRNA Seq / GSEA\nThe Gene Set Enrichment Analysis (GSEA) aimed at transforming the interpretation of the differential expression of individual genes to a collection (or set) of genes enriched in differentially expressed genes. The set of genes being associated with identified functions, processes, molecules, diseases, pathways, etc, it offers a higher level of interpretation for the differential expression analysis.\nTwo sources of gene sets were used: Gene Ontology Terms (GO). The analysis will be extended to the Kyoto Encyclopedia of Genes and Genomes (KEGG).\nThe analysis was run on all mRNA Differential Analysis contrasts using R and the package liger (Fan 2019). The results focused on enriched gene sets with indication of up or down regulation while reporting the proportion of genes being found differentially expressed in each gene set.\nNote: 221107, the gsea analysis is replicable.\n\nShow the codedevtools::load_all(\"src/pkg/dbs.data\")\n\nℹ Loading dbs.data\n\nShow the codedevtools::load_all(\"src/pkg/latarnia.utils\")\n\nℹ Loading latarnia.utils\nLoading required package: grid\n\nLoading required package: shiny\n\nShow the codeknitr::opts_chunk$set(results = cfg_prog$knitr$results)\nlibrary(assertthat)\nlibrary(ggplot2)\nsource(\"R/ngs.R\")\nsource(\"R/inches.R\")\nsource(\"R/export_xl.R\")\n\n\n\n7.1.1 Gene info\n\nShow the codeout_file <- \"../data/dta_13_02_gene_info.RData\"\n\n\n\nShow the code# GO needs entrezgene_id\ngene_info <- biomaRt::listEnsemblArchives() |>\n  subset(date == \"Jul 2019\", select = \"url\") |>\n  unlist(use.names = FALSE) |>\n  biomaRt::useMart(\n    biomart = \"ensembl\",\n    dataset = \"hsapiens_gene_ensembl\",\n    host = _\n  ) |>\n  # the biomaRt::getBM does not work well inside lapply (I don't know why)\n  # + but also more efficient to get all genes data once instead of\n  # + repeating the request for overlapping genes.\n  biomaRt::getBM(\n    mart = _,\n    attributes = c(\n      \"ensembl_gene_id\",\n      \"ensembl_gene_id_version\",\n      \"external_gene_name\",\n      \"entrezgene_id\",\n      \"entrezgene_accession\",\n      \"chromosome_name\"\n    ),\n    filters = \"ensembl_gene_id\",\n    values = rownames(dbs.data::mrna_raw),\n    useCache = FALSE\n  )\n\nsave(gene_info, file = out_file)\n\n\n\nShow the codeload(out_file, verbose = TRUE)\n\n\n\nShow the codegene_info |>\n  head() |>\n  knitr::kable()\n\n\n\nShow the codegsets <- as.list(org.Hs.eg.db::org.Hs.egGO2EG)\n\n\n\n\n\n7.1.2 GSEA preparation (helper functions)\n\nShow the code#' Abbreviate Description\n#'\n#' @param x (`character`)\n#' @param n_char (`numeric`)\n#' @export\n#'\ndesc_abbreviate <- function(x, n_char = 50) {\n  need_short <- nchar(as.character(x)) > n_char\n  x[need_short] <- paste(\n    substr(\n      x = x[need_short],\n      start = 1,\n      stop = n_char\n    ), \"...\"\n  )\n  x\n}\n\n## helper_functions ----\n\n#' Geneset Preparation\n#'\n#' Set a list of genesets including at least three genes from a genepool.\n#'\n#' @param gsets (`list`)\\cr a named list of genes.\n#' @param universe (`character`)\\cr what range of genes to consider.\n#' @param control (`list`)\\cr set the number of cores to run and\n#'   the minimum number of genes is returned gene sets\n#' @export\n#' @details\n#' Restrict each gene set to the genes present in the gene background.\n#' Restrict gene sets including at least 3 genes.\n#'\nlist_genesets <- function(gsets,\n                          universe,\n                          control = list(\n                            mingeneinset_gsea = 5,\n                            minpctgeneinsetgsea = 20,\n                            n_cores = parallel::detectCores()\n                          )) {\n\n  universe <- as.character(universe)\n  universe <- unique(universe)\n\n  # Restrict gsets to universe.\n  gsets <- parallel::mclapply(\n    X = gsets,\n    universe = universe,\n    FUN = function(x, universe) {\n      y <- unique(x[as.character(x) %in% universe])\n      attr(y, \"Geneset size (nsub)\") <- length(x)\n      attr(y, \"Geneset x Universe intersection size (n)\") <- length(y)\n      attr(y, \"Geneset x Universe intersection size (pct)\") <-\n        attr(y, \"Geneset x Universe intersection size (n)\") /\n        attr(y, \"Geneset size (nsub)\") * 100\n      y\n    },\n    mc.cores = control$n_cores\n  )\n\n  gsets_length <- parallel::mclapply(\n    gsets,\n    FUN = attr, which = \"Geneset x Universe intersection size (n)\",\n    mc.cores = control$n_cores\n  )\n  gsets <- gsets[unlist(gsets_length) >= unlist(control$mingeneinset_gsea)]\n\n  gsets_pct <- parallel::mclapply(\n    gsets,\n    FUN = attr, which = \"Geneset x Universe intersection size (pct)\",\n    mc.cores = control$n_cores\n  )\n  gsets <- gsets[unlist(gsets_pct) >= unlist(control$minpctgeneinsetgsea)]\n\n  # Probably to be removed, but requires impact assessment:\n  gsets <- parallel::mclapply(\n    gsets,\n    FUN = function(x) {\n      attr(x, \"genes in universe\") <- length(x)\n      x\n    },\n    mc.cores = control$n_cores\n  )\n  attr(gsets, \"control\") <- control\n  gsets\n}\n\n#' BESD: GSEA\n#'\n#' Optimized Gene Set Enrichment Analysis for BESD.\n#'\n#' @param lfc (`numeric`)\\cr Log2-Fold Change.\n#' @param nm (`character`)\\cr gene name, same length as `lfc`.\n#' @param gset (`list`)\\cr named list of genesets, prepared with\n#'   `list_genesets`.\n#' @param control (`list`)\\cr list of settings as provided by `control_rna()`.\n#'\n#' @export\n#' @details\n#' Interpretation relies on:\n#' <https://cran.r-project.org/web/packages/liger/vignettes/interpreting.pdf>\n#'\nbesd_gsea_analysis <- function(lfc,\n                               nm,\n                               gset,\n                               control = list(\n                                 n_cores = parallel::detectCores(),\n                                 n_rand_gsea = 1e4\n                               )) {\n\n  time_start <- Sys.time()\n  values <- setNames(object = lfc, nm = nm)\n  y <- lapply(\n    X = gset,\n    values = values,\n    FUN = function(x, values = values)\n      liger::gsea(\n        values = values,\n        geneset = x,\n        mc.cores = control$n_cores,\n        plot = FALSE,\n        n.rand = control$n_rand_gsea,\n        return.details = TRUE\n      )\n  )\n  y <- lapply(y, t)\n  y <- lapply(y, as.data.frame)\n  y <- do.call(rbind, y)\n  y <- cbind(\n    gset = names(gset),\n    y\n  )\n\n  time_end <- Sys.time();\n  attr(y, \"gsea_time\") <- list(\n    start = time_start,\n    end = time_end,\n    duration = time_end - time_start\n  )\n  attr(y, \"controls\") <- control\n  attr(y, \"gene_lfc\") <- values\n  y\n\n}\n\n#' Labels\n#'\n#' Get and set labels.\n#' @name label\n#'\nNULL\n\n#' @describeIn label set label.\n#' @param x (any)\\cr any object to attribute a label to.\n#' @param value (any)\\cr the information used as a label for `x`.\n#' @export\n#' @examples\n#' a <- 0\n#' label(a) <- \"A value of interest\"\n#'\n`label<-` <- function(x, value) {\n  attr(x, \"label\") <- value\n  x\n}\n\n#' @describeIn label get label.\n#' @export\n#' @examples\n#' label(a)\n#'\nlabel <- function(x) attr(x, \"label\")\n\n#' GO Description\n#'\n#' For genesets.\n#'\n#' @param id (`character`)\\cr the GO ID.\n#' @param de_bg (`data.frame`)\\cr includes `padj` and `entrezgene_id`\n#'   columns.\n#' @param go_desc (`list`)\\cr gene set description as provided by\n#'   [GO.db::GOTERM].\n#' @param go_compo (`list`)\\cr gene set composition as provided by\n#'   [org.Hs.eg.db::org.Hs.egGO2EG].\n#'\n#' @return `data.frame`\n#'\n#' @export\n#' @note\n#' Because of the selection of DE gene involved in the Gene Ratio,\n#' it is possible that Gene Ratio reaches 0.\n#'\ndescribe_go <- function(id,\n                        de_bg,\n                        go_desc = as.list(GO.db::GOTERM),\n                        go_compo = as.list(org.Hs.eg.db::org.Hs.egGO2EG)) {\n\n  assertthat::assert_that(\n    \"padj\" %in% colnames(de_bg),\n    \"entrezgene_id\" %in% colnames(de_bg)\n  )\n  de_bg$entrezgene_id <- as.character(de_bg$entrezgene_id)\n\n  y <- lapply(\n    X = id,\n    de_bg = de_bg,\n    go_desc = go_desc,\n    go_compo = go_compo,\n    FUN = function(x, de_bg, go_desc, go_compo) {\n      y <- go_desc[[x]]\n      go_compo <- go_compo[[x]]\n      go_compo <- go_compo[\n        go_compo %in% de_bg$entrezgene_id\n      ]\n      de_gene_in_go <- de_bg$entrezgene_id[\n        de_bg$entrezgene_id %in% go_compo &\n          de_bg$padj < 0.05\n      ]\n      data.frame(\n        source = \"GO\",\n        id = AnnotationDbi::GOID(y),\n        cat = AnnotationDbi::Ontology(y),\n        short_desc = AnnotationDbi::Term(y),\n        size = length(go_compo),\n        count = length(de_gene_in_go),\n        gene_ratio = length(de_gene_in_go) / length(go_compo)\n      )\n    }\n  )\n\n  y <- do.call(rbind, y)\n  label(y$id) <- \"Gene Ontology term ID\"\n  label(y$cat) <- \"Gene Ontology name\"\n  label(y$short_desc) <- \"Gene Ontology short term description\"\n  label(y$size) <- \"Number of Genes in GO and background\"\n  label(y$count) <- \"Number of DE Genes in GO and background\"\n  label(y$gene_ratio) <- \"Count / Size\"\n  y\n}\n\n# <https://github.com/JEFworks/liger/blob/master/vignettes/gsea.pdf>\ngsea_wrapper <- function(df,\n                         gs = gs,\n                         gi = gene_info) {\n\n  message(\"names of first gs: \", names(head(gs)))\n\n  # Need the Entrez gene id\n  gi <- gi[!is.na(gi$entrezgene_id), ]\n\n  assertthat::assert_that(is(df, \"data.frame\"))\n  message(unique(df$ctrs))\n\n  res <- list()\n  res$lfc <- merge(df, gi, by.x = \"feature\", by.y = \"ensembl_gene_id\")\n\n  message(\"dim res$df: \", paste(dim(df), collapse = \" x \"))\n  assertthat::assert_that(\n    all(!is.na(res$entrezgene_id)),\n    all(table(res$entrezgene_id) == 1L)\n  )\n\n  gs <- list_genesets(gsets = gs, universe = res$lfc$entrezgene_id)\n  gc(reset = TRUE)\n  message(\"Number of genesets: \", length(gs))\n\n  res$gsea <- besd_gsea_analysis(\n    lfc = res$lfc$log2FoldChange,\n    nm = res$lfc$entrezgene_id,\n    gset = gs\n  )\n  gc(reset = TRUE)\n\n  res$gsea <- cbind(\n    res$gsea,\n    data.frame(\n      padj = p.adjust(res$gsea$p.val, method = \"BH\"),\n      regulation = ifelse(\n        res$gsea$edge.value > 0,\n        yes = \"up-regulated\",\n        no = \"down-regulated\"\n      ),\n      representation =  ifelse(\n        res$gsea$edge.score * res$gsea$edge.value > 0,\n        yes = \"enrichment\",\n        no = \"depletion\"\n      )\n    ),\n    describe_go(id = res$gsea$gset, de_bg = res$lfc)\n  )\n\n  res\n}\n\n\n\n7.1.3 GSEA/Intervention Induced DE by Diabetes Group\n\nShow the codeout_file <- \"../data/dta_13_01.RData\"\n\n\n\nShow the coderesult <- \"../tlg/graph/fig_07_11.xlsx\" |>\n  openxlsx::read.xlsx(sheet = \"fig_07_11\", startRow = 2, rowNames = TRUE) |>\n  (\\(df) split(df, f = df[\"ctrs\"]))() |>\n  lapply(gs = gsets, gsea_wrapper)\n\nsave(result, file = out_file)\n\n\n\nShow the codeload(out_file, verbose = TRUE)\n\n\n\nShow the coderesult |>\n  lapply(\\(x) head(x$gsea))\nresult |>\n  lapply(\\(x) dim(x$gsea))\n\n\n\nShow the codecontrast <- \"chg NGT\"\nde_name <- \" following Intervention\"\n\n\n\nShow the codedta <- result[[contrast]]$gsea |>\n  within({\n    term <- short_desc\n    short_desc <- desc_abbreviate(short_desc)\n    short_desc <- factor(short_desc, unique(short_desc[order(gene_ratio)]))\n  })\n\ndta_sel <- dta |>\n  subset(representation == \"enrichment\") |>\n  (\\(df) {\n    df <- if (sum(df$padj < 0.05 & df$gene_ratio > 0.2) < 5) {\n      df <- y[order(df$padj), ]\n      df[seq_len(min(c(nrow(df), 5))), ]\n    } else {\n      df[df$padj < 0.05 & df$gene_ratio > 0.2, ]\n    }\n  }) ()\n\nlibrary(ggplot2)\ngg <- ggplot(\n  dta_sel,\n  aes_string(\n    x = \"gene_ratio\",\n    color = \"padj\",\n    y = \"short_desc\",\n    size = \"count\",\n    shape = \"regulation\"\n  )\n) +\n  geom_point() +\n  scale_colour_gradient(low = \"black\", high = \"gray80\") +\n  scale_size(breaks = c(10, 50, 100, 500, 1000)) +\n  scale_shape_manual(values = c(1, 19)) +\n  guides(\n    colour = guide_colourbar(title = \"P.adj:\"),\n    shape = guide_legend(title = \"Regulation: \"),\n    size = guide_legend(title = \"Count: \")\n  ) +\n  coord_cartesian(clip = \"off\") +\n  facet_grid(cat ~ ., scales = \"free\", space = \"free\") +\n  labs(title = paste0(\"[mRNA] \", contrast, de_name)) +\n  xlab(\"Gene Ratio\") +\n  ylab(\"Gene Ratio\") +\n  theme_minimal() +\n  theme(\n    axis.title.y = element_blank(),\n    legend.position = \"right\",\n    legend.box = \"vertical\",\n    legend.text = element_text(size = 8, hjust = 0),\n    legend.box.just = \"left\",\n    panel.border = element_rect(fill = NA),\n    text = element_text(size = 7),\n    title =  element_text(size = 7),\n    legend.text.align = 0,\n    panel.grid.minor = element_blank()\n  )\n\n\n\nShow the codep <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 13.1\",\n      strwrap(\n        \"Bubble plot - Gene ontology genesets enriched with gene differentially\n        expressed after exercise intervention in NGT group \",\n        width = 80\n      ),\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_figure(gg, height = inches(5), width = inches(6)) |>\n  add_footer(\n    c(\n      \"Program t2d_13_gea / Env ayup_dbs:v0.1.0-alpha\",\n      format(Sys.time(), format = \"%Y-%m-%d %H:%M (%Z)\")\n    ),\n    cfg_prog$version\n  )\n\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, \"fig_13_01.pdf\"),\n  file_graph_alone = file.path(cfg_prog$paths$grh, \"fig_13_01_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_13_01.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_13_01_af.pdf (annot. free)\n\nShow the codeexport_xl(\n  fig_13_01 = dta,\n  info = c(\n    title = paste(\"Geneset enrichment analysis\", contrast, de_name),\n    source = \"UMB-BESD\"\n  ),\n  dir = cfg_prog$paths$grh,\n  basenm = \"fig_13_01\"\n)\n\nExcel output: ../tlg/graph/fig_13_01.xlsx\n\n\n\nShow the codeshow_slate(p)\n\n\n\nShow the coderm(gg, p, dta, dta_sel, contrast, de_name)\n\n\n\nShow the codecontrast <- \"chg T2D\"\nde_name <- \" following Intervention\"\n\n\n\nShow the codedta <- result[[contrast]]$gsea |>\n  within({\n    term <- short_desc\n    short_desc <- desc_abbreviate(short_desc)\n    short_desc <- factor(short_desc, unique(short_desc[order(gene_ratio)]))\n  })\n\ndta_sel <- dta |>\n  subset(representation == \"enrichment\") |>\n  (\\(df) {\n    df <- if (sum(df$padj < 0.05 & df$gene_ratio > 0.2) < 5) {\n      df <- y[order(df$padj), ]\n      df[seq_len(min(c(nrow(df), 5))), ]\n    } else {\n      df[df$padj < 0.05 & df$gene_ratio > 0.2, ]\n    }\n  }) ()\n\nlibrary(ggplot2)\ngg <- ggplot(\n  dta_sel,\n  aes_string(\n    x = \"gene_ratio\",\n    color = \"padj\",\n    y = \"short_desc\",\n    size = \"count\",\n    shape = \"regulation\"\n  )\n) +\n  geom_point() +\n  scale_colour_gradient(low = \"black\", high = \"gray80\") +\n  scale_size(breaks = c(10, 50, 100, 500, 1000)) +\n  scale_shape_manual(values = c(1, 19)) +\n  guides(\n    colour = guide_colourbar(title = \"P.adj:\"),\n    shape = guide_legend(title = \"Regulation: \"),\n    size = guide_legend(title = \"Count: \")\n  ) +\n  coord_cartesian(clip = \"off\") +\n  facet_grid(cat ~ ., scales = \"free\", space = \"free\") +\n  labs(title = paste0(\"[mRNA] \", contrast, de_name)) +\n  xlab(\"Gene Ratio\") +\n  ylab(\"Gene Ratio\") +\n  theme_minimal() +\n  theme(\n    axis.title.y = element_blank(),\n    legend.position = \"right\",\n    legend.box = \"vertical\",\n    legend.text = element_text(size = 8, hjust = 0),\n    legend.box.just = \"left\",\n    panel.border = element_rect(fill = NA),\n    text = element_text(size = 7),\n    title =  element_text(size = 7),\n    legend.text.align = 0,\n    panel.grid.minor = element_blank()\n  )\n\n\n\nShow the codep <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 13.2\",\n      strwrap(\n        \"Bubble plot - Gene ontology genesets enriched with gene differentially\n        expressed after exercise intervention in T2D group \",\n        width = 80\n      ),\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_figure(gg, height = inches(5), width = inches(6)) |>\n  add_footer(\n    c(\n      \"Program t2d_13_gea / Env ayup_dbs:v0.1.0-alpha\",\n      format(Sys.time(), format = \"%Y-%m-%d %H:%M (%Z)\")\n    ),\n    cfg_prog$version\n  )\n\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, \"fig_13_02.pdf\"),\n  file_graph_alone = file.path(cfg_prog$paths$grh, \"fig_13_02_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_13_02.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_13_02_af.pdf (annot. free)\n\nShow the codeexport_xl(\n  fig_13_02 = dta,\n  info = c(\n    title = paste(\"Geneset enrichment analysis\", contrast, de_name),\n    source = \"UMB-BESD\"\n  ),\n  dir = cfg_prog$paths$grh,\n  basenm = \"fig_13_02\"\n)\n\nExcel output: ../tlg/graph/fig_13_02.xlsx\n\n\n\nShow the codeshow_slate(p)\n\n\n\nShow the coderm(gg, p, dta, dta_sel, contrast, de_name)\n\n\n\n7.1.4 GSEA/DE between Diabetes Group at Baseline\n\nShow the codeout_file <- \"../data/dta_13_04.RData\"\n\n\n\nShow the code# disregard the contrast IGT vs NGT because of the very low level of\n# differential expression.\nresult <- \"../tlg/graph/fig_07_03.xlsx\" |>\n  openxlsx::read.xlsx(sheet = \"fig_07_03\", startRow = 2, rowNames = TRUE) |>\n  subset(ctrs %in% c(\"T2D vs IGT\", \"T2D vs NGT\")) |>\n  (\\(df) split(df, f = df[\"ctrs\"]))() |>\n  lapply(gs = gsets, gsea_wrapper)\n\nsave(result, file = out_file)\n\n\n\nShow the codeload(out_file, verbose = TRUE)\n\n\n\nShow the coderesult |>\n  lapply(\\(x) head(x$gsea))\nresult |>\n  lapply(\\(x) dim(x$gsea))\n\n\n\nShow the codecontrast <- \"T2D vs NGT\"\nde_name <- \" at Baseline\"\n\n\n\nShow the codedta <- result[[contrast]]$gsea |>\n  within({\n    term <- short_desc\n    short_desc <- desc_abbreviate(short_desc)\n    short_desc <- factor(short_desc, unique(short_desc[order(gene_ratio)]))\n  })\n\ndta_sel <- dta |>\n  subset(representation == \"enrichment\") |>\n  (\\(df) {\n    df <- if (sum(df$padj < 0.05 & df$gene_ratio > 0.2) < 5) {\n      df <- y[order(df$padj), ]\n      df[seq_len(min(c(nrow(df), 5))), ]\n    } else {\n      df[df$padj < 0.05 & df$gene_ratio > 0.2, ]\n    }\n  }) ()\n\nlibrary(ggplot2)\ngg <- ggplot(\n  dta_sel,\n  aes_string(\n    x = \"gene_ratio\",\n    color = \"padj\",\n    y = \"short_desc\",\n    size = \"count\",\n    shape = \"regulation\"\n  )\n) +\n  geom_point() +\n  scale_colour_gradient(low = \"black\", high = \"gray80\") +\n  scale_size(breaks = c(10, 50, 100, 500, 1000)) +\n  scale_shape_manual(values = c(1, 19)) +\n  guides(\n    colour = guide_colourbar(title = \"P.adj:\"),\n    shape = guide_legend(title = \"Regulation: \"),\n    size = guide_legend(title = \"Count: \")\n  ) +\n  coord_cartesian(clip = \"off\") +\n  facet_grid(cat ~ ., scales = \"free\", space = \"free\") +\n  labs(title = paste0(\"[mRNA] \", contrast, de_name)) +\n  xlab(\"Gene Ratio\") +\n  ylab(\"Gene Ratio\") +\n  theme_minimal() +\n  theme(\n    axis.title.y = element_blank(),\n    legend.position = \"right\",\n    legend.box = \"vertical\",\n    legend.text = element_text(size = 8, hjust = 0),\n    legend.box.just = \"left\",\n    panel.border = element_rect(fill = NA),\n    text = element_text(size = 7),\n    title =  element_text(size = 7),\n    legend.text.align = 0,\n    panel.grid.minor = element_blank()\n  )\n\n\n\nShow the codep <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 13.4\",\n      strwrap(\n        \"Bubble plot - Gene ontology genesets enriched with gene differentially\n        expressed in T2D group compared to NGT group at Baseline\",\n        width = 80\n      ),\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_figure(gg, height = inches(5), width = inches(6)) |>\n  add_footer(\n    c(\n      \"Program t2d_13_gea / Env ayup_dbs:v0.1.0-alpha\",\n      format(Sys.time(), format = \"%Y-%m-%d %H:%M (%Z)\")\n    ),\n    cfg_prog$version\n  )\n\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, \"fig_13_04.pdf\"),\n  file_graph_alone = file.path(cfg_prog$paths$grh, \"fig_13_04_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_13_04.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_13_04_af.pdf (annot. free)\n\nShow the codeexport_xl(\n  fig_13_04 = dta,\n  info = c(\n    title = paste(\"Geneset enrichment analysis\", contrast, de_name),\n    source = \"UMB-BESD\"\n  ),\n  dir = cfg_prog$paths$grh,\n  basenm = \"fig_13_04\"\n)\n\nExcel output: ../tlg/graph/fig_13_04.xlsx\n\n\n\nShow the codeshow_slate(p)\n\n\n\nShow the coderm(gg, p, dta, dta_sel, contrast, de_name)\n\n\n\n7.1.5 GSEA/DE between Diabetes Group at Month 3\n\nShow the codeout_file <- \"../data/dta_13_03.RData\"\n\n\n\nShow the code# disregard the contrast IGT vs NGT because of the very low level of\n# differential expression.\nresult <- \"../tlg/graph/fig_07_07.xlsx\" |>\n  openxlsx::read.xlsx(sheet = \"fig_07_07\", startRow = 2, rowNames = TRUE) |>\n  subset(ctrs %in% c(\"T2D vs IGT\", \"T2D vs NGT\")) |>\n  (\\(df) split(df, f = df[\"ctrs\"]))() |>\n  lapply(gs = gsets, gsea_wrapper)\n\nsave(result, file = out_file)\nexport_xl(\n  fig_07_03 = dds_2_est,\n  info = c(\n    title =\n      \"mRNA at baseline - differential expression by diabetes group\",\n    source = \"UMB-BESD\"\n  ),\n  dir = cfg_prog$paths$grh,\n  basenm = \"fig_07_03\"\n)\n\n\n\nShow the codeload(out_file, verbose = TRUE)\n\n\n\nShow the coderesult |>\n  lapply(\\(x) head(x$gsea))\nresult |>\n  lapply(\\(x) dim(x$gsea))\n\n\n\nShow the codecontrast <- \"T2D vs NGT\"\nde_name <- \"After Intervention\"\n\n\n\nShow the codedta <- result[[contrast]]$gsea |>\n  within({\n    term <- short_desc\n    short_desc <- desc_abbreviate(short_desc)\n    short_desc <- factor(short_desc, unique(short_desc[order(gene_ratio)]))\n  })\n\ndta_sel <- dta |>\n  subset(representation == \"enrichment\") |>\n  (\\(df) {\n    df <- if (sum(df$padj < 0.05 & df$gene_ratio > 0.2) < 5) {\n      df <- y[order(df$padj), ]\n      df[seq_len(min(c(nrow(df), 5))), ]\n    } else {\n      df[df$padj < 0.05 & df$gene_ratio > 0.2, ]\n    }\n  }) ()\n\nlibrary(ggplot2)\ngg <- ggplot(\n  dta_sel,\n  aes_string(\n    x = \"gene_ratio\",\n    color = \"padj\",\n    y = \"short_desc\",\n    size = \"count\",\n    shape = \"regulation\"\n  )\n) +\n  geom_point() +\n  scale_colour_gradient(low = \"black\", high = \"gray80\") +\n  scale_size(breaks = c(10, 50, 100, 500, 1000)) +\n  scale_shape_manual(values = c(1, 19)) +\n  guides(\n    colour = guide_colourbar(title = \"P.adj:\"),\n    shape = guide_legend(title = \"Regulation: \"),\n    size = guide_legend(title = \"Count: \")\n  ) +\n  coord_cartesian(clip = \"off\") +\n  facet_grid(cat ~ ., scales = \"free\", space = \"free\") +\n  labs(title = paste0(\"[mRNA] \", contrast, de_name)) +\n  xlab(\"Gene Ratio\") +\n  ylab(\"Gene Ratio\") +\n  theme_minimal() +\n  theme(\n    axis.title.y = element_blank(),\n    legend.position = \"right\",\n    legend.box = \"vertical\",\n    legend.text = element_text(size = 8, hjust = 0),\n    legend.box.just = \"left\",\n    panel.border = element_rect(fill = NA),\n    text = element_text(size = 7),\n    title =  element_text(size = 7),\n    legend.text.align = 0,\n    panel.grid.minor = element_blank()\n  )\n\n\n\nShow the codep <- clean_slate() |>\n  add_header(c(\"FCA Collin\", \"UMB BESD\"), c(\"Confidential\", \"Draft\")) |>\n  add_title(\n    c(\n      \"Figure 13.3\",\n      strwrap(\n        \"Bubble plot - Gene ontology genesets enriched with gene differentially\n        expressed in T2D group compared to NGT group at baseline\",\n        width = 80\n      ),\n      \"Analysis Set: Full Analysis Set\"\n    )\n  ) |>\n  add_figure(gg, height = inches(5), width = inches(6)) |>\n  add_footer(\n    c(\n      \"Program t2d_13_gea / Env ayup_dbs:v0.1.0-alpha\",\n      format(Sys.time(), format = \"%Y-%m-%d %H:%M (%Z)\")\n    ),\n    cfg_prog$version\n  )\n\nexport_as(\n  p,\n  file = file.path(cfg_prog$paths$grh, \"fig_13_03.pdf\"),\n  file_graph_alone = file.path(cfg_prog$paths$grh, \"fig_13_03_af.pdf\")\n)\n\n[log] output saved as: ../tlg/graph/fig_13_03.pdf\n\n\n[log] output saved as: ../tlg/graph/fig_13_03_af.pdf (annot. free)\n\nShow the codeexport_xl(\n  fig_13_03 = dta,\n  info = c(\n    title = paste(\"Geneset enrichment analysis\", contrast, de_name),\n    source = \"UMB-BESD\"\n  ),\n  dir = cfg_prog$paths$grh,\n  basenm = \"fig_13_03\"\n)\n\nExcel output: ../tlg/graph/fig_13_03.xlsx\n\n\n\nShow the codeshow_slate(p)\n\n\n\nShow the coderm(gg, p, dta, dta_sel, contrast, de_name)"
  },
  {
    "objectID": "t2d_13_gea.html#session-informations",
    "href": "t2d_13_gea.html#session-informations",
    "title": "\n7  GSEA / DE Results\n",
    "section": "\n7.2 Session Informations",
    "text": "7.2 Session Informations\n\nShow the codesessioninfo::session_info()\n\n\n\n\n\n\n\n\nFan, Jean. 2019. Differential Pathway Analysis. Edited by GC Yuan. Springer."
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "References",
    "section": "",
    "text": "Committee for Medicinal Products for Human Use (CHMP). 2015.\n“Guideline on Adjustment for Baseline Covariates in Clinical\nTrials.” European Medicines Agency. https://www.ema.europa.eu/en/documents/scientific-guideline/guideline-adjustment-baseline-covariates-clinical-trials_en.pdf.\n\n\nCOMMITTEE FOR PROPRIETARY MEDICINAL PRODUCTS. 2003. “POINTS TO\nCONSIDER ON ADJUSTMENT FOR BASELINE COVARIATES.” The European\nAgency for the Evaluation of Medicinal Products Evaluation of Medicines\nfor Human Use. https://www.ema.europa.eu/en/documents/scientific-guideline/points-consider-adjustment-baseline-covariates_en.pdf.\n\n\nDündar, Friederike, Luce Skrabanek, and Paul Zumbo. 2018.\n“Introduction to Differential Gene Expression Analysis Using\nRNA-Seq.” Internet.\n\n\nFan, Jean. 2019. Differential Pathway Analysis. Edited by GC\nYuan. Springer.\n\n\nFox, John, and Sanford Weisberg. 2019. An R Companion\nto Applied Regression. Third. Thousand Oaks CA: Sage.\nhttps://socialsciences.mcmaster.ca/jfox/Books/Companion/.\n\n\nGohel, David. 2022. Flextable: Functions for Tabular Reporting.\n\n\nJosse, Julie, and François Husson. 2016. “missMDA: A Package for Handling Missing Values in\nMultivariate Data Analysis.” Journal of Statistical\nSoftware 70 (1): 1–31. https://doi.org/10.18637/jss.v070.i01.\n\n\nLangfelder, Peter, and Steve Horvath. 2008. “WGCNA: An r Package\nfor Weighted Correlation Network Analysis.” BMC\nBioinformatics, no. 1: 559. https://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-9-559.\n\n\nLenth, Russell V. 2022. Emmeans: Estimated Marginal Means, Aka\nLeast-Squares Means. https://github.com/rvlenth/emmeans.\n\n\nLiu, Guanghan F, Kaifeng Lu, Robin Mogg, Madhuja Mallick, and Devan V\nMehrotra. 2009. “Should Baseline Be a Covariate or Dependent\nVariable in Analyses of Change from Baseline in Clinical Trials?”\nStatistics in Medicine 28 (20): 2509–30. https://doi.org/10.1002/sim.3639.\n\n\nLove, Michael I., Wolfgang Huber, and Simon Anders. 2014.\n“Moderated Estimation of Fold Change and Dispersion for RNA-Seq\nData with DESeq2.” Genome Biology 15: 550. https://doi.org/10.1186/s13059-014-0550-8.\n\n\nNiemira, Magdalena, Francois Collin, Anna Szalkowska, Agnieszka Bielska,\nKarolina Chwialkowska, Joanna Reszec, Jacek Niklinski, Miroslaw\nKwasniewski, and Adam Kretowski. 2020. “Molecular Signature of\nSubtypes of Non-Small-Cell Lung Cancer by Large-Scale Transcriptional\nProfiling: Identification of Key Modules and Genes by Weighted Gene\nCo-Expression Network Analysis (WGCNA).” Cancers 12 (1):\n37. https://doi.org/10.3390/cancers12010037.\n\n\nO’Connell, Nathaniel S, Lin Dai, Yunyun Jiang, Jaime L Speiser, Ralph\nWard, Wei Wei, Rachel Carroll, and Mulugeta Gebregziabher. 2017.\n“Methods for Analysis of Pre-Post Data in Clinical Research: A\nComparison of Five Common Methods.” Journal of Biometrics\n& Biostatistics 8 (1): 1. https://doi.org/10.4172/2155-6180.1000334.\n\n\nR Core Team. 2022. R: A Language and Environment for Statistical\nComputing. Vienna, Austria: R Foundation for Statistical Computing.\nhttps://www.R-project.org/.\n\n\nRamos, Marcel, Lucas Schiffer, Angela Re, Rimsha Azhar, Azfar Basunia,\nCarmen Rodriguez Cabrera, Tiffany Chan, et al. 2017. “Software for\nthe Integration of Multi-Omics Experiments in Bioconductor.”\nCancer Research 77(21); e39-42.\n\n\nVan Breukelen, G. 2006. “ANCOVA Versus Change from Baseline: More\nPower Inrandomized Studies, More Bias in Nonrandomized Studies.”\nJournal of ClinicalEpidemiology, 59–920. https://doi.org/10.1016/j.jclinepi.2006.02.007.\n\n\nVickers, Andrew J. 2001. “The Use of Percentage Change from\nBaseline as an Outcome in a Controlled Trial Is Statistically\nInefficient: A Simulation Study.” BMC Medical Research\nMethodology 1 (1): 1–4. https://doi.org/10.1186/1471-2288-1-6.\n\n\nWickham, Hadley. 2016. Ggplot2: Elegant Graphics for Data\nAnalysis. Springer-Verlag New York. https://ggplot2.tidyverse.org.\n\n\nWickham, Hadley, and Maximilian Girlich. 2022. Tidyr: Tidy Messy\nDataversion.\n\n\nWilke, Claus O. 2020. Cowplot: Streamlined Plot Theme and Plot\nAnnotations for ’Ggplot2’. https://wilkelab.org/cowplot/.\n\n\nZhang, Shiyuan, James Paul, Manyat Nantha-Aree, Norman Buckley, Uswa\nShahzad, Ji Cheng, Justin DeBeer, et al. 2014. “Empirical\nComparison of Four Baseline Covariate Adjustment Methods in Analysis of\nContinuous Outcomes in Randomized Controlled Trials.”\nClinical Epidemiology 6: 227. https://doi.org/10.2147/clep.s56554."
  }
]