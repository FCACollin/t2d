<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.592">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Francois Collin">
<meta name="dcterms.date" content="2022-07-01">
<title>T2D: Exercise and Genetic Expression Profile - 4&nbsp; RNASeq - Refresher</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./t2d_07_mir.html" rel="next">
<link href="./t2d_09_chg.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">
<span class="chapter-number">4</span>&nbsp; <span class="chapter-title">RNASeq - Refresher</span>
</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">T2D: Exercise and Genetic Expression Profile</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/FCACollin/t2d" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preamble</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_03_bds.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Missingness in adlb and advs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_08_dmg.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Demographics and Baseline Anthropometrics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_09_chg.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Anthropometrics Changes From Baseline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_06_rna.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">RNASeq - Refresher</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_07_mir.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">mRNA / micro RNA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2d_11_wcn.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">WGCNA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#rna-seq---local-study-of-confounder-adjustments-impact" id="toc-rna-seq---local-study-of-confounder-adjustments-impact" class="nav-link active" data-scroll-target="#rna-seq---local-study-of-confounder-adjustments-impact"> <span class="header-section-number">4.1</span> RNA Seq - Local Study of Confounder Adjustment’s Impact</a>
  <ul class="collapse">
<li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation"> <span class="header-section-number">4.1.1</span> Data preparation</a></li>
  </ul>
</li>
  <li><a href="#de-baseline-all-micro-rna-no-confounding-factor-dds_1" id="toc-de-baseline-all-micro-rna-no-confounding-factor-dds_1" class="nav-link" data-scroll-target="#de-baseline-all-micro-rna-no-confounding-factor-dds_1"> <span class="header-section-number">4.2</span> DE: Baseline, all micro RNA, no confounding factor (<code>dds_1</code>)</a></li>
  <li><a href="#de-baseline-all-micro-rna-accounting-for-age-bmi-dcal-trainn-dds_2" id="toc-de-baseline-all-micro-rna-accounting-for-age-bmi-dcal-trainn-dds_2" class="nav-link" data-scroll-target="#de-baseline-all-micro-rna-accounting-for-age-bmi-dcal-trainn-dds_2"> <span class="header-section-number">4.3</span> DE: Baseline, all micro RNA, accounting for Age, BMI, DCAL, Trainn (<code>dds_2</code>)</a></li>
  <li><a href="#comparison-withwithout-confounding-factors" id="toc-comparison-withwithout-confounding-factors" class="nav-link" data-scroll-target="#comparison-withwithout-confounding-factors"> <span class="header-section-number">4.4</span> Comparison with/without confounding factors</a></li>
  <li><a href="#session-informations" id="toc-session-informations" class="nav-link" data-scroll-target="#session-informations"> <span class="header-section-number">4.5</span> Session Informations</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/FCACollin/t2d/edit/main/t2d_06_rna.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">
<span class="chapter-number">4</span>&nbsp; <span class="chapter-title">RNASeq - Refresher</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Program 06</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Francois Collin </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 1, 2022</p>
    </div>
  </div>
    
  </div>
  

</header><div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/read_yaml.html">read_yaml</a></span><span class="op">(</span><span class="st">"_prog.yml"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="rna-seq---local-study-of-confounder-adjustments-impact" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="rna-seq---local-study-of-confounder-adjustments-impact">
<span class="header-section-number">4.1</span> RNA Seq - Local Study of Confounder Adjustment’s Impact</h2>
<p>Target:</p>
<ul class="task-list">
<li>
<input type="checkbox" disabled="" checked="">
refresh the differential expression analysis technics with DESeq2.</li>
<li>
<input type="checkbox" disabled="" checked="">
upgrade environment for differential expression analysis.</li>
<li>
<input type="checkbox" disabled="" checked="">
evaluate the impact of confounder adjustment on a specific use case: compare miRNA expression between T2D and NGT at baseline.</li>
</ul>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html">load_all</a></span><span class="op">(</span><span class="st">"src/pkg/dbs.data"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>ℹ Loading dbs.data</code></pre>
</div>
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html">load_all</a></span><span class="op">(</span><span class="st">"src/pkg/latarnia.utils"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>ℹ Loading latarnia.utils</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: grid</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: shiny</code></pre>
</div>
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>results <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">knitr</span><span class="op">$</span><span class="va">results</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">assertthat</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"R/ngs.R"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="data-preparation" class="level3" data-number="4.1.1"><h3 data-number="4.1.1" class="anchored" data-anchor-id="data-preparation">
<span class="header-section-number">4.1.1</span> Data preparation</h3>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">adsl</span>
<span class="va">advs</span> <span class="op">&lt;-</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">advs</span>
<span class="va">adlb</span> <span class="op">&lt;-</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">adlb</span>

<span class="co">#' Subjid and Visit to Sample</span>
<span class="co">#' </span>
<span class="va">subjvis_to_spl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">subjid</span>, <span class="st">"v"</span>, <span class="va">df</span><span class="op">$</span><span class="va">avisitn</span><span class="op">)</span>

<span class="va">ads</span> <span class="op">&lt;-</span> <span class="va">adlb</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>
    <span class="va">paramcd</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
      <span class="st">"CHOL"</span>, <span class="st">"HBA1C"</span>, <span class="st">"HDL"</span>, <span class="st">"HOMAB"</span>, <span class="st">"HOMAIR"</span>, <span class="st">"LDL"</span>, <span class="st">"MATSUDA"</span>, <span class="st">"TRIG"</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">advs</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ct</span>, <span class="va">dtype</span>, <span class="va">param</span>, <span class="va">base</span>, <span class="va">basetype</span>, <span class="va">chg</span>, <span class="va">pchg</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"paramcd"</span>, values_from <span class="op">=</span> <span class="st">"aval"</span><span class="op">)</span> |&gt;
  <span class="op">(</span>\<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">adsl</span>, <span class="va">df</span>, by <span class="op">=</span> <span class="st">"subjid"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="op">(</span>\<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu">S4Vectors</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html">DataFrame</a></span><span class="op">(</span><span class="va">df</span>, row.names <span class="op">=</span> <span class="fu">subjvis_to_spl</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="op">(</span>\<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">assertthat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertthat/man/assert_that.html">assert_that</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu">subjvis_to_spl</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
    <span class="va">df</span>
  <span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="op">)</span>

<span class="va">ads</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">rna</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="co"># There will be mi-RNA data.</span>
  mrna <span class="op">=</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">mrna_raw</span>,
  premirna <span class="op">=</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">premirna_raw</span>,
  mirna <span class="op">=</span> <span class="fu">dbs.data</span><span class="fu">::</span><span class="va">mirna_raw</span>
<span class="op">)</span>

<span class="va">rna</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"premirna"</span>, <span class="st">"mirna"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>
  X <span class="op">=</span> <span class="va">rna</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"premirna"</span>, <span class="st">"mirna"</span><span class="op">)</span><span class="op">]</span>,
  FUN <span class="op">=</span> <span class="va">format_mirna</span>
<span class="op">)</span>

<span class="co"># Rows represent genes.</span>
<span class="va">rna</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">rna</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">]</span><span class="op">)</span>
<span class="va">rna</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">rna</span>, <span class="va">as.matrix</span><span class="op">)</span>
<span class="fu">assertthat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertthat/man/assert_that.html">assert_that</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">rna</span><span class="op">$</span><span class="va">premirna</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">rna</span><span class="op">$</span><span class="va">mirna</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">rna</span><span class="op">$</span><span class="va">allmirna</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">rna</span><span class="op">$</span><span class="va">premirna</span>, <span class="va">rna</span><span class="op">$</span><span class="va">mirna</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org">testthat</a></span><span class="op">)</span>
<span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"rna features discriminated in noexpr, expr"</span>, <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>
    X <span class="op">=</span> <span class="va">rna</span>,
    FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html">expect_true</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://waldronlab.io/MultiAssayExperiment/">MultiAssayExperiment</a></span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Loading required package: SummarizedExperiment</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MatrixGenerics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: matrixStats</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MatrixGenerics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:matrixStats':

    colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse,
    colCounts, colCummaxs, colCummins, colCumprods, colCumsums,
    colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs,
    colMads, colMaxs, colMeans2, colMedians, colMins, colOrderStats,
    colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds,
    colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads,
    colWeightedMeans, colWeightedMedians, colWeightedSds,
    colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet,
    rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods,
    rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,
    rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins,
    rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks,
    rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars,
    rowWeightedMads, rowWeightedMeans, rowWeightedMedians,
    rowWeightedSds, rowWeightedVars</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: GenomicRanges</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: stats4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: BiocGenerics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'BiocGenerics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    IQR, mad, sd, var, xtabs</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    anyDuplicated, append, as.data.frame, basename, cbind, colnames,
    dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep,
    grepl, intersect, is.unsorted, lapply, Map, mapply, match, mget,
    order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,
    rbind, Reduce, rownames, sapply, setdiff, sort, table, tapply,
    union, unique, unsplit, which.max, which.min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: S4Vectors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'S4Vectors'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    expand.grid, I, unname</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: IRanges</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: GenomeInfoDb</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Biobase</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome to Bioconductor

    Vignettes contain introductory material; view with
    'browseVignettes()'. To cite Bioconductor, see
    'citation("Biobase")', and for packages 'citation("pkgname")'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Biobase'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:MatrixGenerics':

    rowMedians</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:matrixStats':

    anyMissing, rowMedians</code></pre>
</div>
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co">#' (Sample-)Map Arrays</span>
<span class="co">#'</span>
<span class="co">#' Use the colnames of `x` to deduce the `primary` and `colnames`.</span>
<span class="co">#' This is used to generate the sample mapping between colData and Experiments.</span>
<span class="co">#'</span>
<span class="co">#' @param x (`dataframe`).</span>
<span class="co">#'</span>
<span class="co">#' @note In our case, primary and colnames are equivalent, colnames could</span>
<span class="co">#' be different from primary names when a biological sample has different</span>
<span class="co">#' names in the biological assays (e.g. machine constraint, technical</span>
<span class="co">#' repetitions).</span>
<span class="co">#'</span>
<span class="co">#' @seealso [MultiAssayExperiment::listToMap()]</span>
<span class="co">#' @examples</span>
<span class="co">#' \dontrun{</span>
<span class="co">#' lapply(rna, map_arrays)</span>
<span class="co">#' MultiAssayExperiment::listToMap(lapply(rna, map_arrays))</span>
<span class="co">#' }</span>
<span class="co">#'</span>
<span class="va">map_arrays</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>colname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
  <span class="va">y</span><span class="op">$</span><span class="va">primary</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">$</span><span class="va">colname</span>
  <span class="va">y</span>
<span class="op">}</span>

<span class="va">besd_mae</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/MultiAssayExperiment.html">MultiAssayExperiment</a></span><span class="op">(</span>
  experiments <span class="op">=</span> <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/ExperimentList.html">ExperimentList</a></span><span class="op">(</span><span class="va">rna</span><span class="op">)</span>,
  colData <span class="op">=</span> <span class="va">ads</span>,
  sampleMap <span class="op">=</span> <span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/mapToList.html">listToMap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">rna</span>, <span class="va">map_arrays</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">besd_mae</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="de-baseline-all-micro-rna-no-confounding-factor-dds_1" class="level2" data-number="4.2"><h2 data-number="4.2" class="anchored" data-anchor-id="de-baseline-all-micro-rna-no-confounding-factor-dds_1">
<span class="header-section-number">4.2</span> DE: Baseline, all micro RNA, no confounding factor (<code>dds_1</code>)</h2>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/read_yaml.html">read_yaml</a></span><span class="op">(</span><span class="st">"_prog.yml"</span><span class="op">)</span><span class="op">$</span><span class="va">rna</span>

<span class="va">ngs_assay</span> <span class="op">&lt;-</span> <span class="st">"allmirna"</span>

<span class="va">filter_for_depth</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span>, <span class="va">assay</span>, <span class="va">depth_threshold</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">mae</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">mae</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">depth_threshold</span>, <span class="op">]</span>
<span class="op">}</span>

<span class="va">filter_for_visit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span>, <span class="va">visit</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">mae</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">avisit</span> <span class="op">==</span> <span class="va">visit</span>, <span class="op">]</span>
<span class="op">}</span>

<span class="va">filter_for_low_expr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span>, <span class="va">assay</span>, <span class="va">cpm_threshold</span>, <span class="va">frac_cols</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Genes expressed at least cpm_threshold in frac_cols columns</span>
  <span class="va">mae</span><span class="op">[</span>
    <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu">cpm</span><span class="op">(</span><span class="va">mae</span><span class="op">[[</span><span class="va">assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">cpm_threshold</span><span class="op">)</span> <span class="op">&gt;</span>
      <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">mae</span><span class="op">[[</span><span class="va">assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">frac_cols</span>,
    ,
  <span class="op">]</span>
<span class="op">}</span>

<span class="va">ads</span> <span class="op">&lt;-</span> <span class="va">besd_mae</span> |&gt;
  <span class="op">(</span>\<span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="va">mae</span><span class="op">[</span> , , <span class="va">ngs_assay</span><span class="op">]</span><span class="op">)</span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu">filter_for_depth</span><span class="op">(</span><span class="st">"allmirna"</span>, <span class="va">ctrl</span><span class="op">$</span><span class="va">depth_threshold</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> |&gt;
  <span class="fu">filter_for_visit</span><span class="op">(</span><span class="st">"Baseline"</span><span class="op">)</span> |&gt;
  <span class="fu">filter_for_low_expr</span><span class="op">(</span><span class="st">"allmirna"</span>, <span class="va">ctrl</span><span class="op">$</span><span class="va">cpm_threshold</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: 'experiments' dropped; see 'metadata'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>harmonizing input:
  removing 282 sampleMap rows not in names(experiments)</code></pre>
</div>
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">ads</span>

<span class="va">dds_1</span> <span class="op">&lt;-</span> <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/DESeqDataSet.html">DESeqDataSetFromMatrix</a></span><span class="op">(</span>
  countData <span class="op">=</span> <span class="va">ads</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span>,
  colData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">ads</span><span class="op">)</span>,
  design <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="op">~</span> <span class="va">diabcd</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">dds_1_res</span> <span class="op">&lt;-</span> <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/DESeq.html">DESeq</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">dds_1</span>,
  quiet <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># default: FALSE</span>
  minReplicatesForReplace <span class="op">=</span> <span class="fl">7</span>, <span class="co"># default: 7</span>
  useT <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># default: FALSE</span>
  minmu <span class="op">=</span> <span class="fl">0.5</span>, <span class="co"># default: 0.5</span>
  parallel <span class="op">=</span> <span class="cn">TRUE</span>,
  BPPARAM <span class="op">=</span> <span class="fu">BiocParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html">bpparam</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>estimating size factors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>gene-wise dispersion estimates: 2 workers</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mean-dispersion relationship</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- note: fitType='parametric', but the dispersion trend was not well captured by the
   function: y = a/x + b, and a local regression fit was automatically substituted.
   specify fitType='local' or 'mean' to avoid this message next time.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>final dispersion estimates, fitting model and testing: 2 workers</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- replacing outliers and refitting for 13 genes
-- DESeq argument 'minReplicatesForReplace' = 7 
-- original counts are preserved in counts(dds)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>fitting model and testing</code></pre>
</div>
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">dds_1_de</span> <span class="op">&lt;-</span> <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/results.html">results</a></span><span class="op">(</span>
  <span class="va">dds_1_res</span>,
  contrast <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"diabcd"</span>, test <span class="op">=</span> <span class="st">"T2D"</span>, ref <span class="op">=</span> <span class="st">"NGT"</span><span class="op">)</span>,
  pAdjustMethod <span class="op">=</span> <span class="va">ctrl</span><span class="op">$</span><span class="va">adj_meth</span>
<span class="op">)</span> |&gt;
  <span class="op">(</span>\<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">df</span><span class="op">$</span><span class="va">feature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
    <span class="va">df</span>
  <span class="op">}</span><span class="op">)</span> <span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/with.html">within</a></span><span class="op">(</span><span class="va">log_padj</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">padj</span><span class="op">)</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="va">dds_1_gg</span> <span class="op">&lt;-</span>
  <span class="va">dds_1_de</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">log2FoldChange</span>, <span class="va">log_padj</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">..count..</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.001</span><span class="op">)</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>
    geom  <span class="op">=</span> <span class="st">"label"</span>, x <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span>,
    label <span class="op">=</span> <span class="st">"p = 0.05"</span>,
    fill <span class="op">=</span> <span class="st">"white"</span>, hjust <span class="op">=</span> <span class="st">"left"</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">1</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>
    geom  <span class="op">=</span> <span class="st">"label"</span>, x <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="fl">0.001</span><span class="op">)</span>,
    label <span class="op">=</span> <span class="st">"p = 0.001"</span>,
    fill <span class="op">=</span> <span class="st">"white"</span>, hjust <span class="op">=</span> <span class="st">"left"</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">1</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Log2-fold-change"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">padj</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">stat_bin_hex</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"black"</span>, high <span class="op">=</span> <span class="st">"gray90"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, asp <span class="op">=</span> <span class="fl">2</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">dds_1_gg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="de-baseline-all-micro-rna-accounting-for-age-bmi-dcal-trainn-dds_2" class="level2" data-number="4.3"><h2 data-number="4.3" class="anchored" data-anchor-id="de-baseline-all-micro-rna-accounting-for-age-bmi-dcal-trainn-dds_2">
<span class="header-section-number">4.3</span> DE: Baseline, all micro RNA, accounting for Age, BMI, DCAL, Trainn (<code>dds_2</code>)</h2>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/read_yaml.html">read_yaml</a></span><span class="op">(</span><span class="st">"_prog.yml"</span><span class="op">)</span><span class="op">$</span><span class="va">rna</span>

<span class="va">ngs_assay</span> <span class="op">&lt;-</span> <span class="st">"allmirna"</span>

<span class="va">filter_for_depth</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span>, <span class="va">assay</span>, <span class="va">depth_threshold</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">mae</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">mae</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">depth_threshold</span>, <span class="op">]</span>
<span class="op">}</span>

<span class="va">filter_for_visit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span>, <span class="va">visit</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">mae</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">$</span><span class="va">avisit</span> <span class="op">==</span> <span class="va">visit</span>, <span class="op">]</span>
<span class="op">}</span>

<span class="va">filter_for_low_expr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span>, <span class="va">assay</span>, <span class="va">cpm_threshold</span>, <span class="va">frac_cols</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Genes expressed at least cpm_threshold in frac_cols columns</span>
  <span class="va">mae</span><span class="op">[</span>
    <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu">cpm</span><span class="op">(</span><span class="va">mae</span><span class="op">[[</span><span class="va">assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">cpm_threshold</span><span class="op">)</span> <span class="op">&gt;</span>
      <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">mae</span><span class="op">[[</span><span class="va">assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">frac_cols</span>,
    ,
  <span class="op">]</span>
<span class="op">}</span>

<span class="va">scale_confounder</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mae</span>, <span class="va">confounder</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">confounder</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">cfd</span> <span class="op">&lt;-</span> <span class="va">confounder</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">[</span><span class="va">cfd</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">mae</span><span class="op">)</span><span class="op">[</span><span class="va">cfd</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">mae</span>
<span class="op">}</span>
<span class="va">ads</span> <span class="op">&lt;-</span> <span class="va">besd_mae</span> |&gt;
  <span class="op">(</span>\<span class="op">(</span><span class="va">mae</span><span class="op">)</span> <span class="va">mae</span><span class="op">[</span> , , <span class="va">ngs_assay</span><span class="op">]</span><span class="op">)</span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu">filter_for_depth</span><span class="op">(</span><span class="st">"allmirna"</span>, <span class="va">ctrl</span><span class="op">$</span><span class="va">depth_threshold</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> |&gt;
  <span class="fu">filter_for_visit</span><span class="op">(</span><span class="st">"Baseline"</span><span class="op">)</span> |&gt;
  <span class="fu">filter_for_low_expr</span><span class="op">(</span><span class="st">"allmirna"</span>, <span class="va">ctrl</span><span class="op">$</span><span class="va">cpm_threshold</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> |&gt;
  <span class="fu">scale_confounder</span><span class="op">(</span>confounder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"trainn"</span>, <span class="st">"BMI"</span>, <span class="st">"DCAL"</span><span class="op">)</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: 'experiments' dropped; see 'metadata'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>harmonizing input:
  removing 282 sampleMap rows not in names(experiments)</code></pre>
</div>
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">ads</span>

<span class="va">dds_2</span> <span class="op">&lt;-</span> <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/DESeqDataSet.html">DESeqDataSetFromMatrix</a></span><span class="op">(</span>
  countData <span class="op">=</span> <span class="va">ads</span><span class="op">[[</span><span class="va">ngs_assay</span><span class="op">]</span><span class="op">]</span>,
  colData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span><span class="op">(</span><span class="va">ads</span><span class="op">)</span>,
  design <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">BMI</span> <span class="op">+</span> <span class="va">trainn</span> <span class="op">+</span> <span class="va">DCAL</span> <span class="op">+</span> <span class="va">diabcd</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">dds_2_res</span> <span class="op">&lt;-</span> <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/DESeq.html">DESeq</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">dds_2</span>,
  quiet <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># default: FALSE</span>
  minReplicatesForReplace <span class="op">=</span> <span class="fl">7</span>, <span class="co"># default: 7</span>
  useT <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># default: FALSE</span>
  minmu <span class="op">=</span> <span class="fl">0.5</span>, <span class="co"># default: 0.5</span>
  parallel <span class="op">=</span> <span class="cn">TRUE</span>,
  BPPARAM <span class="op">=</span> <span class="fu">BiocParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html">bpparam</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>estimating size factors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>estimating dispersions</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>gene-wise dispersion estimates: 2 workers</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mean-dispersion relationship</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- note: fitType='parametric', but the dispersion trend was not well captured by the
   function: y = a/x + b, and a local regression fit was automatically substituted.
   specify fitType='local' or 'mean' to avoid this message next time.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>final dispersion estimates, fitting model and testing: 2 workers</code></pre>
</div>
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">dds_2_de</span> <span class="op">&lt;-</span> <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/results.html">results</a></span><span class="op">(</span>
  <span class="va">dds_2_res</span>,
  contrast <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"diabcd"</span>, test <span class="op">=</span> <span class="st">"T2D"</span>, ref <span class="op">=</span> <span class="st">"NGT"</span><span class="op">)</span>,
  pAdjustMethod <span class="op">=</span> <span class="va">ctrl</span><span class="op">$</span><span class="va">adj_meth</span>
<span class="op">)</span> |&gt;
  <span class="op">(</span>\<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">df</span><span class="op">$</span><span class="va">feature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
    <span class="va">df</span>
  <span class="op">}</span><span class="op">)</span> <span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/with.html">within</a></span><span class="op">(</span><span class="va">log_padj</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">padj</span><span class="op">)</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="va">dds_2_gg</span> <span class="op">&lt;-</span>
  <span class="va">dds_2_de</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">log2FoldChange</span>, <span class="va">log_padj</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">..count..</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.001</span><span class="op">)</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>
    geom  <span class="op">=</span> <span class="st">"label"</span>, x <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span>,
    label <span class="op">=</span> <span class="st">"p = 0.05"</span>,
    fill <span class="op">=</span> <span class="st">"white"</span>, hjust <span class="op">=</span> <span class="st">"left"</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">1</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>
    geom  <span class="op">=</span> <span class="st">"label"</span>, x <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="fl">0.001</span><span class="op">)</span>,
    label <span class="op">=</span> <span class="st">"p = 0.001"</span>,
    fill <span class="op">=</span> <span class="st">"white"</span>, hjust <span class="op">=</span> <span class="st">"left"</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">1</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Log2-fold-change"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">padj</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">stat_bin_hex</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"black"</span>, high <span class="op">=</span> <span class="st">"gray90"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, asp <span class="op">=</span> <span class="fl">2</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">dds_2_gg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="comparison-withwithout-confounding-factors" class="level2" data-number="4.4"><h2 data-number="4.4" class="anchored" data-anchor-id="comparison-withwithout-confounding-factors">
<span class="header-section-number">4.4</span> Comparison with/without confounding factors</h2>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">theme_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
      title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,
      text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">gg_1_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/with.html">within</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">dds_1_de</span><span class="op">)</span>, <span class="va">facet</span> <span class="op">&lt;-</span> <span class="st">"No confounding factors"</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/with.html">within</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">dds_2_de</span><span class="op">)</span>, <span class="va">facet</span> <span class="op">&lt;-</span> <span class="st">"~Age + BMI + DCAL + Train"</span><span class="op">)</span>
<span class="op">)</span> |&gt;
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">log2FoldChange</span>, <span class="va">log_padj</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">..count..</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.001</span><span class="op">)</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>
    geom  <span class="op">=</span> <span class="st">"label"</span>, x <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span>,
    label <span class="op">=</span> <span class="st">"p = 0.05"</span>,
    fill <span class="op">=</span> <span class="st">"white"</span>, hjust <span class="op">=</span> <span class="st">"left"</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">1</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>
    geom  <span class="op">=</span> <span class="st">"label"</span>, x <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="fl">0.001</span><span class="op">)</span>,
    label <span class="op">=</span> <span class="st">"p = 0.001"</span>,
    fill <span class="op">=</span> <span class="st">"white"</span>, hjust <span class="op">=</span> <span class="st">"left"</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">1</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Log2-fold-change"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">padj</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">stat_bin_hex</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"black"</span>, high <span class="op">=</span> <span class="st">"gray90"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">facet</span> <span class="op">~</span> <span class="va">.</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_fun</span><span class="op">(</span>
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
    legend.key.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">5</span>, <span class="st">"lines"</span><span class="op">)</span>,
    legend.key.height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">.8</span>, <span class="st">"lines"</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">dds_1_de</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">dds_2_de</span><span class="op">)</span>,
  by <span class="op">=</span> <span class="st">"feature"</span>,
  all <span class="op">=</span> <span class="cn">TRUE</span>,
  suffixes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">".asis"</span>, <span class="st">".cfd"</span><span class="op">)</span>
<span class="op">)</span>


<span class="va">fun_label</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>,
                      <span class="va">x</span> <span class="op">=</span> <span class="st">"log2FoldChange.asis"</span>,
                      <span class="va">y</span> <span class="op">=</span> <span class="st">"log2FoldChange.cfd"</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">cor_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">meth</span> <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">df</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, <span class="va">df</span><span class="op">[[</span><span class="va">y</span><span class="op">]</span><span class="op">]</span>, method <span class="op">=</span> <span class="va">meth</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span>
    <span class="st">"atop("</span>,
    <span class="st">"r == "</span>, <span class="fu">cor_fun</span><span class="op">(</span><span class="op">)</span>, <span class="st">","</span>,
    <span class="st">"rho == "</span>, <span class="fu">cor_fun</span><span class="op">(</span><span class="st">"spearman"</span><span class="op">)</span>,
    <span class="st">")"</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">lim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">res</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"log2FoldChange.asis"</span>, <span class="st">"log2FoldChange.cfd"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">gg_cor_lfc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">res</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">log2FoldChange.asis</span>, <span class="va">log2FoldChange.cfd</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"F"</span>, begin <span class="op">=</span> <span class="fl">.1</span>, end <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>
    <span class="st">"label"</span>, x <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, y <span class="op">=</span> <span class="cn">Inf</span>, hjust <span class="op">=</span> <span class="fl">0</span>, vjust <span class="op">=</span> <span class="fl">1</span>,
    label <span class="op">=</span> <span class="fu">fun_label</span><span class="op">(</span><span class="va">res</span><span class="op">)</span>,
    parse <span class="op">=</span> <span class="cn">TRUE</span>,
    family <span class="op">=</span> <span class="st">"mono"</span>,
    size <span class="op">=</span> <span class="fl">3</span>
  <span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="va">lim</span>, ylim <span class="op">=</span> <span class="va">lim</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Log Fold Change (LFC)"</span>,
    subtitle <span class="op">=</span> <span class="st">"With / Without Adjustment for Confounding Factors"</span>,
    x <span class="op">=</span> <span class="st">"No Adjustment"</span>,
    y <span class="op">=</span> <span class="st">"Adjusted for Confounding Factors"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_fun</span><span class="op">(</span>asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">lim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">res</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"log_padj.asis"</span>, <span class="st">"log_padj.cfd"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">gg_cor_pval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">res</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">log_padj.asis</span>, <span class="va">log_padj.cfd</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span>, begin <span class="op">=</span> <span class="fl">.1</span>, end <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"green2"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>
    <span class="st">"label"</span>, x <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, y <span class="op">=</span> <span class="cn">Inf</span>, hjust <span class="op">=</span> <span class="fl">0</span>, vjust <span class="op">=</span> <span class="fl">1</span>,
    label <span class="op">=</span> <span class="fu">fun_label</span><span class="op">(</span><span class="va">res</span>, <span class="st">"log_padj.asis"</span>, <span class="st">"log_padj.cfd"</span><span class="op">)</span>,
    parse <span class="op">=</span> <span class="cn">TRUE</span>,
    family <span class="op">=</span> <span class="st">"mono"</span>,
    size <span class="op">=</span> <span class="fl">3</span>
  <span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="va">lim</span>, ylim <span class="op">=</span> <span class="va">lim</span>, clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">"Significance: "</span><span class="op">*</span><span class="op">-</span><span class="fl">1</span> <span class="op">%.%</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">padj</span><span class="op">)</span><span class="op">)</span>,
    subtitle <span class="op">=</span> <span class="st">"With / Without Adjustment for Confounding Factors"</span>,
    x <span class="op">=</span> <span class="st">"No Adjustment"</span>,
    y <span class="op">=</span> <span class="st">"Adjusted for Confounding Factors"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_fun</span><span class="op">(</span>asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/">cowplot</a></span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">gg_1_2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span>
    <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">gg_cor_lfc</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span>,
    <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">gg_cor_pval</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span>,
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span>
  <span class="op">)</span>,
  ncol <span class="op">=</span> <span class="fl">1</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>,
  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="cn">NA</span><span class="op">)</span>
<span class="op">)</span>


<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">clean_slate</span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu">add_header</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FCA Collin"</span>, <span class="st">"UMB BESD"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Confidential"</span>, <span class="st">"Draft"</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">add_title</span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
      <span class="st">"Figure 6.1"</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/strwrap.html">strwrap</a></span><span class="op">(</span>
        <span class="st">"Volcano plot - Level and significance of Differential Expression among
        all miRNA at Baseline between T2D and NGT"</span>, width <span class="op">=</span> <span class="fl">80</span>
      <span class="op">)</span>,
      <span class="st">"Analysis Set: Full Analysis Set"</span>
    <span class="op">)</span>
  <span class="op">)</span> |&gt;
  <span class="fu">add_note</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="st">"A: Left panel accounts for Age, BMI, DCAL (diet) and number of trainings in
    the estimation and test of the differential expression of every gene; it
    may present marginal differences with the version presented 2 years ago
    likely due to slight variations in stochastic elements (e.g. missing
    data imputation)."</span>,
    <span class="st">"A: Right panel discards any confounding factors."</span>,
    <span class="st">"B, C: Scatter plots comparing
    the Log Fold Change estimations (B)/
    the significance (C, the higher the more significant)
    with (y axis) without (x axis) adjustment for confounding factors with
    annotation corresponding to the Pearson's correlation (r) and
    Spearman's rank correlation (rho)."</span>,
    <span class="st">"Hexbin representation: the intensity of each hexagonal bin accounts for
    the number of genes found in the area it covers."</span>
  <span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">add_figure</span><span class="op">(</span><span class="va">p</span>, height <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span> |&gt;
  <span class="fu">add_footer</span><span class="op">(</span>
    <span class="st">"Program t2d_06_rna / Env ayup_dbs:v0.1.0-alpha"</span>,
    <span class="va">params</span><span class="op">$</span><span class="va">version</span>
  <span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values (geom_text).</code></pre>
</div>
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu">export_as</span><span class="op">(</span>
  <span class="va">p</span>,
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="st">"fig_06_01.pdf"</span><span class="op">)</span>,
  file_graph_alone <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="va">grh</span>, <span class="st">"fig_06_01_af.pdf"</span><span class="op">)</span>
<span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/fig_06_01.pdf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[log] output saved as: ../tlg/graph/fig_06_01_af.pdf (annot. free)</code></pre>
</div>
</div>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu">show_slate</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="session-informations" class="level2" data-number="4.5"><h2 data-number="4.5" class="anchored" data-anchor-id="session-informations">
<span class="header-section-number">4.5</span> Session Informations</h2>
<div class="cell">
<details open=""><summary>Show the code</summary><div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://r-lib.github.io/sessioninfo/reference/session_info.html">session_info</a></span><span class="op">(</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
    } else {
      disableStylesheet(alternateStylesheets);
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="./t2d_09_chg.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Anthropometrics Changes From Baseline</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./t2d_07_mir.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">mRNA / micro RNA</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb68" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "RNASeq - Refresher"</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> Program 06</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Francois Collin"</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.time(), '%Y-%m-%d')`"</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, params}</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> yaml<span class="sc">::</span><span class="fu">read_yaml</span>(<span class="st">"_prog.yml"</span>)</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="fu">## RNA Seq - Local Study of Confounder Adjustment's Impact</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>Target:</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[x]</span> refresh the differential expression analysis technics with DESeq2.</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[x]</span> upgrade environment for differential expression analysis.</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[x]</span> evaluate the impact of confounder adjustment on a specific use case:</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>  compare miRNA expression between T2D and NGT at baseline.</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, settings}</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">"src/pkg/dbs.data"</span>)</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">"src/pkg/latarnia.utils"</span>)</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">results =</span> params<span class="sc">$</span>knitr<span class="sc">$</span>results)</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(assertthat)</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/ngs.R"</span>)</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data preparation</span></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, ads}</span></span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>adsl <span class="ot">&lt;-</span> dbs.data<span class="sc">::</span>adsl</span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>advs <span class="ot">&lt;-</span> dbs.data<span class="sc">::</span>advs</span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>adlb <span class="ot">&lt;-</span> dbs.data<span class="sc">::</span>adlb</span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a><span class="co">#' Subjid and Visit to Sample</span></span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a>subjvis_to_spl <span class="ot">&lt;-</span> <span class="cf">function</span>(df) <span class="fu">paste0</span>(df<span class="sc">$</span>subjid, <span class="st">"v"</span>, df<span class="sc">$</span>avisitn)</span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a>ads <span class="ot">&lt;-</span> adlb <span class="sc">|&gt;</span></span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(</span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true" tabindex="-1"></a>    paramcd <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb68-45"><a href="#cb68-45" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CHOL"</span>, <span class="st">"HBA1C"</span>, <span class="st">"HDL"</span>, <span class="st">"HOMAB"</span>, <span class="st">"HOMAIR"</span>, <span class="st">"LDL"</span>, <span class="st">"MATSUDA"</span>, <span class="st">"TRIG"</span></span>
<span id="cb68-46"><a href="#cb68-46" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb68-47"><a href="#cb68-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb68-48"><a href="#cb68-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(advs) <span class="sc">|&gt;</span></span>
<span id="cb68-49"><a href="#cb68-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(ct, dtype, param, base, basetype, chg, pchg)) <span class="sc">|&gt;</span></span>
<span id="cb68-50"><a href="#cb68-50" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"paramcd"</span>, <span class="at">values_from =</span> <span class="st">"aval"</span>) <span class="sc">|&gt;</span></span>
<span id="cb68-51"><a href="#cb68-51" aria-hidden="true" tabindex="-1"></a>  (\(df) <span class="fu">merge</span>(adsl, df, <span class="at">by =</span> <span class="st">"subjid"</span>))() <span class="sc">|&gt;</span></span>
<span id="cb68-52"><a href="#cb68-52" aria-hidden="true" tabindex="-1"></a>  (\(df) S4Vectors<span class="sc">::</span><span class="fu">DataFrame</span>(df, <span class="at">row.names =</span> <span class="fu">subjvis_to_spl</span>(df)))() <span class="sc">|&gt;</span></span>
<span id="cb68-53"><a href="#cb68-53" aria-hidden="true" tabindex="-1"></a>  (\(df) {</span>
<span id="cb68-54"><a href="#cb68-54" aria-hidden="true" tabindex="-1"></a>    assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">all</span>(<span class="fu">table</span>(<span class="fu">subjvis_to_spl</span>(df)) <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb68-55"><a href="#cb68-55" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb68-56"><a href="#cb68-56" aria-hidden="true" tabindex="-1"></a>  })()</span>
<span id="cb68-57"><a href="#cb68-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-58"><a href="#cb68-58" aria-hidden="true" tabindex="-1"></a>ads</span>
<span id="cb68-59"><a href="#cb68-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-60"><a href="#cb68-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-61"><a href="#cb68-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-62"><a href="#cb68-62" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, rna}</span></span>
<span id="cb68-63"><a href="#cb68-63" aria-hidden="true" tabindex="-1"></a>rna <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="co"># There will be mi-RNA data.</span></span>
<span id="cb68-64"><a href="#cb68-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">mrna =</span> dbs.data<span class="sc">::</span>mrna_raw,</span>
<span id="cb68-65"><a href="#cb68-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">premirna =</span> dbs.data<span class="sc">::</span>premirna_raw,</span>
<span id="cb68-66"><a href="#cb68-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">mirna =</span> dbs.data<span class="sc">::</span>mirna_raw</span>
<span id="cb68-67"><a href="#cb68-67" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-68"><a href="#cb68-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-69"><a href="#cb68-69" aria-hidden="true" tabindex="-1"></a>rna[<span class="fu">c</span>(<span class="st">"premirna"</span>, <span class="st">"mirna"</span>)] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb68-70"><a href="#cb68-70" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> rna[<span class="fu">c</span>(<span class="st">"premirna"</span>, <span class="st">"mirna"</span>)],</span>
<span id="cb68-71"><a href="#cb68-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN =</span> format_mirna</span>
<span id="cb68-72"><a href="#cb68-72" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-73"><a href="#cb68-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-74"><a href="#cb68-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Rows represent genes.</span></span>
<span id="cb68-75"><a href="#cb68-75" aria-hidden="true" tabindex="-1"></a>rna <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="at">X =</span> rna, <span class="at">FUN =</span> <span class="cf">function</span>(x) y <span class="ot">&lt;-</span> x[<span class="fu">rowSums</span>(x) <span class="sc">&gt;</span> <span class="dv">0</span>, ])</span>
<span id="cb68-76"><a href="#cb68-76" aria-hidden="true" tabindex="-1"></a>rna <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="at">X =</span> rna, as.matrix)</span>
<span id="cb68-77"><a href="#cb68-77" aria-hidden="true" tabindex="-1"></a>assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(rna<span class="sc">$</span>premirna) <span class="sc">==</span> <span class="fu">colnames</span>(rna<span class="sc">$</span>mirna)))</span>
<span id="cb68-78"><a href="#cb68-78" aria-hidden="true" tabindex="-1"></a>rna<span class="sc">$</span>allmirna <span class="ot">&lt;-</span> <span class="fu">rbind</span>(rna<span class="sc">$</span>premirna, rna<span class="sc">$</span>mirna)</span>
<span id="cb68-79"><a href="#cb68-79" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb68-80"><a href="#cb68-80" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"rna features discriminated in noexpr, expr"</span>, {</span>
<span id="cb68-81"><a href="#cb68-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(</span>
<span id="cb68-82"><a href="#cb68-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> rna,</span>
<span id="cb68-83"><a href="#cb68-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">rowSums</span>(x) <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb68-84"><a href="#cb68-84" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb68-85"><a href="#cb68-85" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb68-86"><a href="#cb68-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-87"><a href="#cb68-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-88"><a href="#cb68-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, mae}</span></span>
<span id="cb68-89"><a href="#cb68-89" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MultiAssayExperiment)</span>
<span id="cb68-90"><a href="#cb68-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-91"><a href="#cb68-91" aria-hidden="true" tabindex="-1"></a><span class="co">#' (Sample-)Map Arrays</span></span>
<span id="cb68-92"><a href="#cb68-92" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb68-93"><a href="#cb68-93" aria-hidden="true" tabindex="-1"></a><span class="co">#' Use the colnames of `x` to deduce the `primary` and `colnames`.</span></span>
<span id="cb68-94"><a href="#cb68-94" aria-hidden="true" tabindex="-1"></a><span class="co">#' This is used to generate the sample mapping between colData and Experiments.</span></span>
<span id="cb68-95"><a href="#cb68-95" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb68-96"><a href="#cb68-96" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param x (`dataframe`).</span></span>
<span id="cb68-97"><a href="#cb68-97" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb68-98"><a href="#cb68-98" aria-hidden="true" tabindex="-1"></a><span class="co">#' @note In our case, primary and colnames are equivalent, colnames could</span></span>
<span id="cb68-99"><a href="#cb68-99" aria-hidden="true" tabindex="-1"></a><span class="co">#' be different from primary names when a biological sample has different</span></span>
<span id="cb68-100"><a href="#cb68-100" aria-hidden="true" tabindex="-1"></a><span class="co">#' names in the biological assays (e.g. machine constraint, technical</span></span>
<span id="cb68-101"><a href="#cb68-101" aria-hidden="true" tabindex="-1"></a><span class="co">#' repetitions).</span></span>
<span id="cb68-102"><a href="#cb68-102" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb68-103"><a href="#cb68-103" aria-hidden="true" tabindex="-1"></a><span class="co">#' @seealso [MultiAssayExperiment::listToMap()]</span></span>
<span id="cb68-104"><a href="#cb68-104" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb68-105"><a href="#cb68-105" aria-hidden="true" tabindex="-1"></a><span class="co">#' \dontrun{</span></span>
<span id="cb68-106"><a href="#cb68-106" aria-hidden="true" tabindex="-1"></a><span class="co">#' lapply(rna, map_arrays)</span></span>
<span id="cb68-107"><a href="#cb68-107" aria-hidden="true" tabindex="-1"></a><span class="co">#' MultiAssayExperiment::listToMap(lapply(rna, map_arrays))</span></span>
<span id="cb68-108"><a href="#cb68-108" aria-hidden="true" tabindex="-1"></a><span class="co">#' }</span></span>
<span id="cb68-109"><a href="#cb68-109" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb68-110"><a href="#cb68-110" aria-hidden="true" tabindex="-1"></a>map_arrays <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb68-111"><a href="#cb68-111" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">colname =</span> <span class="fu">colnames</span>(x))</span>
<span id="cb68-112"><a href="#cb68-112" aria-hidden="true" tabindex="-1"></a>  y<span class="sc">$</span>primary <span class="ot">&lt;-</span> y<span class="sc">$</span>colname</span>
<span id="cb68-113"><a href="#cb68-113" aria-hidden="true" tabindex="-1"></a>  y</span>
<span id="cb68-114"><a href="#cb68-114" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-115"><a href="#cb68-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-116"><a href="#cb68-116" aria-hidden="true" tabindex="-1"></a>besd_mae <span class="ot">&lt;-</span> <span class="fu">MultiAssayExperiment</span>(</span>
<span id="cb68-117"><a href="#cb68-117" aria-hidden="true" tabindex="-1"></a>  <span class="at">experiments =</span> <span class="fu">ExperimentList</span>(rna),</span>
<span id="cb68-118"><a href="#cb68-118" aria-hidden="true" tabindex="-1"></a>  <span class="at">colData =</span> ads,</span>
<span id="cb68-119"><a href="#cb68-119" aria-hidden="true" tabindex="-1"></a>  <span class="at">sampleMap =</span> <span class="fu">listToMap</span>(<span class="fu">lapply</span>(rna, map_arrays))</span>
<span id="cb68-120"><a href="#cb68-120" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-121"><a href="#cb68-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-122"><a href="#cb68-122" aria-hidden="true" tabindex="-1"></a>besd_mae</span>
<span id="cb68-123"><a href="#cb68-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-124"><a href="#cb68-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-125"><a href="#cb68-125" aria-hidden="true" tabindex="-1"></a><span class="fu">## DE: Baseline, all micro RNA, no confounding factor (`dds_1`)</span></span>
<span id="cb68-126"><a href="#cb68-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-127"><a href="#cb68-127" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, dds_1}</span></span>
<span id="cb68-128"><a href="#cb68-128" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> yaml<span class="sc">::</span><span class="fu">read_yaml</span>(<span class="st">"_prog.yml"</span>)<span class="sc">$</span>rna</span>
<span id="cb68-129"><a href="#cb68-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-130"><a href="#cb68-130" aria-hidden="true" tabindex="-1"></a>ngs_assay <span class="ot">&lt;-</span> <span class="st">"allmirna"</span></span>
<span id="cb68-131"><a href="#cb68-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-132"><a href="#cb68-132" aria-hidden="true" tabindex="-1"></a>filter_for_depth <span class="ot">&lt;-</span> <span class="cf">function</span>(mae, assay, depth_threshold) {</span>
<span id="cb68-133"><a href="#cb68-133" aria-hidden="true" tabindex="-1"></a>  mae[, <span class="fu">colSums</span>(mae[[ngs_assay]]) <span class="sc">&gt;</span> depth_threshold, ]</span>
<span id="cb68-134"><a href="#cb68-134" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-135"><a href="#cb68-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-136"><a href="#cb68-136" aria-hidden="true" tabindex="-1"></a>filter_for_visit <span class="ot">&lt;-</span> <span class="cf">function</span>(mae, visit) {</span>
<span id="cb68-137"><a href="#cb68-137" aria-hidden="true" tabindex="-1"></a>  mae[, <span class="fu">colData</span>(mae)<span class="sc">$</span>avisit <span class="sc">==</span> visit, ]</span>
<span id="cb68-138"><a href="#cb68-138" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-139"><a href="#cb68-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-140"><a href="#cb68-140" aria-hidden="true" tabindex="-1"></a>filter_for_low_expr <span class="ot">&lt;-</span> <span class="cf">function</span>(mae, assay, cpm_threshold, <span class="at">frac_cols =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>) {</span>
<span id="cb68-141"><a href="#cb68-141" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Genes expressed at least cpm_threshold in frac_cols columns</span></span>
<span id="cb68-142"><a href="#cb68-142" aria-hidden="true" tabindex="-1"></a>  mae[</span>
<span id="cb68-143"><a href="#cb68-143" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowSums</span>(<span class="fu">cpm</span>(mae[[assay]]) <span class="sc">&gt;</span> cpm_threshold) <span class="sc">&gt;</span></span>
<span id="cb68-144"><a href="#cb68-144" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ncol</span>(mae[[assay]]) <span class="sc">*</span> frac_cols,</span>
<span id="cb68-145"><a href="#cb68-145" aria-hidden="true" tabindex="-1"></a>    ,</span>
<span id="cb68-146"><a href="#cb68-146" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb68-147"><a href="#cb68-147" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-148"><a href="#cb68-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-149"><a href="#cb68-149" aria-hidden="true" tabindex="-1"></a>ads <span class="ot">&lt;-</span> besd_mae <span class="sc">|&gt;</span></span>
<span id="cb68-150"><a href="#cb68-150" aria-hidden="true" tabindex="-1"></a>  (\(mae) mae[ , , ngs_assay])() <span class="sc">|&gt;</span></span>
<span id="cb68-151"><a href="#cb68-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_for_depth</span>(<span class="st">"allmirna"</span>, ctrl<span class="sc">$</span>depth_threshold[[ngs_assay]]) <span class="sc">|&gt;</span></span>
<span id="cb68-152"><a href="#cb68-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_for_visit</span>(<span class="st">"Baseline"</span>) <span class="sc">|&gt;</span></span>
<span id="cb68-153"><a href="#cb68-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_for_low_expr</span>(<span class="st">"allmirna"</span>, ctrl<span class="sc">$</span>cpm_threshold[[ngs_assay]])</span>
<span id="cb68-154"><a href="#cb68-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-155"><a href="#cb68-155" aria-hidden="true" tabindex="-1"></a>ads</span>
<span id="cb68-156"><a href="#cb68-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-157"><a href="#cb68-157" aria-hidden="true" tabindex="-1"></a>dds_1 <span class="ot">&lt;-</span> DESeq2<span class="sc">::</span><span class="fu">DESeqDataSetFromMatrix</span>(</span>
<span id="cb68-158"><a href="#cb68-158" aria-hidden="true" tabindex="-1"></a>  <span class="at">countData =</span> ads[[ngs_assay]],</span>
<span id="cb68-159"><a href="#cb68-159" aria-hidden="true" tabindex="-1"></a>  <span class="at">colData =</span> <span class="fu">colData</span>(ads),</span>
<span id="cb68-160"><a href="#cb68-160" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> stats<span class="sc">::</span><span class="fu">formula</span>(<span class="sc">~</span> diabcd)</span>
<span id="cb68-161"><a href="#cb68-161" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-162"><a href="#cb68-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-163"><a href="#cb68-163" aria-hidden="true" tabindex="-1"></a>dds_1_res <span class="ot">&lt;-</span> DESeq2<span class="sc">::</span><span class="fu">DESeq</span>(</span>
<span id="cb68-164"><a href="#cb68-164" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> dds_1,</span>
<span id="cb68-165"><a href="#cb68-165" aria-hidden="true" tabindex="-1"></a>  <span class="at">quiet =</span> <span class="cn">FALSE</span>, <span class="co"># default: FALSE</span></span>
<span id="cb68-166"><a href="#cb68-166" aria-hidden="true" tabindex="-1"></a>  <span class="at">minReplicatesForReplace =</span> <span class="dv">7</span>, <span class="co"># default: 7</span></span>
<span id="cb68-167"><a href="#cb68-167" aria-hidden="true" tabindex="-1"></a>  <span class="at">useT =</span> <span class="cn">FALSE</span>, <span class="co"># default: FALSE</span></span>
<span id="cb68-168"><a href="#cb68-168" aria-hidden="true" tabindex="-1"></a>  <span class="at">minmu =</span> <span class="fl">0.5</span>, <span class="co"># default: 0.5</span></span>
<span id="cb68-169"><a href="#cb68-169" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-170"><a href="#cb68-170" aria-hidden="true" tabindex="-1"></a>  <span class="at">BPPARAM =</span> BiocParallel<span class="sc">::</span><span class="fu">bpparam</span>()</span>
<span id="cb68-171"><a href="#cb68-171" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-172"><a href="#cb68-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-173"><a href="#cb68-173" aria-hidden="true" tabindex="-1"></a>dds_1_de <span class="ot">&lt;-</span> DESeq2<span class="sc">::</span><span class="fu">results</span>(</span>
<span id="cb68-174"><a href="#cb68-174" aria-hidden="true" tabindex="-1"></a>  dds_1_res,</span>
<span id="cb68-175"><a href="#cb68-175" aria-hidden="true" tabindex="-1"></a>  <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"diabcd"</span>, <span class="at">test =</span> <span class="st">"T2D"</span>, <span class="at">ref =</span> <span class="st">"NGT"</span>),</span>
<span id="cb68-176"><a href="#cb68-176" aria-hidden="true" tabindex="-1"></a>  <span class="at">pAdjustMethod =</span> ctrl<span class="sc">$</span>adj_meth</span>
<span id="cb68-177"><a href="#cb68-177" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb68-178"><a href="#cb68-178" aria-hidden="true" tabindex="-1"></a>  (\(df) {</span>
<span id="cb68-179"><a href="#cb68-179" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>feature <span class="ot">&lt;-</span> <span class="fu">rownames</span>(df)</span>
<span id="cb68-180"><a href="#cb68-180" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb68-181"><a href="#cb68-181" aria-hidden="true" tabindex="-1"></a>  }) () <span class="sc">|&gt;</span></span>
<span id="cb68-182"><a href="#cb68-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">within</span>(log_padj <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">log10</span>(padj))</span>
<span id="cb68-183"><a href="#cb68-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-184"><a href="#cb68-184" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb68-185"><a href="#cb68-185" aria-hidden="true" tabindex="-1"></a>dds_1_gg <span class="ot">&lt;-</span></span>
<span id="cb68-186"><a href="#cb68-186" aria-hidden="true" tabindex="-1"></a>  dds_1_de <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb68-187"><a href="#cb68-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(log2FoldChange, log_padj, <span class="at">fill =</span> <span class="fu">log10</span>(..count..))) <span class="sc">+</span></span>
<span id="cb68-188"><a href="#cb68-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">log10</span>(<span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.001</span>)), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb68-189"><a href="#cb68-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb68-190"><a href="#cb68-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb68-191"><a href="#cb68-191" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom  =</span> <span class="st">"label"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">log10</span>(<span class="fl">0.05</span>),</span>
<span id="cb68-192"><a href="#cb68-192" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"p = 0.05"</span>,</span>
<span id="cb68-193"><a href="#cb68-193" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">hjust =</span> <span class="st">"left"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span></span>
<span id="cb68-194"><a href="#cb68-194" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb68-195"><a href="#cb68-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb68-196"><a href="#cb68-196" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom  =</span> <span class="st">"label"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">log10</span>(<span class="fl">0.001</span>),</span>
<span id="cb68-197"><a href="#cb68-197" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"p = 0.001"</span>,</span>
<span id="cb68-198"><a href="#cb68-198" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">hjust =</span> <span class="st">"left"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span></span>
<span id="cb68-199"><a href="#cb68-199" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb68-200"><a href="#cb68-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Log2-fold-change"</span>) <span class="sc">+</span></span>
<span id="cb68-201"><a href="#cb68-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">%*%</span> <span class="fu">log10</span>(padj))) <span class="sc">+</span></span>
<span id="cb68-202"><a href="#cb68-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_bin_hex</span>() <span class="sc">+</span></span>
<span id="cb68-203"><a href="#cb68-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"black"</span>, <span class="at">high =</span> <span class="st">"gray90"</span>) <span class="sc">+</span></span>
<span id="cb68-204"><a href="#cb68-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb68-205"><a href="#cb68-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">asp =</span> <span class="dv">2</span> <span class="sc">/</span> <span class="dv">3</span>)</span>
<span id="cb68-206"><a href="#cb68-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-207"><a href="#cb68-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-208"><a href="#cb68-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-209"><a href="#cb68-209" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, dds_1_render, eval=params$knitr$results!="hide"}</span></span>
<span id="cb68-210"><a href="#cb68-210" aria-hidden="true" tabindex="-1"></a>dds_1_gg</span>
<span id="cb68-211"><a href="#cb68-211" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-212"><a href="#cb68-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-213"><a href="#cb68-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-214"><a href="#cb68-214" aria-hidden="true" tabindex="-1"></a><span class="fu">## DE: Baseline, all micro RNA, accounting for Age, BMI, DCAL, Trainn (`dds_2`)</span></span>
<span id="cb68-215"><a href="#cb68-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-216"><a href="#cb68-216" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, dds_2}</span></span>
<span id="cb68-217"><a href="#cb68-217" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> yaml<span class="sc">::</span><span class="fu">read_yaml</span>(<span class="st">"_prog.yml"</span>)<span class="sc">$</span>rna</span>
<span id="cb68-218"><a href="#cb68-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-219"><a href="#cb68-219" aria-hidden="true" tabindex="-1"></a>ngs_assay <span class="ot">&lt;-</span> <span class="st">"allmirna"</span></span>
<span id="cb68-220"><a href="#cb68-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-221"><a href="#cb68-221" aria-hidden="true" tabindex="-1"></a>filter_for_depth <span class="ot">&lt;-</span> <span class="cf">function</span>(mae, assay, depth_threshold) {</span>
<span id="cb68-222"><a href="#cb68-222" aria-hidden="true" tabindex="-1"></a>  mae[, <span class="fu">colSums</span>(mae[[ngs_assay]]) <span class="sc">&gt;</span> depth_threshold, ]</span>
<span id="cb68-223"><a href="#cb68-223" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-224"><a href="#cb68-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-225"><a href="#cb68-225" aria-hidden="true" tabindex="-1"></a>filter_for_visit <span class="ot">&lt;-</span> <span class="cf">function</span>(mae, visit) {</span>
<span id="cb68-226"><a href="#cb68-226" aria-hidden="true" tabindex="-1"></a>  mae[, <span class="fu">colData</span>(mae)<span class="sc">$</span>avisit <span class="sc">==</span> visit, ]</span>
<span id="cb68-227"><a href="#cb68-227" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-228"><a href="#cb68-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-229"><a href="#cb68-229" aria-hidden="true" tabindex="-1"></a>filter_for_low_expr <span class="ot">&lt;-</span> <span class="cf">function</span>(mae, assay, cpm_threshold, <span class="at">frac_cols =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>) {</span>
<span id="cb68-230"><a href="#cb68-230" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Genes expressed at least cpm_threshold in frac_cols columns</span></span>
<span id="cb68-231"><a href="#cb68-231" aria-hidden="true" tabindex="-1"></a>  mae[</span>
<span id="cb68-232"><a href="#cb68-232" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowSums</span>(<span class="fu">cpm</span>(mae[[assay]]) <span class="sc">&gt;</span> cpm_threshold) <span class="sc">&gt;</span></span>
<span id="cb68-233"><a href="#cb68-233" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ncol</span>(mae[[assay]]) <span class="sc">*</span> frac_cols,</span>
<span id="cb68-234"><a href="#cb68-234" aria-hidden="true" tabindex="-1"></a>    ,</span>
<span id="cb68-235"><a href="#cb68-235" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb68-236"><a href="#cb68-236" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-237"><a href="#cb68-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-238"><a href="#cb68-238" aria-hidden="true" tabindex="-1"></a>scale_confounder <span class="ot">&lt;-</span> <span class="cf">function</span>(mae, confounder) {</span>
<span id="cb68-239"><a href="#cb68-239" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(confounder)) {</span>
<span id="cb68-240"><a href="#cb68-240" aria-hidden="true" tabindex="-1"></a>    cfd <span class="ot">&lt;-</span> confounder[i]</span>
<span id="cb68-241"><a href="#cb68-241" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colData</span>(mae)[cfd] <span class="ot">&lt;-</span> <span class="fu">scale</span>(<span class="fu">colData</span>(mae)[cfd])</span>
<span id="cb68-242"><a href="#cb68-242" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb68-243"><a href="#cb68-243" aria-hidden="true" tabindex="-1"></a>  mae</span>
<span id="cb68-244"><a href="#cb68-244" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-245"><a href="#cb68-245" aria-hidden="true" tabindex="-1"></a>ads <span class="ot">&lt;-</span> besd_mae <span class="sc">|&gt;</span></span>
<span id="cb68-246"><a href="#cb68-246" aria-hidden="true" tabindex="-1"></a>  (\(mae) mae[ , , ngs_assay])() <span class="sc">|&gt;</span></span>
<span id="cb68-247"><a href="#cb68-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_for_depth</span>(<span class="st">"allmirna"</span>, ctrl<span class="sc">$</span>depth_threshold[[ngs_assay]]) <span class="sc">|&gt;</span></span>
<span id="cb68-248"><a href="#cb68-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_for_visit</span>(<span class="st">"Baseline"</span>) <span class="sc">|&gt;</span></span>
<span id="cb68-249"><a href="#cb68-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_for_low_expr</span>(<span class="st">"allmirna"</span>, ctrl<span class="sc">$</span>cpm_threshold[[ngs_assay]]) <span class="sc">|&gt;</span></span>
<span id="cb68-250"><a href="#cb68-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_confounder</span>(<span class="at">confounder =</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"trainn"</span>, <span class="st">"BMI"</span>, <span class="st">"DCAL"</span>))</span>
<span id="cb68-251"><a href="#cb68-251" aria-hidden="true" tabindex="-1"></a>ads</span>
<span id="cb68-252"><a href="#cb68-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-253"><a href="#cb68-253" aria-hidden="true" tabindex="-1"></a>dds_2 <span class="ot">&lt;-</span> DESeq2<span class="sc">::</span><span class="fu">DESeqDataSetFromMatrix</span>(</span>
<span id="cb68-254"><a href="#cb68-254" aria-hidden="true" tabindex="-1"></a>  <span class="at">countData =</span> ads[[ngs_assay]],</span>
<span id="cb68-255"><a href="#cb68-255" aria-hidden="true" tabindex="-1"></a>  <span class="at">colData =</span> <span class="fu">colData</span>(ads),</span>
<span id="cb68-256"><a href="#cb68-256" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> stats<span class="sc">::</span><span class="fu">formula</span>(<span class="sc">~</span> age <span class="sc">+</span> BMI <span class="sc">+</span> trainn <span class="sc">+</span> DCAL <span class="sc">+</span> diabcd)</span>
<span id="cb68-257"><a href="#cb68-257" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-258"><a href="#cb68-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-259"><a href="#cb68-259" aria-hidden="true" tabindex="-1"></a>dds_2_res <span class="ot">&lt;-</span> DESeq2<span class="sc">::</span><span class="fu">DESeq</span>(</span>
<span id="cb68-260"><a href="#cb68-260" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> dds_2,</span>
<span id="cb68-261"><a href="#cb68-261" aria-hidden="true" tabindex="-1"></a>  <span class="at">quiet =</span> <span class="cn">FALSE</span>, <span class="co"># default: FALSE</span></span>
<span id="cb68-262"><a href="#cb68-262" aria-hidden="true" tabindex="-1"></a>  <span class="at">minReplicatesForReplace =</span> <span class="dv">7</span>, <span class="co"># default: 7</span></span>
<span id="cb68-263"><a href="#cb68-263" aria-hidden="true" tabindex="-1"></a>  <span class="at">useT =</span> <span class="cn">FALSE</span>, <span class="co"># default: FALSE</span></span>
<span id="cb68-264"><a href="#cb68-264" aria-hidden="true" tabindex="-1"></a>  <span class="at">minmu =</span> <span class="fl">0.5</span>, <span class="co"># default: 0.5</span></span>
<span id="cb68-265"><a href="#cb68-265" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-266"><a href="#cb68-266" aria-hidden="true" tabindex="-1"></a>  <span class="at">BPPARAM =</span> BiocParallel<span class="sc">::</span><span class="fu">bpparam</span>()</span>
<span id="cb68-267"><a href="#cb68-267" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-268"><a href="#cb68-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-269"><a href="#cb68-269" aria-hidden="true" tabindex="-1"></a>dds_2_de <span class="ot">&lt;-</span> DESeq2<span class="sc">::</span><span class="fu">results</span>(</span>
<span id="cb68-270"><a href="#cb68-270" aria-hidden="true" tabindex="-1"></a>  dds_2_res,</span>
<span id="cb68-271"><a href="#cb68-271" aria-hidden="true" tabindex="-1"></a>  <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"diabcd"</span>, <span class="at">test =</span> <span class="st">"T2D"</span>, <span class="at">ref =</span> <span class="st">"NGT"</span>),</span>
<span id="cb68-272"><a href="#cb68-272" aria-hidden="true" tabindex="-1"></a>  <span class="at">pAdjustMethod =</span> ctrl<span class="sc">$</span>adj_meth</span>
<span id="cb68-273"><a href="#cb68-273" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb68-274"><a href="#cb68-274" aria-hidden="true" tabindex="-1"></a>  (\(df) {</span>
<span id="cb68-275"><a href="#cb68-275" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>feature <span class="ot">&lt;-</span> <span class="fu">rownames</span>(df)</span>
<span id="cb68-276"><a href="#cb68-276" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb68-277"><a href="#cb68-277" aria-hidden="true" tabindex="-1"></a>  }) () <span class="sc">|&gt;</span></span>
<span id="cb68-278"><a href="#cb68-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">within</span>(log_padj <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">log10</span>(padj))</span>
<span id="cb68-279"><a href="#cb68-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-280"><a href="#cb68-280" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb68-281"><a href="#cb68-281" aria-hidden="true" tabindex="-1"></a>dds_2_gg <span class="ot">&lt;-</span></span>
<span id="cb68-282"><a href="#cb68-282" aria-hidden="true" tabindex="-1"></a>  dds_2_de <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb68-283"><a href="#cb68-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(log2FoldChange, log_padj, <span class="at">fill =</span> <span class="fu">log10</span>(..count..))) <span class="sc">+</span></span>
<span id="cb68-284"><a href="#cb68-284" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">log10</span>(<span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.001</span>)), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb68-285"><a href="#cb68-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb68-286"><a href="#cb68-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb68-287"><a href="#cb68-287" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom  =</span> <span class="st">"label"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">log10</span>(<span class="fl">0.05</span>),</span>
<span id="cb68-288"><a href="#cb68-288" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"p = 0.05"</span>,</span>
<span id="cb68-289"><a href="#cb68-289" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">hjust =</span> <span class="st">"left"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span></span>
<span id="cb68-290"><a href="#cb68-290" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb68-291"><a href="#cb68-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb68-292"><a href="#cb68-292" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom  =</span> <span class="st">"label"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">log10</span>(<span class="fl">0.001</span>),</span>
<span id="cb68-293"><a href="#cb68-293" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"p = 0.001"</span>,</span>
<span id="cb68-294"><a href="#cb68-294" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">hjust =</span> <span class="st">"left"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span></span>
<span id="cb68-295"><a href="#cb68-295" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb68-296"><a href="#cb68-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Log2-fold-change"</span>) <span class="sc">+</span></span>
<span id="cb68-297"><a href="#cb68-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">%*%</span> <span class="fu">log10</span>(padj))) <span class="sc">+</span></span>
<span id="cb68-298"><a href="#cb68-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_bin_hex</span>() <span class="sc">+</span></span>
<span id="cb68-299"><a href="#cb68-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"black"</span>, <span class="at">high =</span> <span class="st">"gray90"</span>) <span class="sc">+</span></span>
<span id="cb68-300"><a href="#cb68-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb68-301"><a href="#cb68-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">asp =</span> <span class="dv">2</span> <span class="sc">/</span> <span class="dv">3</span>)</span>
<span id="cb68-302"><a href="#cb68-302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-303"><a href="#cb68-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-304"><a href="#cb68-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-305"><a href="#cb68-305" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, dds_2_render, eval=params$knitr$results!="hide"}</span></span>
<span id="cb68-306"><a href="#cb68-306" aria-hidden="true" tabindex="-1"></a>dds_2_gg</span>
<span id="cb68-307"><a href="#cb68-307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-308"><a href="#cb68-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-309"><a href="#cb68-309" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparison with/without confounding factors</span></span>
<span id="cb68-310"><a href="#cb68-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-311"><a href="#cb68-311" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, graph_comp}</span></span>
<span id="cb68-312"><a href="#cb68-312" aria-hidden="true" tabindex="-1"></a>theme_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb68-313"><a href="#cb68-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb68-314"><a href="#cb68-314" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb68-315"><a href="#cb68-315" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb68-316"><a href="#cb68-316" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>)</span>
<span id="cb68-317"><a href="#cb68-317" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb68-318"><a href="#cb68-318" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(...)</span>
<span id="cb68-319"><a href="#cb68-319" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-320"><a href="#cb68-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-321"><a href="#cb68-321" aria-hidden="true" tabindex="-1"></a>gg_1_2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb68-322"><a href="#cb68-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">within</span>(<span class="fu">as.data.frame</span>(dds_1_de), facet <span class="ot">&lt;-</span> <span class="st">"No confounding factors"</span>),</span>
<span id="cb68-323"><a href="#cb68-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">within</span>(<span class="fu">as.data.frame</span>(dds_2_de), facet <span class="ot">&lt;-</span> <span class="st">"~Age + BMI + DCAL + Train"</span>)</span>
<span id="cb68-324"><a href="#cb68-324" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb68-325"><a href="#cb68-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(log2FoldChange, log_padj, <span class="at">fill =</span> <span class="fu">log10</span>(..count..))) <span class="sc">+</span></span>
<span id="cb68-326"><a href="#cb68-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">log10</span>(<span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.001</span>)), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb68-327"><a href="#cb68-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb68-328"><a href="#cb68-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb68-329"><a href="#cb68-329" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom  =</span> <span class="st">"label"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">log10</span>(<span class="fl">0.05</span>),</span>
<span id="cb68-330"><a href="#cb68-330" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"p = 0.05"</span>,</span>
<span id="cb68-331"><a href="#cb68-331" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">hjust =</span> <span class="st">"left"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span></span>
<span id="cb68-332"><a href="#cb68-332" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb68-333"><a href="#cb68-333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb68-334"><a href="#cb68-334" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom  =</span> <span class="st">"label"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">log10</span>(<span class="fl">0.001</span>),</span>
<span id="cb68-335"><a href="#cb68-335" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"p = 0.001"</span>,</span>
<span id="cb68-336"><a href="#cb68-336" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">hjust =</span> <span class="st">"left"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span></span>
<span id="cb68-337"><a href="#cb68-337" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb68-338"><a href="#cb68-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Log2-fold-change"</span>) <span class="sc">+</span></span>
<span id="cb68-339"><a href="#cb68-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">%*%</span> <span class="fu">log10</span>(padj))) <span class="sc">+</span></span>
<span id="cb68-340"><a href="#cb68-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_bin_hex</span>() <span class="sc">+</span></span>
<span id="cb68-341"><a href="#cb68-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"black"</span>, <span class="at">high =</span> <span class="st">"gray90"</span>) <span class="sc">+</span></span>
<span id="cb68-342"><a href="#cb68-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(facet <span class="sc">~</span> ., <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb68-343"><a href="#cb68-343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_fun</span>(</span>
<span id="cb68-344"><a href="#cb68-344" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb68-345"><a href="#cb68-345" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb68-346"><a href="#cb68-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb68-347"><a href="#cb68-347" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">"lines"</span>),</span>
<span id="cb68-348"><a href="#cb68-348" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> <span class="fu">unit</span>(.<span class="dv">8</span>, <span class="st">"lines"</span>)</span>
<span id="cb68-349"><a href="#cb68-349" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb68-350"><a href="#cb68-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-351"><a href="#cb68-351" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb68-352"><a href="#cb68-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(dds_1_de),</span>
<span id="cb68-353"><a href="#cb68-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(dds_2_de),</span>
<span id="cb68-354"><a href="#cb68-354" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">"feature"</span>,</span>
<span id="cb68-355"><a href="#cb68-355" aria-hidden="true" tabindex="-1"></a>  <span class="at">all =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-356"><a href="#cb68-356" aria-hidden="true" tabindex="-1"></a>  <span class="at">suffixes =</span> <span class="fu">c</span>(<span class="st">".asis"</span>, <span class="st">".cfd"</span>)</span>
<span id="cb68-357"><a href="#cb68-357" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-358"><a href="#cb68-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-359"><a href="#cb68-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-360"><a href="#cb68-360" aria-hidden="true" tabindex="-1"></a>fun_label <span class="ot">&lt;-</span> <span class="cf">function</span>(df,</span>
<span id="cb68-361"><a href="#cb68-361" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x =</span> <span class="st">"log2FoldChange.asis"</span>,</span>
<span id="cb68-362"><a href="#cb68-362" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> <span class="st">"log2FoldChange.cfd"</span>) {</span>
<span id="cb68-363"><a href="#cb68-363" aria-hidden="true" tabindex="-1"></a>  cor_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">meth =</span> <span class="st">"pearson"</span>) {</span>
<span id="cb68-364"><a href="#cb68-364" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">cor</span>(df[[x]], df[[y]], <span class="at">method =</span> meth), <span class="dv">2</span>)</span>
<span id="cb68-365"><a href="#cb68-365" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb68-366"><a href="#cb68-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(</span>
<span id="cb68-367"><a href="#cb68-367" aria-hidden="true" tabindex="-1"></a>    <span class="st">"atop("</span>,</span>
<span id="cb68-368"><a href="#cb68-368" aria-hidden="true" tabindex="-1"></a>    <span class="st">"r == "</span>, <span class="fu">cor_fun</span>(), <span class="st">","</span>,</span>
<span id="cb68-369"><a href="#cb68-369" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rho == "</span>, <span class="fu">cor_fun</span>(<span class="st">"spearman"</span>),</span>
<span id="cb68-370"><a href="#cb68-370" aria-hidden="true" tabindex="-1"></a>    <span class="st">")"</span></span>
<span id="cb68-371"><a href="#cb68-371" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb68-372"><a href="#cb68-372" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-373"><a href="#cb68-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-374"><a href="#cb68-374" aria-hidden="true" tabindex="-1"></a>lim <span class="ot">&lt;-</span> <span class="fu">range</span>(<span class="fu">unlist</span>(res[<span class="fu">c</span>(<span class="st">"log2FoldChange.asis"</span>, <span class="st">"log2FoldChange.cfd"</span>)]))</span>
<span id="cb68-375"><a href="#cb68-375" aria-hidden="true" tabindex="-1"></a>gg_cor_lfc <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(res, <span class="fu">aes</span>(log2FoldChange.asis, log2FoldChange.cfd)) <span class="sc">+</span></span>
<span id="cb68-376"><a href="#cb68-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hex</span>() <span class="sc">+</span></span>
<span id="cb68-377"><a href="#cb68-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"F"</span>, <span class="at">begin =</span> .<span class="dv">1</span>, <span class="at">end =</span> .<span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb68-378"><a href="#cb68-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb68-379"><a href="#cb68-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb68-380"><a href="#cb68-380" aria-hidden="true" tabindex="-1"></a>    <span class="st">"label"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="dv">1</span>,</span>
<span id="cb68-381"><a href="#cb68-381" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">fun_label</span>(res),</span>
<span id="cb68-382"><a href="#cb68-382" aria-hidden="true" tabindex="-1"></a>    <span class="at">parse =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-383"><a href="#cb68-383" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"mono"</span>,</span>
<span id="cb68-384"><a href="#cb68-384" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb68-385"><a href="#cb68-385" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb68-386"><a href="#cb68-386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> lim, <span class="at">ylim =</span> lim) <span class="sc">+</span></span>
<span id="cb68-387"><a href="#cb68-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb68-388"><a href="#cb68-388" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Log Fold Change (LFC)"</span>,</span>
<span id="cb68-389"><a href="#cb68-389" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"With / Without Adjustment for Confounding Factors"</span>,</span>
<span id="cb68-390"><a href="#cb68-390" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"No Adjustment"</span>,</span>
<span id="cb68-391"><a href="#cb68-391" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Adjusted for Confounding Factors"</span></span>
<span id="cb68-392"><a href="#cb68-392" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb68-393"><a href="#cb68-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_fun</span>(<span class="at">asp =</span> <span class="dv">1</span>)</span>
<span id="cb68-394"><a href="#cb68-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-395"><a href="#cb68-395" aria-hidden="true" tabindex="-1"></a>lim <span class="ot">&lt;-</span> <span class="fu">range</span>(<span class="fu">unlist</span>(res[<span class="fu">c</span>(<span class="st">"log_padj.asis"</span>, <span class="st">"log_padj.cfd"</span>)]))</span>
<span id="cb68-396"><a href="#cb68-396" aria-hidden="true" tabindex="-1"></a>gg_cor_pval <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(res, <span class="fu">aes</span>(log_padj.asis, log_padj.cfd)) <span class="sc">+</span></span>
<span id="cb68-397"><a href="#cb68-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hex</span>() <span class="sc">+</span></span>
<span id="cb68-398"><a href="#cb68-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"D"</span>, <span class="at">begin =</span> .<span class="dv">1</span>, <span class="at">end =</span> .<span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb68-399"><a href="#cb68-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"green2"</span>) <span class="sc">+</span></span>
<span id="cb68-400"><a href="#cb68-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb68-401"><a href="#cb68-401" aria-hidden="true" tabindex="-1"></a>    <span class="st">"label"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="dv">1</span>,</span>
<span id="cb68-402"><a href="#cb68-402" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">fun_label</span>(res, <span class="st">"log_padj.asis"</span>, <span class="st">"log_padj.cfd"</span>),</span>
<span id="cb68-403"><a href="#cb68-403" aria-hidden="true" tabindex="-1"></a>    <span class="at">parse =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-404"><a href="#cb68-404" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"mono"</span>,</span>
<span id="cb68-405"><a href="#cb68-405" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb68-406"><a href="#cb68-406" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb68-407"><a href="#cb68-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> lim, <span class="at">ylim =</span> lim, <span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb68-408"><a href="#cb68-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb68-409"><a href="#cb68-409" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">expression</span>(<span class="st">"Significance: "</span><span class="sc">*-</span><span class="dv">1</span> <span class="sc">%.%</span> <span class="fu">log10</span>(padj)),</span>
<span id="cb68-410"><a href="#cb68-410" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"With / Without Adjustment for Confounding Factors"</span>,</span>
<span id="cb68-411"><a href="#cb68-411" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"No Adjustment"</span>,</span>
<span id="cb68-412"><a href="#cb68-412" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Adjusted for Confounding Factors"</span></span>
<span id="cb68-413"><a href="#cb68-413" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb68-414"><a href="#cb68-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_fun</span>(<span class="at">asp =</span> <span class="dv">1</span>)</span>
<span id="cb68-415"><a href="#cb68-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-416"><a href="#cb68-416" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb68-417"><a href="#cb68-417" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb68-418"><a href="#cb68-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_grid</span>(gg_1_2) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>)),</span>
<span id="cb68-419"><a href="#cb68-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_grid</span>(</span>
<span id="cb68-420"><a href="#cb68-420" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_grid</span>(gg_cor_lfc) <span class="sc">+</span></span>
<span id="cb68-421"><a href="#cb68-421" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>)),</span>
<span id="cb68-422"><a href="#cb68-422" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_grid</span>(gg_cor_pval) <span class="sc">+</span></span>
<span id="cb68-423"><a href="#cb68-423" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>)),</span>
<span id="cb68-424"><a href="#cb68-424" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"B"</span>, <span class="st">"C"</span>)</span>
<span id="cb68-425"><a href="#cb68-425" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb68-426"><a href="#cb68-426" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>),</span>
<span id="cb68-427"><a href="#cb68-427" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="cn">NA</span>)</span>
<span id="cb68-428"><a href="#cb68-428" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-429"><a href="#cb68-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-430"><a href="#cb68-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-431"><a href="#cb68-431" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">clean_slate</span>() <span class="sc">|&gt;</span></span>
<span id="cb68-432"><a href="#cb68-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header</span>(<span class="fu">c</span>(<span class="st">"FCA Collin"</span>, <span class="st">"UMB BESD"</span>), <span class="fu">c</span>(<span class="st">"Confidential"</span>, <span class="st">"Draft"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb68-433"><a href="#cb68-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_title</span>(</span>
<span id="cb68-434"><a href="#cb68-434" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb68-435"><a href="#cb68-435" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Figure 6.1"</span>,</span>
<span id="cb68-436"><a href="#cb68-436" aria-hidden="true" tabindex="-1"></a>      <span class="fu">strwrap</span>(</span>
<span id="cb68-437"><a href="#cb68-437" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Volcano plot - Level and significance of Differential Expression among</span></span>
<span id="cb68-438"><a href="#cb68-438" aria-hidden="true" tabindex="-1"></a><span class="st">        all miRNA at Baseline between T2D and NGT"</span>, <span class="at">width =</span> <span class="dv">80</span></span>
<span id="cb68-439"><a href="#cb68-439" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb68-440"><a href="#cb68-440" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Analysis Set: Full Analysis Set"</span></span>
<span id="cb68-441"><a href="#cb68-441" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb68-442"><a href="#cb68-442" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb68-443"><a href="#cb68-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_note</span>(<span class="fu">c</span>(</span>
<span id="cb68-444"><a href="#cb68-444" aria-hidden="true" tabindex="-1"></a>    <span class="st">"A: Left panel accounts for Age, BMI, DCAL (diet) and number of trainings in</span></span>
<span id="cb68-445"><a href="#cb68-445" aria-hidden="true" tabindex="-1"></a><span class="st">    the estimation and test of the differential expression of every gene; it</span></span>
<span id="cb68-446"><a href="#cb68-446" aria-hidden="true" tabindex="-1"></a><span class="st">    may present marginal differences with the version presented 2 years ago</span></span>
<span id="cb68-447"><a href="#cb68-447" aria-hidden="true" tabindex="-1"></a><span class="st">    likely due to slight variations in stochastic elements (e.g. missing</span></span>
<span id="cb68-448"><a href="#cb68-448" aria-hidden="true" tabindex="-1"></a><span class="st">    data imputation)."</span>,</span>
<span id="cb68-449"><a href="#cb68-449" aria-hidden="true" tabindex="-1"></a>    <span class="st">"A: Right panel discards any confounding factors."</span>,</span>
<span id="cb68-450"><a href="#cb68-450" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B, C: Scatter plots comparing</span></span>
<span id="cb68-451"><a href="#cb68-451" aria-hidden="true" tabindex="-1"></a><span class="st">    the Log Fold Change estimations (B)/</span></span>
<span id="cb68-452"><a href="#cb68-452" aria-hidden="true" tabindex="-1"></a><span class="st">    the significance (C, the higher the more significant)</span></span>
<span id="cb68-453"><a href="#cb68-453" aria-hidden="true" tabindex="-1"></a><span class="st">    with (y axis) without (x axis) adjustment for confounding factors with</span></span>
<span id="cb68-454"><a href="#cb68-454" aria-hidden="true" tabindex="-1"></a><span class="st">    annotation corresponding to the Pearson's correlation (r) and</span></span>
<span id="cb68-455"><a href="#cb68-455" aria-hidden="true" tabindex="-1"></a><span class="st">    Spearman's rank correlation (rho)."</span>,</span>
<span id="cb68-456"><a href="#cb68-456" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Hexbin representation: the intensity of each hexagonal bin accounts for</span></span>
<span id="cb68-457"><a href="#cb68-457" aria-hidden="true" tabindex="-1"></a><span class="st">    the number of genes found in the area it covers."</span></span>
<span id="cb68-458"><a href="#cb68-458" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb68-459"><a href="#cb68-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_figure</span>(p, <span class="at">height =</span> .<span class="dv">9</span>) <span class="sc">|&gt;</span></span>
<span id="cb68-460"><a href="#cb68-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_footer</span>(</span>
<span id="cb68-461"><a href="#cb68-461" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Program t2d_06_rna / Env ayup_dbs:v0.1.0-alpha"</span>,</span>
<span id="cb68-462"><a href="#cb68-462" aria-hidden="true" tabindex="-1"></a>    params<span class="sc">$</span>version</span>
<span id="cb68-463"><a href="#cb68-463" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb68-464"><a href="#cb68-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-465"><a href="#cb68-465" aria-hidden="true" tabindex="-1"></a><span class="fu">export_as</span>(</span>
<span id="cb68-466"><a href="#cb68-466" aria-hidden="true" tabindex="-1"></a>  p,</span>
<span id="cb68-467"><a href="#cb68-467" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="fu">file.path</span>(params<span class="sc">$</span>paths<span class="sc">$</span>grh, <span class="st">"fig_06_01.pdf"</span>),</span>
<span id="cb68-468"><a href="#cb68-468" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_graph_alone =</span> <span class="fu">file.path</span>(params<span class="sc">$</span>paths<span class="sc">$</span>grh, <span class="st">"fig_06_01_af.pdf"</span>)</span>
<span id="cb68-469"><a href="#cb68-469" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-470"><a href="#cb68-470" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-471"><a href="#cb68-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-472"><a href="#cb68-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-473"><a href="#cb68-473" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, graph_comp_render, eval=params$knitr$results!="hide"}</span></span>
<span id="cb68-474"><a href="#cb68-474" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8.3</span></span>
<span id="cb68-475"><a href="#cb68-475" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 11.7</span></span>
<span id="cb68-476"><a href="#cb68-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-477"><a href="#cb68-477" aria-hidden="true" tabindex="-1"></a><span class="fu">show_slate</span>(p)</span>
<span id="cb68-478"><a href="#cb68-478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-479"><a href="#cb68-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-480"><a href="#cb68-480" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session Informations</span></span>
<span id="cb68-481"><a href="#cb68-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-484"><a href="#cb68-484" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb68-485"><a href="#cb68-485" aria-hidden="true" tabindex="-1"></a>sessioninfo<span class="sc">::</span><span class="fu">session_info</span>()</span>
<span id="cb68-486"><a href="#cb68-486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
      <div class="nav-footer-center">Copyright 2022, FCA Collin, Ph.D.</div>
  </div>
</footer>


</body></html>